
<!DOCTYPE html>


<html lang="ja" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>お知らせ &#8212; Groonga v13.0.2ドキュメント</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/translations.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'news';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://groonga.org/docs/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'japanese';
        </script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://groonga.org/ja/">
  
  
  
  
    
    
      
    
    
    <img src="_static/groonga.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/groonga.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      japanese  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      japanese  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">お知らせ</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="news">
<h1>お知らせ<a class="headerlink" href="#news" title="この見出しへのパーマリンク">#</a></h1>
<section id="release-13-0-2-2023-07-12">
<span id="release-13-0-2"></span><h2>13.0.2リリース - 2023-07-12<a class="headerlink" href="#release-13-0-2-2023-07-12" title="この見出しへのパーマリンク">#</a></h2>
<section id="improvements">
<h3>改良<a class="headerlink" href="#improvements" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 18.04（Bionic Beaver）のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 23.04（Lunar Lobster）をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 12 (bookworm) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/oracle-linux.html"><span class="doc">Oracle Linux</span></a>] Oracle Linuxサポートをやめました。代わりに <a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a> 用パッケージを使ってください。</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">grn_highlighter</span></code>] タグの変更をサポートしました。</p>
<p>[<a class="reference external" href="https://github.com/groonga/groonga/issues/1453">GH-1453</a>] [askdkcさんが報告]</p>
</li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">grn_highlighter</span></code>] ノーマライザーの変更をサポートしました。</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">grn_highlighter</span></code>] HTMLモードの変更をサポートしました。</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">grn_highlighter</span></code>] 複数タグをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/highlight.html"><span class="doc">highlight</span></a>] <code class="docutils literal notranslate"><span class="pre">sequential_class_tag_mode</span></code> オプションを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] <code class="docutils literal notranslate"><span class="pre">sequential_class_tag_mode</span></code> オプションを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> が使われたときに対象オブジェクト用のインデックスカラムも参照するように変更しました。</p>
<p>対象オブジェクトがカラムの場合、そのカラム用のインデックスカラムも参照されます。</p>
<p>対象オブジェクトがテーブルの場合、そのテーブル用のインデックスカラムも参照されます。</p>
<p>対象オブジェクトがDBの場合、すべてのテーブルが対象オブジェクトになります。</p>
</li>
<li><p>[CMake] CMake 3.16以降を必須としました。近い将来、GNU AutotoolsではなくCMakeを推奨ビルドツールとし、いずれGNU Autotoolsサポートをやめる予定です。</p></li>
<li><p>[CMake] CMakeパッケージに対応しました。 <code class="docutils literal notranslate"><span class="pre">find_package(Groonga)</span></code> というように使えます。</p></li>
<li><p>[Packaging] ソースアーカイブ中の <code class="docutils literal notranslate"><span class="pre">configure</span></code> を生成しているGNU Autotoolsを更新しました。</p>
<p>[<a class="reference external" href="https://github.com/ranguba/rroonga/issues/220">ranguba/rroonga#220</a>] [ZangRuochenさんが報告]</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] 組み込みオブジェクト用のリファレンスカウント実装を最適化しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SIGABRT</span></code> 発生時もバックトレースのログ出力するようにしました。</p></li>
</ul>
</section>
<section id="fixes">
<h3>修正<a class="headerlink" href="#fixes" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-ordered-near-phrase-product-search-condition"><span class="std std-ref">順序付き近傍フレーズ直積検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-ordered-near-phrase-product-search-operator"><span class="std std-ref">順序付き近傍フレーズ直積検索演算子</span></a>] マッチするべきレコードがマッチしないことがある問題を修正しました。</p>
<p>この問題は、クエリー内に3つ以上トークンがあり、かつ、それらがオーバーラップしているときに発生します。たとえば、 <code class="docutils literal notranslate"><span class="pre">abc</span></code> と <code class="docutils literal notranslate"><span class="pre">abcd</span></code> はうまく動かない組み合わせです。もし、短い方（ <code class="docutils literal notranslate"><span class="pre">abc</span></code> ）が長い方（ <code class="docutils literal notranslate"><span class="pre">abcd</span></code> ）より前にある場合はこの問題は発生しません。たとえば、 <code class="docutils literal notranslate"><span class="pre">ONPP1</span> <span class="pre">&quot;(abcd</span> <span class="pre">abc)</span> <span class="pre">(1</span> <span class="pre">2)&quot;</span></code> は動きますが、 <code class="docutils literal notranslate"><span class="pre">ONPP1</span> <span class="pre">&quot;(abc</span> <span class="pre">abcd)</span> <span class="pre">(1</span> <span class="pre">2)&quot;</span></code> は動きません。</p>
</li>
<li><p>複数の重み調整演算子を使った場合、不正な重みが使われることがある問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html"><span class="doc">クエリー構文</span></a>] 誤字を修正しました。</p>
<p>[<a class="reference external" href="https://github.com/groonga/groonga/issues/1560">GH-1560</a>] [Dylan Golowさんがパッチ提供]</p>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-phrase-search-condition"><span class="std std-ref">近傍フレーズ検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-near-phrase-search-operator"><span class="std std-ref">近傍フレーズ検索演算子</span></a>] [<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-phrase-product-search-condition"><span class="std std-ref">近傍フレーズ直積検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-near-phrase-product-search-operator"><span class="std std-ref">近傍フレーズ直積検索演算子</span></a>] [<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-ordered-near-phrase-search-condition"><span class="std std-ref">順序付き近傍フレーズ検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-ordered-near-phrase-search-operator"><span class="std std-ref">順序付き近傍フレーズ検索演算子</span></a>] [<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-ordered-near-phrase-product-search-condition"><span class="std std-ref">順序付き近傍フレーズ直積検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-ordered-near-phrase-product-search-operator"><span class="std std-ref">順序付き近傍フレーズ直積検索演算子</span></a>] <code class="docutils literal notranslate"><span class="pre">additional_last_interval</span></code> を使っている場合、距離の計算が間違っている問題を修正しました。</p>
<p>たとえば、 <code class="docutils literal notranslate"><span class="pre">aaaxxxbbbcdefghi.</span></code> に対して <code class="docutils literal notranslate"><span class="pre">*NP3,-1&quot;aaa</span> <span class="pre">bbb</span> <span class="pre">.$&quot;</span></code> で検索するケースを考えます。このケースでは <code class="docutils literal notranslate"><span class="pre">aaa</span></code> と <code class="docutils literal notranslate"><span class="pre">bbb</span></code> の間のトークン数は3であるべきですが7になっていました。</p>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-phrase-product-search-condition"><span class="std std-ref">近傍フレーズ直積検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-near-phrase-product-search-operator"><span class="std std-ref">近傍フレーズ直積検索演算子</span></a>] [<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-ordered-near-phrase-product-search-condition"><span class="std std-ref">順序付き近傍フレーズ直積検索条件</span></a>] [<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-ordered-near-phrase-product-search-operator"><span class="std std-ref">順序付き近傍フレーズ直積検索演算子</span></a>] 同じフレーズグループ内に同じフレーズが存在するときに無限ループする問題を修正しました。</p>
<p>たとえば、 <code class="docutils literal notranslate"><span class="pre">*NPP1</span> <span class="pre">&quot;(abcd</span> <span class="pre">abc</span> <span class="pre">abcd</span> <span class="pre">bcde)</span> <span class="pre">(efghi)&quot;</span></code> は問題が発生するクエリーです。なぜなら最初のフレーズグループ内に2つ <code class="docutils literal notranslate"><span class="pre">abcd</span></code> が存在するからです。</p>
<p>たとえば、 <code class="docutils literal notranslate"><span class="pre">*NPP1</span> <span class="pre">&quot;(abcde</span> <span class="pre">\&quot;abc</span> <span class="pre">de\&quot;)</span> <span class="pre">(efghi)&quot;</span></code> は問題が発生するクエリーです。なぜなら最初のフレーズグループ内に <code class="docutils literal notranslate"><span class="pre">abcde</span></code> と <code class="docutils literal notranslate"><span class="pre">&quot;abc</span> <span class="pre">de&quot;</span></code> が存在するからです。これらは「論理的に」同じフレーズです。</p>
</li>
<li><p>ロック獲得に失敗した場合に内部のロックカウントを減らしていない問題を修正しました。通常はこれが問題になることはありません。</p></li>
</ul>
</section>
<section id="thanks">
<h3>感謝<a class="headerlink" href="#thanks" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>askdkcさん</p></li>
<li><p>Dylan Golowさん</p></li>
<li><p>ZangRuochenさん</p></li>
</ul>
</section>
</section>
<section id="release-13-0-1-2023-03-24">
<span id="release-13-0-1"></span><h2>13.0.1リリース - 2023-03-24<a class="headerlink" href="#release-13-0-1-2023-03-24" title="この見出しへのパーマリンク">#</a></h2>
<section id="id1">
<h3>改良<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] 前方一致検索をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">highlight_html</span></code> で前方一致検索ができるようになりました。</p>
<p>ただし、ハイライトするキーワードは、最初の出現箇所だけでなく、途中および最後の出現箇所もハイライトされます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150&#39;</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">tags_name</span> <span class="n">COLUMN_INDEX</span> <span class="n">Tags</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tags</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Tags</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;name:^g&quot;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;highlight_html(name)&quot;</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    0.0,</span>
<span class="c1">#    0.0</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        1</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;highlight_html&quot;,</span>
<span class="c1">#          null</span>
<span class="c1">#        ]</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        &quot;&lt;span class=\&quot;keyword\&quot;&gt;G&lt;/span&gt;roon&lt;span class=\&quot;keyword\&quot;&gt;g&lt;/span&gt;a&quot;</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC*</span></code> に新しいオプションを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_prolonged_sound_mark</span></code></p>
<p>このオプションによって、長音記号を以下のように正規化できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ァー</span> <span class="o">-&gt;</span> <span class="n">ァア</span><span class="p">,</span> <span class="n">アー</span> <span class="o">-&gt;</span> <span class="n">アア</span><span class="p">,</span> <span class="n">ヵー</span> <span class="o">-&gt;</span> <span class="n">ヵア</span><span class="p">,</span> <span class="n">カー</span> <span class="o">-&gt;</span> <span class="n">カア</span><span class="p">,</span> <span class="n">ガー</span> <span class="o">-&gt;</span> <span class="n">ガア</span><span class="p">,</span> <span class="n">サー</span> <span class="o">-&gt;</span> <span class="n">サア</span><span class="p">,</span> <span class="n">ザー</span> <span class="o">-&gt;</span> <span class="n">ザア</span><span class="p">,</span>
<span class="n">ター</span> <span class="o">-&gt;</span> <span class="n">タア</span><span class="p">,</span> <span class="n">ダー</span> <span class="o">-&gt;</span> <span class="n">ダア</span><span class="p">,</span> <span class="n">ナー</span> <span class="o">-&gt;</span> <span class="n">ナア</span><span class="p">,</span> <span class="n">ハー</span> <span class="o">-&gt;</span> <span class="n">ハア</span><span class="p">,</span> <span class="n">バー</span> <span class="o">-&gt;</span> <span class="n">バア</span><span class="p">,</span> <span class="n">パー</span> <span class="o">-&gt;</span> <span class="n">パア</span><span class="p">,</span> <span class="n">マー</span> <span class="o">-&gt;</span> <span class="n">マア</span><span class="p">,</span>
<span class="n">ャー</span> <span class="o">-&gt;</span> <span class="n">ャア</span><span class="p">,</span> <span class="n">ヤー</span> <span class="o">-&gt;</span> <span class="n">ヤア</span><span class="p">,</span> <span class="n">ラー</span> <span class="o">-&gt;</span> <span class="n">ラア</span><span class="p">,</span> <span class="n">ヮー</span> <span class="o">-&gt;</span> <span class="n">ヮア</span><span class="p">,</span> <span class="n">ワー</span> <span class="o">-&gt;</span> <span class="n">ワア</span><span class="p">,</span> <span class="n">ヷー</span> <span class="o">-&gt;</span> <span class="n">ヷア</span><span class="p">,</span>

<span class="n">ィー</span> <span class="o">-&gt;</span> <span class="n">ィイ</span><span class="p">,</span> <span class="n">イー</span> <span class="o">-&gt;</span> <span class="n">イイ</span><span class="p">,</span> <span class="n">キー</span> <span class="o">-&gt;</span> <span class="n">キイ</span><span class="p">,</span> <span class="n">ギー</span> <span class="o">-&gt;</span> <span class="n">ギイ</span><span class="p">,</span> <span class="n">シー</span> <span class="o">-&gt;</span> <span class="n">シイ</span><span class="p">,</span> <span class="n">ジー</span> <span class="o">-&gt;</span> <span class="n">ジイ</span><span class="p">,</span> <span class="n">チー</span> <span class="o">-&gt;</span> <span class="n">チイ</span><span class="p">,</span>
<span class="n">ヂー</span> <span class="o">-&gt;</span> <span class="n">ヂイ</span><span class="p">,</span> <span class="n">ニー</span> <span class="o">-&gt;</span> <span class="n">ニイ</span><span class="p">,</span> <span class="n">ヒー</span> <span class="o">-&gt;</span> <span class="n">ヒイ</span><span class="p">,</span> <span class="n">ビー</span> <span class="o">-&gt;</span> <span class="n">ビイ</span><span class="p">,</span> <span class="n">ピー</span> <span class="o">-&gt;</span> <span class="n">ピイ</span><span class="p">,</span> <span class="n">ミー</span> <span class="o">-&gt;</span> <span class="n">ミイ</span><span class="p">,</span> <span class="n">リー</span> <span class="o">-&gt;</span> <span class="n">リイ</span><span class="p">,</span>
<span class="n">ヰー</span> <span class="o">-&gt;</span> <span class="n">ヰイ</span><span class="p">,</span> <span class="n">ヸー</span> <span class="o">-&gt;</span> <span class="n">ヸイ</span><span class="p">,</span>

<span class="n">ゥー</span> <span class="o">-&gt;</span> <span class="n">ゥウ</span><span class="p">,</span> <span class="n">ウー</span> <span class="o">-&gt;</span> <span class="n">ウウ</span><span class="p">,</span> <span class="n">クー</span> <span class="o">-&gt;</span> <span class="n">クウ</span><span class="p">,</span> <span class="n">グー</span> <span class="o">-&gt;</span> <span class="n">グウ</span><span class="p">,</span> <span class="n">スー</span> <span class="o">-&gt;</span> <span class="n">スウ</span><span class="p">,</span> <span class="n">ズー</span> <span class="o">-&gt;</span> <span class="n">ズウ</span><span class="p">,</span> <span class="n">ツー</span> <span class="o">-&gt;</span> <span class="n">ツウ</span><span class="p">,</span>
<span class="n">ヅー</span> <span class="o">-&gt;</span> <span class="n">ヅウ</span><span class="p">,</span> <span class="n">ヌー</span> <span class="o">-&gt;</span> <span class="n">ヌウ</span><span class="p">,</span> <span class="n">フー</span> <span class="o">-&gt;</span> <span class="n">フウ</span><span class="p">,</span> <span class="n">ブー</span> <span class="o">-&gt;</span> <span class="n">ブウ</span><span class="p">,</span> <span class="n">プー</span> <span class="o">-&gt;</span> <span class="n">プウ</span><span class="p">,</span> <span class="n">ムー</span> <span class="o">-&gt;</span> <span class="n">ムウ</span><span class="p">,</span> <span class="n">ュー</span> <span class="o">-&gt;</span> <span class="n">ュウ</span><span class="p">,</span>
<span class="n">ユー</span> <span class="o">-&gt;</span> <span class="n">ユウ</span><span class="p">,</span> <span class="n">ルー</span> <span class="o">-&gt;</span> <span class="n">ルウ</span><span class="p">,</span> <span class="n">ヱー</span> <span class="o">-&gt;</span> <span class="n">ヱウ</span><span class="p">,</span> <span class="n">ヴー</span> <span class="o">-&gt;</span> <span class="n">ヴウ</span><span class="p">,</span>

<span class="n">ェー</span> <span class="o">-&gt;</span> <span class="n">ェエ</span><span class="p">,</span> <span class="n">エー</span> <span class="o">-&gt;</span> <span class="n">エエ</span><span class="p">,</span> <span class="n">ヶー</span> <span class="o">-&gt;</span> <span class="n">ヶエ</span><span class="p">,</span> <span class="n">ケー</span> <span class="o">-&gt;</span> <span class="n">ケエ</span><span class="p">,</span> <span class="n">ゲー</span> <span class="o">-&gt;</span> <span class="n">ゲエ</span><span class="p">,</span> <span class="n">セー</span> <span class="o">-&gt;</span> <span class="n">セエ</span><span class="p">,</span> <span class="n">ゼー</span> <span class="o">-&gt;</span> <span class="n">ゼエ</span><span class="p">,</span>
<span class="n">テー</span> <span class="o">-&gt;</span> <span class="n">テエ</span><span class="p">,</span> <span class="n">デー</span> <span class="o">-&gt;</span> <span class="n">デエ</span><span class="p">,</span> <span class="n">ネー</span> <span class="o">-&gt;</span> <span class="n">ネエ</span><span class="p">,</span> <span class="n">ヘー</span> <span class="o">-&gt;</span> <span class="n">ヘエ</span><span class="p">,</span> <span class="n">ベー</span> <span class="o">-&gt;</span> <span class="n">ベエ</span><span class="p">,</span> <span class="n">ペー</span> <span class="o">-&gt;</span> <span class="n">ペエ</span><span class="p">,</span> <span class="n">メー</span> <span class="o">-&gt;</span> <span class="n">メエ</span><span class="p">,</span>
<span class="n">レー</span> <span class="o">-&gt;</span> <span class="n">レエ</span><span class="p">,</span> <span class="n">ヹー</span> <span class="o">-&gt;</span> <span class="n">ヹエ</span><span class="p">,</span>

<span class="n">ォー</span> <span class="o">-&gt;</span> <span class="n">ォオ</span><span class="p">,</span> <span class="n">オー</span> <span class="o">-&gt;</span> <span class="n">オオ</span><span class="p">,</span> <span class="n">コー</span> <span class="o">-&gt;</span> <span class="n">コオ</span><span class="p">,</span> <span class="n">ゴー</span> <span class="o">-&gt;</span> <span class="n">ゴオ</span><span class="p">,</span> <span class="n">ソー</span> <span class="o">-&gt;</span> <span class="n">ソオ</span><span class="p">,</span> <span class="n">ゾー</span> <span class="o">-&gt;</span> <span class="n">ゾオ</span><span class="p">,</span> <span class="n">トー</span> <span class="o">-&gt;</span> <span class="n">トオ</span><span class="p">,</span>
<span class="n">ドー</span> <span class="o">-&gt;</span> <span class="n">ドオ</span><span class="p">,</span> <span class="n">ノー</span> <span class="o">-&gt;</span> <span class="n">ノオ</span><span class="p">,</span> <span class="n">ホー</span> <span class="o">-&gt;</span> <span class="n">ホオ</span><span class="p">,</span> <span class="n">ボー</span> <span class="o">-&gt;</span> <span class="n">ボオ</span><span class="p">,</span> <span class="n">ポー</span> <span class="o">-&gt;</span> <span class="n">ポオ</span><span class="p">,</span> <span class="n">モー</span> <span class="o">-&gt;</span> <span class="n">モオ</span><span class="p">,</span> <span class="n">ョー</span> <span class="o">-&gt;</span> <span class="n">ョオ</span><span class="p">,</span>
<span class="n">ヨー</span> <span class="o">-&gt;</span> <span class="n">ヨオ</span><span class="p">,</span> <span class="n">ロー</span> <span class="o">-&gt;</span> <span class="n">ロオ</span><span class="p">,</span> <span class="n">ヲー</span> <span class="o">-&gt;</span> <span class="n">ヲオ</span><span class="p">,</span> <span class="n">ヺー</span> <span class="o">-&gt;</span> <span class="n">ヺオ</span><span class="p">,</span>

<span class="n">ンー</span> <span class="o">-&gt;</span> <span class="n">ンン</span>

<span class="n">ぁー</span> <span class="o">-&gt;</span> <span class="n">ぁあ</span><span class="p">,</span> <span class="n">あー</span> <span class="o">-&gt;</span> <span class="n">ああ</span><span class="p">,</span> <span class="n">ゕー</span> <span class="o">-&gt;</span> <span class="n">ゕあ</span><span class="p">,</span> <span class="n">かー</span> <span class="o">-&gt;</span> <span class="n">かあ</span><span class="p">,</span> <span class="n">がー</span> <span class="o">-&gt;</span> <span class="n">があ</span><span class="p">,</span> <span class="n">さー</span> <span class="o">-&gt;</span> <span class="n">さあ</span><span class="p">,</span> <span class="n">ざー</span> <span class="o">-&gt;</span> <span class="n">ざあ</span><span class="p">,</span>
<span class="n">たー</span> <span class="o">-&gt;</span> <span class="n">たあ</span><span class="p">,</span> <span class="n">だー</span> <span class="o">-&gt;</span> <span class="n">だあ</span><span class="p">,</span> <span class="n">なー</span> <span class="o">-&gt;</span> <span class="n">なあ</span><span class="p">,</span> <span class="n">はー</span> <span class="o">-&gt;</span> <span class="n">はあ</span><span class="p">,</span> <span class="n">ばー</span> <span class="o">-&gt;</span> <span class="n">ばあ</span><span class="p">,</span> <span class="n">ぱー</span> <span class="o">-&gt;</span> <span class="n">ぱあ</span><span class="p">,</span> <span class="n">まー</span> <span class="o">-&gt;</span> <span class="n">まあ</span><span class="p">,</span>
<span class="n">ゃー</span> <span class="o">-&gt;</span> <span class="n">ゃあ</span><span class="p">,</span> <span class="n">やー</span> <span class="o">-&gt;</span> <span class="n">やあ</span><span class="p">,</span> <span class="n">らー</span> <span class="o">-&gt;</span> <span class="n">らあ</span><span class="p">,</span> <span class="n">ゎー</span> <span class="o">-&gt;</span> <span class="n">ゎあ</span><span class="p">,</span> <span class="n">わー</span> <span class="o">-&gt;</span> <span class="n">わあ</span>

<span class="n">ぃー</span> <span class="o">-&gt;</span> <span class="n">ぃい</span><span class="p">,</span> <span class="n">いー</span> <span class="o">-&gt;</span> <span class="n">いい</span><span class="p">,</span> <span class="n">きー</span> <span class="o">-&gt;</span> <span class="n">きい</span><span class="p">,</span> <span class="n">ぎー</span> <span class="o">-&gt;</span> <span class="n">ぎい</span><span class="p">,</span> <span class="n">しー</span> <span class="o">-&gt;</span> <span class="n">しい</span><span class="p">,</span> <span class="n">じー</span> <span class="o">-&gt;</span> <span class="n">じい</span><span class="p">,</span> <span class="n">ちー</span> <span class="o">-&gt;</span> <span class="n">ちい</span><span class="p">,</span>
<span class="n">ぢー</span> <span class="o">-&gt;</span> <span class="n">ぢい</span><span class="p">,</span> <span class="n">にー</span> <span class="o">-&gt;</span> <span class="n">にい</span><span class="p">,</span> <span class="n">ひー</span> <span class="o">-&gt;</span> <span class="n">ひい</span><span class="p">,</span> <span class="n">びー</span> <span class="o">-&gt;</span> <span class="n">びい</span><span class="p">,</span> <span class="n">ぴー</span> <span class="o">-&gt;</span> <span class="n">ぴい</span><span class="p">,</span> <span class="n">みー</span> <span class="o">-&gt;</span> <span class="n">みい</span><span class="p">,</span> <span class="n">りー</span> <span class="o">-&gt;</span> <span class="n">りい</span><span class="p">,</span>
<span class="n">ゐー</span> <span class="o">-&gt;</span> <span class="n">ゐい</span>

<span class="n">ぅー</span> <span class="o">-&gt;</span> <span class="n">ぅう</span><span class="p">,</span> <span class="n">うー</span> <span class="o">-&gt;</span> <span class="n">うう</span><span class="p">,</span> <span class="n">くー</span> <span class="o">-&gt;</span> <span class="n">くう</span><span class="p">,</span> <span class="n">ぐー</span> <span class="o">-&gt;</span> <span class="n">ぐう</span><span class="p">,</span> <span class="n">すー</span> <span class="o">-&gt;</span> <span class="n">すう</span><span class="p">,</span> <span class="n">ずー</span> <span class="o">-&gt;</span> <span class="n">ずう</span><span class="p">,</span> <span class="n">つー</span> <span class="o">-&gt;</span> <span class="n">つう</span><span class="p">,</span>
<span class="n">づー</span> <span class="o">-&gt;</span> <span class="n">づう</span><span class="p">,</span> <span class="n">ぬー</span> <span class="o">-&gt;</span> <span class="n">ぬう</span><span class="p">,</span> <span class="n">ふー</span> <span class="o">-&gt;</span> <span class="n">ふう</span><span class="p">,</span> <span class="n">ぶー</span> <span class="o">-&gt;</span> <span class="n">ぶう</span><span class="p">,</span> <span class="n">ぷー</span> <span class="o">-&gt;</span> <span class="n">ぷう</span><span class="p">,</span> <span class="n">むー</span> <span class="o">-&gt;</span> <span class="n">むう</span><span class="p">,</span> <span class="n">ゅー</span> <span class="o">-&gt;</span> <span class="n">ゅう</span><span class="p">,</span>
<span class="n">ゆー</span> <span class="o">-&gt;</span> <span class="n">ゆう</span><span class="p">,</span> <span class="n">るー</span> <span class="o">-&gt;</span> <span class="n">るう</span><span class="p">,</span> <span class="n">ゑー</span> <span class="o">-&gt;</span> <span class="n">ゑう</span><span class="p">,</span> <span class="n">ゔー</span> <span class="o">-&gt;</span> <span class="n">ゔう</span>

<span class="n">ぇー</span> <span class="o">-&gt;</span> <span class="n">ぇえ</span><span class="p">,</span> <span class="n">えー</span> <span class="o">-&gt;</span> <span class="n">ええ</span><span class="p">,</span> <span class="n">ゖー</span> <span class="o">-&gt;</span> <span class="n">ゖえ</span><span class="p">,</span> <span class="n">けー</span> <span class="o">-&gt;</span> <span class="n">けえ</span><span class="p">,</span> <span class="n">げー</span> <span class="o">-&gt;</span> <span class="n">げえ</span><span class="p">,</span> <span class="n">せー</span> <span class="o">-&gt;</span> <span class="n">せえ</span><span class="p">,</span> <span class="n">ぜー</span> <span class="o">-&gt;</span> <span class="n">ぜえ</span><span class="p">,</span>
<span class="n">てー</span> <span class="o">-&gt;</span> <span class="n">てえ</span><span class="p">,</span> <span class="n">でー</span> <span class="o">-&gt;</span> <span class="n">でえ</span><span class="p">,</span> <span class="n">ねー</span> <span class="o">-&gt;</span> <span class="n">ねえ</span><span class="p">,</span> <span class="n">へー</span> <span class="o">-&gt;</span> <span class="n">へえ</span><span class="p">,</span> <span class="n">べー</span> <span class="o">-&gt;</span> <span class="n">べえ</span><span class="p">,</span> <span class="n">ぺー</span> <span class="o">-&gt;</span> <span class="n">ぺえ</span><span class="p">,</span> <span class="n">めー</span> <span class="o">-&gt;</span> <span class="n">めえ</span><span class="p">,</span>
<span class="n">れー</span> <span class="o">-&gt;</span> <span class="n">れえ</span>

<span class="n">ぉー</span> <span class="o">-&gt;</span> <span class="n">ぉお</span><span class="p">,</span> <span class="n">おー</span> <span class="o">-&gt;</span> <span class="n">おお</span><span class="p">,</span> <span class="n">こー</span> <span class="o">-&gt;</span> <span class="n">こお</span><span class="p">,</span> <span class="n">ごー</span> <span class="o">-&gt;</span> <span class="n">ごお</span><span class="p">,</span> <span class="n">そー</span> <span class="o">-&gt;</span> <span class="n">そお</span><span class="p">,</span> <span class="n">ぞー</span> <span class="o">-&gt;</span> <span class="n">ぞお</span><span class="p">,</span> <span class="n">とー</span> <span class="o">-&gt;</span> <span class="n">とお</span><span class="p">,</span>
<span class="n">どー</span> <span class="o">-&gt;</span> <span class="n">どお</span><span class="p">,</span> <span class="n">のー</span> <span class="o">-&gt;</span> <span class="n">のお</span><span class="p">,</span> <span class="n">ほー</span> <span class="o">-&gt;</span> <span class="n">ほお</span><span class="p">,</span> <span class="n">ぼー</span> <span class="o">-&gt;</span> <span class="n">ぼお</span><span class="p">,</span> <span class="n">ぽー</span> <span class="o">-&gt;</span> <span class="n">ぽお</span><span class="p">,</span> <span class="n">もー</span> <span class="o">-&gt;</span> <span class="n">もお</span><span class="p">,</span> <span class="n">ょー</span> <span class="o">-&gt;</span> <span class="n">ょお</span><span class="p">,</span>
<span class="n">よー</span> <span class="o">-&gt;</span> <span class="n">よお</span><span class="p">,</span> <span class="n">ろー</span> <span class="o">-&gt;</span> <span class="n">ろお</span><span class="p">,</span> <span class="n">をー</span> <span class="o">-&gt;</span> <span class="n">をお</span>

<span class="n">んー</span> <span class="o">-&gt;</span> <span class="n">んん</span>
</pre></div>
</div>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_kana_prolonged_sound_mark</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">name</span> <span class="n">sound</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;羊&quot;</span><span class="p">,</span> <span class="s2">&quot;sound&quot;</span><span class="p">:</span><span class="s2">&quot;メーメー&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_animals_sound</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_kana_prolonged_sound_mark&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_animals_sound</span> <span class="o">--</span><span class="n">name</span> <span class="n">animals_sound</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">source</span> <span class="n">sound</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">query</span> <span class="n">sound</span><span class="p">:</span><span class="nd">@メエメエ</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    1677829950.652696,</span>
<span class="c1">#    0.01971983909606934</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        1</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_id&quot;,</span>
<span class="c1">#          &quot;UInt32&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_key&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;name&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;sound&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ]</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;1&quot;,</span>
<span class="c1">#        &quot;羊&quot;,</span>
<span class="c1">#        &quot;メーメー&quot;</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_hyphen</span></code></p>
<p>このオプションを使うことで、ハイフンを以下のように正規化できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ァ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ァア</span><span class="p">,</span> <span class="n">ア</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">アア</span><span class="p">,</span> <span class="n">ヵ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヵア</span><span class="p">,</span> <span class="n">カ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">カア</span><span class="p">,</span> <span class="n">ガ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ガア</span><span class="p">,</span> <span class="n">サ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">サア</span><span class="p">,</span> <span class="n">ザ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ザア</span><span class="p">,</span>
<span class="n">タ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">タア</span><span class="p">,</span> <span class="n">ダ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ダア</span><span class="p">,</span> <span class="n">ナ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ナア</span><span class="p">,</span> <span class="n">ハ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ハア</span><span class="p">,</span> <span class="n">バ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">バア</span><span class="p">,</span> <span class="n">パ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">パア</span><span class="p">,</span> <span class="n">マ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">マア</span><span class="p">,</span>
<span class="n">ャ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ャア</span><span class="p">,</span> <span class="n">ヤ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヤア</span><span class="p">,</span> <span class="n">ラ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ラア</span><span class="p">,</span> <span class="n">ヮ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヮア</span><span class="p">,</span> <span class="n">ワ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ワア</span><span class="p">,</span> <span class="n">ヷ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヷア</span><span class="p">,</span>

<span class="n">ィ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ィイ</span><span class="p">,</span> <span class="n">イ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">イイ</span><span class="p">,</span> <span class="n">キ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">キイ</span><span class="p">,</span> <span class="n">ギ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ギイ</span><span class="p">,</span> <span class="n">シ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">シイ</span><span class="p">,</span> <span class="n">ジ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ジイ</span><span class="p">,</span> <span class="n">チ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">チイ</span><span class="p">,</span>
<span class="n">ヂ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヂイ</span><span class="p">,</span> <span class="n">ニ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ニイ</span><span class="p">,</span> <span class="n">ヒ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヒイ</span><span class="p">,</span> <span class="n">ビ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ビイ</span><span class="p">,</span> <span class="n">ピ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ピイ</span><span class="p">,</span> <span class="n">ミ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ミイ</span><span class="p">,</span> <span class="n">リ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">リイ</span><span class="p">,</span>
<span class="n">ヰ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヰイ</span><span class="p">,</span> <span class="n">ヸ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヸイ</span><span class="p">,</span>

<span class="n">ゥ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゥウ</span><span class="p">,</span> <span class="n">ウ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ウウ</span><span class="p">,</span> <span class="n">ク</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">クウ</span><span class="p">,</span> <span class="n">グ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">グウ</span><span class="p">,</span> <span class="n">ス</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">スウ</span><span class="p">,</span> <span class="n">ズ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ズウ</span><span class="p">,</span> <span class="n">ツ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ツウ</span><span class="p">,</span>
<span class="n">ヅ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヅウ</span><span class="p">,</span> <span class="n">ヌ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヌウ</span><span class="p">,</span> <span class="n">フ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">フウ</span><span class="p">,</span> <span class="n">ブ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ブウ</span><span class="p">,</span> <span class="n">プ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">プウ</span><span class="p">,</span> <span class="n">ム</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ムウ</span><span class="p">,</span> <span class="n">ュ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ュウ</span><span class="p">,</span>
<span class="n">ユ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ユウ</span><span class="p">,</span> <span class="n">ル</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ルウ</span><span class="p">,</span> <span class="n">ヱ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヱウ</span><span class="p">,</span> <span class="n">ヴ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヴウ</span><span class="p">,</span>

<span class="n">ェ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ェエ</span><span class="p">,</span> <span class="n">エ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">エエ</span><span class="p">,</span> <span class="n">ヶ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヶエ</span><span class="p">,</span> <span class="n">ケ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ケエ</span><span class="p">,</span> <span class="n">ゲ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゲエ</span><span class="p">,</span> <span class="n">セ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">セエ</span><span class="p">,</span> <span class="n">ゼ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゼエ</span><span class="p">,</span>
<span class="n">テ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">テエ</span><span class="p">,</span> <span class="n">デ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">デエ</span><span class="p">,</span> <span class="n">ネ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ネエ</span><span class="p">,</span> <span class="n">ヘ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヘエ</span><span class="p">,</span> <span class="n">ベ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ベエ</span><span class="p">,</span> <span class="n">ペ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ペエ</span><span class="p">,</span> <span class="n">メ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">メエ</span><span class="p">,</span>
<span class="n">レ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">レエ</span><span class="p">,</span> <span class="n">ヹ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヹエ</span><span class="p">,</span>

<span class="n">ォ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ォオ</span><span class="p">,</span> <span class="n">オ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">オオ</span><span class="p">,</span> <span class="n">コ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">コオ</span><span class="p">,</span> <span class="n">ゴ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゴオ</span><span class="p">,</span> <span class="n">ソ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ソオ</span><span class="p">,</span> <span class="n">ゾ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゾオ</span><span class="p">,</span> <span class="n">ト</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">トオ</span><span class="p">,</span>
<span class="n">ド</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ドオ</span><span class="p">,</span> <span class="n">ノ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ノオ</span><span class="p">,</span> <span class="n">ホ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ホオ</span><span class="p">,</span> <span class="n">ボ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ボオ</span><span class="p">,</span> <span class="n">ポ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ポオ</span><span class="p">,</span> <span class="n">モ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">モオ</span><span class="p">,</span> <span class="n">ョ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ョオ</span><span class="p">,</span>
<span class="n">ヨ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヨオ</span><span class="p">,</span> <span class="n">ロ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ロオ</span><span class="p">,</span> <span class="n">ヲ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヲオ</span><span class="p">,</span> <span class="n">ヺ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ヺオ</span><span class="p">,</span>

<span class="n">ン</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ンン</span>

<span class="n">ぁ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぁあ</span><span class="p">,</span> <span class="n">あ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ああ</span><span class="p">,</span> <span class="n">ゕ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゕあ</span><span class="p">,</span> <span class="n">か</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">かあ</span><span class="p">,</span> <span class="n">が</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">があ</span><span class="p">,</span> <span class="n">さ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">さあ</span><span class="p">,</span> <span class="n">ざ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ざあ</span><span class="p">,</span>
<span class="n">た</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">たあ</span><span class="p">,</span> <span class="n">だ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">だあ</span><span class="p">,</span> <span class="n">な</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">なあ</span><span class="p">,</span> <span class="n">は</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">はあ</span><span class="p">,</span> <span class="n">ば</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ばあ</span><span class="p">,</span> <span class="n">ぱ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぱあ</span><span class="p">,</span> <span class="n">ま</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">まあ</span><span class="p">,</span>
<span class="n">ゃ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゃあ</span><span class="p">,</span> <span class="n">や</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">やあ</span><span class="p">,</span> <span class="n">ら</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">らあ</span><span class="p">,</span> <span class="n">ゎ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゎあ</span><span class="p">,</span> <span class="n">わ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">わあ</span>

<span class="n">ぃ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぃい</span><span class="p">,</span> <span class="n">い</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">いい</span><span class="p">,</span> <span class="n">き</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">きい</span><span class="p">,</span> <span class="n">ぎ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぎい</span><span class="p">,</span> <span class="n">し</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">しい</span><span class="p">,</span> <span class="n">じ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">じい</span><span class="p">,</span> <span class="n">ち</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ちい</span><span class="p">,</span>
<span class="n">ぢ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぢい</span><span class="p">,</span> <span class="n">に</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">にい</span><span class="p">,</span> <span class="n">ひ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ひい</span><span class="p">,</span> <span class="n">び</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">びい</span><span class="p">,</span> <span class="n">ぴ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぴい</span><span class="p">,</span> <span class="n">み</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">みい</span><span class="p">,</span> <span class="n">り</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">りい</span><span class="p">,</span>
<span class="n">ゐ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゐい</span>

<span class="n">ぅ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぅう</span><span class="p">,</span> <span class="n">う</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">うう</span><span class="p">,</span> <span class="n">く</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">くう</span><span class="p">,</span> <span class="n">ぐ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぐう</span><span class="p">,</span> <span class="n">す</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">すう</span><span class="p">,</span> <span class="n">ず</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ずう</span><span class="p">,</span> <span class="n">つ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">つう</span><span class="p">,</span>
<span class="n">づ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">づう</span><span class="p">,</span> <span class="n">ぬ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぬう</span><span class="p">,</span> <span class="n">ふ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ふう</span><span class="p">,</span> <span class="n">ぶ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぶう</span><span class="p">,</span> <span class="n">ぷ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぷう</span><span class="p">,</span> <span class="n">む</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">むう</span><span class="p">,</span> <span class="n">ゅ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゅう</span><span class="p">,</span>
<span class="n">ゆ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゆう</span><span class="p">,</span> <span class="n">る</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">るう</span><span class="p">,</span> <span class="n">ゑ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゑう</span><span class="p">,</span> <span class="n">ゔ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゔう</span>

<span class="n">ぇ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぇえ</span><span class="p">,</span> <span class="n">え</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ええ</span><span class="p">,</span> <span class="n">ゖ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ゖえ</span><span class="p">,</span> <span class="n">け</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">けえ</span><span class="p">,</span> <span class="n">げ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">げえ</span><span class="p">,</span> <span class="n">せ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">せえ</span><span class="p">,</span> <span class="n">ぜ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぜえ</span><span class="p">,</span>
<span class="n">て</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">てえ</span><span class="p">,</span> <span class="n">で</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">でえ</span><span class="p">,</span> <span class="n">ね</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ねえ</span><span class="p">,</span> <span class="n">へ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">へえ</span><span class="p">,</span> <span class="n">べ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">べえ</span><span class="p">,</span> <span class="n">ぺ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぺえ</span><span class="p">,</span> <span class="n">め</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">めえ</span><span class="p">,</span>
<span class="n">れ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">れえ</span>

<span class="n">ぉ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぉお</span><span class="p">,</span> <span class="n">お</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">おお</span><span class="p">,</span> <span class="n">こ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">こお</span><span class="p">,</span> <span class="n">ご</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ごお</span><span class="p">,</span> <span class="n">そ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">そお</span><span class="p">,</span> <span class="n">ぞ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぞお</span><span class="p">,</span> <span class="n">と</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">とお</span><span class="p">,</span>
<span class="n">ど</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">どお</span><span class="p">,</span> <span class="n">の</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">のお</span><span class="p">,</span> <span class="n">ほ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ほお</span><span class="p">,</span> <span class="n">ぼ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぼお</span><span class="p">,</span> <span class="n">ぽ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ぽお</span><span class="p">,</span> <span class="n">も</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">もお</span><span class="p">,</span> <span class="n">ょ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ょお</span><span class="p">,</span>
<span class="n">よ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">よお</span><span class="p">,</span> <span class="n">ろ</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">ろお</span><span class="p">,</span> <span class="n">を</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">をお</span>

<span class="n">ん</span><span class="o">-</span> <span class="o">-&gt;</span> <span class="n">んん</span>
</pre></div>
</div>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_kana_hyphen</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">name</span> <span class="n">sound</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;羊&quot;</span><span class="p">,</span> <span class="s2">&quot;sound&quot;</span><span class="p">:</span><span class="s2">&quot;メ-メ-&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_animals_sound</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_kana_hyphen&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_animals_sound</span> <span class="o">--</span><span class="n">name</span> <span class="n">animals_sound</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">source</span> <span class="n">sound</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Animals</span> <span class="o">--</span><span class="n">query</span> <span class="n">sound</span><span class="p">:</span><span class="nd">@メエメエ</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,1677829950.652696,</span>
<span class="c1">#    0.01971983909606934</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        1</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_id&quot;,</span>
<span class="c1">#          &quot;UInt32&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_key&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;name&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;sound&quot;,</span>
<span class="c1">#          &quot;ShortText&quot;</span>
<span class="c1">#        ]</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;1&quot;,</span>
<span class="c1">#        &quot;羊&quot;,</span>
<span class="c1">#        &quot;メ-メ-&quot;</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-search-condition"><span class="std std-ref">近傍検索条件</span></a>][<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-near-search-operator"><span class="std std-ref">近傍検索演算子</span></a>] 各近傍検索に <code class="docutils literal notranslate"><span class="pre">${MIN_INTERVAL}</span></code> オプションを追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">${MIN_INTERVAL}</span></code> でフレーズ間（単語間）の最低距離を指定できるようになりました。フレーズ間（単語間）の距離は、最低でもこの値以上である必要があります。</p>
<p>新しい構文は以下のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*N${MAX_INTERVAL},${MAX_TOKEN_INTERVAL_1}|${MAX_TOKEN_INTERVAL_2}|...,${MIN_INTERVAL} &quot;word1 word2 ...&quot;
*NP${MAX_INTERVAL},${ADDITIONAL_LAST_INTERVAL},${MAX_PHRASE_INTERVAL_1}|${MAX_PHRASE_INTERVAL_2}|...,${MIN_INTERVAL} &quot;phrase1 phrase2 ...&quot;
*NPP${MAX_INTERVAL},${ADDITIONAL_LAST_INTERVAL},${MAX_PHRASE_INTERVAL_1}|${MAX_PHRASE_INTERVAL_2}|...,${MIN_INTERVAL} &quot;(phrase1-1 phrase1-2 ...) (phrase2-1 phrase2-2 ...) ...&quot;
*ONP${MAX_INTERVAL},${ADDITIONAL_LAST_INTERVAL},${MAX_PHRASE_INTERVAL_1}|${MAX_PHRASE_INTERVAL_2}|...,${MIN_INTERVAL} &quot;phrase1 phrase2 ...&quot;
*ONPP${MAX_INTERVAL},${ADDITIONAL_LAST_INTERVAL},${MAX_PHRASE_INTERVAL_1}|${MAX_PHRASE_INTERVAL_2}|...,${MIN_INTERVAL} &quot;(phrase1-1 phrase1-2 ...) (phrase2-1 phrase2-2 ...) ...&quot;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">${MIN_INTERVAL}</span></code> のデフォルト値は <code class="docutils literal notranslate"><span class="pre">INT32_MIN</span></code> (<code class="docutils literal notranslate"><span class="pre">-2147483648</span></code>) です。<code class="docutils literal notranslate"><span class="pre">${MIN_INTERVAL}</span></code> を省略した場合デフォルト値が使用されます。</p>
<p>このオプションは重複したフレーズを無視するのに便利です。</p>
<p><code class="docutils literal notranslate"><span class="pre">*NP</span></code> の距離は <code class="docutils literal notranslate"><span class="pre">各フレーズの先頭のトークンの距離</span> <span class="pre">-</span> <span class="pre">左のフレーズのトークン数</span> <span class="pre">+</span> <span class="pre">1</span></code> で計算されます。</p>
<p>トークナイザーがバイグラムの場合を考えると、例えば、 <code class="docutils literal notranslate"><span class="pre">東京</span></code> は <code class="docutils literal notranslate"><span class="pre">東京</span></code> という一つのトークンを持ち、 <code class="docutils literal notranslate"><span class="pre">京都</span></code> は <code class="docutils literal notranslate"><span class="pre">京都</span></code> という一つのトークンを持ちます。</p>
<p><code class="docutils literal notranslate"><span class="pre">*NP</span> <span class="pre">&quot;東京</span> <span class="pre">京都&quot;</span></code> の対象の値として <code class="docutils literal notranslate"><span class="pre">東京都</span></code> を考えてみます。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">各フレーズの先頭のトークンの距離</span></code>: <code class="docutils literal notranslate"><span class="pre">1</span></code> (<code class="docutils literal notranslate"><span class="pre">東京</span></code> と <code class="docutils literal notranslate"><span class="pre">京都</span></code> の距離)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">左のフレーズのトークン数</span></code>: <code class="docutils literal notranslate"><span class="pre">1</span></code> ( <code class="docutils literal notranslate"><span class="pre">東京</span></code> )</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">東京都</span></code> に対して <code class="docutils literal notranslate"><span class="pre">*NP</span></code> で使われる距離は、 <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">1</span></code> = <code class="docutils literal notranslate"><span class="pre">1</span></code> となります。</p>
<p>結果として、 <code class="docutils literal notranslate"><span class="pre">東京</span></code> と <code class="docutils literal notranslate"><span class="pre">京都</span></code> が重複していないとき、 <code class="docutils literal notranslate"><span class="pre">*NP</span></code> で使われる距離は <code class="docutils literal notranslate"><span class="pre">1</span></code> より大きくなります。</p>
<p>このオプションは重複したフレーズを無視するのに便利です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC150</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;東京都&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;東京京都&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;*NP-1,0,,2&quot;東京 京都&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    0.0,</span>
<span class="c1">#    0.0</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        1</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_score&quot;,</span>
<span class="c1">#          &quot;Int32&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;content&quot;,</span>
<span class="c1">#          &quot;Text&quot;</span>
<span class="c1">#        ]</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;東京京都&quot;</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
<p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">東京都</span></code> は距離が <code class="docutils literal notranslate"><span class="pre">1</span></code> なのでマッチしませんが、 <code class="docutils literal notranslate"><span class="pre">東京京都</span></code> は距離が <code class="docutils literal notranslate"><span class="pre">2</span></code> なのでマッチします。</p>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">unify_katakana_trailing_o</span></code> オプションで新しい値をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">unify_katakana_trailing_o</span></code> で以下の新しい値のノーマライズをサポートしました。これらの左側の文字の母音が <code class="docutils literal notranslate"><span class="pre">オ</span></code> なので、ノーマライズすべきなためです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ォオ</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">ォウ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ョオ</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">ョウ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ヺオ</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">ヺウ</span></code></p></li>
</ul>
</li>
<li><p>MessagePack v6.0.0 をサポートしました。 [GitHub#1536][Reported by Carlo Cabrera]</p>
<p>今まで、Groongaは <code class="docutils literal notranslate"><span class="pre">configure</span></code> または <code class="docutils literal notranslate"><span class="pre">cmake</span></code> 実行時にMessagePack v6.0.0以降のMessagePackを検出できませんでした。このリリースから、MessagePackがv6.0.0以降であっても検出できるようになります。</p>
</li>
</ul>
</section>
<section id="id2">
<h3>修正<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] NormalizerNFKCが不正な正規化をする問題を修正しました。</p>
<p>この問題は、 <code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code> と <code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span></code> を同時に使う場合に発生します。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code> と <code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span></code> を同時に使うとき、  <code class="docutils literal notranslate"><span class="pre">ヴァ</span></code> が <code class="docutils literal notranslate"><span class="pre">バア</span></code> にノーマライズされていました。しかし <code class="docutils literal notranslate"><span class="pre">ヴァ</span></code> は <code class="docutils literal notranslate"><span class="pre">バ</span></code> と正規化されるべきです。</p>
<p>これは、 <code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code> で <code class="docutils literal notranslate"><span class="pre">ヴァ</span></code> が <code class="docutils literal notranslate"><span class="pre">ヴア</span></code> と正規化され、その後、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span></code> によって <code class="docutils literal notranslate"><span class="pre">ヴア</span></code> が <code class="docutils literal notranslate"><span class="pre">バア</span></code> と正規化されていたことが原因です。<code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span></code> が <code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code> より前に適用されるように修正しました。</p>
<p>以下は以前のバージョンでの問題の発生例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> \
<span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_v_sounds&quot;, true, </span><span class="se">\</span>
<span class="s1">                  &quot;unify_kana_case&quot;, true)&#39;</span> \
<span class="s2">&quot;ヴァーチャル&quot;</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    1678097412.913053,</span>
<span class="c1">#    0.00019073486328125</span>
<span class="c1">#  ],</span>
<span class="c1">#  {</span>
<span class="c1">#    &quot;normalized&quot;:&quot;ブアーチヤル&quot;,</span>
<span class="c1">#    &quot;types&quot;:[],</span>
<span class="c1">#    &quot;checks&quot;:[]</span>
<span class="c1">#  }</span>
</pre></div>
</div>
<p>このバージョンから、 <code class="docutils literal notranslate"><span class="pre">ヴァーチャル</span></code> は <code class="docutils literal notranslate"><span class="pre">バーチヤル</span></code> にノーマライズされます。</p>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-ordered-near-phrase-search-condition"><span class="std std-ref">順序付き近傍フレーズ検索条件</span></a>][<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-ordered-near-phrase-search-operator"><span class="std std-ref">順序付き近傍フレーズ検索演算子</span></a>] <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> が正しく動かない問題を修正しました。</p>
<p>この問題が発生したとき、距離は <code class="docutils literal notranslate"><span class="pre">0</span></code> とみなされます。したがって、この問題が発生した場合、余分にレコードがヒットすることがあります。</p>
<p>この問題は以下の場合に発生します。</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*ONP</span></code> で <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> を使用している</p></li>
<li><p>マッチした左側のフレーズに含まれるトークンの数が、 <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> で指定した要素数より多い</p></li>
</ol>
<p>以下はこの問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC150</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcXYZdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123456789def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc12345678def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc1de2def&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *ONP-1,0,1 &quot;abc def&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    0.0,</span>
<span class="c1">#    0.0</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        5</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_score&quot;,</span>
<span class="c1">#          &quot;Int32&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;content&quot;,</span>
<span class="c1">#          &quot;Text&quot;</span>
<span class="c1">#        ]</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;abcXYZdef&quot;</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;abcdef&quot;</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;abc123456789def&quot;</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;abc12345678def&quot;</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        1,</span>
<span class="c1">#        &quot;abc1de2def&quot;</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
<p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">*ONP-1,0,1</span> <span class="pre">&quot;abc</span> <span class="pre">def&quot;</span></code> で、最初の要素の距離に <code class="docutils literal notranslate"><span class="pre">1</span></code> を指定しています。しかし、距離が <code class="docutils literal notranslate"><span class="pre">1</span></code> より離れているものも含めた、すべての <code class="docutils literal notranslate"><span class="pre">content</span></code> がマッチしています。</p>
<p>これは、この例がこの問題の発生条件を満たしていて、距離が <code class="docutils literal notranslate"><span class="pre">0</span></code> とみなされているためです。</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">*ONP</span></code> で <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> を使用している</p>
<p><code class="docutils literal notranslate"><span class="pre">*ONP-1,0,1</span> <span class="pre">&quot;abc</span> <span class="pre">def&quot;</span></code> は <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> を使用している。</p>
</li>
<li><p>マッチした左側のフレーズに含まれるトークンの数が、 <code class="docutils literal notranslate"><span class="pre">${MAX_PHRASE_INTERVALS}</span></code> で指定した要素数より多い</p>
<ul class="simple">
<li><p>マッチした左側のフレーズ: <code class="docutils literal notranslate"><span class="pre">abc</span></code></p>
<ul>
<li><p>含まれるトークン: <code class="docutils literal notranslate"><span class="pre">ab</span></code> 、 <code class="docutils literal notranslate"><span class="pre">bc</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenNgram(&quot;unify_alphabet&quot;,</span> <span class="pre">false,</span> <span class="pre">&quot;unify_digit&quot;,</span> <span class="pre">false)</span></code> によるトークナイズ</p></li>
</ul>
</li>
<li><p>左側のフレーズに含まれるトークン数 (<code class="docutils literal notranslate"><span class="pre">2</span></code>) &gt; <code class="docutils literal notranslate"><span class="pre">max_element_intervals</span></code> にに含まれる要素数 (<code class="docutils literal notranslate"><span class="pre">1</span></code>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">*ONP-1,0,1</span> <span class="pre">&quot;abc</span> <span class="pre">def&quot;</span></code> の <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
</li>
<li><p>左側のフレーズに含まれるトークン数 (<code class="docutils literal notranslate"><span class="pre">2</span></code>) &gt; <code class="docutils literal notranslate"><span class="pre">max_element_intervals</span></code> にに含まれる要素数 (<code class="docutils literal notranslate"><span class="pre">1</span></code>)</p></li>
</ul>
</li>
</ol>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-phrase-search-condition"><span class="std std-ref">近傍フレーズ検索条件</span></a>][<a class="reference internal" href="reference/grn_expr/script_syntax.html#script-syntax-near-phrase-search-operator"><span class="std std-ref">近傍フレーズ検索演算子</span></a>] 各近傍フレーズ検索で、最後として指定したフレーズが最後として使用されない問題を修正しました。</p>
<p>この問題が発生すると <code class="docutils literal notranslate"><span class="pre">${ADDITIONAL_LAST_INTERVAL}</span></code> は無視され、 <code class="docutils literal notranslate"><span class="pre">${MAX_INTERVAL}</span></code> が使用されます。</p>
<p>この問題は以下の場合に発生します。</p>
<ol class="arabic simple">
<li><p>最後として指定されたフレーズが複数のトークンを含む</p></li>
<li><p>そのフレーズの最後のトークンのサイズが、他のトークンのサイズ以下である</p>
<ul class="simple">
<li><p>トークンサイズとは、全レコード中に出現するそのトークンの数です。</p></li>
</ul>
</li>
</ol>
<p>以下はこの問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC150</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123456789defg&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;dededede&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *NP10,1&quot;abc defg$&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="c1">#[</span>
<span class="c1">#  [</span>
<span class="c1">#    0,</span>
<span class="c1">#    0.0,</span>
<span class="c1">#    0.0</span>
<span class="c1">#  ],</span>
<span class="c1">#  [</span>
<span class="c1">#    [</span>
<span class="c1">#      [</span>
<span class="c1">#        0</span>
<span class="c1">#      ],</span>
<span class="c1">#      [</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;_score&quot;,</span>
<span class="c1">#          &quot;Int32&quot;</span>
<span class="c1">#        ],</span>
<span class="c1">#        [</span>
<span class="c1">#          &quot;content&quot;,</span>
<span class="c1">#          &quot;Text&quot;</span>
<span class="c1">#        ]</span>
<span class="c1">#      ]</span>
<span class="c1">#    ]</span>
<span class="c1">#  ]</span>
<span class="c1">#]</span>
</pre></div>
</div>
<p>上記の例の <code class="docutils literal notranslate"><span class="pre">abc123456789defg</span></code> について考えると、 <code class="docutils literal notranslate"><span class="pre">abc</span></code> から <code class="docutils literal notranslate"><span class="pre">defg</span></code> までの距離は <code class="docutils literal notranslate"><span class="pre">11</span></code> です。 <code class="docutils literal notranslate"><span class="pre">${MAX_INTERVAL}</span></code> は <code class="docutils literal notranslate"><span class="pre">10</span></code> で <code class="docutils literal notranslate"><span class="pre">${ADDITIONAL_LAST_INTERVAL}</span></code> は <code class="docutils literal notranslate"><span class="pre">1</span></code> が指定されています。したがって、最後のフレーズがマッチするしきい値は11になります。以上から、 <code class="docutils literal notranslate"><span class="pre">abc123456789defg</span></code> はマッチするはずですが、していません。</p>
<p>これは、この例が、以下のようにこの問題の発生条件を満たしていて、<code class="docutils literal notranslate"><span class="pre">${MAX_INTERVAL}</span></code> のみが使われているためです。</p>
<ol class="arabic">
<li><p>最後として指定されたフレーズが複数のトークンを含む</p>
<p>最後に <code class="docutils literal notranslate"><span class="pre">$</span></code> がついているので、 <code class="docutils literal notranslate"><span class="pre">defg$</span></code> は最後と指定されています。</p>
<p><code class="docutils literal notranslate"><span class="pre">defg$</span></code> は <code class="docutils literal notranslate"><span class="pre">TokenNgram(&quot;unify_alphabet&quot;,</span> <span class="pre">false,</span> <span class="pre">&quot;unify_digit&quot;,</span> <span class="pre">false)</span></code> によって <code class="docutils literal notranslate"><span class="pre">de</span></code>, <code class="docutils literal notranslate"><span class="pre">ef</span></code>, <code class="docutils literal notranslate"><span class="pre">fg</span></code> にトークナイズされます。</p>
</li>
<li><p>そのフレーズの最後のトークンのサイズが、他のトークンのサイズ以下である</p>
<p><code class="docutils literal notranslate"><span class="pre">fg</span></code> は <code class="docutils literal notranslate"><span class="pre">defg$</span></code> の最後のトークンです。 <code class="docutils literal notranslate"><span class="pre">abc123456789defg</span></code> は1つの <code class="docutils literal notranslate"><span class="pre">fg</span></code>  と <code class="docutils literal notranslate"><span class="pre">de</span></code> を含みます。そして、 <code class="docutils literal notranslate"><span class="pre">dededede</span></code> は4つの <code class="docutils literal notranslate"><span class="pre">de</span></code> を含みます。</p>
<p>したがって、 <code class="docutils literal notranslate"><span class="pre">fg</span></code> のサイズは <code class="docutils literal notranslate"><span class="pre">1</span></code> で、 <code class="docutils literal notranslate"><span class="pre">de</span></code> のサイズは <code class="docutils literal notranslate"><span class="pre">5</span></code> です。</p>
</li>
</ol>
</li>
<li><p>[<a class="reference internal" href="reference/grn_expr/query_syntax.html#query-syntax-near-phrase-search-condition"><span class="std std-ref">近傍フレーズ検索条件</span></a>] 距離の計算方法を修正しました。</p>
<p>この問題によって、近傍フレーズ検索を使った場合に、ヒットしないはずのレコードがヒットすることがあります。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] <code class="docutils literal notranslate"><span class="pre">loose_symbol=true</span></code> の時にハイライト位置がずれることがある問題を修正しました。</p></li>
</ul>
</section>
<section id="id3">
<h3>感謝<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Carlo Cabreraさん</p></li>
</ul>
</section>
</section>
<section id="release-13-0-0-2023-02-09">
<span id="release-13-0-0"></span><h2>13.0.0リリース - 2023-02-09<a class="headerlink" href="#release-13-0-0-2023-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく13.0.0へアップグレードできます。</p>
<p>まずはじめに 13.0.0の主な変更点を紹介します。次に、Groonga 12.0.0 から 12.1.2 までの変更点を紹介します。</p>
<section id="new-features-and-improvements-in-13-0-0">
<h3>13.0.0の新規機能と改良<a class="headerlink" href="#new-features-and-improvements-in-13-0-0" title="この見出しへのパーマリンク">#</a></h3>
</section>
<section id="id4">
<h3>改良<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] Unicode 15.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたノーマライザー <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC150</span></code> を新しく追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] Unicode 15.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたトークンフィルター <code class="docutils literal notranslate"><span class="pre">TokenFilterNFKC150</span></code> を新しく追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc150.html"><span class="doc">NormalizerNFKC150</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC</span></code> に以下の新しいオプションを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_gu_small_sounds</span></code></p>
<p>このオプションを使うことで、&quot;グァ -&gt; ガ&quot;, &quot;グィ -&gt; ギ&quot;, &quot;グェ -&gt; ゲ&quot;, &quot;グォ -&gt; ゴ&quot;と正規化できます。</p>
<p>以下は <code class="docutils literal notranslate"><span class="pre">unify_katakana_gu_small_sounds</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Countries</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Countries</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Countries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;JP&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;日本&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;GT&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;グァテマラ共和国&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_contry_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_gu_small_sounds&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_contry_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">contry_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Countries</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Countries</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@ガテマラ共和国</span>
<span class="p">[</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span>
   <span class="mi">0</span><span class="p">,</span>
   <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;GT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;グァテマラ共和国&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_di_sound</span></code></p>
<p>このオプションを使うことで、&quot;ヂ -&gt; ジ&quot;と正規化できます。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_di_sound</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;チジミ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;パジョン&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_food_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_di_sound&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_food_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">food_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@チヂミ</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;チジミ&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_wo_sound</span></code></p>
<p>このオプションを使うことで、&quot;ヲ -&gt; オ&quot;と正規化できます。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_wo_sound</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;アヲハタ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ヴェルデ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ランプ&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_food_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_wo_sound&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_food_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">food_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Foods</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@アオハタ</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;アヲハタ&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_zu_small_sounds</span></code></p>
<p>このオプションを使うことで、&quot;ズァ -&gt; ザ&quot;, &quot;ズィ -&gt; ジ&quot;, &quot;ズェ -&gt; ゼ&quot;, &quot;ズォ -&gt; ゾ&quot;と正規化できます。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_zu_small_sounds</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Cities</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Cities</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Cities</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ガージヤーバード&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;デリー&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_city_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_zu_small_sounds&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_city_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">city_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Cities</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Cities</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@ガーズィヤーバード</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ガージヤーバード&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_du_sound</span></code></p>
<p>このオプションを使うことで、&quot;ヅ -&gt; ズ&quot;と正規化できます。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_du_sound</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Plants</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Plants</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Plants</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ハスノカヅラ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;オオツヅラフジ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;アオツヅラフジ&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_plant_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_du_sound&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_plant_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">plant_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Plants</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Plants</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@ツズラ</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;オオツヅラフジ&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;アオツヅラフジ&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_trailing_o</span></code></p>
<p>このオプションによって、以下の文字を正規化できます。</p>
<blockquote>
<div><ul class="simple">
<li><p>&quot;オオ -&gt; オウ&quot;</p></li>
<li><p>&quot;コオ -&gt; コウ&quot;</p></li>
<li><p>&quot;ソオ -&gt; ソウ&quot;</p></li>
<li><p>&quot;トオ -&gt; トウ&quot;</p></li>
<li><p>&quot;ノオ -&gt; ノウ&quot;</p></li>
<li><p>&quot;ホオ -&gt; ホウ&quot;</p></li>
<li><p>&quot;モオ -&gt; モウ&quot;</p></li>
<li><p>&quot;ヨオ -&gt; ヨウ&quot;</p></li>
<li><p>&quot;ロオ -&gt; ロウ&quot;</p></li>
<li><p>&quot;ゴオ -&gt; ゴウ&quot;</p></li>
<li><p>&quot;ゾオ -&gt; ゾウ&quot;</p></li>
<li><p>&quot;ドオ -&gt; ドウ&quot;</p></li>
<li><p>&quot;ボオ -&gt; ボウ&quot;</p></li>
<li><p>&quot;ポオ -&gt; ポウ&quot;</p></li>
</ul>
</div></blockquote>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_trailing_o</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Sharks</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Sharks</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Sharks</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ホオジロザメ&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;ジンベイザメ&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_shark_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_trailing_o&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_shark_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">shark_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Sharks</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Sharks</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@ホウジロザメ</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ホオジロザメ&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_du_small_sounds</span></code></p>
<p>このオプションを使うことで、 &quot;ヅァ -&gt; ザ&quot;, &quot;ヅィ -&gt; ジ&quot;, &quot;ヅェ -&gt; ゼ&quot;, &quot;ヅォ -&gt; ゾ&quot;と正規化できます。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">unify_katakana_du_small_sounds</span></code> オプションの使用例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Airports</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Airports</span> <span class="o">--</span><span class="n">name</span> <span class="n">name</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Airports</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;HER&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;イラクリオ・ニコスカザンヅァキス国際空港&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;ATH&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;アテネ国際空港&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="o">--</span><span class="n">name</span> <span class="n">idx_airport_name</span> \
  <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> \
  <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerNFKC150(&quot;unify_katakana_du_small_sounds&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">idx_airport_name</span> <span class="o">--</span><span class="n">name</span> <span class="n">airport_name</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Airports</span> <span class="o">--</span><span class="n">source</span> <span class="n">name</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Airports</span> <span class="o">--</span><span class="n">query</span> <span class="n">name</span><span class="p">:</span><span class="nd">@ニコスカザンザキス</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="mi">1</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UInt32&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;HER&quot;</span><span class="p">,</span>
      <span class="s2">&quot;イラクリオ・ニコスカザンヅァキス国際空港&quot;</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/oracle-linux.html"><span class="doc">Oracle Linux</span></a>] Oracle Linux 8と9 向けのパッケージを新しくサポートしました。</p></li>
</ul>
</section>
<section id="higlight-and-summary-of-changes-from-12-0-0-to-12-1-2">
<h3>Groonga 12.0.0 から 12.1.2 までの主な変更点<a class="headerlink" href="#higlight-and-summary-of-changes-from-12-0-0-to-12-1-2" title="この見出しへのパーマリンク">#</a></h3>
</section>
<section id="higlight">
<h3>ハイライト<a class="headerlink" href="#higlight" title="この見出しへのパーマリンク">#</a></h3>
<p>[<a class="reference internal" href="#release-12-0-9"><span class="std std-ref">12.0.9リリース - 2022-10-28</span></a>]</p>
<blockquote>
<div><ul>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> を追加しました。（実験的）</p>
<p><code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> はHTML用のノーマライザーです。</p>
<p>現在 <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> は <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> といったタグの削除と、<code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> といった文字参照の展開を行います。</p>
<p>以下は <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="n">NormalizerHTML</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666923364.883798</span><span class="p">,</span><span class="mf">0.0005481243133544922</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp; Mroonga &amp; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除され、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> に展開されています。</p>
<p>タグを削除するかどうかは <code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;remove_tag&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924069.278549</span><span class="p">,</span><span class="mf">0.0001978874206542969</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;span&gt; Groonga &amp; Mroonga &amp; Rroonga &lt;/span&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除されていません。</p>
<p>文字参照を展開するかどうかは <code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;expand_character_reference&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924357.099782</span><span class="p">,</span><span class="mf">0.0002346038818359375</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は展開されていません。</p>
</li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-3"><span class="std std-ref">12.0.3リリース - 2022-04-29</span></a>]</p>
<blockquote>
<div><ul>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>],[<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 入力としてベクターをサポートしました。[groonga-dev,04956][Reported by shinonon]</p>
<p>例えば、以下のようにJSONデータ内のベクターに対して検索キーワードの周辺テキストを抽出できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_title</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">title</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_contents</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span><span class="o">|</span><span class="n">WITH_POSITION</span>   <span class="n">Entries</span> <span class="n">contents</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga and MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on &lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt;&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>今までも、 <code class="docutils literal notranslate"><span class="pre">--output_columns</span> <span class="pre">'snippet_html(contents[1])'</span></code> のように <code class="docutils literal notranslate"><span class="pre">snippet*</span></code> を指定することで以下のようにベクターに対して検索キーワードの周辺テキストを抽出できますが、この方法ではどの要素を出力すればよいかわかりません。どの要素が検索にヒットしたかわからないためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents[0]), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-1"><span class="std std-ref">12.0.1リリース - 2022-02-28</span></a>]</p>
<blockquote>
<div><ul>
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループをサポートしました。</p>
<p>同義語検索をする場合、今までは、以下のようにキーワードとその同義語をそれぞれ定義していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Thesaurus</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="n">Thesaurus</span> <span class="n">synonym</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;senna&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>上記のケースでは、<code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を検索した場合、 Groongaは、意図通り、 <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span> <span class="pre">を検索しますが、``tritonn</span></code> を検索した場合は、 Groongaは、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> のみを検索します。<code class="docutils literal notranslate"><span class="pre">tritonn</span></code> を検索した場合でも、<code class="docutils literal notranslate"><span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と検索した場合、以下のように定義を追加する必要がありました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>多くのケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開した場合、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開して欲しくなりますが、今までは、そのようなケースでは定義を追加する必要がありました。したがって、対象のキーワードに同義語がたくさんあると、同じような定義をたくさん定義する必要があるため、同義語の定義が煩雑でした。</p>
<p>加えて、同義語を削除する際も、多くのレコードを削除する必要があるので面倒でした。</p>
<p>今回のリリースから同義語の代表値を決めることで一つのグループを作れるようになりました。例えば、以下のすべてのキーワードは、 &quot;mroonga&quot; グループです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>このケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> は <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。また、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。</p>
<p>同義語を削除する際も、対象のレコードを削除するだけです。例えば、同義語から <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> を削除する場合は、 <code class="docutils literal notranslate"><span class="pre">{&quot;_key&quot;:</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;:</span> <span class="pre">&quot;representative&quot;:</span> <span class="pre">&quot;mroonga&quot;}</span></code> を削除するだけです。</p>
</li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-0"><span class="std std-ref">12.0.0リリース - 2022-02-09</span></a>]</p>
<blockquote>
<div><ul>
<li><p>[index_column_have_source_record] 新しい関数 <code class="docutils literal notranslate"><span class="pre">index_column_have_source_record()</span></code> を追加しました。</p>
<p>インデックスに存在するトークンがGroongaに登録されているいずれかのレコードに含まれているかどうかを確認できます。</p>
<p>Groongaは、レコードの更新によってどのレコードからも使われていないトークンがあっても、それを削除しません。したがって、例えば、オートコンプリート機能を使っていると、検索候補としてどのレコードにも含まれていないトークンを返す可能性がありますが、この関数をつかうことで、不要なトークンを返さないようにできます。</p>
<p>この関数は、トークンがどのレコードにも含まれていないことを検出できるからです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">drilldown_max_n_target_records</span></code> と <code class="docutils literal notranslate"><span class="pre">drilldown[${LABEL}].max_n_target_records</span></code> を追加しました。</p>
<p>ドリルダウン対象のテーブル（フィルター結果）の中のうち最大で何レコードをドリルダウンに使うかを指定します。もし、フィルター結果のレコード数が指定した値より大きかったらフィルターした結果内のいくつかのレコードはドリルダウンには使われません。これらの引数のデフォルト値は、 <code class="docutils literal notranslate"><span class="pre">-1</span></code> です。これらの引数に <code class="docutils literal notranslate"><span class="pre">-1</span></code> がセットされた場合、Groongaは全てのレコードをドリルダウンに使います。</p>
<p>この機能はフィルター結果が非常に大きくなるかもしれない場合に有用です。大きなフィルター結果に対するドリルダウンは遅くなることがあるためです。この機能を使うことでドリルダウンに使うレコード数を制限できます。</p>
<p>以下はドリルダウンに使う最大レコード数を制限する例です。最後の2レコード（ <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">4,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> と <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">5,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> ）は使われていません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">n_likes</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_key_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">_key</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;The first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome! This is my first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also started to use Mroonga. It&#39;s also very fast! Really fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Senna&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I migrated all Senna system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Tritonn&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also migrated all Tritonn system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown_max_n_target_records</span> <span class="mi">3</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Hello&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="mi">2</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</section>
<section id="summary">
<h3>概要<a class="headerlink" href="#summary" title="この見出しへのパーマリンク">#</a></h3>
</section>
<section id="id5">
<h3>改良<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">#</a></h3>
<p>[<a class="reference internal" href="#release-12-1-2"><span class="std std-ref">12.1.2リリース - 2023-01-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.3に更新しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-1-1"><span class="std std-ref">12.1.1リリース - 2023-01-06</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="reference/commands/select.html#select-drilldowns-label-key-vector-expansions-power-set"><span class="std std-ref">POWER_SET</span></a>] ドリルダウンでベクターのべき集合を集計できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ベクターカラムの特定の要素のみを対象に検索できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> 形式をサポートしました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-1-0"><span class="std std-ref">12.1.0 リリース - 2022-11-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">load</span></code> のスローログの出力に対応しました。</p></li>
<li><p>[<a class="reference internal" href="reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_is_reference_count_enable()</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">back_trace</span></code> と <code class="docutils literal notranslate"><span class="pre">reference_count</span></code> を追加しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-9"><span class="std std-ref">12.0.9リリース - 2022-10-28</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 9 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/escalate.html"><span class="doc">escalate</span></a>] <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> を追加しました。（実験的）</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.2に更新しました。</p></li>
<li><p>メモリーが不足した際に、同じログが大量に出力されないように変更しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-8"><span class="std std-ref">12.0.8リリース - 2022-10-03</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数（実験的）の仕様を使いやすいように変更しました。</p></li>
<li><p>[<a class="reference internal" href="install/cmake.html"><span class="doc">CMakeを使ってGroongaをビルドする方法</span></a>] CMakeを使ってビルドする方法を追加しました。</p></li>
<li><p>[<a class="reference internal" href="install/others.html"><span class="doc">その他</span></a>] GNU Autotoolsを使ってビルドする場合に、Apache Arrowの機能を有効化/無効化する方法について追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="reference/commands/select.html#select-drilldowns-label-table"><span class="std std-ref">drilldowns[${LABEL}].table</span></a> のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="contribution/documentation/i18n.html"><span class="doc">国際化</span></a>] 翻訳方法を更新しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-7"><span class="std std-ref">12.0.7リリース - 2022-08-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> を追加しました。(実験的)</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.1に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--n_workers</span></code> オプションのドキュメントを追加しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-6"><span class="std std-ref">12.0.6リリース - 2022-08-04</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>groonga-delta用の新しいMuninプラグインを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/column_copy.html"><span class="doc">column_copy</span></a>] 重み付きベクターをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri) のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 10 (buster) のサポートをやめました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-5"><span class="std std-ref">12.0.5リリース - 2022-06-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 検索エスカレーションによる前方一致検索のパフォーマンスを少し改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL]._key</span></code> に重み付き参照ベクターカラムを指定できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> や <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使っていても、ドリルダウンのキーに重み付き参照ベクターカラムを指定できるようになりました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-4"><span class="std std-ref">12.0.4リリース - 2022-06-06</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 22.04 (Jammy Jellyfish)をサポートしました。</p></li>
<li><p><cite>groonga-benchmark</cite> の提供をやめました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">memory_map_size</span></code> を追加しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-3"><span class="std std-ref">12.0.3リリース - 2022-04-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中のメモリー使用量を改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE/MISSING_NIL</span></code> をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>],[<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 入力としてベクターをサポートしました。</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">vector_join</span></code>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">vector_join()</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] 動的インデックス構築のようにとても大きなトークンを無視するようにしました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-2"><span class="std std-ref">12.0.2リリース - 2022-03-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] シャードを処理した直後に参照を減らすようにしました。</p></li>
<li><p>クラッシュリカバリー機能の安定性が向上しました。</p></li>
<li><p>無名マッピングが利用可能な時のmmapのパフォーマンスを向上しました。</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] 以下のタイプのカラムで静的インデックス構築をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいフラグ <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>][<a class="reference internal" href="reference/commands/column_list.html"><span class="doc">column_list</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/schema.html"><span class="doc">schema</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p></li>
<li><p>Amazon Linux 2向けのパッケージを提供するようにしました。</p></li>
<li><p>[Windows] Visual Studio 2017 でのビルドをやめました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-1"><span class="std std-ref">12.0.1リリース - 2022-02-28</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループにベクターを使えるようにしました。</p></li>
<li><p>環境変数によって、バックトレースを無効にできるようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--slices</span></code> のパフォーマンスを改善しました。</p></li>
<li><p>[Windows] VisualStudio 2022 をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 近傍検索でそれぞれの要素ごとの距離を指定できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] RPMパッケージのGroongaであっても、 <code class="docutils literal notranslate"><span class="pre">groonga-server-http</span></code> を使えるようにしました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-0"><span class="std std-ref">12.0.0リリース - 2022-02-09</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">pre_filter_threshold</span></code> を追加しました。</p></li>
<li><p>[index_column_have_source_record] 新しい関数 <code class="docutils literal notranslate"><span class="pre">index_column_have_source_record()</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">strip</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">drilldown_max_n_target_records</span></code> と <code class="docutils literal notranslate"><span class="pre">drilldown[${LABEL}].max_n_target_records</span></code> を追加しました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.6に更新しました。</p></li>
</ul>
</div></blockquote>
</section>
<section id="id6">
<h3>修正<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">#</a></h3>
<p>[<a class="reference internal" href="#release-12-1-1"><span class="std std-ref">12.1.1リリース - 2023-01-06</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">command_version</span></code> が <code class="docutils literal notranslate"><span class="pre">3</span></code> のとき、 <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> の結果のラベルが不正になる問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a>] 特定の定義が <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> に存在する場合、Groongaがクラッシュすることがある問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-1-0"><span class="std std-ref">12.1.0 リリース - 2022-11-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="reference/columns/vector.html"><span class="doc">ベクターカラム</span></a>] 重み付きベクターカラムで <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> を指定したとき、結果が整数で表示されていた問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-9"><span class="std std-ref">12.0.9リリース - 2022-10-28</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="reference/commands/select.html#select-n-workers"><span class="std std-ref">n_workers</span></a> を指定したとき、Groongaがクラッシュしたり、誤った結果を返すことがある問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-8"><span class="std std-ref">12.0.8リリース - 2022-10-03</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> で冪等でない（繰り返し実行すると結果が変わることがある）定義をした時に、Groongaが誤った結果を返すことがある問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-7"><span class="std std-ref">12.0.7リリース - 2022-08-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>OR検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した場合、Groongaの応答が遅くなることがある問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-6"><span class="std std-ref">12.0.6リリース - 2022-08-04</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_workers</span></code> オプションを使ってドリルダウンを並行して実行したときにGroongaがクラッシュすることがある問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--filter</span></code> に非常に長い式を指定するとシンタックスエラーになる問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-4"><span class="std std-ref">12.0.4リリース - 2022-06-06</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した時Groongaの応答が遅くなることがある問題を修正しました。</p></li>
<li><p>文字列リストをint32のベクターにキャストできない問題を修正しました。</p></li>
<li><p>GroongaのMuninプラグインがAlmaLinux 8 とCentOS 7上で動作しない問題を修正しました。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#release-12-0-3"><span class="std std-ref">12.0.3リリース - 2022-04-29</span></a>]</p>
<blockquote>
<div><ul class="simple">
<li><p>パトリシアトライのテーブルにキーを追加できなくなることがある問題を修正しました。</p></li>
</ul>
</div></blockquote>
</section>
<section id="id7">
<h3>感謝<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>篠田さん</p></li>
<li><p>i10aさん</p></li>
<li><p>naoaさん</p></li>
<li><p>shinononさん</p></li>
<li><p>Zhanzhao (Deo) Liangさん</p></li>
<li><p>David CARLIERさん</p></li>
</ul>
</section>
</section>
<section id="release-12-1-2-2023-01-29">
<span id="release-12-1-2"></span><h2>12.1.2リリース - 2023-01-29<a class="headerlink" href="#release-12-1-2-2023-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id8">
<h3>改良<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.3に更新しました。</p></li>
</ul>
</section>
</section>
<section id="release-12-1-1-2023-01-06">
<span id="release-12-1-1"></span><h2>12.1.1リリース - 2023-01-06<a class="headerlink" href="#release-12-1-1-2023-01-06" title="この見出しへのパーマリンク">#</a></h2>
<section id="id9">
<h3>改良<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="reference/commands/select.html#select-drilldowns-label-key-vector-expansions-power-set"><span class="std std-ref">POWER_SET</span></a>] ドリルダウンでベクターのべき集合を集計できるようになりました。</p>
<p>ドリルダウンに 新しいオプション <code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> を追加しました。 <code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> は、ドリルダウン対象のキーがベクターのときに、キーの展開方法を指定します。 現状は、<code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> には <code class="docutils literal notranslate"><span class="pre">NONE</span></code> または <code class="docutils literal notranslate"><span class="pre">POWER_SET</span></code> が指定できます。</p>
<p><code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> に <code class="docutils literal notranslate"><span class="pre">POWER_SET</span></code> を指定することで、べき集合での集計ができるようになります。 この集計方法は、例えばタグの出現回数と、タグの組み合わせの出現回数を一度に集計したい場合に便利です。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">Groonga</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> 、 <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code> という３つのタグに対して、これらのタグの出現回数と、 これらの組み合わせの出現回数を集計するケースを考えます。</p>
<p>実行例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">PowersetDrilldownMemos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="n">PowersetDrilldownMemos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">PowersetDrilldownMemos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga uses Groonga!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;PGroonga uses Groonga!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;PGroonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga and PGroonga are Groonga family&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;PGroonga&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 4]</span>
<span class="n">select</span> <span class="n">PowersetDrilldownMemos</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">key_vector_expansion</span> <span class="n">POWER_SET</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">initial</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="n">_key</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">sort_keys</span> <span class="s1">&#39;power_set&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="s1">&#39;power_set, _nsubrecs&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         4</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     {</span>
<span class="c1">#       &quot;tags&quot;: [</span>
<span class="c1">#         [</span>
<span class="c1">#           7</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;power_set&quot;,</span>
<span class="c1">#             &quot;Text&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;Int32&quot;</span>
<span class="c1">#           ]</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           4</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Mroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;Mroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Mroonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           1</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;Mroonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           1</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     }</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>この集計結果から、以下のことがわかります。</p>
<table class="table">
<tbody>
<tr class="row-odd"><td><p>タグ</p></td>
<td><p>登場回数</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Mroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>複雑な機能なので、 <a class="reference internal" href="reference/commands/select.html#select-drilldowns-label-key-vector-expansions-power-set"><span class="std std-ref">POWER_SET</span></a> も合わせて参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ベクターカラムの特定の要素のみを対象に検索できるようになりました。</p>
<p><code class="docutils literal notranslate"><span class="pre">match_columns</span></code> にベクターカラムの特定の要素をインデックス番号で指定することで、ベクターカラムの特定の要素のみを対象に検索できるようになりました。</p>
<p>以下はこの機能の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">memo_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Memos</span> <span class="n">contents</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;contents&quot;</span><span class="p">],</span>
<span class="p">[[</span><span class="s2">&quot;I like Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Use Groonga with Ruby&quot;</span><span class="p">]],</span>
<span class="p">[[</span><span class="s2">&quot;I like Ruby&quot;</span><span class="p">,</span> <span class="s2">&quot;Use Groonga&quot;</span><span class="p">]]</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;contents[1]&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="n">Ruby</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;contents, _score&quot;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;contents&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;I like Groonga&quot;,</span>
<span class="c1">#           &quot;Use Groonga with Ruby&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         1</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--match_columns</span> <span class="pre">&quot;contents[1]&quot;</span></code> とすることで、 <code class="docutils literal notranslate"><span class="pre">contents</span></code> ベクターの第2要素のみを <code class="docutils literal notranslate"><span class="pre">--query</span></code> の対象にしています。この例では、 <code class="docutils literal notranslate"><span class="pre">[&quot;I</span> <span class="pre">like</span> <span class="pre">Groonga&quot;,</span> <span class="pre">&quot;Use</span> <span class="pre">Groonga</span> <span class="pre">with</span> <span class="pre">Ruby&quot;]</span></code> は第2要素 <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Groonga</span> <span class="pre">with</span> <span class="pre">Ruby</span></code> に <code class="docutils literal notranslate"><span class="pre">Ruby</span></code> を含むのでヒットしていますが、 <code class="docutils literal notranslate"><span class="pre">[&quot;I</span> <span class="pre">like</span> <span class="pre">Ruby&quot;,</span> <span class="pre">&quot;Use</span> <span class="pre">Groonga&quot;]</span></code> は第2要素 <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Groonga</span></code> に <code class="docutils literal notranslate"><span class="pre">Ruby</span></code> を含まないのでヒットしていません。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> 形式をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> は一般的な時間形式です。この形式をサポートしたことで、 <code class="docutils literal notranslate"><span class="pre">load</span></code> がより使いやすくなりました。</p>
<p>ロードされた値の時間部分は、現地時間の <code class="docutils literal notranslate"><span class="pre">00:00:00</span></code> になります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_NO_KEY</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at_text</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0,0.0,0.0],1]</span>
<span class="n">select</span> <span class="n">Logs</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;time_format_iso8601(created_at), created_at_text&quot;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;time_format_iso8601&quot;,</span>
<span class="c1">#           null</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;created_at_text&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;2000-01-01T00:00:00.000000+09:00&quot;,</span>
<span class="c1">#         &quot;2000-01-01&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id10">
<h3>修正<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">command_version</span></code> が <code class="docutils literal notranslate"><span class="pre">3</span></code> のとき、 <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> の結果のラベルが不正になる問題を修正しました。 [groonga-dev,05005][篠田さんの報告]</p>
<p>以下はこの機能の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Documents</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">tag1</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">tag2</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Documents</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tag1&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;tag2&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Documents</span> <span class="o">--</span><span class="n">drilldown</span> <span class="n">tag1</span><span class="p">,</span><span class="n">tag2</span> <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;header&quot;: {</span>
<span class="c1">#     &quot;return_code&quot;: 0,</span>
<span class="c1">#     &quot;start_time&quot;: 1672123380.653039,</span>
<span class="c1">#     &quot;elapsed_time&quot;: 0.0005846023559570312</span>
<span class="c1">#   },</span>
<span class="c1">#   &quot;body&quot;: {</span>
<span class="c1">#     &quot;n_hits&quot;: 1,</span>
<span class="c1">#     &quot;columns&quot;: [</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;_id&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;UInt32&quot;</span>
<span class="c1">#       },</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;tag1&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#       },</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;tag2&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#       }</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;records&quot;: [</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;1&quot;,</span>
<span class="c1">#         &quot;2&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;drilldowns&quot;: {</span>
<span class="c1">#       &quot;ctor&quot;: {</span>
<span class="c1">#         &quot;n_hits&quot;: 1,</span>
<span class="c1">#         &quot;columns&quot;: [</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_key&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#           },</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;Int32&quot;</span>
<span class="c1">#           }</span>
<span class="c1">#         ],</span>
<span class="c1">#         &quot;records&quot;: [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;1&quot;,</span>
<span class="c1">#             1</span>
<span class="c1">#           ]</span>
<span class="c1">#         ]</span>
<span class="c1">#       },</span>
<span class="c1">#       &quot;tag2&quot;: {</span>
<span class="c1">#         &quot;n_hits&quot;: 1,</span>
<span class="c1">#         &quot;columns&quot;: [</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_key&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#           },</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;Int32&quot;</span>
<span class="c1">#           }</span>
<span class="c1">#         ],</span>
<span class="c1">#         &quot;records&quot;: [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;2&quot;,</span>
<span class="c1">#             1</span>
<span class="c1">#           ]</span>
<span class="c1">#         ]</span>
<span class="c1">#       }</span>
<span class="c1">#     }</span>
<span class="c1">#   }</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> の実行結果の <code class="docutils literal notranslate"><span class="pre">drilldowns</span></code> 直後の <code class="docutils literal notranslate"><span class="pre">ctor</span></code> は、本来 <code class="docutils literal notranslate"><span class="pre">tag1</span></code> であるべきです。 この例では <code class="docutils literal notranslate"><span class="pre">tag1</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">ctor</span></code> という値になっていますが、どのような値になるかは不定です。</p>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a>] 特定の定義が <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> に存在する場合、Groongaがクラッシュすることがある問題を修正しました。 [GitHub:pgroonga/pgroonga#279][i10aさんの報告]</p>
<p>以下の例を考えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Normalizations</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Normalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Normalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅰ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅱ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅲ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">normalize</span> <span class="s1">&#39;NormalizerTable(&quot;normalized&quot;, &quot;Normalizations.normalized&quot;)&#39;</span>   <span class="s2">&quot;ⅡⅡ&quot;</span>
</pre></div>
</div>
<p>この問題は、以下の1.、2.、3.の条件を満たした時に発生します。</p>
<ol class="arabic">
<li><p>対象となるテーブルのキーがノーマライズされる</p>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> に <code class="docutils literal notranslate"><span class="pre">--normalizer</span> <span class="pre">NormalizerNFKC130</span></code> が指定されているので、この条件を満たしています。<code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Ⅱ</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Ⅲ</span></code> はそれぞれ <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によって <code class="docutils literal notranslate"><span class="pre">i</span></code> 、 <code class="docutils literal notranslate"><span class="pre">ii</span></code> 、 <code class="docutils literal notranslate"><span class="pre">iii</span></code> にノーマライズされます。</p>
</li>
<li><p>ノーマライズされた文字列に他のノーマライズされた文字列が含まれている</p>
<p>上記のノーマライズ後の値を考えると、 <code class="docutils literal notranslate"><span class="pre">iii</span></code> が <code class="docutils literal notranslate"><span class="pre">ii</span></code> と <code class="docutils literal notranslate"><span class="pre">i</span></code> を含んでいるため、条件を満たしています。<code class="docutils literal notranslate"><span class="pre">ii</span></code> は <code class="docutils literal notranslate"><span class="pre">i</span></code> それぞれノーマライズ前の <code class="docutils literal notranslate"><span class="pre">Ⅱ</span></code> と <code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> に対応します。</p>
</li>
<li><p>2.の文字列を複数使用する</p>
<p><code class="docutils literal notranslate"><span class="pre">normaize</span></code> の対象である <code class="docutils literal notranslate"><span class="pre">ⅡⅡ</span></code> は <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によって <code class="docutils literal notranslate"><span class="pre">iiii</span></code> にノーマライズされます。 この値に対して、 <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> の <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によるノーマライズ後の値が一致条件として使用されてノーマライズされます。</p>
<p>したがって、 <code class="docutils literal notranslate"><span class="pre">iiii</span></code> を <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> でノーマライズしようとするときには、以下の順番でノーマライズされるため、この条件を満たしています。</p>
<ul>
<li><p>最初の <code class="docutils literal notranslate"><span class="pre">iii</span></code> （ <code class="docutils literal notranslate"><span class="pre">Ⅲ</span></code> に対応）</p>
<p><a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> は最長共通接頭辞探索を行うため、 最初は <code class="docutils literal notranslate"><span class="pre">ii</span></code> や <code class="docutils literal notranslate"><span class="pre">i</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">iii</span></code> が使用されます。</p>
</li>
<li><p>残りの <code class="docutils literal notranslate"><span class="pre">i</span></code> （ <code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> に対応）</p></li>
</ul>
</li>
</ol>
</li>
</ul>
</section>
<section id="id11">
<h3>感謝<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>i10aさん</p></li>
<li><p>篠田さん</p></li>
</ul>
</section>
</section>
<section id="release-12-1-0-2022-11-29">
<span id="release-12-1-0"></span><h2>12.1.0 リリース - 2022-11-29<a class="headerlink" href="#release-12-1-0-2022-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id12">
<h3>改良<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">load</span></code> のスローログの出力に対応しました。</p>
<p>この機能は、Groongaのパフォーマンスチューニングに使用します。例えば、 <code class="docutils literal notranslate"><span class="pre">load</span></code> が遅いときに、この機能を使うことで平均よりも時間がかかっているレコードを検出できます。</p>
<p>環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> を指定することで、スローログの出力が有効になります。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> については以下のとおりです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> にはしきい値となる時間を秒単位で指定します。小数を指定することで、1秒よりも短い時間も指定できます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> で指定された時間よりも時間がかかっている処理がある場合、デバッグレベルのログが出力されます。</p></li>
</ul>
<p>ログレベルの設定は <a class="reference internal" href="reference/executables/groonga.html#cmdoption-groonga-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">log-level</span></code></a> オプションまたは <a class="reference internal" href="reference/commands/log_level.html"><span class="doc">log_level</span></a> コマンドで変更可能です。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> にどのような値を指定すべきかは環境や調べたい内容に依存します。例えば、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の件数と所要時間から、1レコードあたりの所要時間を求め、その値を指定することが考えられます。こうすることで、平均よりも <code class="docutils literal notranslate"><span class="pre">load</span></code> に時間がかかっているレコードを調べることができます。</p>
<p><code class="docutils literal notranslate"><span class="pre">load</span></code> の所要時間は <a class="reference internal" href="reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a> から確認することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">27.139000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|&gt;</span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memo</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.841000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|</span><span class="p">:</span><span class="mi">000133702000000</span> <span class="n">load</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">100000</span><span class="p">]</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.842000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|</span><span class="p">:</span><span class="mi">000133703000000</span> <span class="n">send</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.842000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|&lt;</span><span class="mi">000133703000000</span> <span class="n">rc</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>この例では、所要時間は以下のようになっています。</p>
<ul class="simple">
<li><p>レコード数: 100000件</p></li>
<li><p>所要時間: 2分13秒 = 133秒 （ <code class="docutils literal notranslate"><span class="pre">load</span></code> の開始時間 16:43:27 と <code class="docutils literal notranslate"><span class="pre">load</span></code> の終了時間（ <code class="docutils literal notranslate"><span class="pre">rc=0</span></code> ）16:43:40 に基づいています。 ）</p></li>
<li><p>1行あたりの所要時間: 0.00133 秒</p></li>
</ul>
<p>したがって、どのレコードが時間がかかっているのか調べるためには、 <code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> に <code class="docutils literal notranslate"><span class="pre">0.00133</span></code> を指定します。</p>
<p>スローログを有効化すると以下の悪影響があることに注意してください。</p>
<ul class="simple">
<li><p>パフォーマンスの悪化</p></li>
<li><p>ログサイズの肥大化</p></li>
</ul>
<p>そのため、必要な場合にのみこのスローログを有効にすることを推奨します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_is_reference_count_enable()</span></code> を追加しました。</p>
<p>参照カウントモードが有効になっているかどうかの真偽値を返却します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_set_reference_count_enable(bool</span> <span class="pre">enable)</span></code> を追加しました。</p>
<p>参照カウントモードの有効/無効を切り替えます。</p>
<p>安全のため、複数のテーブルを開いている場合は参照カウントモードを切り替えません。</p>
</li>
<li><p>[<a class="reference internal" href="reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_is_back_trace_enable()</span></code> を追加しました。</p>
<p>バックトレースの出力が有効になっているかどうかの真偽値を返却します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_set_back_trace_enable(bool</span> <span class="pre">enable)</span></code> を追加しました。</p>
<p>バックトレース(back trace)の出力の有効/無効を切り替えます。</p>
<p>バックトレースの出力時にクラッシュする環境があるため、その環境では無効化します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">back_trace</span></code> と <code class="docutils literal notranslate"><span class="pre">reference_count</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">back_trace</span></code> はバックトレースの出力が有効になっているかどうかを真偽値で返却します。</p>
<p><code class="docutils literal notranslate"><span class="pre">reference_count</span></code> は参照カウントモードが有効になっているかどうかを真偽値で返却します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1654237168.304533</span><span class="p">,</span>
    <span class="mf">0.0001480579376220703</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
    <span class="s2">&quot;back_trace&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;reference_count&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id13">
<h3>修正<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="reference/columns/vector.html"><span class="doc">ベクターカラム</span></a>] 重み付きベクターカラムで <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> を指定したとき、結果が整数で表示されていた問題を修正しました。</p>
<p>参照型の重み付きベクターカラムにはこの問題はなく、参照型ではない重み付きベクターカラムにだけこの問題がありました。</p>
<p>内部的な処理は浮動小数点数で行われていましたが、最終的な結果の表示が整数になっていました。</p>
<p>以下は、この問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast&quot;</span><span class="p">,</span>
  <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
    <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.2</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0,0.0,0.0],1]</span>
<span class="n">select</span> <span class="n">Memos</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Groonga is fast&quot;,</span>
<span class="c1">#         {</span>
<span class="c1">#           &quot;groonga&quot;: 2,</span>
<span class="c1">#           &quot;full text search&quot;: 1</span>
<span class="c1">#         }</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tags</span></code> カラムが <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型の重み付きベクターカラム、つまり参照型でない重み付きベクターカラムです。</p>
<p>この例の <code class="docutils literal notranslate"><span class="pre">select</span></code> の結果の以下の部分は、それぞれ2.8、1.2であるべきですが、2、1と誤った結果が返却されていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;groonga&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この修正により、以下のように正しい結果が返却されるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Groonga is fast&quot;,</span>
<span class="c1">#         {</span>
<span class="c1">#           &quot;groonga&quot;: 2.8,</span>
<span class="c1">#           &quot;full text search&quot;: 1.2</span>
<span class="c1">#         }</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="release-12-0-9-2022-10-28">
<span id="release-12-0-9"></span><h2>12.0.9リリース - 2022-10-28<a class="headerlink" href="#release-12-0-9-2022-10-28" title="この見出しへのパーマリンク">#</a></h2>
<section id="id14">
<h3>改良<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 9 向けのパッケージをサポートしました。</p>
<p><a class="reference internal" href="#release-12-0-8"><span class="std std-ref">12.0.8リリース - 2022-10-03</span></a> でサポートしていましたが、アナウンスしていませんでした。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/escalate.html"><span class="doc">escalate</span></a>] <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> を追加しました。（実験的）</p>
<p><code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> はHTML用のノーマライザーです。</p>
<p>現在 <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> は <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> といったタグの削除と、<code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> といった文字参照の展開を行います。</p>
<p>以下は <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="n">NormalizerHTML</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666923364.883798</span><span class="p">,</span><span class="mf">0.0005481243133544922</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp; Mroonga &amp; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除され、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> に展開されています。</p>
<p>タグを削除するかどうかは <code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;remove_tag&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924069.278549</span><span class="p">,</span><span class="mf">0.0001978874206542969</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;span&gt; Groonga &amp; Mroonga &amp; Rroonga &lt;/span&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除されていません。</p>
<p>文字参照を展開するかどうかは <code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;expand_character_reference&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924357.099782</span><span class="p">,</span><span class="mf">0.0002346038818359375</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は展開されていません。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.2に更新しました。</p>
<p>CVE-2022-41741とCVE-2022-41742のセキュリティの修正が含まれています。これらのセキュリティーの修正の詳細については、<a class="reference external" href="https://nginx.org/en/CHANGES">https://nginx.org/en/CHANGES</a> を参照してください。</p>
</li>
<li><p>メモリーが不足した際に、同じログが大量に出力されないように変更しました。</p>
<p>メモリーが不足した際に、 <code class="docutils literal notranslate"><span class="pre">mmap</span> <span class="pre">failed!!!!</span></code> というメッセージが大量にログが記載されることがありました。このメッセージを可能な限り重複してログ出力されないように改良しました。</p>
</li>
</ul>
</section>
<section id="id15">
<h3>修正<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="reference/commands/select.html#select-n-workers"><span class="std std-ref">n_workers</span></a> を指定したとき、Groongaがクラッシュしたり、誤った結果を返すことがある問題を修正しました。</p>
<p>この問題は、 <a class="reference internal" href="reference/commands/select.html#select-n-workers"><span class="std std-ref">n_workers</span></a> に <code class="docutils literal notranslate"><span class="pre">1</span></code> より大きい値を指定し、かつ同時に <code class="docutils literal notranslate"><span class="pre">drilldowns[{LABEL}].filter</span></code> を使用している場合に発生していました。</p>
<p>この問題は内部的な並列処理の際に、誤った値（オブジェクト）を参照していたことが原因で発生していました。そのため、上記の条件が満たされたとき、内部的に並列処理のタイミングによって、Groongaがクラッシュしたり誤った値を返すことがありました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-8-2022-10-03">
<span id="release-12-0-8"></span><h2>12.0.8リリース - 2022-10-03<a class="headerlink" href="#release-12-0-8-2022-10-03" title="この見出しへのパーマリンク">#</a></h2>
<section id="id16">
<h3>改良<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数（実験的）の仕様を使いやすいように変更しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の外部の結果セットを使用しないように変更しました。</p>
<p>前回の仕様では、ユーザーはどのくらいの結果が <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> に渡されるのか推測して最初のしきい値を決める必要があり、不便でした。</p>
<p>以下は前回の <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number_column</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span>
                               <span class="o">...</span><span class="p">,</span>
                               <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CONDITION1</span></code> は <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> の結果が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> 以下の時に実行されます。ユーザーは <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> を決めるのに <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> がどのくらいの結果を返すのか推測する必要がありました。</p>
<p>今回のリリースから、ユーザーが <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> がどのくらいの結果を返すのか推測する必要がなくなり、使いやすくなりました。</p>
<p>この変更により、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の構文が以下の通り変更されています。</p>
<p>前回の構文</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span><span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p>新しい構文</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">CONDITION_1</span><span class="p">,</span> <span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p>以下は構文の変更の詳細です。</p>
<ul class="simple">
<li><p>最初の条件のためのしきい値は不要となりました。</p></li>
<li><p>引数の指定を必須としました。最初の条件が必須となります。</p></li>
<li><p>最初の引数を常に実行します。</p></li>
</ul>
<p>この関数は実験的な関数です。将来的にこれらの動作は変更になる可能性があります。</p>
</li>
<li><p>[<a class="reference internal" href="install/cmake.html"><span class="doc">CMakeを使ってGroongaをビルドする方法</span></a>] CMakeを使ってビルドする方法を追加しました。</p></li>
<li><p>[<a class="reference internal" href="install/others.html"><span class="doc">その他</span></a>] GNU Autotoolsを使ってビルドする場合に、Apache Arrowの機能を有効化/無効化する方法について追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="reference/commands/select.html#select-drilldowns-label-table"><span class="std std-ref">drilldowns[${LABEL}].table</span></a> のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="contribution/documentation/i18n.html"><span class="doc">国際化</span></a>] 翻訳方法を更新しました。</p></li>
</ul>
</section>
<section id="id17">
<h3>修正<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> で冪等でない（繰り返し実行すると結果が変わることがある）定義をした時に、Groongaが誤った結果を返すことがある問題を修正しました。</p>
<p>これは、検索する値について、値を受け取った後と、トークナイズした後の二回ノーマライズしていたことが原因です。</p>
<p>Groongaはレコードを追加する時に、インデックス用のテーブルに設定したトークナイザーとノーマライザーを使って、登録するデータをトークナイズしてからノーマライズしています。検索する値についても、インデックス用のテーブルに設定したトークナイザーとノーマライザーを使って、トークナイズしてからノーマライズして、その後インデックスと照合します。両者は同じトークナイザーとノーマライザーを使うので、検索する値がインデックスに登録したデータと同じであれば、インデックスに格納されている状態と同じ状態になります。</p>
<p>しかし、いままでGroongaは検索する値だけを余分にノーマライズしていました。</p>
<p><a class="reference internal" href="reference/normalizers/normalizer_auto.html"><span class="doc">NormalizerAuto</span></a> といった組み込みのノーマライザーは冪等である（繰り返し実行しても結果が変わらない）ため、この問題は発生しません。一方で、 <a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> はユーザー自身がノーマライザーの定義をすることができます。そのため、冪等でない（繰り返し実行すると結果が変わることがある）定義をすることができました。</p>
<p><a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> に冪等でない定義が存在する場合、検索する値のみが余分にノーマライズされることで、インデックスに登録したデータと検索する値が一致しない場合がありました。</p>
<p>そのような場合、ヒットするはずのデータがヒットしなかったり、ヒットしないはずのデータがヒットしたりしていました。</p>
<p>以下はこの問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">ColumnNormalizations</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">ColumnNormalizations</span> <span class="n">target_column</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">ColumnNormalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">ColumnNormalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;target_column&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;target_column&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Targets</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Targets</span> <span class="n">column_normalizations_target_column</span> <span class="n">COLUMN_INDEX</span> \
  <span class="n">ColumnNormalizations</span> <span class="n">target_column</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;c&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="n">Terms</span> \
  <span class="n">TABLE_PAT_KEY</span> \
  <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram&#39;</span> \
  <span class="o">--</span><span class="n">normalizers</span> <span class="s1">&#39;NormalizerTable(&quot;normalized&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;ColumnNormalizations.normalized&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;target&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;target_column&quot;)&#39;</span>

<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">query</span> <span class="n">content</span><span class="p">:</span><span class="nd">@a</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1664781132.892326</span><span class="p">,</span><span class="mf">0.03527212142944336</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">Memos</span> <span class="pre">--query</span> <span class="pre">content:&#64;a</span></code> の結果の期待値は <code class="docutils literal notranslate"><span class="pre">a</span></code> ですが、Groongaは <code class="docutils literal notranslate"><span class="pre">c</span></code> を返していました。これは、入力された <code class="docutils literal notranslate"><span class="pre">a</span></code> が <code class="docutils literal notranslate"><span class="pre">ColumnNormalizations</span></code> の定義にしたがって <code class="docutils literal notranslate"><span class="pre">b</span></code> にノーマライズされ、その後、 ノーマライズされた <code class="docutils literal notranslate"><span class="pre">b</span></code> を更に <code class="docutils literal notranslate"><span class="pre">c</span></code> にノーマライズしていたためです。結果的に、入力された <code class="docutils literal notranslate"><span class="pre">a</span></code> は <code class="docutils literal notranslate"><span class="pre">c</span></code> に変換され、 <code class="docutils literal notranslate"><span class="pre">Memos</span></code> テーブルの <code class="docutils literal notranslate"><span class="pre">{&quot;content&quot;:&quot;c&quot;}</span></code> にマッチしていました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-7-2022-08-29">
<span id="release-12-0-7"></span><h2>12.0.7リリース - 2022-08-29<a class="headerlink" href="#release-12-0-7-2022-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id18">
<h3>改良<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> を追加しました。(実験的)</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は既存のマッチエスカレーション( <a class="reference internal" href="spec/search.html"><span class="doc">検索</span></a> )と似ています。この関数は、全ての条件で使えます。（既存のマッチエスカレーションは、一つの転置インデックスによる全文検索で使えます。）</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は検索結果の数を制限したい時に便利です。検索結果の数の制限は、 <code class="docutils literal notranslate"><span class="pre">--limit</span></code> でもできますが、 <code class="docutils literal notranslate"><span class="pre">--limit</span></code> は全ての条件を評価した後に評価されます。<code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は結果セットが <code class="docutils literal notranslate"><span class="pre">THRESHOLD</span></code> より多くのレコードを持っていたら、その時点で評価を終了します。つまり、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は条件の評価の数を減らせる可能性があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の構文は以下の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span>
         <span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span>
         <span class="o">...</span><span class="p">,</span>
         <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">THRESHOLD_N</span></code> は、0や29のような正の数です。 <code class="docutils literal notranslate"><span class="pre">CONDITION_N</span></code> は <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">29</span></code> のような <a class="reference internal" href="reference/grn_expr/script_syntax.html"><span class="doc">スクリプト構文</span></a> を使った文字列です。</p>
<p>現在の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> 以下の場合、 <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span></code> が実行されます。同様に、 <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span></code> 評価後の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_2</span></code> 以下の場合、 <code class="docutils literal notranslate"><span class="pre">CONDITION_2</span></code> が実行されます。 <code class="docutils literal notranslate"><span class="pre">CONDITION_2</span></code> 評価後の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_3</span></code> より大きい場合、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> は終了します。</p>
<p>全ての <code class="docutils literal notranslate"><span class="pre">CONDITION</span></code> が実行された場合、 <code class="docutils literal notranslate"><span class="pre">escalate(THRESHOLD_1,</span> <span class="pre">CONDITION_1,</span> <span class="pre">...,</span> <span class="pre">THRESHOLD_N,</span> <span class="pre">CONDITION_N)</span></code> は <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N</span></code> と同じです。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;!</span></code> のような論理演算子と一緒に使えます。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>number_column &gt; 10 &amp;&amp; escalate(THRESHOLD_1, CONDITION_1,
                               ...,
                               THRESHOLD_N, CONDITION_N)
number_column &gt; 10 &amp;! escalate(THRESHOLD_1, CONDITION_1,
                               ...,
                               THRESHOLD_N, CONDITION_N)
</pre></div>
</div>
<p>これらは、 <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span> <span class="pre">&amp;&amp;</span> <span class="pre">(CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N)</span></code> と <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span> <span class="pre">&amp;!</span> <span class="pre">(CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N)</span></code> と同じです。</p>
<p>しかし、これらの挙動は使いにくいため変更される可能性があります。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.1に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--n_workers</span></code> オプションのドキュメントを追加しました。</p></li>
</ul>
</section>
<section id="id19">
<h3>修正<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>OR検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した場合、Groongaの応答が遅くなることがある問題を修正しました。</p>
<p>OR検索の結果が多い場合や多くのOR条件をもつクエリー場合に、 &quot;request_cancel&quot; コマンドが原因でGroongaのレスポンスが遅くなることがあります。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-6-2022-08-04">
<span id="release-12-0-6"></span><h2>12.0.6リリース - 2022-08-04<a class="headerlink" href="#release-12-0-6-2022-08-04" title="この見出しへのパーマリンク">#</a></h2>
<section id="id20">
<h3>改良<a class="headerlink" href="#id20" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>groonga-delta用の新しいMuninプラグインを追加しました。</p>
<p>このプラグインによって、以下の項目を監視できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-import</span></code> がローカルのストレージ上の <code class="docutils literal notranslate"><span class="pre">.grn</span></code> ファイルをインポートできているかどうか。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-import</span></code> がMySQLの差分データをインポートできているかどうか。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-apply</span></code> がインポートしたデータを適用できているかどうか。</p></li>
<li><p>適用したデータの総サイズ。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/column_copy.html"><span class="doc">column_copy</span></a>] 重み付きベクターをサポートしました。</p>
<p>以下のように、重み付きベクターの値を <code class="docutils literal notranslate"><span class="pre">column_copy</span></code> でコピーできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">CopyFloat32Value</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">CopyFloat32Value</span> <span class="n">source_tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">CopyFloat32Value</span> <span class="n">destination_tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">CopyFloat32Value</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!!!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;source_tags&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
    <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span>
<span class="n">column_copy</span> <span class="n">CopyFloat32Value</span> <span class="n">source_tags</span> <span class="n">CopyFloat32Value</span> <span class="n">destination_tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">select</span> <span class="n">CopyFloat32Value</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;destination_tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;source_tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!!!&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
          <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
          <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri) のサポートをやめました。</p>
<p>Ubuntu 21.10 は、2022年7月でEOLとなったためです。</p>
</li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 10 (buster) のサポートをやめました。</p>
<p>Debian 10 は、2022年8月でEOLとなるためです。</p>
</li>
</ul>
</section>
<section id="id21">
<h3>修正<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">n_workers</span></code> オプションを使ってドリルダウンを並行して実行したときにGroongaがクラッシュすることがある問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--filter</span></code> に非常に長い式を指定するとシンタックスエラーになる問題を修正しました。</p>
<p>今まで <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 用のスタックサイズを100にしていたため発生していました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-5-2022-06-29">
<span id="release-12-0-5"></span><h2>12.0.5リリース - 2022-06-29<a class="headerlink" href="#release-12-0-5-2022-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id22">
<h3>改良<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 検索エスカレーションによる前方一致検索のパフォーマンスを少し改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL]._key</span></code> に重み付き参照ベクターカラムを指定できるようになりました。 [GitHub#1366][naoaさんがパッチ提供]</p>
<p>今までは、ドリルダウンのキーに重み付き参照ベクターカラムを指定すると、Groongaが誤った結果を返していました。</p>
<p>例えば、以下のタグ検索は、今まで誤った結果を返していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">date</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1656480220.591901</span><span class="p">,</span>
    <span class="mf">0.0005342960357666016</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">80</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;sticker&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;ruby&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">8</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>今回のリリースから上記のクエリーは、以下のように正しい結果を返します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span>   <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span>   <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">4</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> や <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使っていても、ドリルダウンのキーに重み付き参照ベクターカラムを指定できるようになりました。 [GitHub#1367][naoaさんがパッチ提供]</p>
<p>今までは、 <code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> や <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使っているときに、ドリルダウンのキーに重み付き参照ベクターカラムを指定するとGroongaは誤った結果、またはエラーを返していました。</p>
<p>例えば、今まで以下のクエリーはエラーを返していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">date</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1656473820.734894</span><span class="p">,</span>
    <span class="mf">0.03771400451660156</span><span class="p">,</span>
    <span class="s2">&quot;[hash][add][           ] key size unmatch&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;grn_hash_add&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hash.c&quot;</span><span class="p">,</span>
        <span class="mi">3405</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>今回のリリースから上記のクエリーは、以下のように正しい結果を返します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">4</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="known-issues">
<h3>既知の問題<a class="headerlink" href="#known-issues" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id23">
<h3>感謝<a class="headerlink" href="#id23" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-4-2022-06-06">
<span id="release-12-0-4"></span><h2>12.0.4リリース - 2022-06-06<a class="headerlink" href="#release-12-0-4-2022-06-06" title="この見出しへのパーマリンク">#</a></h2>
<section id="id24">
<h3>改良<a class="headerlink" href="#id24" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 22.04 (Jammy Jellyfish)をサポートしました。</p></li>
<li><p><cite>groonga-benchmark</cite> の提供をやめました。</p>
<p>誰も使用しておらず、メンテナンスもできないためです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">memory_map_size</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">status</span></code> コマンドを使うことで、Groongaのメモリーマップサイズの合計を取得できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1654237168.304533</span><span class="p">,</span>
    <span class="mf">0.0001480579376220703</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
    <span class="s2">&quot;memory_map_size&quot;</span><span class="p">:</span> <span class="mi">70098944</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、Windowsでは、Mroogaが物理メモリーとスワップ領域を使い果たした場合、それ以上メモリーをマップすることができません。そのため、この値を監視することで、メモリーが十分でない環境でもメモリーマップサイズを適切にコントロールできます。</p>
</li>
</ul>
</section>
<section id="id25">
<h3>修正<a class="headerlink" href="#id25" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した時Groongaの応答が遅くなることがある問題を修正しました。</p>
<p>特に、検索対象のレコード数が多い時に、Groongaの応答がとても遅くなることがあります。</p>
</li>
<li><p>文字列リストをint32のベクターにキャストできない問題を修正しました。</p>
<p>例えば、以下のキャストは失敗していました。</p>
<ul class="simple">
<li><p>[&quot;10&quot;, &quot;100&quot;] -&gt; [10, 100]</p></li>
</ul>
<p>この問題は、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の引数として、 <code class="docutils literal notranslate"><span class="pre">input_type</span></code> に <code class="docutils literal notranslate"><span class="pre">apache-arrow</span></code> を指定したときのみ発生します。 この問題は、Groonga 12.0.2以降で発生します。</p>
</li>
<li><p>GroongaのMuninプラグインがAlmaLinux 8 とCentOS 7上で動作しない問題を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-12-0-3-2022-04-29">
<span id="release-12-0-3"></span><h2>12.0.3リリース - 2022-04-29<a class="headerlink" href="#release-12-0-3-2022-04-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id26">
<h3>改良<a class="headerlink" href="#id26" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中のメモリー使用量を改善しました。</p>
<p>いままで、Groongaは <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中に確保したオブジェクト(オブジェクトとは、テーブルやカラム、インデックスなどです。)と一時テーブルを <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> の実行完了まで保持し続けていました。</p>
<p>この機能によって、Groongaは、1つのシャードを処理した後すぐに参照を減らします。そのため、Groongaは、 <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> の実行中にメモリーを解放できるようになり、Groongaのメモリー使用量を削減できることがあります。</p>
<p>この機能は参照カウントモードのときのみ有効です。<code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> と設定することで、参照カウントモードを有効にできます。</p>
<p>加えて、Groongaは、この機能によって <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中に一時テーブルを動的に解放します。そのため、Groongaのメモリー使用量を削減できます。この改善は、参照カウントモードが有効でなくても効果があります。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE/MISSING_NIL</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE/MISSING_NIL</span></code> を持つカラムがある場合、これらのカラムのダンプに失敗していました。このリリースから、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドはこれらのカラムをサポートしました。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>],[<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 入力としてベクターをサポートしました。[groonga-dev,04956][Reported by shinonon]</p>
<p>例えば、以下のようにJSONデータ内のベクターに対して検索キーワードの周辺テキストを抽出できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_title</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">title</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_contents</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span><span class="o">|</span><span class="n">WITH_POSITION</span>   <span class="n">Entries</span> <span class="n">contents</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga and MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on &lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt;&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>今までも、 <code class="docutils literal notranslate"><span class="pre">--output_columns</span> <span class="pre">'snippet_html(contents[1])'</span></code> のように <code class="docutils literal notranslate"><span class="pre">snippet*</span></code> を指定することで以下のようにベクターに対して検索キーワードの周辺テキストを抽出できますが、この方法ではどの要素を出力すればよいかわかりません。どの要素が検索にヒットしたかわからないためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents[0]), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">vector_join</span></code>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">vector_join()</span></code> を追加しました。 [groonga-dev,04956][shinononさんの報告]</p>
<p>この関数は各要素を結合します。この関数の第二引数で区切り文字を指定できます。</p>
<p>例えば、以下のようにベクターに対して <code class="docutils literal notranslate"><span class="pre">snippet()</span></code> や <code class="docutils literal notranslate"><span class="pre">snippet_html()</span></code> を実行できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">vector</span>

<span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_title</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">title</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_contents</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span><span class="o">|</span><span class="n">WITH_POSITION</span>   <span class="n">Entries</span> <span class="n">contents</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga and MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(vector_join(contents, &quot;</span><span class="se">\n</span><span class="s1">&quot;)), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span> <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1650849001.524027</span><span class="p">,</span>
    <span class="mf">0.0003361701965332031</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine</span><span class="se">\n</span><span class="s2">MySQL is a RDBMS</span><span class="se">\n</span><span class="s2">Mroonga is a MySQL storage engine based on &lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt;&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span><span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span><span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] 動的インデックス構築のようにとても大きなトークンを無視するようにしました。 [GitHub:pgroonga/pgroonga#209][Zhanzhao (Deo) Liangさんの報告]</p>
<p>Groongaはエラーを発生しなくなり、静的インデックス構築を実行する時に大きなトークンを無視し警告を出力します。</p>
</li>
</ul>
</section>
<section id="id27">
<h3>修正<a class="headerlink" href="#id27" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>パトリシアトライのテーブルにキーを追加できなくなることがある問題を修正しました。</p>
<p>この問題は、以下の条件で発生します。</p>
<ul class="simple">
<li><p>パトリシアトライのテーブルにすでにキーがある場合。</p></li>
<li><p>4096バイトのキーを追加する場合。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id28">
<h3>既知の問題<a class="headerlink" href="#id28" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id29">
<h3>感謝<a class="headerlink" href="#id29" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>shinononさん</p></li>
<li><p>Zhanzhao (Deo) Liangさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-2-2022-03-29">
<span id="release-12-0-2"></span><h2>12.0.2リリース - 2022-03-29<a class="headerlink" href="#release-12-0-2-2022-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id30">
<h3>改良<a class="headerlink" href="#id30" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] シャードを処理した直後に参照を減らすようにしました。</p>
<p>今までGroongaは、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> 終了時にすべてのシャードの参照を減らしていました。この機能によって、Groongaは、シャードを処理した後すぐに参照を減らします。この機能によって、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> 実行中のメモリー使用量を削減できることがあります。</p>
<p>この機能は参照カウントモードのときのみ有効です。<code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> と設定することで、参照カウントモードを有効にできます。</p>
<p>通常、Groongaは一度でも開いたオブジェクト(テーブル、カラム、インデックスなど)をメモリ上に保持し続けますが、たくさんのオブジェクトを開いた場合、Groongaはたくさんのメモリーを使用します。参照カウントモードでは、どこからも参照されてないオブジェクトをメモリーから開放します。これにより、Groongaのメモリー使用量が減ることがあります。</p>
</li>
<li><p>クラッシュリカバリー機能の安定性が向上しました。</p>
<p>この機能は実験的で、デフォルトで無効です。したがって、以下の改良は。一般的なユーザーには影響ありません。</p>
<ul class="simple">
<li><p>Groongaがクラッシュしたときにインデックスが破損する問題を修正しました。</p></li>
<li><p>ロックが残留する問題を修正しました。</p></li>
<li><p>クラッシュリカバリー中にGroongaがクラッシュする問題を修正しました。</p></li>
</ul>
</li>
<li><p>無名マッピングが利用可能な時のmmapのパフォーマンスを向上しました。[GitHub:MariaDB/server#1999][David CARLIERさんの提案]</p>
<p>この改善によって、Groongaのパフォーマンスが少し向上します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] 以下のタイプのカラムで静的インデックス構築をサポートしました。</p>
<ul class="simple">
<li><p>非参照重み付きベクターカラム</p></li>
<li><p>参照重み付きベクターカラム</p></li>
<li><p>参照スカラーカラム</p></li>
</ul>
<p>これらのカラムは、いままで、静的インデックス構築をサポートしていませんでした。そのため、これらのカラムにデータをロードしたあとに、インデックスを構築しても、インデックスの構築時間が長くなっていました。この改良によって、このケースでインデックス構築時間が短くなります。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいフラグ <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">column_create</span></code> に以下の新しいフラグを追加しました。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_WARN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_IGNORE</span></code></p></li>
</ul>
</div></blockquote>
<p>通常、データカラムが参照データカラムで存在しないキーを指定された場合、自動的に存在しないキーを作成し、新しいレコードを作ります。</p>
<p>このGroongaが参照先のカラムにキーを自動的に追加する挙動は、タグ検索のような検索で便利です。Groongaがロード時に自動的にデータを追加してくれるためです。</p>
<p>しかしながら、この挙動は、キー以外の値が必要な場合に不便です。キーしか存在しないレコードがあるためです。</p>
<p>このリリースで追加したフラグを使ってこの挙動を変更できます。</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code>: デフォルト値です。現在と同じ挙動になります。</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、自動的にキーを作成し、新しいレコードを追加します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code>:</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、存在しないキーを無視します。参照データカラムがスカラーカラムの場合、値は <code class="docutils literal notranslate"><span class="pre">GRN_ID_NIL</span></code> になります。参照データカラムがベクターカラムの場合、以下のようにその要素のみを無視します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;nonexistent&quot;</span><span class="p">,</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span> <span class="o">-&gt;</span>
<span class="p">[</span><span class="s2">&quot;existent1&quot;</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code>:</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、スカラーカラムとベクターカラムは存在しないキーを``GRN_ID_NIL`` として扱います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;nonexistent&quot;</span><span class="p">,</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span> <span class="o">-&gt;</span>
<span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">(</span><span class="n">GRN_ID_NIL</span><span class="p">),</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code>: デフォルト値です。 ベクターカラムのエラー応答を除いて、現在と同じ挙動になります。</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、設定操作をエラーとして扱います。データカラムがスカラーカラムの場合、 <code class="docutils literal notranslate"><span class="pre">load</span></code> は応答とログにエラーを報告します。データカラムがベクターカラムの場合、 <code class="docutils literal notranslate"><span class="pre">load</span></code> はログにエラーを報告しますが、応答にエラーを報告しません。これは非互換の変更です。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_WARN</span></code>:</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、警告メッセージをログに記録し、設定操作を無視します。対象のデータカラムが参照ベクターカラムの場合、<code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code> と <code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code> を使って挙動を決定します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_IGNORE</span></code>:</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、設定操作を無視します。対象のデータカラムが参照ベクターカラムの場合、<code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code> と <code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code> を使って挙動を決定します。</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>][<a class="reference internal" href="reference/commands/column_list.html"><span class="doc">column_list</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p>
<p>これらのコマンドは、後方互換性を維持するため、 <code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code> フラグを表示しません。これらのフラグはデフォルトの挙動を表すためです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/schema.html"><span class="doc">schema</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p>
<p>後方互換性を維持するため、 <code class="docutils literal notranslate"><span class="pre">MISSING_AND</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code> フラグを <code class="docutils literal notranslate"><span class="pre">flag</span></code> に表示しませんがそれぞれのカラムに、新しく <code class="docutils literal notranslate"><span class="pre">missing</span></code> と <code class="docutils literal notranslate"><span class="pre">invalid</span></code> キーが追加されます。</p>
</li>
<li><p>Amazon Linux 2向けのパッケージを提供するようにしました。</p></li>
<li><p>[Windows] Visual Studio 2017 でのビルドをやめました。</p>
<p>GitHub Actionsで windows-2016 のイメージが使えなくなったためです。</p>
</li>
</ul>
</section>
<section id="id31">
<h3>既知の問題<a class="headerlink" href="#id31" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id32">
<h3>感謝<a class="headerlink" href="#id32" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>David CARLIERさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-1-2022-02-28">
<span id="release-12-0-1"></span><h2>12.0.1リリース - 2022-02-28<a class="headerlink" href="#release-12-0-1-2022-02-28" title="この見出しへのパーマリンク">#</a></h2>
<section id="id33">
<h3>改良<a class="headerlink" href="#id33" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループをサポートしました。</p>
<p>同義語検索をする場合、今までは、以下のようにキーワードとその同義語をそれぞれ定義していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Thesaurus</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="n">Thesaurus</span> <span class="n">synonym</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;senna&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>上記のケースでは、<code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を検索した場合、 Groongaは、意図通り、 <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span> <span class="pre">を検索しますが、``tritonn</span></code> を検索した場合は、 Groongaは、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> のみを検索します。<code class="docutils literal notranslate"><span class="pre">tritonn</span></code> を検索した場合でも、<code class="docutils literal notranslate"><span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と検索した場合、以下のように定義を追加する必要がありました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>多くのケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開した場合、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開して欲しくなりますが、今までは、そのようなケースでは定義を追加する必要がありました。したがって、対象のキーワードに同義語がたくさんあると、同じような定義をたくさん定義する必要があるため、同義語の定義が煩雑でした。</p>
<p>加えて、同義語を削除する際も、多くのレコードを削除する必要があるので面倒でした。</p>
<p>今回のリリースから同義語の代表値を決めることで一つのグループを作れるようになりました。例えば、以下のすべてのキーワードは、 &quot;mroonga&quot; グループです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>このケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> は <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。また、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。</p>
<p>同義語を削除する際も、対象のレコードを削除するだけです。例えば、同義語から <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> を削除する場合は、 <code class="docutils literal notranslate"><span class="pre">{&quot;_key&quot;:</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;:</span> <span class="pre">&quot;representative&quot;:</span> <span class="pre">&quot;mroonga&quot;}</span></code> を削除するだけです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループにベクターを使えるようにしました。</p>
<p>以下のように、同義語グループにベクターを使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">SynonymGroups</span> <span class="n">TABLE_NO_KEY</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">SynonymGroups</span> <span class="n">synonyms</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">Synonyms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Synonyms</span> <span class="n">group</span> <span class="n">COLUMN_INDEX</span> <span class="n">SynonymGroups</span> <span class="n">synonyms</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">SynonymGroups</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;synonyms&quot;</span><span class="p">],</span>
<span class="p">[[</span><span class="s2">&quot;rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby groonga&quot;</span><span class="p">]],</span>
<span class="p">[[</span><span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">]]</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">2</span><span class="p">]</span>
<span class="n">query_expand</span> <span class="n">Synonyms</span><span class="o">.</span><span class="n">group</span> <span class="s2">&quot;rroonga&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="s2">&quot;((rroonga) OR (Ruby groonga) OR (groonga) OR (rroonga) OR (mroonga))&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>環境変数によって、バックトレースを無効にできるようにしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE</span></code> を使うことで、バックトレースの出力を無効にできます。<code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE=no</span></code> と設定すると、Groongaはバックトレースを出力しません。</p>
<p>Groongaはバックトレースをスタック領域に保持します。したがって、OSによっては、Groongaがスタック領域を使い切ってしまいクラッシュする可能性があります。<code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE=no</span></code> を使うことで、このようなケースを避けることができます。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--slices</span></code> のパフォーマンスを改善しました。</p></li>
<li><p>[Windows] VisualStudio 2022 をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 近傍検索でそれぞれの要素ごとの距離を指定できるようになりました。</p>
<p>例えば、近傍フレーズ検索なら、フレーズごとに最大距離を指定できます。この機能は今後ドキュメント化されます。そのため、機能の詳細は後日、共有します。</p>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] RPMパッケージのGroongaであっても、 <code class="docutils literal notranslate"><span class="pre">groonga-server-http</span></code> を使えるようにしました。</p></li>
</ul>
</section>
<section id="id34">
<h3>修正<a class="headerlink" href="#id34" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[Windows] Groongaがバックトレースを出力時にクラッシュする問題を修正しました。</p></li>
</ul>
</section>
<section id="id35">
<h3>既知の問題<a class="headerlink" href="#id35" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
</section>
<section id="release-12-0-0-2022-02-09">
<span id="release-12-0-0"></span><h2>12.0.0リリース - 2022-02-09<a class="headerlink" href="#release-12-0-0-2022-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく12.0.0へアップグレードできます。</p>
<p>まずはじめに Groonga 11.0.0 から 11.1.3 までの変更点を紹介します。次に、12.0.0の主な変更点を紹介します。</p>
<section id="summary-of-changes-from-groonga-11-0-0-to-11-1-3">
<h3>Groonga 11.0.0 から 11.1.3 までの主な変更点<a class="headerlink" href="#summary-of-changes-from-groonga-11-0-0-to-11-1-3" title="この見出しへのパーマリンク">#</a></h3>
<section id="new-features-and-improvements">
<h4>新規機能と改良<a class="headerlink" href="#new-features-and-improvements" title="この見出しへのパーマリンク">#</a></h4>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>] 32個以上のキーワードを使えるようにしました。</p>
<p>いままで、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> は32個以上のキーワードを指定できませんでしたが、この改良によって、32個以上のキーワードを指定できます。</p>
<p>通常の使用では、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> に32以上のキーワードは指定しませんが、 <code class="docutils literal notranslate"><span class="pre">query_expand</span></code> などを使うことによって自動的にキーワードが増加したときに対象のキーワードが32以上になることがあります。</p>
<p>今までは、このようなケースでは、Groongaはエラーになっていましたが、この改良によって、エラーが発生しなくなります。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-1-3"><span class="std std-ref">release 11.1.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_symbol</span></code> を追加しました。</p>
<p>このオプションは、正規化対象の文字列から記号(例えば #, !, &quot;, &amp;, % 等)を削除します。例えば、歌のタイトルやアーティスト名、お店の名前等の表記ゆれの防止に使えます。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-1-3"><span class="std std-ref">release 11.1.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] ISO 8601 形式をサポートしました。</p>
<p>ISO 8601形式は一般的なフォーマットです。より一般的な形式をサポートしたことによって <code class="docutils literal notranslate"><span class="pre">load</span></code> の使い勝手が良くなりました。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-1-0"><span class="std std-ref">release 11.1.0</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>] 正規表現を使ってスニペットの区切り文字を見つける新しいオプション <code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> を追加しました。</p>
<p>この機能は検索結果を文で表示したい時に便利です。</p>
<p><a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺のテキストを抽出します。 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> で抽出したテキストをスニペットと呼びます。</p>
<p>通常、 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺の200byteのテキストを返しますが、 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、センテンスの区切りを考慮しません。スニペットは、複数のセンテンスで構成されることがあります。</p>
<p><code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> オプションは、検索キーワードと同じセンテンスのテキストのみを抽出したいときに便利です。例えば、 <code class="docutils literal notranslate"><span class="pre">\.\s*</span></code> を使って対象のセンテンス内のテキストのみを抽出できます。文字列は、 <code class="docutils literal notranslate"><span class="pre">\</span></code> でエスケープする必要があることに注意してください。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-0-9"><span class="std std-ref">release 11.0.9</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/cache_limit.html"><span class="doc">cache_limit</span></a>] <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行したときにクエリーキャッシュを削除するようにしました。</p>
<p>Groongaは内部的なテーブルにクエリーキャッシュを保存しています。このテーブルは、ハッシュテーブルなので、トータルのキーサイズは最大で4GiBです。そのため、もし多くの巨大なクエリーを実行した場合、トータルのキーサイズの最大値4GiBを超え、Groongaがクエリーをキャッシュできない可能性があります。このようなケースで、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行することで、クエリーキャッシュ用のテーブルをクリアーし、Groongaがクエリーキャッシュを保存できるようにします。</p>
<p>今まではこの問題を解消するには、Groongaを再起動する必要がありましたが、この改良によって、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行するだけで問題を解消できます。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-0-6"><span class="std std-ref">release 11.0.6</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">between()</span></code> で、条件式の評価順序の最適化をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code> を設定することで、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> で条件式の評価順序の最適化を使えます。この最適化は、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> で十分にレコードを絞り込めるか、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> でほとんどレコードを絞り込めない時に効果があります。</p>
</li>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] 標準出力、標準エラー出力への出力をサポートしました。</p>
<p>この機能はDocker上でGroongaを実行する際に有用です。Dockerは標準で標準出力と標準エラー出力を記録する機能を持っています。したがって、Groongaのログを取得するために、Dockerの環境にログインする必要がなくなります。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-0-4"><span class="std std-ref">release 11.0.4</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にできるようになりました。</p>
<p>特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にして検索できるようになりました。</p>
<p>この機能は、検索キーワードと正確に同じ語を検索したい時に便利です。通常、ステミングやストップワードの除去を有効にしたほうが良い結果を得られますが、検索キーワードと正確に同じ語を検索したい場合は、これらの機能は不要です。</p>
<p>今までは、検索キーワードと正確に同じ語を検索したい場合は、専用のインデックスを作る必要がありましたが、この改良によって、専用のインデックスを作らずに検索キーワードと正確に同じ語を検索できます。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-0-3"><span class="std std-ref">release 11.0.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/string_slice.html"><span class="doc">string_slice</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">string_slice</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> は、検索結果の文字列から文字の位置や正規表現を使って、部分文字列を抽出します。この機能は、検索結果を編集したい時に便利です。</p>
<p>例えば、この機能は、検索結果からタグを除去するのに使えます。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] クエリーを並行して実行できる新しい関数を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は query と似ていますが、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は複数の OR 条件を並列に処理します。この機能を使うことで、大量のOR条件の実行速度を向上できます。</p>
<p>ただ、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> だけで複数のCPUを使います。したがって、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> と同時に実行しているクエリーは速度が低下する可能性があります。</p>
</li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] オプションをつけた複数のトークンフィルターを使えるようにしました。</p>
<p>以下の例のように、オプション付きのトークンフィルターを複数使うことができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">token_filters</span> <span class="s1">&#39;TokenFilterStopWord(&quot;column&quot;, &quot;ignore&quot;), TokenFilterNFKC130(&quot;unify_kana&quot;, true)&#39;</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> を使うことで、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 実行後に再度フィルタリングすることができます。<code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の違いは応答フォーマットです。</p>
<p><code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> の応答フォーマットは、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> と同じです。<code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の応答フォーマットは <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の実行前後の結果を出力します。</p>
<p><code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の応答フォーマットは、通常の <code class="docutils literal notranslate"><span class="pre">select</span></code> の応答と異なることに注意してください。</p>
</li>
</ul>
</section>
<section id="id36">
<h4>修正<a class="headerlink" href="#id36" title="この見出しへのパーマリンク">#</a></h4>
<ul>
<li><p>Groongaが依存している arrow-libs がバージョンアップしたことによって、Groongaのバージョンアップが失敗する問題を修正しました。</p>
<p>ただし、 arrow-libs がメジャーバージョンアップした場合は、この問題は再発します。その場合は、Groongaパッケージを再構築して対応する予定です。</p>
<p>This bug only occurs AlmaLinux 8 and CentOS 7.</p>
</li>
<li><p>[Windows] メモリー不足によって、新しくファイルのオープンに失敗した時にリソースリークする問題を修正しました。</p></li>
<li><p>オプションをサポートしているトークナイザーやノーマライザー、トークンフィルターが使われている際、多くの検索クエリーを送信するとGroongaが応答を返さなくなることがある問題を修正しました。</p></li>
<li><p>インデックス内のデータを大量に追加、削除、更新した際にインデックスが破損することがある問題を修正しました。</p>
<p>この問題は、インデックス内のデータを大量に削除しただけでも発生します。ただ、インデックスにデータを追加しただけでは発生しません。</p>
<p>詳細は、 <a class="reference internal" href="#release-11-0-0"><span class="std std-ref">release 11.0.0</span></a> を参照してください。</p>
</li>
</ul>
</section>
<section id="newly-supported-oses">
<h4>新しくサポートしたOS<a class="headerlink" href="#newly-supported-oses" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] ARM64版 AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 11 (Bullseye) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] ARM64版 Debian 11 (Bullseye) と ARM64版 Debian 10 (buster) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri)をサポートしました。</p></li>
</ul>
</section>
<section id="dropped-support-oses">
<h4>サポートをやめたOS<a class="headerlink" href="#dropped-support-oses" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] CentOS 8のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 16.04 LTS (Xenial Xerus)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="install/windows.html"><span class="doc">Windows</span></a>] Linux上のMinGWを使ってクロスコンパイルしていた以下のWindows向けパッケージの提供をやめました。</p>
<ul>
<li><p>groonga-x.x.x-x86.exe</p></li>
<li><p>groonga-x.x.x-x86.zip</p></li>
<li><p>groonga-x.x.x-x64.exe</p></li>
<li><p>groonga-x.x.x-x86.zip</p></li>
</ul>
</li>
</ul>
</section>
<section id="id37">
<h4>感謝<a class="headerlink" href="#id37" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>naoaさん</p></li>
<li><p>Anthony M. Cookさん</p></li>
<li><p>MASUDA Kazuhiroさん</p></li>
<li><p>potiさん</p></li>
<li><p>Takashi Hashidaさん</p></li>
<li><p>higchiさん</p></li>
<li><p>wi24rdさん</p></li>
<li><p>Josep Sanzさん</p></li>
<li><p>Keitaro YOSHIMURAさん</p></li>
<li><p>shibanao4870さん</p></li>
</ul>
<p>12.0.0 の主な変更点は以下の通りです。</p>
</section>
</section>
<section id="id38">
<h3>改良<a class="headerlink" href="#id38" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">pre_filter_threshold</span></code> を追加しました。</p>
<p>このオプションで、 <code class="docutils literal notranslate"><span class="pre">GRN_SUB_FILTER_PRE_FILTER_THRESHOLD</span></code> の値を変更できます。Groongaが <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> 実行時に レコード数が <code class="docutils literal notranslate"><span class="pre">GRN_SUB_FILTER_PRE_FILTER_THRESHOLD</span></code> 以下だった場合、Groongaは既に絞り込んだレコードに対して <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> を実行します。</p>
<p>-1にすると、常にこの最適化を有効にできます。</p>
</li>
<li><p>[index_column_have_source_record] 新しい関数 <code class="docutils literal notranslate"><span class="pre">index_column_have_source_record()</span></code> を追加しました。</p>
<p>インデックスに存在するトークンがGroongaに登録されているいずれかのレコードに含まれているかどうかを確認できます。</p>
<p>Groongaは、レコードの更新によってどのレコードからも使われていないトークンがあっても、それを削除しません。したがって、例えば、オートコンプリート機能を使っていると、検索候補としてどのレコードにも含まれていないトークンを返す可能性がありますが、この関数をつかうことで、不要なトークンを返さないようにできます。</p>
<p>この関数は、トークンがどのレコードにも含まれていないことを検出できるからです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">strip</span></code> を追加しました。</p>
<p>このオプションは、先頭と末尾から空白を削除します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> \
<span class="s1">&#39;NormalizerNFKC121(&quot;strip&quot;, true, </span><span class="se">\</span>
<span class="s1">                   &quot;report_source_offset&quot;, true)&#39;</span> \
<span class="s2">&quot;  hello world</span><span class="se">\t</span><span class="s2">! </span><span class="se">\t</span><span class="s2"> &quot;</span> \
<span class="n">WITH_CHECKS</span><span class="o">|</span><span class="n">WITH_TYPES</span>
 <span class="p">[</span>
   <span class="p">[</span>
     <span class="mi">0</span><span class="p">,</span>
     <span class="mf">0.0</span><span class="p">,</span>
     <span class="mf">0.0</span>
   <span class="p">],</span>
   <span class="p">{</span>
     <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;hello world!&quot;</span><span class="p">,</span>
     <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;others&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha|blank&quot;</span><span class="p">,</span>
       <span class="s2">&quot;symbol|blank&quot;</span>
     <span class="p">],</span>
     <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="mi">3</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">2</span>
     <span class="p">],</span>
     <span class="s2">&quot;offsets&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="mi">0</span><span class="p">,</span>
       <span class="mi">3</span><span class="p">,</span>
       <span class="mi">4</span><span class="p">,</span>
       <span class="mi">5</span><span class="p">,</span>
       <span class="mi">6</span><span class="p">,</span>
       <span class="mi">7</span><span class="p">,</span>
       <span class="mi">8</span><span class="p">,</span>
       <span class="mi">9</span><span class="p">,</span>
       <span class="mi">10</span><span class="p">,</span>
       <span class="mi">11</span><span class="p">,</span>
       <span class="mi">12</span><span class="p">,</span>
       <span class="mi">14</span>
     <span class="p">]</span>
   <span class="p">}</span>
 <span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">drilldown_max_n_target_records</span></code> と <code class="docutils literal notranslate"><span class="pre">drilldown[${LABEL}].max_n_target_records</span></code> を追加しました。</p>
<p>ドリルダウン対象のテーブル（フィルター結果）の中のうち最大で何レコードをドリルダウンに使うかを指定します。もし、フィルター結果のレコード数が指定した値より大きかったらフィルターした結果内のいくつかのレコードはドリルダウンには使われません。これらの引数のデフォルト値は、 <code class="docutils literal notranslate"><span class="pre">-1</span></code> です。これらの引数に <code class="docutils literal notranslate"><span class="pre">-1</span></code> がセットされた場合、Groongaは全てのレコードをドリルダウンに使います。</p>
<p>この機能はフィルター結果が非常に大きくなるかもしれない場合に有用です。大きなフィルター結果に対するドリルダウンは遅くなることがあるためです。この機能を使うことでドリルダウンに使うレコード数を制限できます。</p>
<p>以下はドリルダウンに使う最大レコード数を制限する例です。最後の2レコード（ <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">4,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> と <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">5,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> ）は使われていません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">n_likes</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_key_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">_key</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;The first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome! This is my first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also started to use Mroonga. It&#39;s also very fast! Really fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Senna&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I migrated all Senna system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Tritonn&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also migrated all Tritonn system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown_max_n_target_records</span> <span class="mi">3</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Hello&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="mi">2</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.6に更新しました。</p></li>
</ul>
</section>
</section>
<section id="release-11-1-3-2022-01-29">
<span id="release-11-1-3"></span><h2>11.1.3リリース - 2022-01-29<a class="headerlink" href="#release-11-1-3-2022-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id39">
<h3>改良<a class="headerlink" href="#id39" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>] 32個以上のキーワードを使えるようにしました。 [GitHub#1313][Takashi Hashidaさんがパッチ提供]</p>
<p>いままで、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> は32個以上のキーワードを指定できませんでしたが、この改良によって、以下のように32個以上のキーワードを指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a fast and accurate full text search engine based on inverted index. One of the characteristics of Groonga is that a newly registered document instantly appears in search results. Also, Groonga allows updates without read locks. These characteristics result in superior performance on real-time applications.</span><span class="se">\n</span><span class="s2">Groonga is also a column-oriented database management system (DBMS). Compared with well-known row-oriented systems, such as MySQL and PostgreSQL, column-oriented systems are more suited for aggregate queries. Due to this advantage, Groonga can cover weakness of row-oriented systems.</span><span class="se">\n</span><span class="s2">The basic functions of Groonga are provided in a C library. Also, libraries for using Groonga in other languages, such as Ruby, are provided by related projects. In addition, groonga-based storage engines are provided for MySQL and PostgreSQL. These libraries and storage engines allow any application to use Groonga. See usage examples.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;In widely used DBMSs, updates are immediately processed, for example, a newly registered record appears in the result of the next query. In contrast, some full text search engines do not support instant updates, because it is difficult to dynamically update inverted indexes, the underlying data structure.</span><span class="se">\n</span><span class="s2">Groonga also uses inverted indexes but supports instant updates. In addition, Groonga allows you to search documents even when updating the document collection. Due to these superior characteristics, Groonga is very flexible as a full text search engine. Also, Groonga always shows good performance because it divides a large task, inverted index merging, into smaller tasks.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  snippet(content, </span><span class="se">\</span>
<span class="s1">  &quot;groonga&quot;, &quot;inverted&quot;, &quot;index&quot;, &quot;fast&quot;, &quot;full&quot;, &quot;text&quot;, &quot;search&quot;, &quot;engine&quot;, &quot;registered&quot;, &quot;document&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;results&quot;, &quot;appears&quot;, &quot;also&quot;, &quot;system&quot;, &quot;libraries&quot;, &quot;for&quot;, &quot;mysql&quot;, &quot;postgresql&quot;, &quot;column-oriented&quot;, &quot;dbms&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;basic&quot;, &quot;ruby&quot;, &quot;projects&quot;, &quot;storage&quot;, &quot;allow&quot;, &quot;application&quot;, &quot;usage&quot;, &quot;sql&quot;, &quot;well-known&quot;, &quot;real-time&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;weakness&quot;, &quot;merging&quot;, &quot;performance&quot;, &quot;superior&quot;, &quot;large&quot;, &quot;dynamically&quot;, &quot;difficult&quot;, &quot;query&quot;, &quot;examples&quot;, &quot;divides&quot;, </span><span class="se">\</span>
<span class="s1">  { </span><span class="se">\</span>
<span class="s1">    &quot;default_open_tag&quot;: &quot;[&quot;, </span><span class="se">\</span>
<span class="s1">    &quot;default_close_tag&quot;: &quot;]&quot;, </span><span class="se">\</span>
<span class="s1">    &quot;width&quot; : 2048 </span><span class="se">\</span>
<span class="s1">  })&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1643165838.691991</span><span class="p">,</span>
    <span class="mf">0.0003311634063720703</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;[Groonga] is a [fast] and accurate [full] [text] [search] [engine] based on [inverted] [index]. One of the characteristics of [Groonga] is that a newly [registered] [document] instantly [appears] in [search] [results]. [Also], [Groonga] [allow]s updates without read locks. These characteristics result in [superior] [performance] on [real-time] [application]s.</span><span class="se">\n</span><span class="s2">[Groonga] is [also] a [column-oriented] database management [system] ([DBMS]). Compared with [well-known] row-oriented [system]s, such as [MySQL] and [PostgreSQL], [column-oriented] [system]s are more suited [for] aggregate queries. Due to this advantage, [Groonga] can cover [weakness] of row-oriented [system]s.</span><span class="se">\n</span><span class="s2">The [basic] functions of [Groonga] are provided in a C library. [Also], [libraries] [for] using [Groonga] in other languages, such as [Ruby], are provided by related [projects]. In addition, [groonga]-based [storage] [engine]s are provided [for] [MySQL] and [PostgreSQL]. These [libraries] and [storage] [engine]s [allow] any [application] to use [Groonga]. See [usage] [examples].&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;In widely used [DBMS]s, updates are immediately processed, [for] example, a newly [registered] record [appears] in the result of the next [query]. In contrast, some [full] [text] [search] [engine]s do not support instant updates, because it is [difficult] to [dynamically] update [inverted] [index]es, the underlying data structure.</span><span class="se">\n</span><span class="s2">[Groonga] [also] uses [inverted] [index]es but supports instant updates. In addition, [Groonga] [allow]s you to [search] [document]s even when updating the [document] collection. Due to these [superior] characteristics, [Groonga] is very flexible as a [full] [text] [search] [engine]. [Also], [Groonga] always shows good [performance] because it [divides] a [large] task, [inverted] [index] [merging], into smaller tasks.&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_symbol</span></code> を追加しました。</p>
<p>このオプションは、以下のように正規化対象の文字列から記号(例えば #, !, &quot;, &amp;, % 等)を削除します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span>   <span class="s1">&#39;NormalizerNFKC130(&quot;remove_symbol&quot;, true)&#39;</span>   <span class="s2">&quot;#This &amp; is </span><span class="si">%%</span><span class="s2"> a pen.&quot;</span>   <span class="n">WITH_TYPES</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1643595008.729597</span><span class="p">,</span>
    <span class="mf">0.0005540847778320312</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;this  is  a pen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] ARM64版 AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.5に更新しました。</p></li>
<li><p>[Documentation] <a class="reference internal" href="reference/commands/ruby_eval.html"><span class="doc">ruby_eval</span></a> の誤記を修正しました。[GitHub#1317][wi24rdさんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)サポートをやめました。</p>
<ul class="simple">
<li><p>Ubuntu 21.04 は、2022年1月20日でEOLとなったためです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id40">
<h3>修正<a class="headerlink" href="#id40" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] 存在しないカラムを指定してロードした時にクラッシュする問題を修正しました。</p>
<p>この問題は、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の引数として、 <code class="docutils literal notranslate"><span class="pre">input_type</span></code> に <code class="docutils literal notranslate"><span class="pre">apache-arrow</span></code> を指定したときのみ発生します。</p>
</li>
<li><p>Groongaが依存している arrow-libs がバージョンアップしたことによって、Groongaのバージョンアップが失敗する問題を修正しました。[groonga-talk,540][Josep Sanzさんの報告][Gitter,61eaaa306d9ba23328d23ce1][shibanao4870さんの報告][GitHub#1316][Keitaro YOSHIMURAさんの報告]</p>
<p>ただし、 arrow-libs がメジャーバージョンアップした場合は、この問題は再発します。その場合は、Groongaパッケージを再構築して対応する予定です。</p>
</li>
</ul>
</section>
<section id="id41">
<h3>既知の問題<a class="headerlink" href="#id41" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id42">
<h3>感謝<a class="headerlink" href="#id42" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
<li><p>wi24rdさん</p></li>
<li><p>Josep Sanzさん</p></li>
<li><p>Keitaro YOSHIMURAさん</p></li>
<li><p>shibanao4870さん</p></li>
</ul>
</section>
</section>
<section id="release-11-1-1-2021-12-29">
<span id="release-11-1-1"></span><h2>11.1.1リリース - 2021-12-29<a class="headerlink" href="#release-11-1-1-2021-12-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id43">
<h3>改良<a class="headerlink" href="#id43" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 組み合わせフレーズ近傍検索をサポートしました。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> の短縮形です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> を使って <code class="docutils literal notranslate"><span class="pre">*NP</span></code> を複数実行する式のかわりに <code class="docutils literal notranslate"><span class="pre">*NPP</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*NP&quot;</span><span class="n">a</span> <span class="mi">1</span> <span class="n">x</span><span class="s2">&quot; OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 z&quot;&quot;)</span>
</pre></div>
</div>
<p>この機能によって、上記の式を <code class="docutils literal notranslate"><span class="pre">*NPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> と書くことができます。加えて、 <code class="docutils literal notranslate"><span class="pre">*NPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> より高速です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*NPP&quot;</span><span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">)</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> のような近傍フレーズ検索のパフォーマンスを改善するために実装されました。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 順序付き組み合わせフレーズ近傍検索をサポートしました。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> の短縮形です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> を使って <code class="docutils literal notranslate"><span class="pre">*ONP</span></code> を複数実行する式のかわりに <code class="docutils literal notranslate"><span class="pre">*ONPP</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*ONP&quot;</span><span class="n">a</span> <span class="mi">1</span> <span class="n">x</span><span class="s2">&quot; OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 z&quot;&quot;)</span>
</pre></div>
</div>
<p>この機能によって、上記の式を <code class="docutils literal notranslate"><span class="pre">*ONPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> と書くことができます。加えて、 <code class="docutils literal notranslate"><span class="pre">*ONPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> は、 <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> より高速です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*ONPP&quot;</span><span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">)</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この機能は <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> のような順序付き近傍フレーズ検索のパフォーマンスを改善するために実装されました。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/request_cancel.html"><span class="doc">request_cancel</span></a>] 検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を検知しやすくしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を検知するために、リターンコードのチェックを増やしたためです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/thread_dump.html"><span class="doc">thread_dump</span></a>] 新しいコマンド <code class="docutils literal notranslate"><span class="pre">thread_dump</span></code> を追加しました。</p>
<p>現状、このコマンドはWindowsでしか動作しません。</p>
<p>このコマンド実行時の全てのスレッドのバックトレースをNOTICEレベルのログとして出力できます。</p>
<p>この機能は、Groongaが応答を返さない等の問題を解決するのに役立ちます。</p>
</li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] CentOS 8のサポートをやめました。</p>
<p>CentOS 8は、2021年12月31日でEOLとなるためです。</p>
</li>
</ul>
</section>
<section id="id44">
<h3>修正<a class="headerlink" href="#id44" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>無効なパラメータを持つインデックスカラムを削除できない問題を修正しました。 [GitHub#1301][Takashi Hashidaさんがパッチ提供]</p>
<ul>
<li><p>例えば、以下のように <code class="docutils literal notranslate"><span class="pre">column_create</span></code> を使って無効なインデックスカラムを作成した時、テーブルが削除できなくなります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Statuses</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Statuses</span> <span class="n">start_time</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt16</span>
<span class="n">column_create</span> <span class="n">Statuses</span> <span class="n">end_time</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt16</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">UInt16</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">statuses</span> <span class="n">COLUMN_INDEX</span> <span class="n">Statuses</span> <span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1639037503.16114</span><span class="p">,</span>
    <span class="mf">0.003981828689575195</span><span class="p">,</span>
    <span class="s2">&quot;grn_obj_set_info(): GRN_INFO_SOURCE: multi column index must be created with WITH_SECTION flag: &lt;Times.statuses&gt;&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;grn_obj_set_info_source_validate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;../../groonga/lib/db.c&quot;</span><span class="p">,</span>
        <span class="mi">9605</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;/tmp/d.grn&quot;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;column_create Times statuses COLUMN_INDEX Statuses start_time,end_time&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="n">false</span>
<span class="p">]</span>
<span class="n">table_remove</span> <span class="n">Times</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1639037503.16515</span><span class="p">,</span>
    <span class="mf">0.0005414485931396484</span><span class="p">,</span>
    <span class="s2">&quot;[object][remove] column is broken: &lt;Times.statuses&gt;&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;remove_columns&quot;</span><span class="p">,</span>
        <span class="s2">&quot;../../groonga/lib/db.c&quot;</span><span class="p">,</span>
        <span class="mi">10649</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;/tmp/d.grn&quot;</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;table_remove Times&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="n">false</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id45">
<h3>既知の問題<a class="headerlink" href="#id45" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id46">
<h3>感謝<a class="headerlink" href="#id46" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-1-0-2021-11-29">
<span id="release-11-1-0"></span><h2>11.1.0リリース - 2021-11-29<a class="headerlink" href="#release-11-1-0-2021-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id47">
<h3>改良<a class="headerlink" href="#id47" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] ISO 8601 形式をサポートしました。[GitHub#1228][Takashi Hashidaさんがパッチ提供]</p>
<p>この変更によって、<code class="docutils literal notranslate"><span class="pre">load</span></code> は、以下のフォーマットをサポートします。</p>
<blockquote>
<div><ul class="simple">
<li><p>YYYY-MM-ddThh:mm:ss.sZ</p></li>
<li><p>YYYY-MM-ddThh:mm:ss.s+10:00</p></li>
<li><p>YYYY-MM-ddThh:mm:ss.s-10:00</p></li>
</ul>
</div></blockquote>
<p>この構文の <code class="docutils literal notranslate"><span class="pre">T</span></code> と <code class="docutils literal notranslate"><span class="pre">Z</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">t</span></code> と <code class="docutils literal notranslate"><span class="pre">z</span></code> を使うこともできます。<code class="docutils literal notranslate"><span class="pre">-</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">/</span></code> を使うこともできます。ただし、 <code class="docutils literal notranslate"><span class="pre">/</span></code> は、ISO 8601 形式ではないことに注意してください。<code class="docutils literal notranslate"><span class="pre">/</span></code> は互換性のためにサポートしています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">case</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at_text</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01t10:00:00z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: +01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: +11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: -01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: -11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone hour threshold: +23:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone minute threshold: +00:59&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone omitting minute: +01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone omitting minute: -01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: localtime&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T19:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T19:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;compatible: date delimiter: /&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;case, time_format_iso8601(created_at), created_at_text&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">14</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;case&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;time_format_iso8601&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;created_at_text&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: 00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: +01:01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: +11:11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: -01:01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: -11:11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone hour threshold: +23:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone minute threshold: +00:59&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone omitting minute: +01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone omitting minute: -01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: localtime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;compatible: date delimiter: /&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;decimal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.123000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい <code class="docutils literal notranslate"><span class="pre">query_flags</span></code> <code class="docutils literal notranslate"><span class="pre">DISABLE_PREFIX_SEARCH</span></code> を追加しました。</p>
<p>以下のように、<code class="docutils literal notranslate"><span class="pre">DISABLE_PREFIX_SEARCH</span></code> によって、前方一致検索の演算子の <code class="docutils literal notranslate"><span class="pre">^</span></code> と <code class="docutils literal notranslate"><span class="pre">*</span></code> を検索キーワードとして使えます。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">^</span></code> や <code class="docutils literal notranslate"><span class="pre">*</span></code> を含むドキュメントを検索したい時に便利です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alan&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;ba*&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;a*&quot;</span> \
  <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;DISABLE_PREFIX_SEARCH&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;ba*&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alan&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;^a&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;_key:^a&quot;</span> \
  <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;ALLOW_COLUMN|DISABLE_PREFIX_SEARCH&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;^a&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい <code class="docutils literal notranslate"><span class="pre">query_flags</span></code> <code class="docutils literal notranslate"><span class="pre">DISABLE_AND_NOT</span></code> を追加しました。</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">DISABLE_AND_NOT</span></code> によって、 <code class="docutils literal notranslate"><span class="pre">AND</span> <span class="pre">NOT</span></code> の演算子の <code class="docutils literal notranslate"><span class="pre">-</span></code> を検索キーワードとして使えます。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">-</span></code> を含むドキュメントを検索したい時に便利です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cab-&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span>   <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;_key&quot;</span>   <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;b - a&quot;</span>   <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;DISABLE_AND_NOT&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;cab-&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id48">
<h3>修正<a class="headerlink" href="#id48" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[ブラウザーベースの管理ツール] レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信される問題を修正しました。 [Github#1186][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id49">
<h3>既知の問題<a class="headerlink" href="#id49" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id50">
<h3>感謝<a class="headerlink" href="#id50" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-9-2021-11-04">
<span id="release-11-0-9"></span><h2>11.0.9リリース - 2021-11-04<a class="headerlink" href="#release-11-0-9-2021-11-04" title="この見出しへのパーマリンク">#</a></h2>
<section id="id51">
<h3>改良<a class="headerlink" href="#id51" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a>] 正規表現を使ってスニペットの区切り文字を見つける新しいオプション <code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> を追加しました。</p>
<p><a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺のテキストを抽出します。 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> で抽出したテキストをスニペットと呼びます。</p>
<p>通常、 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺の200byteのテキストを返しますが、 <a class="reference internal" href="reference/functions/snippet.html"><span class="doc">snippet</span></a> は、センテンスの区切りを考慮しません。スニペットは、複数のセンテンスで構成されることがあります。</p>
<p><code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> オプションは、検索キーワードと同じセンテンスのテキストのみを抽出したいときに便利です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">\.\s*</span></code> を使って対象のセンテンス内のテキストのみを抽出できます。文字列は、 <code class="docutils literal notranslate"><span class="pre">\</span></code> でエスケープする必要があることに注意してください。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Documents</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span>  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">documents_content_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Documents</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Documents</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga is a fast and accurate full text search engine based on inverted index. One of the characteristics of groonga is that a newly registered document instantly appears in search results. Also, groonga allows updates without read locks. These characteristics result in superior performance on real-time applications.&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga is also a column-oriented database management system (DBMS). Compared with well-known row-oriented systems, such as MySQL and PostgreSQL, column-oriented systems are more suited for aggregate queries. Due to this advantage, groonga can cover weakness of row-oriented systems.&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Documents</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet(content, </span><span class="se">\</span>
<span class="s1">                            { </span><span class="se">\</span>
<span class="s1">                               &quot;default_open_tag&quot;: &quot;[&quot;, </span><span class="se">\</span>
<span class="s1">                               &quot;default_close_tag&quot;: &quot;]&quot;, </span><span class="se">\</span>
<span class="s1">                               &quot;delimiter_regexp&quot;: &quot;</span><span class="se">\\\\</span><span class="s1">.</span><span class="se">\\\\</span><span class="s1">s*&quot; </span><span class="se">\</span>
<span class="s1">                            })&#39;</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;fast performance&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a [fast] and accurate full text search engine based on inverted index&quot;</span><span class="p">,</span>
          <span class="s2">&quot;These characteristics result in superior [performance] on real-time applications&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_rank.html"><span class="doc">window_rank</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">window_rank()</span></code> を追加しました。</p>
<ul>
<li><p>ギャップを含む各レコードの順位を計算できます。通常、順位は、複数のレコードが同じ順位の時は増加しません。例えば、ソートキーの値が 100、 100、 200の場合、これらの順位は 1、 1、 3です。1位のレコードが2つあるので、最後のレコードの順位は2ではなく3です。</p>
<p>これは、 <a class="reference internal" href="reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a> と似ていますが、 <a class="reference internal" href="reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a> はギャップを考慮しません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Points</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">game</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">score</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Points</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;game&quot;</span><span class="p">,</span>  <span class="s2">&quot;score&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Points</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;window_rank()&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">sort_keys</span> <span class="n">score</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;game, score, rank&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="n">score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">8</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;game&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;rank&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">150</span><span class="p">,</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">400</span><span class="p">,</span>
        <span class="mi">8</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] テーブル検索時に自動的にキャストするようにしました。</p>
<p>例えば、 キーの型が <code class="docutils literal notranslate"><span class="pre">UInt64</span></code> のテーブルに <code class="docutils literal notranslate"><span class="pre">UInt32</span></code> の値をロードした場合、Groongaは、 <code class="docutils literal notranslate"><span class="pre">in_values()</span></code> でテーブルを検索するときに自動的に値を <code class="docutils literal notranslate"><span class="pre">UInt64</span></code> にキャストします。ただ、 <code class="docutils literal notranslate"><span class="pre">in_values(_key,</span> <span class="pre">10)</span></code> はこの機能の対象外です。10は、 <code class="docutils literal notranslate"><span class="pre">Int32</span></code> として解釈されるためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Numbers</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">UInt64</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Numbers</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Numbers</span>   <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span>   <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;in_values(_key, 200, 100)&#39;</span>   <span class="o">--</span><span class="n">sortby</span> <span class="n">_id</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">2</span><span class="p">],[[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;UInt64&quot;</span><span class="p">]],[</span><span class="mi">100</span><span class="p">],[</span><span class="mi">200</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.3に更新しました。</p></li>
<li><p>[<a class="reference internal" href="install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri)をサポートしました。</p></li>
</ul>
</section>
<section id="id52">
<h3>修正<a class="headerlink" href="#id52" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Groongaがコマンドエラー(例えば、filterのシンタックスエラー)発生時に応答を返さない問題を修正しました。</p>
<ul>
<li><p>これは、 <code class="docutils literal notranslate"><span class="pre">--output_type</span> <span class="pre">apache-arrow</span></code> を使っているときのみ発生します。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id53">
<h3>既知の問題<a class="headerlink" href="#id53" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
</section>
<section id="release-11-0-7-2021-09-29">
<span id="release-11-0-7"></span><h2>11.0.7リリース - 2021-09-29<a class="headerlink" href="#release-11-0-7-2021-09-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id54">
<h3>改良<a class="headerlink" href="#id54" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] &quot;[int, int,...]&quot; のような文字列を [int, int,...] のような整数のベクターにキャストするようにしました。</p>
<p>例えば、以下のように、&quot;[1, -2]&quot; のようなベクターを文字列としてロードしたとしても、 [1, -2] のように整数のベクターとして扱います。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">numbers</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Int16</span>
<span class="n">table_create</span> <span class="n">Numbers</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Int16</span>
<span class="n">column_create</span> <span class="n">Numbers</span> <span class="n">data_numbers</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">numbers</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="s2">&quot;[1, -2]&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="s2">&quot;[-3, 4]&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">dump</span>   <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span>   <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;numbers&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Numbers</span> <span class="n">data_numbers</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">numbers</span>
<span class="n">select</span> <span class="n">Data</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;numbers @ -2&#39;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;numbers&quot;</span><span class="p">,</span><span class="s2">&quot;Int16&quot;</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]]]]]</span>
</pre></div>
</div>
</div></blockquote>
<p>この機能は以下の型をサポートします。</p>
<blockquote>
<div><ul class="simple">
<li><p>Int8</p></li>
<li><p>UInt8</p></li>
<li><p>Int16</p></li>
<li><p>UInt16</p></li>
<li><p>Int32</p></li>
<li><p>UInt32</p></li>
<li><p>Int64</p></li>
<li><p>UInt64</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] 文字列として表現されたJSON配列を文字列のベクターとしてロードできるようにしました。</p>
<p>例えば、以下のように &quot;[&quot;hello&quot;, &quot;world&quot;]&quot; のような文字列として表現されたJSON配列をロードした場合、 [&quot;hello&quot;, &quot;world&quot;] のように2つの要素を持つベクターとして扱います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">strings</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">data_strings</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">strings</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;strings&quot;</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="se">\&quot;</span><span class="s2">Hello</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">World</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;strings&quot;</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="se">\&quot;</span><span class="s2">Good-bye</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">World</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dump</span>   <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span>   <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;strings&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span><span class="s2">&quot;World&quot;</span><span class="p">]],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="s2">&quot;Good-bye&quot;</span><span class="p">,</span><span class="s2">&quot;World&quot;</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">data_strings</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">strings</span>
<span class="n">select</span> <span class="n">Data</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;strings @ &quot;bye&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;strings&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;Good-bye&quot;</span><span class="p">,</span>
          <span class="s2">&quot;World&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>以前のバージョンでは、 &quot;[&quot;hello&quot;, &quot;world&quot;]&quot; のような文字列として表現されたJSON配列をロードした場合は、 [&quot;[&quot;hello&quot;, &quot;world&quot;]&quot;] のような一つの要素を持つベクターとして扱っていました。</p>
</li>
<li><p>[Documentation] 以下の項目についてのドキュメントを追加しました。</p>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグについてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc121.html"><span class="doc">NormalizerNFKC121</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC121</span></code> についてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> についてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> についてのドキュメントを追加しました。</p></li>
</ul>
</li>
<li><p>Groongaが要求する Apache Arrow のバージョンを 3.0.0 に更新しました。[GitHub#1265][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id55">
<h3>修正<a class="headerlink" href="#id55" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>テーブル作成時に無効なオプションを持つトークナイザーを指定するとメモリーリークする問題を修正しました。</p></li>
<li><p>Hashテーブルに新しいエントリーを追加できなくなることがある問題を修正しました。</p>
<p>このバグは、Groonga 11.0.6 でのみ発生し、頻繁にデータを追加、削除すると発生することがあります。もし、このバグが発生した場合は、以下の手順を実行することで、この問題を解決できます。</p>
<ol class="arabic simple">
<li><p>Groongaを11.0.6から11.0.7以降にアップグレードします。</p></li>
<li><p>元のテーブルと同じスキーマを持つ新しいテーブルを作ります。</p></li>
<li><p>元のテーブルから新しいテーブルにデータをコピーします。</p></li>
</ol>
</li>
<li><p>[Windows] メモリー不足によって、新しくファイルのオープンに失敗した時にリソースリークする問題を修正しました。</p></li>
</ul>
</section>
<section id="id56">
<h3>既知の問題<a class="headerlink" href="#id56" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id57">
<h3>感謝<a class="headerlink" href="#id57" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-6-2021-08-29">
<span id="release-11-0-6"></span><h2>11.0.6リリース - 2021-08-29<a class="headerlink" href="#release-11-0-6-2021-08-29" title="この見出しへのパーマリンク">#</a></h2>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Groonga 11.0.6 には、Hashテーブルに新しいエントリーを追加できなくなることがある問題があります。</p>
<p>この問題は、Groonga 11.0.7で修正しました。この問題は、Groonga 11.0.6でのみ発生します。したがって、Groonga 11.0.6をお使いの方は、Groonga 11.0.7以降を使うことを強くおすすめします。</p>
</div>
</div></blockquote>
<section id="id58">
<h3>改良<a class="headerlink" href="#id58" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>クラッシュ時に自動でリカバリーする機能を追加しました。(実験的な機能です。)</p>
<p>この機能は実験的な機能です。現状、この機能はまだ安定していません。</p>
<p>この機能によって、Groongaがクラッシュした時、Groongaはクラッシュした後、最初のデータベースオープン時に自動的にデータベースをリカバリーします。ただ、全てのクラッシュケースで自動的にデータベースをリカバリーできるわけではありません。クラッシュのタイミングによっては、手動でデータベースのリカバリーが必要になります。</p>
<p>この機能が有効な時、GroongaはWAL(ログ先行書き込み)を実行します。以下のツールを使うことでWALをダンプできますが、現状これらをユーザーが使う必要はありません。</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">dump-wal</span></code> コマンド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump-wal.rb</span></code> スクリプト</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/cache_limit.html"><span class="doc">cache_limit</span></a>] <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行したときにキャッシュを削除するようにしました。[GitHub#1224][higchiさんからの報告]</p>
<p>Groongaは内部的なテーブルにクエリーキャッシュを保存しています。このテーブルは、ハッシュテーブルなので、トータルのキーサイズは最大で4GiBです。そのため、もし多くの巨大なクエリーを実行した場合、トータルのキーサイズの最大値4GiBを超え、Groongaがクエリーをキャッシュできない可能性があります。このようなケースで、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行することで、クエリーキャッシュ用のテーブルをクリアーし、Groongaがクエリーキャッシュを保存できるようにします。</p>
</li>
</ul>
</section>
<section id="id59">
<h3>修正<a class="headerlink" href="#id59" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>同時期に複数のスレッドで同じオブジェクトをオープンした時に、Groongaがロックを解除しない問題を修正しました。</p>
<p>同時期に複数のスレッドが同じオブジェクトをオープンすると、最初にオブジェクトを開いたスレッド以外のスレッドは対象のオブジェクトが開かれるまで待ちます。この時、対象のオブジェクトが開かれるのを待っているスレッドもロックを取得しますが、これらのロックは解放されません。したがって、Groongaのプロセスを再起動するまでこれらのロックが残り、その新しいスレッドは、Groongaが再起動するまで、そのオブジェクトを開けません。</p>
<p>ただ、スレッドがオブジェクトを開く時間は非常に短いため、このバグは滅多に起こりません。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] <code class="docutils literal notranslate"><span class="pre">query()</span></code> と結果が異なることがある問題を修正しました。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">query(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> とした場合は、以下のレコードはマッチしますが、<code class="docutils literal notranslate"><span class="pre">query_parallel_or(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> とした場合は、今までは、以下のレコードはマッチしませんでした。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;_key&quot;:</span> <span class="pre">&quot;Bob&quot;,</span>&#160;&#160; <span class="pre">&quot;comment&quot;:</span> <span class="pre">&quot;Hey!&quot;,</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">&quot;tags&quot;:</span> <span class="pre">[&quot;expert&quot;,</span> <span class="pre">&quot;man&quot;],</span> <span class="pre">&quot;tags2&quot;:</span> <span class="pre">[&quot;beginner&quot;]}</span></code></p></li>
</ul>
<p>今回の変更によって、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> を使った場合であっても、上記のレコードがマッチするようになりました。</p>
</li>
</ul>
</section>
<section id="id60">
<h3>既知の問題<a class="headerlink" href="#id60" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id61">
<h3>感謝<a class="headerlink" href="#id61" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>higchiさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-5-2021-07-29">
<span id="release-11-0-5"></span><h2>11.0.5リリース - 2021-07-29<a class="headerlink" href="#release-11-0-5-2021-07-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id62">
<h3>改良<a class="headerlink" href="#id62" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] ノーマライザーを複数指定できるようになりました。</p>
<p>テーブル作成時に <code class="docutils literal notranslate"><span class="pre">--normalizers</span></code> オプションを使うことで、複数のノーマライザーを指定できます。互換性のため、既存の <code class="docutils literal notranslate"><span class="pre">--normalizer</span></code> を使っても複数のノーマライザーを指定できます。</p>
<p>Groonga 11.0.4 でノーマライザーをカスタマイズするための <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> を追加しました。この <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> と既存のノーマライザーを組み合わせることでより柔軟な制御ができます。</p>
<p>例えば、この機能は、以下のようなケースで有用です。</p>
<blockquote>
<div><ul class="simple">
<li><p>電話番号を検索します。ただし、データはOCRで手書きのデータを取り込みます。OCRは数字と文字列をご認識することがあります。(例えば、 5とS など)</p></li>
</ul>
</div></blockquote>
<p>具体的には以下の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Normalizations</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Normalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Normalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">}</span>
<span class="p">]</span>


<span class="n">table_create</span> <span class="n">Tels</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Tels</span> <span class="n">tel</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">TelsIndex</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizers</span> <span class="s1">&#39;NormalizerNFKC130(&quot;unify_hyphen_and_prolonged_sound_mark&quot;, true), </span><span class="se">\</span>
<span class="s1">                 NormalizerTable(&quot;column&quot;, &quot;Normalizations.normalized&quot;)&#39;</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;loose_symbol&quot;, true, &quot;loose_blank&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">TelsIndex</span> <span class="n">tel_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Tels</span> <span class="n">tel</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tels</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-4S-1234&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-45-9876&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tels</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;tel @ &quot;03-45-1234&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1625227424.560146</span><span class="p">,</span>
    <span class="mf">0.0001730918884277344</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;03-4S-1234&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>既存のノーマライザーでは、このようなケースには対応できませんでしたが、このリリースから既存のノーマライザーと <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> を組み合わせることで、このようなケースにも対応できます。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] シーケンシャルサーチのしきい値をカスタマイズできるようにしました。</p>
<p>以下のオプションを使うことで、シーケンシャルサーチを使うかどうかのしきい値をクエリーごとにカスタマイズできます。</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;max_n_enough_filtered_records&quot;:</span> <span class="pre">xx}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">max_n_enough_filtered_records</span></code> は、レコード数を指定します。 <code class="docutils literal notranslate"><span class="pre">query</span></code> または、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で、この値以下までレコードが絞り込めそうな場合、シーケンシャルサーチを使います。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;enough_filtered_ratio&quot;:</span> <span class="pre">x.x}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">enough_filtered_ratio</span></code> は、全体に占める割合を指定します。 <code class="docutils literal notranslate"><span class="pre">query</span></code> または、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で、この割合以下までレコードが絞り込めそうな場合、シーケンシャルサーチを使います。例えば、　<code class="docutils literal notranslate"><span class="pre">{&quot;enough_filtered_ratio&quot;:</span> <span class="pre">0.5}</span></code> とした場合、 <code class="docutils literal notranslate"><span class="pre">query</span></code> または <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で全体の半分まで絞り込めそうな場合はシーケンシャルサーチを使います。</p>
</li>
</ul>
</div></blockquote>
<p>具体的には以下の通りです。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Products</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">products_name</span> <span class="n">COLUMN_INDEX</span> <span class="n">Products</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Mroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PGroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ruby&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;name&quot;, &quot;r name:Ruby&quot;, {&quot;enough_filtered_ratio&quot;: 0.5})&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Products</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">products_name</span> <span class="n">COLUMN_INDEX</span> <span class="n">Products</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Mroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PGroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ruby&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;name&quot;, &quot;r name:Ruby&quot;, {&quot;max_n_enough_filtered_records&quot;: 10})&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>][<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] シーケンシャルサーチのしきい値をカスタマイズできるようにしました。</p>
<p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] と [<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] は、検索対象のレコードが十分に絞り込まれている時に、シーケンシャルサーチに切り替える機能があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span></code> / <code class="docutils literal notranslate"><span class="pre">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span></code> の値は、Groongaがシーケンシャルサーチを実行するかインデックスを使った検索をするかのしきい値として使われます。</p>
<p>今までは、以下の環境変数でのみカスタマイズ可能でした。</p>
<p><code class="docutils literal notranslate"><span class="pre">in_values()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t use auto sequential search</span>
<span class="n">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=-</span><span class="mi">1</span>
<span class="c1"># Set threshold to 0.02</span>
<span class="n">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=</span><span class="mf">0.02</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">between()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t use auto sequential search</span>
<span class="n">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=-</span><span class="mi">1</span>
<span class="c1"># Set threshold to 0.02</span>
<span class="n">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=</span><span class="mf">0.02</span>
</pre></div>
</div>
<p>環境変数によるカスタマイズは、すべてのクエリーに対して適用されますが、この機能を使うことで、クエリーごとにしきい値を指定できます。</p>
<p>具体的には以下の通りです。 <code class="docutils literal notranslate"><span class="pre">{&quot;too_many_index_match_ratio&quot;:</span> <span class="pre">x.xx}</span></code> オプションでしきい値を指定できます。このオプションの値の型は <code class="docutils literal notranslate"><span class="pre">double</span></code> 型です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">memos_timestamp</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">timestamp</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;001&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:23&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;002&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:24&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;003&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:25&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;004&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:26&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;005&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:27&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;006&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:28&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;007&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:29&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;008&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:30&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;009&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:31&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;010&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:32&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;011&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:33&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;012&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:34&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;013&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:35&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;014&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:36&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;015&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:37&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;016&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:38&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;017&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:39&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;018&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:40&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;019&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:41&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;020&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:42&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;021&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:43&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;022&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:44&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;023&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:45&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;024&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:46&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;025&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:47&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;026&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:48&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;027&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:49&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;028&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:50&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;029&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:51&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;030&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:52&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;031&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:53&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;032&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:54&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;033&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:55&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;034&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:56&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;035&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:57&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;036&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:58&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;037&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:59&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;038&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;039&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;040&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:02&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;041&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:03&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;042&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:04&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;043&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:05&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;044&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:06&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;045&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:07&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;046&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:08&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;047&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:09&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;048&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:10&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;049&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;050&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:12&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_key == &quot;003&quot; &amp;&amp; </span><span class="se">\</span>
<span class="s1">            between(timestamp, </span><span class="se">\</span>
<span class="s1">                    &quot;2014-11-10 07:25:24&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;include&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;2014-11-10 07:27:26&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;exclude&quot;, </span><span class="se">\</span>
<span class="s1">                    {&quot;too_many_index_match_ratio&quot;: 0.03})&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">memos_tag</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">tag</span>

<span class="n">select</span> \
  <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt;= 3 &amp;&amp; </span><span class="se">\</span>
<span class="s1">            in_values(tag, </span><span class="se">\</span>
<span class="s1">                     &quot;Groonga&quot;, </span><span class="se">\</span>
<span class="s1">                     {&quot;too_many_index_match_ratio&quot;: 0.7})&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_score</span><span class="p">,</span><span class="n">_key</span><span class="p">,</span><span class="n">tag</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">between()</span></code> で、条件式の評価順序の最適化をサポートしました。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] match_columns を vector で指定できるようにしました。[GitHub#1238][naoaさんがパッチ提供]</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> と <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> の <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> に vector を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">memo</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memo</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">memo</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">tag</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">tag</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga user&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga user&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_score</span><span class="p">,</span><span class="n">name</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query([&quot;name * 100&quot;, &quot;memo&quot;, &quot;tag * 10&quot;], </span><span class="se">\</span>
<span class="s1">                  &quot;Alice OR Groonga&quot;)&#39;</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 前方一致検索でセクションと重みをサポートしました。[GitHub#1240][naoaさんがパッチ提供]</p>
<p>前方一致検索でマルチカラムインデックスと、スコアーの調整ができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Memos</span> <span class="n">title</span><span class="p">,</span><span class="n">tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;MySQL&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;Terms.index.title * 2&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;G*&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">title</span><span class="p">,</span><span class="n">tags</span><span class="p">,</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;title&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga&quot;</span>
        <span class="p">],</span>
        <span class="mi">2</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">recover</span></code> で使用したオブジェクトを即時閉じるようにしました。</p>
<p>これにより、メモリ消費を抑制できます。おそらくパフォーマンスは低下していますが、許容可能な低下です。</p>
<p><code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> はまだ、使用したオブジェクトを即時閉じないので注意してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] 以下のように、 <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> に <code class="docutils literal notranslate"><span class="pre">scorer_tf_idf</span></code> を指定できるようにしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beginner&quot;</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;expert&quot;</span><span class="p">,</span> <span class="s2">&quot;passive&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Chris&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beginner&quot;</span><span class="p">,</span> <span class="s2">&quot;passive&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">users</span> <span class="n">COLUMN_INDEX</span> <span class="n">Users</span> <span class="n">tags</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_score</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="n">_id</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query_parallel_or(&quot;scorer_tf_idf(tags)&quot;, </span><span class="se">\</span>
<span class="s1">                              &quot;beginner active&quot;)&#39;</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="mf">2.098612308502197</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 展開後の語の重みを操作できるようにしました。</p>
<p>展開後の語に対して、重みを指定できます。</p>
<p>スコアーを増やしたい場合は、 <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> を使います。スコアーを減らしたい場合は、 <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> を指定します。</p>
<p>数字でスコアーの量を指定できます。負の数も指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">TermExpansions</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">TermExpansions</span> <span class="n">term</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">TermExpansions</span> <span class="n">expansions</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">TermExpansions</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;expansions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby Groonga&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">query_expand</span> <span class="n">TermExpansions</span> <span class="s2">&quot;Groonga &lt;-0.2Rroonga Mroonga&quot;</span> \
  <span class="o">--</span><span class="n">term_column</span> <span class="n">term</span> \
  <span class="o">--</span><span class="n">expanded_term_column</span> <span class="n">expansions</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="s2">&quot;Groonga &lt;-0.2((Rroonga) OR (Ruby Groonga)) Mroonga&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.1に更新しました。</p></li>
<li><p>バンドルしているApache Arrowを5.0.0に更新しました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)サポートをやめました。</p>
<ul class="simple">
<li><p>Ubuntu 20.10 は、2021年7月22日でEOLとなったためです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id63">
<h3>修正<a class="headerlink" href="#id63" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] <code class="docutils literal notranslate"><span class="pre">query_options</span></code> とその他のオプションを指定すると、その他のオプションが無視される問題を修正しました。</p>
<p>例えば、以下のケースでは、 <code class="docutils literal notranslate"><span class="pre">&quot;default_operator&quot;:</span> <span class="pre">&quot;OR&quot;</span></code> オプションは無視されていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query_parallel_or( </span><span class="se">\</span>
<span class="s1">              &quot;content&quot;, </span><span class="se">\</span>
<span class="s1">              &quot;Hello and&quot;, </span><span class="se">\</span>
<span class="s1">              {&quot;default_operator&quot;: &quot;OR&quot;, </span><span class="se">\</span>
<span class="s1">               &quot;options&quot;: {&quot;TokenFilterStopWord.enable&quot;: false}})&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id64">
<h3>既知の問題<a class="headerlink" href="#id64" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>多くのデータを削除し、同じデータを再度loadすることを繰り返すと、Groongaがヒットすべきレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id65">
<h3>感謝<a class="headerlink" href="#id65" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-4-2021-06-29">
<span id="release-11-0-4"></span><h2>11.0.4リリース - 2021-06-29<a class="headerlink" href="#release-11-0-4-2021-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id66">
<h3>改良<a class="headerlink" href="#id66" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[Normalizer] カスタマイズされたノーマライザーを使えるようになりました。</p>
<p>この機能を使うためにノーマライズ用のテーブルを定義し、このテーブルを使ってノーマライズします。つまり、カスタマイズされたノーマライザーを使うことができます。</p>
<p>例えば、以下の例では、 &quot;S&quot; を &quot;5&quot; に正規化するよう定義しています。<code class="docutils literal notranslate"><span class="pre">Substitutions</span></code> テーブルが正規化用のテーブルです。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Substitutions</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Substitutions</span> <span class="n">substituted</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Substitutions</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;substituted&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">TelLists</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">TelLists</span> <span class="n">tel</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerTable(&quot;column&quot;, &quot;Substitutions.substituted&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;report_source_offset&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">tel_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">TelLists</span> <span class="n">tel</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">TelLists</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-4S-1234&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">TelLists</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;tel @ &quot;03-45-1234&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1624686303.538532</span><span class="p">,</span>
    <span class="mf">0.001319169998168945</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;03-4S-1234&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>例えば、手書きの文字を取り込む際に誤認識されやすい語を定義できます。そうすることで、誤ったデータを正規化して正しいデータにできます。</p>
<p>この正規化用のテーブルを更新した場合は、インデックスの再構築が必要なことに注意してください。</p>
</li>
<li><p>新しいコマンド <code class="docutils literal notranslate"><span class="pre">object_warm</span></code> を追加しました。</p>
<p>このコマンドは、GroongaのDBをOSのページキャッシュに乗せます。</p>
<p>OS起動後、Groongaを一度も起動していない場合、GroongaのDBはOSのページキャッシュ上に存在しません。そのため、Groongaに対する最初の操作は遅くなります。</p>
<p>予めこのコマンドを実行した場合、Groongaへの最初の操作は速くなります。Linuxでは、 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">*.db</span> <span class="pre">&gt;</span> <span class="pre">dev/null</span></code> で同等のことができますが、Windowsでは、いままで、同様のことはできませんでした。</p>
<p>このコマンドを使うことで、LinuxでもWindowsでもGroongaのDBをOSのページキャッシュへ乗せることができます。また、テーブル、カラム、インデックス単位でも同様のことができます。したがって、よく使うテーブルやカラム、インデックスのみをOSのページキャッシュに乗せることができます。</p>
<p>このコマンドは、以下のように様々な対象に対して実行できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">index_name</span></code> と指定した場合は、指定したインデックスがOSのページキャッシュへ転送されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">column_name</span></code> と指定した場合は、指定したカラムがOSののページキャッシュへ転送されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">table_name</span></code> と指定した場合は、指定したテーブルをOSのページキャッシュへ転送します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span></code> と指定した場合は、GroongaのDB全体がOSのページキャッシュへ転送されます。</p></li>
</ul>
</div></blockquote>
<p>ただ、メモリーに空きスペースが無い場合は、このコマンドは効果がないことに注意してください。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 内で特定のレコードのスコアーを調整できるようにしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">*~</span></code> という演算子を使うことで、特定のレコードのスコアーを調整できます。<code class="docutils literal notranslate"><span class="pre">*~</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">||</span></code> と同じ論理演算子です。したがって、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">||</span></code> と同じように使えます。<code class="docutils literal notranslate"><span class="pre">*~</span></code> のデフォルトの重みは -1 です。</p>
<p>したがって、例えば、 <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code> は以下の操作を意味します。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> と <code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;</span></code> にマッチしたレコードを抽出します。</p></li>
<li><p>以下のようにスコアーを追加します。</p>
<ol class="loweralpha simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> のスコアーを計算します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code> のスコアーを計算します。</p></li>
<li><p>bのスコアーを -1 倍します。</p></li>
<li><p>このレコードのスコアーは a + b です。したがって、 aのスコアー 1 で bのスコアーが1 の場合、このレコードのスコアーは 1 + (1 * -1) = 0 です。</p></li>
</ol>
</li>
</ol>
</div></blockquote>
<p>また、 <code class="docutils literal notranslate"><span class="pre">*~${score_quantity}</span></code> とすることで、スコアーの量を指定できます。</p>
<p>具体的には、 以下の条件( <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;'</span></code> ) にマッチしたレコードのスコアーを調整します。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content @ &quot;Groonga&quot; *~2.5 content @ &quot;Mroonga&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content, _score&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span><span class="p">,</span><span class="n">_id</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">1624605205.641078</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.002965450286865234</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.5</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference internal" href="reference/commands/select.html#select-adjuster"><span class="std std-ref">adjuster</span></a> を使っても同様のことができます。<a class="reference internal" href="reference/commands/select.html#select-adjuster"><span class="std std-ref">adjuster</span></a> を使う場合、アプリケーション上で、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件と <code class="docutils literal notranslate"><span class="pre">--adjuster</span></code> 条件を作る必要がありますが、この改良で、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件のみを作成すればよくなりました。</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使って、filter条件を記述することもできます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 重み付き <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> を使うことで、重み付きの <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> を使えます。<code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> のデフォルトの重みは 0.5です。 <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> のデフォルトの重みは 2.0 です。</p>
<p><code class="docutils literal notranslate"><span class="pre">*&lt;${score_quantity}</span></code> や <code class="docutils literal notranslate"><span class="pre">*&gt;${score_quantity}</span></code> とすることで、スコアーの量を指定できます。また、 <code class="docutils literal notranslate"><span class="pre">*&lt;${score_quantity}</span></code> と指定した場合は、 ${score_quantity} の正負の符号が反転します。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;2.5</span> <span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)'</span></code> は以下の操作を意味します。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> と <code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;</span></code> にマッチしたレコードを抽出します。</p></li>
<li><p>以下のようにスコアーを追加します。</p>
<ol class="loweralpha simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> のスコアーを計算します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)</span></code> のスコアーを計算します。</p></li>
<li><p>bのスコアーは、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> によって -2.5倍されます。</p></li>
<li><p>このレコードのスコアーは a + b です。したがって、 aのスコアー 1 で bのスコアーが1 の場合、このレコードのスコアーは 1 + (1 * -2.5) = −1.5 です。</p></li>
</ol>
</li>
</ol>
</div></blockquote>
<p>具体的には、 以下の条件( <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)'</span></code> にマッチしたレコードのスコアーを調整します。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content @ &quot;Groonga&quot; *&lt;2.5 query(&quot;content&quot;, &quot;Mroonga&quot;)&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content, _score&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span><span class="p">,</span><span class="n">_id</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">1624605205.641078</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.002965450286865234</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.5</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] 標準出力、標準エラー出力への出力をサポートしました。</p>
<p>[<a class="reference internal" href="reference/log.html#process-log"><span class="std std-ref">プロセスログ</span></a>] と [<a class="reference internal" href="reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a>] が標準出力と標準エラー出力への出力をサポートしました。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--log-path</span> <span class="pre">-</span></code> や <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">-</span></code> と指定した場合、Groongaはログを標準出力に出力します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--log-path</span> <span class="pre">+</span></code> や <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">+</span></code> と指定した場合、Groongaはログを標準エラー出力に出力します。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="reference/log.html#process-log"><span class="std std-ref">プロセスログ</span></a>] はGroongaの動作全てに関することのログです。 [<a class="reference internal" href="reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a>] は、クエリー処理に関することだけのログです。</p>
<p>この機能はDocker上でGroongaを実行する際に有用です。Dockerは標準で標準出力と標準エラー出力を記録する機能を持っています。したがって、Groongaのログを取得するために、Dockerの環境にログインする必要がなくなります。</p>
<p>例えば、この機能は、以下のようなケースで有用です。</p>
<blockquote>
<div><ul>
<li><p>Docker上のGroongaのスロークエリーを解析したい場合。</p>
<p>Groonga起動時に <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">-</span></code> と指定している場合、以下のコマンドを実行するだけでスロークエリーを解析できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">${container_name}</span> <span class="pre">|</span> <span class="pre">groonga-query-log-analyze</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>このように、 Groonga上のDockerから出力したクエリーログを使って、簡単にスロークエリの解析ができます。</p>
</li>
<li><p>[ドキュメント] <code class="docutils literal notranslate"><span class="pre">string_substring</span></code> に不足している内容を追加しました。[Github#1209][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id67">
<h3>既知の問題<a class="headerlink" href="#id67" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="id68">
<h3>感謝<a class="headerlink" href="#id68" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-3-2021-05-29">
<span id="release-11-0-3"></span><h2>11.0.3リリース - 2021-05-29<a class="headerlink" href="#release-11-0-3-2021-05-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id69">
<h3>改良<a class="headerlink" href="#id69" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> を無効にできるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> は語幹を使った検索ができます。例えば <code class="docutils literal notranslate"><span class="pre">develop</span></code> も <code class="docutils literal notranslate"><span class="pre">developing</span></code> も <code class="docutils literal notranslate"><span class="pre">developed</span></code> も <code class="docutils literal notranslate"><span class="pre">develops</span></code> も、すべてステミングすると <code class="docutils literal notranslate"><span class="pre">develop</span></code> になります。そのため、 <code class="docutils literal notranslate"><span class="pre">develops</span></code> というクエリーで <code class="docutils literal notranslate"><span class="pre">develop</span></code> も <code class="docutils literal notranslate"><span class="pre">developing</span></code> も <code class="docutils literal notranslate"><span class="pre">developed</span></code> も検索できます。</p></li>
<li><p>今回のリリースでは、以下のように特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> を無効にして検索できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stem</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="s1">&#39;TokenFilterStem(&quot;keep_original&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I develop Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m developing Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I developed Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;&quot;developed groonga&quot;&#39;</span> \
  <span class="o">--</span><span class="n">query_options</span> <span class="s1">&#39;{&quot;TokenFilterStem.enable&quot;: false}&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;I developed Groonga&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能は、通常は語幹を使った検索がしたいが、時々、以下のように(ステミングされていない)正確な語で検索したいときに有用です。</p>
<ul class="simple">
<li><p>ステミングされた語を使った検索だとGroongaが大量の検索結果を返す場合。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilerStem</span></code> が間違ったステミング結果を返す場合。</p></li>
<li><p>(ステミングされていない)正確な語を含むレコードのみを検索したい場合。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にできるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> は、予め登録したストップワードを検索から除外します。これは、 <code class="docutils literal notranslate"><span class="pre">and</span></code> や <code class="docutils literal notranslate"><span class="pre">is</span></code> などの頻出語を無視することで検索ノイズを減らすために使います。</p></li>
<li><p>ただ、ときどき、特定のクエリーでのみこれらの語を含めて検索したいときがあります。今回のリリースでは、以下のように特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にして検索できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;Hello and&quot;</span> \
  <span class="o">--</span><span class="n">query_options</span> <span class="s1">&#39;{&quot;TokenFilterStopWord.enable&quot;: false}&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">--query-options</span></code> を使って、 <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord.enable</span></code> を指定していますが、以下のように <code class="docutils literal notranslate"><span class="pre">{&quot;options&quot;:</span> <span class="pre">{&quot;TokenFilterStopWord.enable&quot;:</span> <span class="pre">false}}</span></code> を使っても指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;content&quot;, </span><span class="se">\</span>
<span class="s1">                  &quot;Hello and&quot;, </span><span class="se">\</span>
<span class="s1">                  {&quot;options&quot;: {&quot;TokenFilterStopWord.enable&quot;: false}})&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能は、よく使われる語を含めて検索しないとGroongaが正しい結果を返さない時に便利です。(例えば、曲名や店名等を検索する場合です。)</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>][NormalizerNFKC] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_new_line</span></code> を追加しました。</p>
<ul class="simple">
<li><p>データを格納するテーブルのキーを正規化したい場合、そのテーブルにノーマライザーを設定しますが、通常ノーマライザーは改行を削除します。</p></li>
<li><p>ノーマライザーが改行を削除してしまうと、Groongaは改行のみのキーを扱えません。</p></li>
<li><p>このオプションを使うことで、改行のみのデータをキーとして登録できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/string_slice.html"><span class="doc">string_slice</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> を追加しました。 [Github#1177][Takashi Hashidaさんがパッチ提供]</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> は、文字列の部分文字列を抽出します。</p></li>
<li><p>この関数を使うには、 <code class="docutils literal notranslate"><span class="pre">functions/string</span></code> プラグインの登録が必要です。</p></li>
<li><p>以下のように、引数によって２つの異なる抽出方法を使えます。</p>
<ul>
<li><p>位置を使った抽出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">string</span>
<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, string_slice(_key, 2, 3)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;string_slice&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oon&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>正規表現を使った抽出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">string</span>
<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, string_slice(_key, &quot;(Gro+)(.*)&quot;, 2)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span><span class="n">p</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;string_slice&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nga&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 16.04 LTS (Xenial Xerus)のサポートをやめました。</p></li>
<li><p>Visual Studio 用の EditorConfig を追加しました。[GitHub#1191][Takashi Hashidaさんがパッチ提供]</p>
<ul class="simple">
<li><p>多くの設定は、Visual Studio 専用です。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.20.1に更新しました。</p>
<ul class="simple">
<li><p>CVE-2021-23017のセキュリティの修正が含まれています。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id70">
<h3>修正<a class="headerlink" href="#id70" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>オプションをサポートしているトークナイザーやノーマライザー、トークンフィルターが使われている際、多くの検索クエリーを送信するとGroongaが応答を返さなくなることがある問題を修正しました。</p></li>
</ul>
</section>
<section id="id71">
<h3>既知の問題<a class="headerlink" href="#id71" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
</ul>
</section>
<section id="id72">
<h3>感謝<a class="headerlink" href="#id72" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-2-2021-05-10">
<span id="release-11-0-2"></span><h2>11.0.2リリース - 2021-05-10<a class="headerlink" href="#release-11-0-2-2021-05-10" title="この見出しへのパーマリンク">#</a></h2>
<section id="id73">
<h3>改良<a class="headerlink" href="#id73" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[Documentation] <code class="docutils literal notranslate"><span class="pre">ruby_load</span></code> コマンドのリファレンスを削除しました。　[GitHub#1172][Anthony M. Cookさんがパッチ提供]</p>
<ul class="simple">
<li><p>このコマンドはすでに削除されているためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 11(Bullseye) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> をサポートしました。</p>
<ul>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージの動的カラムに対して <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使ってフィルターできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;price &gt;= 150&quot;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s2">&quot;price * 1.1&quot;</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="s2">&quot;price_with_tax &lt;= 250&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price_with_tax&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">165</span><span class="p">,</span>
        <span class="mi">150</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">220</span><span class="p">,</span>
        <span class="mi">200</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> をサポートしました。</p>
<ul>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">--slices[].filter</span></code> の条件でフィルターされた結果に対して <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">expensive</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span> <span class="s1">&#39;price &gt;= 1000&#39;</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">expensive</span><span class="p">]</span><span class="o">.</span><span class="n">post_filter</span> <span class="s1">&#39;price &lt; 3000&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">100</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">200</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">300</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="mi">1000</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">2000</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">3000</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;expensive&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">2</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="mi">4</span><span class="p">,</span>
          <span class="mi">1000</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="mi">5</span><span class="p">,</span>
          <span class="mi">2000</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> 内に式を記述できるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> に式を記述できます。</p>
<ul class="simple">
<li><p>存在しないキーが sort_keys の式に含まれていた場合、それらは、無視され警告がログに出力されます。</p></li>
</ul>
</li>
<li><p>これによって、例えば、 <code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> に <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素を指定し、 <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素で結果をソートできます。</p></li>
<li><p>以前のバージョンでも動的カラムを使えば、 <code class="docutils literal notranslate"><span class="pre">VECTOR</span> <span class="pre">COLUMN</span></code> の要素で結果をソートできましたが、この機能によって、動的カラムを使わずに <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素で結果をソートできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Values</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Values</span> <span class="n">numbers</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Int32</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Values</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">126</span><span class="p">,</span> <span class="mi">255</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">254</span><span class="p">]}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Values</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;numbers[1]&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">numbers</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;numbers&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">128</span><span class="p">,</span>
          <span class="o">-</span><span class="mi">254</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">127</span><span class="p">,</span>
          <span class="mi">128</span><span class="p">,</span>
          <span class="mi">129</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">126</span><span class="p">,</span>
          <span class="mi">255</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] オプションをつけた複数のトークンフィルターを使えるようにしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--token_filters</span> <span class="pre">'TokenFilterStopWord(&quot;column&quot;,</span> <span class="pre">&quot;ignore&quot;),</span> <span class="pre">TokenFilterNFKC130(&quot;unify_kana&quot;,</span> <span class="pre">true)'</span></code> のように複数のトークンフィルターを指定できます。 [Github#mroonga/mroonga#399][MASUDA Kazuhiroさんが報告]</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] 複雑な式で <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的カラムを扱えるようにしました。</p>
<ul>
<li><p>複雑な式とは、以下のように一時的な内部結果セットが必要な式です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;(true &amp;&amp; query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1"> (true &amp;&amp; query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
</pre></div>
</div>
<ul>
<li><p>上記の式では、 <code class="docutils literal notranslate"><span class="pre">true</span></code> の評価結果を格納するために一時的な結果セットを使用します。</p></li>
<li><p>したがって、例えば、以下の式では、式の中で <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的カラムの値を使えます。以下の式では、一時的な内部結果セットが必要ないためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;(query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1"> (query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>今回のリリースでは、以下のように <code class="docutils literal notranslate"><span class="pre">li_score</span></code> に値を設定できます。(以前のバージョンでは、2番めの式が動的カラムの値を取得出来なかったため、 <code class="docutils literal notranslate"><span class="pre">li_score</span></code> の値は <code class="docutils literal notranslate"><span class="pre">0</span></code> になっていました。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigramSplitSymbolAlphaDigit</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">users_name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alisa&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">name</span><span class="p">,</span><span class="n">_score</span><span class="p">,</span><span class="n">ali_score</span><span class="p">,</span><span class="n">li_score</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;(true &amp;&amp; query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1">            (true &amp;&amp; query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ali_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;li_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mf">10.0</span><span class="p">,</span>
        <span class="mf">2.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alisa&quot;</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mf">10.0</span><span class="p">,</span>
        <span class="mf">2.0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的ベクターカラムも扱えるようにしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigramSplitSymbolAlphaDigit</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">users_name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alisa&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">name</span><span class="p">,</span><span class="n">tags</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;(true &amp;&amp; query(&quot;name&quot;, &quot;al&quot;, {&quot;tags&quot;: [&quot;al&quot;], &quot;tags_column&quot;: &quot;tags&quot;})) || </span><span class="se">\</span>
<span class="s1">            (true &amp;&amp; query(&quot;name&quot;, &quot;sa&quot;, {&quot;tags&quot;: [&quot;sa&quot;], &quot;tags_column&quot;: &quot;tags&quot;}))&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;al&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alisa&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;al&quot;</span><span class="p">,</span>
          <span class="s2">&quot;sa&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>動的ベクターカラムを使う場合、格納する値は各要素が追加された値になります。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)をサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.10に更新しました。</p></li>
</ul>
</section>
<section id="id74">
<h3>既知の問題<a class="headerlink" href="#id74" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。 [Github#1186][potiさんが報告]</p></li>
</ul>
</section>
<section id="id75">
<h3>感謝<a class="headerlink" href="#id75" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Anthony M. Cookさん</p></li>
<li><p>MASUDA Kazuhiroさん</p></li>
<li><p>potiさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-1-2021-03-31">
<span id="release-11-0-1"></span><h2>11.0.1リリース - 2021-03-31<a class="headerlink" href="#release-11-0-1-2021-03-31" title="この見出しへのパーマリンク">#</a></h2>
<section id="id76">
<h3>改良<a class="headerlink" href="#id76" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] ARM64向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] キーワードごとに重みをカスタマイズできるようにしました。</p>
<ul class="simple">
<li><p>今まで、スコアーを調整するには、すべてのキーワードに対して <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> を指定する必要がありました。デフォルトのスコアの重み(1)より、デフォルトの重みの調整量(6 または 4)のほうが大きいためです。</p>
<ul>
<li><p>例えば、<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;B</span></code> では、 &quot;A&quot; の重みは1、 &quot;B&quot; の重みは4になります。デクリメントされていない &quot;A&quot; の重み(1)より、デクリメントされた &quot;B&quot; の重み(4)のほうが大きくなります。これは、期待した動作ではありません。&quot;B&quot; に &quot;A&quot; より小さい重みを使うためには、 <code class="docutils literal notranslate"><span class="pre">&gt;A</span> <span class="pre">&lt;B</span></code> と指定する必要があります。<code class="docutils literal notranslate"><span class="pre">&gt;A</span> <span class="pre">&lt;B</span></code> では、 &quot;A&quot; の重みは6、 &quot;B&quot; の重みは4になります。</p></li>
</ul>
</li>
<li><p>今回のリリースから、対象のキーワードに <code class="docutils literal notranslate"><span class="pre">&lt;${WEIGHT}</span></code> または <code class="docutils literal notranslate"><span class="pre">&gt;${WEIGHT}</span></code> と指定するだけで、キーワードごとに重みの調整量をカスタマイズできます。例えば、 <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;0.1B</span></code> では、 &quot;A&quot; の重みは1、 &quot;B&quot; の重みは0.9になります。(&quot;B&quot; の重みを0.1デクリメントしています。)</p></li>
<li><p>ただし、これらの形式(<code class="docutils literal notranslate"><span class="pre">&gt;${WEIGHT}...</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;${WEIGHT}...</span></code>, and <code class="docutils literal notranslate"><span class="pre">~${WEIGHT}...</span></code>)は互換性が無いことに注意してください。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式で <code class="docutils literal notranslate"><span class="pre">Float</span></code> と <code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値を出力できるようにしました。</p>
<ul class="simple">
<li><p>例えば、以下のように出力します。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="nb">float</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Float</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Data</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="n">output_type</span> <span class="n">apache</span><span class="o">-</span><span class="n">arrow</span>

  <span class="n">return_code</span><span class="p">:</span> <span class="n">int32</span>
  <span class="n">start_time</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
  <span class="n">elapsed_time</span><span class="p">:</span> <span class="n">double</span>
  <span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
  <span class="n">GROONGA</span><span class="p">:</span><span class="n">data_type</span><span class="p">:</span> <span class="n">metadata</span>
   <span class="n">return_code</span>                    <span class="n">start_time</span>       <span class="n">elapsed_time</span>
  <span class="mi">0</span>                  <span class="mi">0</span>     <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T09</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>           <span class="mf">0.000000</span>
  <span class="o">========================================</span>
  <span class="n">_id</span><span class="p">:</span> <span class="n">uint32</span>
  <span class="nb">float</span><span class="p">:</span> <span class="n">double</span>
  <span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
  <span class="n">GROONGA</span><span class="p">:</span><span class="n">n_hits</span><span class="p">:</span> <span class="mi">1</span>
   <span class="n">_id</span>          <span class="nb">float</span>
  <span class="mi">0</span>          <span class="mi">1</span>       <span class="mf">1.100000</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 結果出力時に、インデックスカラム経由で参照先のデータを取得できるようになりました。</p>
<ul>
<li><p>今までは、 出力値に <code class="docutils literal notranslate"><span class="pre">index_column.xxx</span></code> のように指定すると、Groongaは意図しない値を返していました。例えば以下の例では、 <code class="docutils literal notranslate"><span class="pre">--columns[tags].value</span> <span class="pre">purchases.tag</span></code> の値は、 <code class="docutils literal notranslate"><span class="pre">[&quot;apple&quot;,[&quot;many&quot;]],[&quot;banana&quot;,[&quot;man&quot;]],[&quot;cacao&quot;,[&quot;man&quot;]]</span></code> になりました。このケースでは、期待される値は、 <code class="docutils literal notranslate"><span class="pre">[&quot;apple&quot;,[&quot;man&quot;,&quot;many&quot;]],[&quot;banana&quot;,[&quot;man&quot;]],[&quot;cacao&quot;,[&quot;woman&quot;]]</span></code> でした。今回のリリースから、以下のように、インデックスカラム経由で参照先の正しい値を取得できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;woman&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;many&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">output</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="n">purchases</span><span class="o">.</span><span class="n">tag</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">tags</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;man&quot;</span><span class="p">,</span>
          <span class="s2">&quot;many&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;man&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;woman&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ネストされたインデックスの一部として直接インデックスカラムを指定できるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index_column.except_source_column</span></code> を使ってフィルター後にソーステーブルを検索できます。例えば、以下の例では、検索時に <code class="docutils literal notranslate"><span class="pre">comments.content</span></code> を指定しています。この場合、最初に、このクエリは <code class="docutils literal notranslate"><span class="pre">Comments</span></code> テーブルの <code class="docutils literal notranslate"><span class="pre">content</span></code> カラムを全文検索し、次に <code class="docutils literal notranslate"><span class="pre">Comments</span></code> テーブルを検索した結果のレコードを参照する <code class="docutils literal notranslate"><span class="pre">Articles</span></code> テーブルのレコードを取得します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Articles</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Comments</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Comments</span> <span class="n">article</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Articles</span>
<span class="n">column_create</span> <span class="n">Comments</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Articles</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">column_create</span> <span class="n">Articles</span> <span class="n">comments</span> <span class="n">COLUMN_INDEX</span> <span class="n">Comments</span> <span class="n">article</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">articles_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> \
  <span class="n">Articles</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">comments_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> \
  <span class="n">Comments</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Articles</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-2&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is useful!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-3&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Comments</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using Groonga too!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-3&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using Mroonga!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using PGroonga!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Articles</span> <span class="o">--</span><span class="n">match_columns</span> <span class="n">comments</span><span class="o">.</span><span class="n">content</span> <span class="o">--</span><span class="n">query</span> <span class="n">groonga</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;_key, _score, comments.content</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;comments.content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;article-1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;I&#39;m using Groonga too!&quot;</span><span class="p">,</span>
          <span class="s2">&quot;I&#39;m using PGroonga!&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] オブジェクトリテラルを使って、参照先のレコードをロードできるようにしました。</p>
<ul>
<li><p>例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;[</span> <span class="pre">{</span> <span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;value&quot;,</span> <span class="pre">...,</span> <span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;value&quot;</span> <span class="pre">}</span> <span class="pre">]&quot;</span></code> のようなデータをロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">table_create</span> <span class="n">Settlements</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Settlements</span> <span class="n">purchases</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Purchases</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;super market&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;milk&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;shoes shop&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;sneakers&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能によって、参照カラムにJSONデータを追加しやすくなります。</p></li>
<li><p>現状、この機能は、JSONの入力のみをサポートしています。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] JSON文字列で、参照先のレコードをロードできるようにしました。</p>
<ul>
<li><p>以下のように、JSONテキストを使ってソーステーブルから参照ベクターへデータをロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">table_create</span> <span class="n">Settlements</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Settlements</span> <span class="n">purchases</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Purchases</span>

<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;super market&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="s2">&quot;[{</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">super market-1</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">apple</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 100}, {</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">super market-2</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">milk</span><span class="se">\&quot;</span><span class="s2">,  </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 200}]&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;shoes shop&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="s2">&quot;[{</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">shoes shop-1</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">sneakers</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 3000}]&quot;</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">dump</span> \
  <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span> \
  <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;item&quot;</span><span class="p">,</span><span class="s2">&quot;price&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market-1&quot;</span><span class="p">,</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market-2&quot;</span><span class="p">,</span><span class="s2">&quot;milk&quot;</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;shoes shop-1&quot;</span><span class="p">,</span><span class="s2">&quot;sneakers&quot;</span><span class="p">,</span><span class="mi">3000</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;purchases&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market&quot;</span><span class="p">,[</span><span class="s2">&quot;super market-1&quot;</span><span class="p">,</span><span class="s2">&quot;super market-2&quot;</span><span class="p">]],</span>
<span class="p">[</span><span class="s2">&quot;shoes shop&quot;</span><span class="p">,[</span><span class="s2">&quot;shoes shop-1&quot;</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>
</pre></div>
</div>
</li>
<li><p>現状、この機能は、ネストされた参照レコードをサポートしていません。</p></li>
</ul>
</li>
<li><p>[Windows] <code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 関数で UNIXエポック を扱えるようになりました。</p>
<ul>
<li><p>Groongaは、現地時刻でタイムスタンプを扱っています。したがって、例えば日本でUNIXエポックを入力した場合、入力した時刻はUNIXエポックの9時間前になります。</p></li>
<li><p>WindowsのAPIはUNIXエポックより前の時間が入力されるとエラーになります。</p></li>
<li><p>今回のリリースから、以下のようにUNIXエポックを <code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 内で使えるように</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Timestamps</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Timestamps</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-06 00:00:00.000001&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-06 23:59:59.999999&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-07 00:00:00.000000&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-07 00:00:00.000001&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-08 23:59:59.999999&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-08 00:00:00.000000&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Timestamps</span> \
  <span class="o">--</span><span class="n">sortby</span> <span class="n">_id</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, time_classify_day_of_week(_key)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">7</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;time_classify_day_of_week&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462460400.000001</span><span class="p">,</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546799.999999</span><span class="p">,</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546800.0</span><span class="p">,</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546800.000001</span><span class="p">,</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462719599.999999</span><span class="p">,</span>
        <span class="mi">0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462633200.0</span><span class="p">,</span>
        <span class="mi">0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] クエリーを並行して実行できる新しい関数を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> でクエリーを並行で処理するためにはApache Arrowが必要です。Apache Arrowが無い場合は、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> はクエリーをシーケンシャルに実行します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は、 <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> と <code class="docutils literal notranslate"><span class="pre">query_string</span></code> の組み合わせを平行に処理します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> の構文は以下の通りです。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query_parallel_or</span><span class="p">(</span><span class="n">match_columns</span><span class="p">,</span> <span class="n">query_string1</span><span class="p">,</span>
                                 <span class="n">query_string2</span><span class="p">,</span>
                                 <span class="o">.</span>
                                 <span class="o">.</span>
                                 <span class="o">.</span>
                                 <span class="n">query_stringN</span><span class="p">,</span>
                                 <span class="p">{</span><span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 存在しないソートキーを無視するようにしました。</p>
<ul class="simple">
<li><p>今まで、存在しないソートキーを指定したとき、Groongaはエラーを出力していましたが、今回のリリースから存在しないソートキーを無視します。(エラーを出力しなくなります。)</p></li>
<li><p>この機能は、一貫性のために実装しています。<code class="docutils literal notranslate"><span class="pre">output_columns</span></code> も無効な値を無視します。また、 <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> も無効な値のほとんどを無視します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] drilldowns[].table で存在しないテーブルを無視します。 [GitHub#1169][naoaさんが報告]</p>
<ul class="simple">
<li><p>今まで、  <code class="docutils literal notranslate"><span class="pre">drilldowns[].table</span></code> で存在しないテーブルを指定したとき、Groongaはエラーを出力していましたが、今回のリリースから存在しないテーブルを無視します。(エラーを出力しなくなります。)</p></li>
<li><p>この機能は、一貫性のために実装しています。<code class="docutils literal notranslate"><span class="pre">output_columns</span></code> も無効な値を無視します。また、 <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> も無効な値のほとんどを無視します。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.8に更新しました。</p></li>
</ul>
</section>
<section id="id77">
<h3>修正<a class="headerlink" href="#id77" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] 参照の自動リリースが発生する前に、テーブルにカラムが追加されテーブルの参照が獲得されたときにGroongaがクラッシュする問題を修正しました。</p>
<ul>
<li><p>追加されたカラムの参照は獲得されませんが、自動リリースの対象になるためです。</p></li>
</ul>
</li>
<li><p>[Windows] 別のスレッドで、他のバックトレースロギングプロセスが動作しているときに、新しくバックトレースロギングプロセスが開始されると、1つ以上のプロセスがSEGVのバックトレースの出力に失敗する問題を修正しました。</p></li>
</ul>
</section>
<section id="id78">
<h3>既知の問題<a class="headerlink" href="#id78" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
</ul>
</section>
<section id="id79">
<h3>感謝<a class="headerlink" href="#id79" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-0-2021-02-09">
<span id="release-11-0-0"></span><h2>11.0.0リリース - 2021-02-09<a class="headerlink" href="#release-11-0-0-2021-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく11.0.0へアップグレードできます。</p>
<section id="id80">
<h3>改良<a class="headerlink" href="#id80" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ネストされたインデックス経由でスカラーカラムとベクターカラムの値を出力できるようになりました。</p>
<ul>
<li><p>ネストされたインデックスとは、以下のような構造です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>
</pre></div>
</div>
</li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">Products.purchases</span></code> カラムは <code class="docutils literal notranslate"><span class="pre">Purchases.product</span></code> カラムのインデックスです。また、 <code class="docutils literal notranslate"><span class="pre">Purchases.product</span></code> カラムは、 <code class="docutils literal notranslate"><span class="pre">Products</span></code> テーブルへの参照です。</p></li>
<li><p>今までは、ネストされたインデックス経由の検索は、期待した結果を返しませんでした。</p></li>
<li><p>今までの結果は以下のようになっていました。 <code class="docutils literal notranslate"><span class="pre">{&quot;product&quot;:</span> <span class="pre">&quot;apple&quot;,</span>&#160; <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;man&quot;}</span></code> が出力されていないことがわかります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;woman&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;many&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">purchases</span><span class="o">.</span><span class="n">tag</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1612504193.380738</span><span class="p">,</span>
    <span class="mf">0.0002026557922363281</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;purchases.tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;many&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="s2">&quot;man&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="s2">&quot;man&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>このリリースから、結果は以下のようになります。 <code class="docutils literal notranslate"><span class="pre">{&quot;product&quot;:</span> <span class="pre">&quot;apple&quot;,</span>&#160; <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;man&quot;}</span></code> が出力されているのがわかります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">purchases</span><span class="o">.</span><span class="n">tag</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;purchases.tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;man&quot;</span><span class="p">,</span>
            <span class="s2">&quot;one&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;child&quot;</span><span class="p">,</span>
            <span class="s2">&quot;many&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;man&quot;</span><span class="p">,</span>
            <span class="s2">&quot;many&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;woman&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[Windows] Linux上のMinGWを使ってクロスコンパイルしていたWindows向けパッケージの提供をやめました。</p>
<ul class="simple">
<li><p>おそらく、ほとんどの人がこのパッケージを使っていないためです。</p></li>
<li><p>上記のパッケージはこれまで、以下のような名前で提供されていたものです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.exe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x64.exe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.zip</span></code></p></li>
</ul>
</li>
<li><p>これからは、以下のパッケージを使用してください。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x86-vs2019-with-vcruntime.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x64-vs2019-with-vcruntime.zip</span></code></p></li>
</ul>
</li>
<li><p>既に Microsoft Visual C++ Runtime Library がインストール済みのシステムの場合は、以下のパッケージを使用してください。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x86-vs2019.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x64-vs2019.zip</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id81">
<h3>修正<a class="headerlink" href="#id81" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>インデックス内のデータを大量に追加、削除、更新した際にインデックスが破損することがある問題を修正しました。</p>
<ul>
<li><p>この問題は、インデックス内のデータを大量に削除しただけでも発生します。ただ、インデックスにデータを追加しただけでは発生しません。</p></li>
<li><p>この問題によって破損したインデックスは、インデックスを再構築することで修復できます。</p></li>
<li><p>この問題は、壊れたインデックスを参照しない限り発覚しません。したがって、既にインデックスが破損しているかもしれません。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/index_column_diff.html"><span class="doc">index_column_diff</span></a>] コマンドを使うことで、インデックスが破損しているかどうかを確認できます。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-10-1-1-2021-01-25">
<span id="release-10-1-1"></span><h2>10.1.1リリース - 2021-01-25<a class="headerlink" href="#release-10-1-1-2021-01-25" title="この見出しへのパーマリンク">#</a></h2>
<section id="id82">
<h3>改良<a class="headerlink" href="#id82" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式でUInt64の値の出力をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式で以下のようにヒット数の出力をサポートしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
<span class="n">GROONGA</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="n">hits</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] &quot;order by estimated size&quot; の最適化をサポートしました。</p>
<ul class="simple">
<li><p>通常、ヒット数の少ない条件から最初に実行すると、高速に検索できます。</p>
<ul>
<li><p>&quot;A (ヒット数が多い) &amp;&amp; B (ヒット数が少ない)&quot; より &quot;B (ヒット数が少ない) &amp;&amp; A (ヒット数が多い)&quot; 方が高速です。</p></li>
</ul>
</li>
<li><p>これは、よく知られた最適化ですが、自分で条件を並び替える必要があります。</p></li>
<li><p>Groongaは、 &quot;order by estimated size&quot; の最適化を使うことで、自動的にこの並び替えを実行します。</p></li>
<li><p>この最適化は、 <code class="docutils literal notranslate"><span class="pre">GRN_ORDER_BY_ESTIMATED_SIZE_ENABLE=yes</span></code> で有効になります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] 以下の改良で、パフォーマンスを改善しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">between()</span></code> でシーケンシャルサーチを使うかどうかの判断の精度を改善しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">between()</span></code> の結果を結果セットに一度にセットするよう改善しました。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 前方一致検索のパフォーマンスを改善しました。</p>
<ul>
<li><p>例えば、以下のような &quot;*&quot; を使った前方一致検索のパフォーマンスが向上します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Contents</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Contents</span> <span class="n">entries_key_index</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">_key</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(groonga) Start to try!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(mroonga) Installed&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(groonga) Upgraded!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">_key</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(groonga</span><span class="se">\\</span><span class="s1">)*&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] トークンカラムを並列で構築する際のパフォーマンスを改善しました。 [GitHub#1158][naoaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id83">
<h3>修正<a class="headerlink" href="#id83" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] <code class="docutils literal notranslate"><span class="pre">slices[].filter</span></code> 内で <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> が動作しない問題を修正しました。</p>
<ul>
<li><p>例えば、以下のクエリーでは、この問題によって、 <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> の結果は0件になります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">age</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt8</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">user</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Users</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">29</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;yay&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">adult</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span> <span class="s1">&#39;_id &gt; 1 &amp;&amp; sub_filter(user, &quot;age &gt;= 18&quot;)&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>ハッシュテーブルに対して、繰り返し大量のデータを追加、削除すると、Groongaがクラッシュしたり、データの追加ができなくなる可能性がある問題を修正しました。</p></li>
</ul>
</section>
<section id="id84">
<h3>感謝<a class="headerlink" href="#id84" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-1-0-2020-12-29">
<span id="release-10-1-0"></span><h2>10.1.0リリース - 2020-12-29<a class="headerlink" href="#release-10-1-0-2020-12-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id85">
<h3>改良<a class="headerlink" href="#id85" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] 全角スペースをハイライト対処から除外しました。[PGroonga#GitHub#155][Hung Nguyen Vさんが報告]</p>
<ul>
<li><p>今までは、以下のように先頭の全角スペースも含めてハイライト対象としていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">body</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">document_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">body</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga　高速！&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="n">output_columns</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">body</span> <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;高速&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;highlight_html(body)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;highlight_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;　高速&lt;/span&gt;！&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>しかし、この全角スペースはハイライト対象としては不要です。そのため、このリリースから <code class="docutils literal notranslate"><span class="pre">highlight_html()</span></code> は先頭の全角スペースを削除します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">features</span></code> を追加しました。</p>
<ul>
<li><p>以下のように、Groongaのどの機能が有効なのかを表示できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;alloc_count&quot;</span><span class="p">:</span> <span class="mi">361</span><span class="p">,</span>
    <span class="s2">&quot;starttime&quot;</span><span class="p">:</span> <span class="mi">1608087311</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mi">1608087311</span><span class="p">,</span>
    <span class="s2">&quot;uptime&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n_queries&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;cache_hit_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;default_command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;max_command_version&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nfkc&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mecab&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;message_pack&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mruby&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;onigmo&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zlib&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;lz4&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;zstandard&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;kqueue&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;epoll&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;poll&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;rapidjson&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;xxhash&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">apache_arrow</span></code> を追加しました。</p>
<ul class="simple">
<li><p>以下のようにGroongaが使うApache Arrowのバージョンを表示できます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1608088628.440753</span><span class="p">,</span>
    <span class="mf">0.0006628036499023438</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;alloc_count&quot;</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span>
    <span class="s2">&quot;starttime&quot;</span><span class="p">:</span> <span class="mi">1608088617</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mi">1608088617</span><span class="p">,</span>
    <span class="s2">&quot;uptime&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.9-39-g5a4c6f3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n_queries&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;cache_hit_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;default_command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;max_command_version&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nfkc&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mecab&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;message_pack&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mruby&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;onigmo&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zlib&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;lz4&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zstandard&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;kqueue&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;epoll&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;poll&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;rapidjson&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;xxhash&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">},</span>
    <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;version_major&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;version_minor&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;version_patch&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.0&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>この項目は、Apache Arrowが有効な場合にのみ表示されます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/window_function.html"><span class="doc">ウィンドウ関数</span></a>] 対象のテーブルがシャードをまたいでいる場合でも、全てのテーブルを一度に処理するようにしました。(実験的)</p>
<ul>
<li><p>今まで、対象のテーブルがシャードをまたいでいた場合、ウインドウ関数はシャード毎に処理をしていました。</p>
<ul>
<li><p>そのため、複数のグループキーを使う場合、2番目以降のグループキーの値は1種類でなければなりませんでした。</p></li>
<li><p>この改良によって、以下のように複数の種類の値を2番目以降のグループキーで使用できるようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">sharding</span>
<span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Logs_20170315</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Logs_20170316</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Logs_20170317</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170315</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170316</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">530</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">520</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">110</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">410</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 14:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">710</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170317</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170315</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170315</span> <span class="n">timestamp</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170316</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170316</span> <span class="n">timestamp</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170317</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170317</span> <span class="n">timestamp</span>

<span class="n">logical_range_filter</span> <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">shard_key</span> <span class="n">timestamp</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;price &gt;= 300&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Time</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;timestamp - 39600000000&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Time</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;time_classify_day(offsetted_timestamp)&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;window_count()&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">group_keys</span> <span class="s1">&#39;offsetted_day,item&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;_id,time_format_iso8601(offsetted_day),item,n_records_per_day_and_item&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UInt32&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;time_format_iso8601&quot;</span><span class="p">,</span>
        <span class="n">null</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;item&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;n_records_per_day_and_item&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UInt32&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-14T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>この機能には、まだリリースされていない、Apache Arrow 3.0.0が必要です。</p></li>
</ul>
</li>
<li><p>参照カラムに対する検索でシーケンシャルサーチをサポートしました。</p>
<ul>
<li><p>この機能は、インデックス検索でたくさんのレコードがマッチした場合、かつ結果セットが十分小さい場合にのみ使われます。</p>
<ul class="simple">
<li><p>上記のケースでは、インデックス検索よりもシーケンシャルサーチの方が速いためです。</p></li>
</ul>
</li>
<li><p>この機能はデフォルトでは無効です。</p></li>
<li><p>この機能は、環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE</span></code> を設定することで有効になります。</p></li>
<li><p>環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE</span></code> はインデックス検索からシーケンシャルサーチに切り替えるためのしきい値です。</p>
<ul>
<li><p>例えば、以下のように <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE=0.7</span></code> とセットした場合、結果セットのレコード数が、総レコード数の70%以下の場合にシーケンシャルサーチで検索します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE=0.7

table_create Tags TABLE_HASH_KEY ShortText
table_create Memos TABLE_HASH_KEY ShortText
column_create Memos tag COLUMN_SCALAR Tags

load --table Memos
[
{&quot;_key&quot;: &quot;Rroonga is fast!&quot;, &quot;tag&quot;: &quot;Rroonga&quot;},
{&quot;_key&quot;: &quot;Groonga is fast!&quot;, &quot;tag&quot;: &quot;Groonga&quot;},
{&quot;_key&quot;: &quot;Mroonga is fast!&quot;, &quot;tag&quot;: &quot;Mroonga&quot;},
{&quot;_key&quot;: &quot;Groonga sticker!&quot;, &quot;tag&quot;: &quot;Groonga&quot;},
{&quot;_key&quot;: &quot;Groonga is good!&quot;, &quot;tag&quot;: &quot;Groonga&quot;}
]

column_create Tags memos_tag COLUMN_INDEX Memos tag

select Memos --query &#39;_id:&gt;=3 tag:@Groonga&#39; --output_columns _id,_score,_key,tag
[
  [
    0,
    0.0,
    0.0
  ],
  [
    [
      [
        2
      ],
      [
        [
          &quot;_id&quot;,
          &quot;UInt32&quot;
        ],
        [
          &quot;_score&quot;,
          &quot;Int32&quot;
        ],
        [
          &quot;_key&quot;,
          &quot;ShortText&quot;
        ],
        [
          &quot;tag&quot;,
          &quot;Tags&quot;
        ]
      ],
      [
        4,
        2,
        &quot;Groonga sticker!&quot;,
        &quot;Groonga&quot;
      ],
      [
        5,
        2,
        &quot;Groonga is good!&quot;,
        &quot;Groonga&quot;
      ]
    ]
  ]
]
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[tokenizers] <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> でトークンカラムをサポートしました。</p>
<ul>
<li><p>インデックスカラムと同じソースを持つトークンカラムがある場合、これらのトークナイザーは、トークンカラムのトークンIDを使います。</p>
<ul class="simple">
<li><p>トークンカラムは、既にトークナイズ済みのデータを持っています。</p></li>
<li><p>そのため、トークンカラムを使うことによって、これらのトークナイザーのパフォーマンスが改善されます。</p></li>
</ul>
</li>
<li><p>例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">content_tokens</span></code> というトークンカラムを作ることで、この機能を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a b c a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;c b c&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;b b a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a c c&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content_tokens</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tokens</span> <span class="n">content</span>

<span class="n">table_create</span> <span class="n">DocumentVectorBM25</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Tokens</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> \
    <span class="s1">&#39;TokenDocumentVectorBM25(&quot;index_column&quot;, &quot;memos_content&quot;, </span><span class="se">\</span>
<span class="s1">                             &quot;df_column&quot;, &quot;df&quot;)&#39;</span>
<span class="n">column_create</span> <span class="n">DocumentVectorBM25</span> <span class="n">df</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content_feature</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> \
  <span class="n">DocumentVectorBM25</span> <span class="n">content</span>

<span class="n">select</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content_feature&quot;</span><span class="p">,</span>
          <span class="s2">&quot;DocumentVectorBM25&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content_tokens&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tokens&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;a b c a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.5095787</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.6084117</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.6084117</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;c b c&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.8342565</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.5513765</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;b b a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.9430448</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.3326656</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;a c c&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.3326656</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.9430448</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> は、各トークンに対して重みをつけます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> は、TF-IDFを使ってトークンの重みを計算します。</p>
<blockquote>
<div><ul class="simple">
<li><p>TF-IDFについては、 <a class="reference external" href="https://radimrehurek.com/gensim/models/tfidfmodel.html">https://radimrehurek.com/gensim/models/tfidfmodel.html</a> を参照してください。</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> は、Okapi BM25を使ってトークンの重みを計算します。</p>
<blockquote>
<div><ul class="simple">
<li><p>Okapi BM25については、 <a class="reference external" href="https://en.wikipedia.org/wiki/Okapi_BM25">https://en.wikipedia.org/wiki/Okapi_BM25</a> を参照してください。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>以下のケースのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;value&quot;)</span> <span class="pre">&amp;&amp;</span> <span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;value&quot;)</span></code></p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] stretchのサポートをやめました。</p>
<ul class="simple">
<li><p>EOLになったためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] CentOS 6のサポートをやめました。</p>
<ul class="simple">
<li><p>EOLになったためです。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.6に更新しました。</p></li>
</ul>
</section>
<section id="id86">
<h3>修正<a class="headerlink" href="#id86" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>以下のように、複数のドリルダウンのキーと複数のアクセサーを使用した時にGroongaがクラッシュする問題を修正しました。[GitHub#1153][naoaさんがパッチ提供]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">year</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Int32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2019</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2019</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt; 0&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="s1">&#39;tags,year &gt;= 2020&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">_key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">_nsubrecs</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt; 0&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="s1">&#39;tags,year &gt;= 2020&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">_nsubrecs</span>
</pre></div>
</div>
</li>
<li><p>以下のように、同じフレーズが複数回出現すると、近傍フレーズ検索がマッチしない問題を修正しました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a x a x b x x&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a x x b x&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;*NP2&quot;a b&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id87">
<h3>感謝<a class="headerlink" href="#id87" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Hung Nguyen Vさん</p></li>
<li><p>naoaさん</p></li>
<li><p>timgates42さん [GitHub#1155にてパッチ提供]</p></li>
</ul>
</section>
</section>
<section id="release-10-0-9-2020-12-01">
<span id="release-10-0-9"></span><h2>10.0.9リリース - 2020-12-01<a class="headerlink" href="#release-10-0-9-2020-12-01" title="この見出しへのパーマリンク">#</a></h2>
<section id="id88">
<h3>改良<a class="headerlink" href="#id88" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> に <code class="docutils literal notranslate"><span class="pre">-1</span></code> を指定した時のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--auto_release_count</span></code> を追加しました。</p>
<ul>
<li><p>Groongaは、リクエストが <code class="docutils literal notranslate"><span class="pre">--auto_release_count</span></code> で指定された値に到達した時に自動的に参照カウントを減らします。</p></li>
<li><p>例えば、以下のように、取得した <code class="docutils literal notranslate"><span class="pre">User</span></code> の参照は、2番目の <code class="docutils literal notranslate"><span class="pre">status</span></code> が処理された後に自動的に解放されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reference_acquire</span> <span class="o">--</span><span class="n">target_name</span> <span class="n">Users</span> <span class="o">--</span><span class="n">auto_release_count</span> <span class="mi">2</span>
<span class="n">status</span> <span class="c1"># Users is still referred.</span>
<span class="n">status</span> <span class="c1"># Users&#39; reference is released after this command is processed.</span>
</pre></div>
</div>
</li>
<li><p>このオプションで、取得した参照の解放漏れを防げます。</p></li>
</ul>
</li>
<li><p>Groongaが空の <code class="docutils literal notranslate"><span class="pre">vector</span></code> や <code class="docutils literal notranslate"><span class="pre">uvector</span></code> を評価した時の動作を変更しました。</p>
<ul class="simple">
<li><p>空の <code class="docutils literal notranslate"><span class="pre">vector</span></code> と <code class="docutils literal notranslate"><span class="pre">uvector</span></code> はcommand version 3では、 <code class="docutils literal notranslate"><span class="pre">false</span></code> と評価されます。</p>
<ul>
<li><p>この挙動はcommand version 3でのみ有効です。</p></li>
<li><p>今までとは挙動が異なることに注意してください。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] Unicode 13.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたノーマライザー <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] Unicode 13.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたトークンフィルター <code class="docutils literal notranslate"><span class="pre">TokenFilterNFKC130</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">column</span> <span class="pre">-</span> <span class="pre">X&quot;</span></code> のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> オプションを指定した時に必要のないインデックスカラムへの参照を取得しないように改善しました。</p>
<ul class="simple">
<li><p>今回のリリースから、 <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> の対象は、対象のテーブルのキーあるいはデータカラムに設定してあるインデックスカラムです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 順序限定の近傍フレーズ検索をサポートしました。</p>
<ul>
<li><p>今までの近傍フレーズ検索は、指定したフレーズ間の距離が近いレコードのみを探していました。</p></li>
<li><p>この機能は、以下の条件を満たすレコードを探します。</p>
<ul class="simple">
<li><p>指定したフレーズ間の距離が近い場合。</p></li>
<li><p>指定したフレーズが指定した順序で並んでいる場合。</p></li>
</ul>
</li>
<li><p>この機能は、 <code class="docutils literal notranslate"><span class="pre">*ONP</span></code> を演算子として使います。(<code class="docutils literal notranslate"><span class="pre">*NP</span></code> 演算子ではないことに注意してください。)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span></code> はクエリー構文では、 <code class="docutils literal notranslate"><span class="pre">$</span></code> そのものとして扱います。クエリー構文では、 <code class="docutils literal notranslate"><span class="pre">$</span></code> は特殊文字ではないことに注意してください。</p></li>
<li><p>スクリプト構文の場合、この機能は以下のように使用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcXYZdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abebcdXYZdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;defXYZabc&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;XYZabc&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123456789def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc12345678def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc1de2def&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *ONP &quot;abc def&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcXYZdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc12345678def&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc1de2def&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>クエリー構文の場合、この機能は以下のように使用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;content:*ONP &quot;abc def&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcXYZdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc12345678def&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc1de2def&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.5に更新しました。</p></li>
</ul>
</section>
<section id="id89">
<h3>修正<a class="headerlink" href="#id89" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] Groonga HTTP server が全てのワーカースレッドの完全な終了を待たずに終了していた問題を修正しました。</p>
<ul>
<li><p>今まで、Groonga HTTP server は、ワーカースレッドの処理が終了した後から、自身の終了処理を開始していました。しかし、このタイミングでは、ワーカースレッドは完全に終了していないことがあります。そのため、タイミングによってはGroonga HTTP serverがクラッシュすることがあります。Groonga HTTP server がワーカースレッドがまだ使用している領域を解放することがあるためです。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-10-0-8-2020-10-29">
<span id="release-10-0-8"></span><h2>10.0.8リリース - 2020-10-29<a class="headerlink" href="#release-10-0-8-2020-10-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id90">
<h3>改良<a class="headerlink" href="#id90" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 大きいサイズのドリルダウンのキーを使えるようになりました。</p>
<ul>
<li><p>Groongaのテーブルのキーサイズの最大は4KiBですが、複数のドリルダウンのキーを指定している場合、ドリルダウンのキーのサイズが4KiBを超える場合があります。</p>
<ul class="simple">
<li><p>例えば、以下のケースで、 <code class="docutils literal notranslate"><span class="pre">tag</span></code> キーと <code class="docutils literal notranslate"><span class="pre">n_like</span></code> キーのトータルサイズが4KiB以上だった場合、ドリルダウンは失敗します。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">tag</span><span class="p">,</span><span class="n">n_likes</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">n_likes</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span><span class="p">,</span><span class="n">n_likes</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">n_likes</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_value</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="n">_value</span><span class="o">.</span><span class="n">n_likes</span><span class="p">,</span><span class="n">_nsubrecs</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ドリルダウンは指定されている全てのキーを連結しているためです。そのため、ドリルダウンのキーそれぞれが大きい場合は、ドリルダウンのキーを連結したサイズが4KiB以上になります。</p></li>
</ul>
</li>
<li><p>この機能には、 <a class="reference external" href="https://github.com/Cyan4973/xxHash">xxHash</a> が必要です。</p>
<ul class="simple">
<li><p>ただ、Groongaをパッケージからインストールしている場合は、特に何もしなくてもこの機能を使えます。Groongaのパッケージには、すでに <a class="reference external" href="https://github.com/Cyan4973/xxHash">xxHash</a> が含まれているためです。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 異なるテーブルを参照しているカラムを同じ動的カラムで扱えるようにしました。</p>
<ul>
<li><p>従来、異なるテーブルを参照しているカラムは、同一の動的カラムでは扱えませんでした。カラムの型が異なるためです。</p></li>
<li><p>今回のバージョンから、以下のように異なるテーブルを参照しているカラムであってもビルトインの型にキャストすることで同じ動的カラムで扱うことができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Store_A</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Store_B</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Customers</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Int32</span>
<span class="n">column_create</span> <span class="n">Customers</span> <span class="n">customers_A</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Store_A</span>
<span class="n">column_create</span> <span class="n">Customers</span> <span class="n">customers_B</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Store_B</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Customers</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">1604020694</span><span class="p">,</span> <span class="s2">&quot;customers_A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]},</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">1602724694</span><span class="p">,</span> <span class="s2">&quot;customers_B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]},</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Customers</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_key == 1604020694&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">output</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;customers_A&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, customers&#39;</span>
</pre></div>
</div>
</li>
<li><p>今までは、 <code class="docutils literal notranslate"><span class="pre">Store_A</span></code> または <code class="docutils literal notranslate"><span class="pre">Store_B</span></code> を <code class="docutils literal notranslate"><span class="pre">customers</span></code> カラムの　<code class="docutils literal notranslate"><span class="pre">type</span></code>　に設定する必要がありました。</p></li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">customers_A</span></code> カラムの型は、 <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> にキャストします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">customers_A</span></code> のキーも <code class="docutils literal notranslate"><span class="pre">customers_B</span></code> のキーも <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型であるため、これで <code class="docutils literal notranslate"><span class="pre">customers</span></code> カラムの値に <code class="docutils literal notranslate"><span class="pre">customers_B</span></code> の値も設定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 検索結果のレコード数が非常に多い場合のパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>この最適化は、以下のケースで効果があります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">&lt;=</span> <span class="pre">&quot;value&quot;'</span></code> or <code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">&gt;=</span> <span class="pre">&quot;value&quot;'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">==</span> <span class="pre">&quot;value&quot;'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'between(...)'</span></code> または <code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'between(_key,</span> <span class="pre">...)'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'sub_filter(reference_column,</span> <span class="pre">...)'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'_key</span> <span class="pre">&gt;</span> <span class="pre">&quot;value&quot;'</span></code> のような <code class="docutils literal notranslate"><span class="pre">_key</span></code> に対する比較</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'geo_in_circle(...)'</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>バンドルしているLZ4を1.8.2から1.9.2に更新しました。</p></li>
<li><p>xxHash 0.8 をサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.4に更新しました。</p></li>
</ul>
</section>
<section id="id92">
<h3>修正<a class="headerlink" href="#id92" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>ブラウザーベースの管理ツール関連の問題を修正しました。　[GitHub#1139][sutaminさんの報告]</p>
<ul>
<li><p>Groongaのロゴが表示されない問題。</p></li>
<li><p>日本語のインデックスページにスループットグラフが表示されない問題。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">between(_key,</span> <span class="pre">...)</span></code> が常にシーケンシャルサーチで評価される問題を修正しました。</p></li>
</ul>
</section>
<section id="id93">
<h3>感謝<a class="headerlink" href="#id93" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>sutaminさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-7-2020-09-29">
<span id="release-10-0-7"></span><h2>10.0.7リリース - 2020-09-29<a class="headerlink" href="#release-10-0-7-2020-09-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id94">
<h3>改良<a class="headerlink" href="#id94" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[highlight], [<a class="reference internal" href="reference/functions/highlight_full.html"><span class="doc">highlight_full</span></a>] ノーマライザーにオプションを指定できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/command/return_code.html"><span class="doc">リターンコード</span></a>] 新しいリターンコード <code class="docutils literal notranslate"><span class="pre">GRN_CONNECTION_RESET</span></code> を追加しました。</p>
<ul>
<li><p>このリターンコードは、リモートホストから強制的に接続を切断されたときに返されます。</p></li>
</ul>
</li>
<li><p>Ubuntu 19.10(Eoan Ermine)のサポートをやめました。</p>
<ul>
<li><p>このバージョンはEOLになっているためです。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.2に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] キーの重複を検出できるようになりました。</p>
<ul>
<li><p>今回のリリースから、　<code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> でキーの重複も検出できるようになりました。</p></li>
<li><p>このチェックは、 <code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code> のテーブル以外で有効です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> で重複が検出されたテーブルにインデックスカラムしかない場合は、 <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">recover</span></code> で復旧できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/table_create.html"><span class="doc">table_create</span></a>], [<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--path</span></code> を追加しました。</p>
<ul>
<li><p>このオプションによって指定したテーブルまたは、カラムを任意のパスに格納できます。</p></li>
<li><p>このオプションは、高速なストレージ(SSDなど)によく使うテーブルやカラムを格納し、低速なストレージ(HDDなど)にあまり使わないテーブルやカラムを格納したいときに有用です。</p></li>
<li><p>このオプションは、相対パス、絶対パスの両方が指定できます。</p>
<ul>
<li><p>相対パスを指定した場合は、 <code class="docutils literal notranslate"><span class="pre">groonga</span></code> プロセスのパスを起点に指定したパスが解決されます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定した場合、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドの結果に <code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報が含まれます。</p>
<ul>
<li><p>したがって、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定した場合、 異なる環境のホストではリストアできなくなります。</p>
<ul>
<li><p>これは、ディレクトリ構成や <code class="docutils literal notranslate"><span class="pre">groonga</span></code> プロセスの場所が環境ごとに異なるためです。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報を <code class="docutils literal notranslate"><span class="pre">dump</span></code> に含みたくない場合は、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンド実行時に <code class="docutils literal notranslate"><span class="pre">--dump_paths</span> <span class="pre">no</span></code> を指定する必要があります。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> オプションは、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> をダンプするかどうかを制御します。</p></li>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">yes</span></code> です。</p></li>
<li><p>もし、テーブルやカラム作成時に <code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定していて、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報を <code class="docutils literal notranslate"><span class="pre">dump</span></code> に含みたくない場合は、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンド実行時に <code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> に <code class="docutils literal notranslate"><span class="pre">no</span></code> を指定してください。</p></li>
</ul>
</li>
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">string_toknize()</span></code> を追加しました。</p>
<ul>
<li><p>この関数は、第二引数に指定されたカラムの値を、第一引数に指定されたトークナイザーでトークナイズします。</p></li>
</ul>
</li>
<li><p>[tokenizers] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> を追加しました。(実験的)</p>
<ul>
<li><p>このトークナイザーは、TF-IDFで文書ベクトルを自動で生成します。</p></li>
</ul>
</li>
<li><p>[tokenizers] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> を追加しました。(実験的)</p>
<ul>
<li><p>このトークナイザーは、BM25で文書ベクトルを自動で生成します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 同一センテンス内での、フレーズ近傍検索をサポートしました。</p></li>
</ul>
</section>
<section id="id95">
<h3>修正<a class="headerlink" href="#id95" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] 257個のカラムに対して <code class="docutils literal notranslate"><span class="pre">load</span></code> を実行すると <code class="docutils literal notranslate"><span class="pre">load</span></code> の応答が返らなくなる問題を修正しました。</p>
<ul>
<li><p>この問題は、10.0.4以降で発生する可能性があります。</p></li>
<li><p>この問題は、 <code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b,</span> <span class="pre">c,</span> <span class="pre">...]</span></code> の形式でデータをロードした時にのみ発生します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[{...}]</span></code> を使ってデータをロードした場合は発生しません。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[MessagePack] float32の値を正しくアンパックできない問題を修正しました。</p></li>
<li><p>マルチカラムインデックス関連の問題を修正しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code> の値が壊れることがあります。</p></li>
<li><p>ヒットしないはずのレコードがヒットすることがあります。</p></li>
<li><p>この問題の発生条件については、以下のURLを参照してください。</p>
<ul>
<li><p><a class="reference external" href="https://groonga.org/ja/blog/2020/09/29/groonga-10.0.7.html#multi-column-index">https://groonga.org/ja/blog/2020/09/29/groonga-10.0.7.html#multi-column-index</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-10-0-6-2020-08-29">
<span id="release-10-0-6"></span><h2>10.0.6リリース - 2020-08-29<a class="headerlink" href="#release-10-0-6-2020-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id96">
<h3>改良<a class="headerlink" href="#id96" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 大きなデータの検索プランを改善しました。</p>
<ul>
<li><p>通常、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> より高速ですが、以下のケースでは、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> より遅くなっていました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> には要求されたレコード数をなかなか見つけられない場合にシーケンシャル検索からインデックス検索に切り替える機能があります。( <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は通常、検索対象のレコード数が多い場合は、シーケンシャル検索を使います。)</p></li>
<li><p>上記の切り替えが発生した場合は、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> と検索処理がほぼ同じになります。そのため、大きなデータを対象とした検索では、上記のケースで、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> の数倍遅くなります。なぜなら、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は検索後にソートを実行するためです。</p></li>
</ul>
</li>
<li><p>今回のリリースから、大きなデータを検索する場合に、今までよりシーケンシャル検索が採用されやすくしました。</p></li>
<li><p>これによって、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> と同等の処理になるケースが減少し <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> のパフォーマンスが改善します。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.1に更新しました。</p></li>
<li><p>Debian GNU/Linux へのインストール方法を変更しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-archive-keyring</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">groonga-apt-source</span></code> を使うように変更しました。 <code class="docutils literal notranslate"><span class="pre">lintian</span></code> コマンドが <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.lists.d/</span></code> 配下にファイルを置くパッケージは <code class="docutils literal notranslate"><span class="pre">apt-source</span></code> を使うよう推奨しているためです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lintian</span></code> コマンドはパッケージングに共通のエラーをチェックするためのコマンドです。</p></li>
<li><p>インストール方法についての詳細は、以下のURLも参照してください。</p>
<ul>
<li><p><a class="reference external" href="https://groonga.org/ja/docs/install/debian.html">https://groonga.org/ja/docs/install/debian.html</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">highlight_html</span></code> と <code class="docutils literal notranslate"><span class="pre">highlight_full</span></code> をサポートしました。</p></li>
<li><p>値を持たない配列を削除した時、そのレコードのIDを再利用するようにしました。[GitHub#mroonga/mroonga#327][gaeeyoさんの報告]</p>
<ul>
<li><p>値を持たない配列を削除した場合、削除されたIDは再利用されません。</p></li>
<li><p>Groongaは大きなIDがあることによって、多くのストレージを使用します。大きなIDはそれだけで、多くのストレージを使うためです。</p>
<ul>
<li><p>大きなIDは、例えば、Mroongaの <code class="docutils literal notranslate"><span class="pre">mroonga_operations</span></code> のように多くの追加と削除によって発生します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] インデックスを設定していない全文検索のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/function.html"><span class="doc">関数</span></a>] 全ての引数が他のテーブルへの参照か、リテラルである関数のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] トークンカラムを使った静的インデックス構築のパフォーマンスを改善しました。 [GitHub#1126][naoaさんがパッチ提供]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">func(...)&quot;</span></code> のパフォーマンスを改善しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code> の値が <code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">func(...)&quot;</span></code> のように関数によってのみ算出される場合のパフォーマンスを改善しました。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id97">
<h3>修正<a class="headerlink" href="#id97" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>応答送信のエラーが発生した後の応答にゴミが含まれることがある問題を修正しました。</p>
<ul>
<li><p>これは、クライアントが全ての応答を読み込まずにコネクションがクローズされた場合に発生することがあります。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id98">
<h3>感謝<a class="headerlink" href="#id98" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>gaeeyoさん</p></li>
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-5-2020-07-30">
<span id="release-10-0-5"></span><h2>10.0.5リリース - 2020-07-30<a class="headerlink" href="#release-10-0-5-2020-07-30" title="この見出しへのパーマリンク">#</a></h2>
<section id="id99">
<h3>改良<a class="headerlink" href="#id99" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">-load_table</span></code> で指定したテーブルに参照を格納できるようにしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--load-table</span></code> は予め用意したテーブルに検索結果を格納する機能です。</p>
<ul class="simple">
<li><p>複数回検索が実行される場合、このテーブルに結果を格納することで、検索結果をキャッシュできます。</p></li>
<li><p>このテーブルを使うことで、初回以降の検索時間を短縮できます。</p></li>
</ul>
</li>
<li><p>今回のリリース以降で、以下のようにこのテーブルに別のテーブルへの参照を格納できます。</p>
<ul class="simple">
<li><p>カラムの値を格納せず、参照のみを格納するため、このテーブルのサイズを小さくすることができます。</p></li>
<li><p>このテーブルに対して検索する場合、参照先のテーブルのインデックスを使って検索できます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_timestamp</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs</span> <span class="n">timestamp</span>

<span class="n">table_create</span> <span class="n">LoadedLogs</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Logs</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03:1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03 10:49:00&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03:2&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03 12:49:00&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-04:1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-04 00:00:00&quot;</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">load_table</span> <span class="n">LoadedLogs</span> \
  <span class="o">--</span><span class="n">load_columns</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">load_values</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">LoadedLogs</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;timestamp &gt;= &quot;2015-02-03 12:49:00&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;2015-02-03:2&quot;</span><span class="p">,</span>
        <span class="mf">1422935340.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;2015-02-04:1&quot;</span><span class="p">,</span>
        <span class="mf">1422975600.0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 以下のケースのソートのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>多くのソートキーがID解決をする場合。</p>
<ul>
<li><p>例えば、以下の式はIDを解決する必要があります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">true</span> <span class="pre">--sort_keys</span> <span class="pre">column</span></code></p></li>
</ul>
</li>
<li><p>例えば、以下の式はIDを解決する必要がありません。 擬似カラム <code class="docutils literal notranslate"><span class="pre">_score</span></code> は、結果テーブルに存在しており、ソーステーブルには存在しないためIDを解決する必要がありません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">true</span> <span class="pre">--sort_keys</span> <span class="pre">_score</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>ソート対象のテーブルがキーを持っている場合。</p>
<ul>
<li><p>したがって、 <code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code> はこの改善をサポートしていません。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 以下のケースのパフォーマンスを少し改善しました。</p>
<ul class="simple">
<li><p>沢山のレコードがマッチする検索をしているケース。</p></li>
<li><p>沢山のレコードに対してドリルダウンするケース。</p></li>
</ul>
</li>
<li><p>[aggregator] score アクセサーをサポートしました。[GitHub#1120][naoaさんのパッチ提供]</p>
<ul>
<li><p>例えば、 以下のように <code class="docutils literal notranslate"><span class="pre">_score</span></code> を <code class="docutils literal notranslate"><span class="pre">aggregator_*</span></code> の対象にできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">score_mean</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_mean(_score)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;score_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/indexing.html"><span class="doc">インデックス構築</span></a>] VC++版の静的インデックス構築のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] JSON形式で出力する際に <code class="docutils literal notranslate"><span class="pre">NaN</span></code> や <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> 、 <code class="docutils literal notranslate"><span class="pre">-Infinity</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">null</span></code> を出力するようにしました。</p>
<ul class="simple">
<li><p>これらの値はJSONではサポートされていないためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 標準偏差の集計をサポートしました。</p>
<ul>
<li><p>例えば、以下のようにグループごとの標準偏差を計算できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">price_sd</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sd(price)&#39;</span> \
  <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1594339851.924836</span><span class="p">,</span>
    <span class="mf">0.002813816070556641</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price_sd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mf">250.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mf">294.3920288775949</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mf">0.0</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aggregate_sd(target,</span> <span class="pre">{&quot;unbiased&quot;:</span> <span class="pre">true})</span></code> と指定することで、不偏標準偏差も計算できます。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[Windows] Visual Studio 2013のサポートをやめました。</p></li>
</ul>
</section>
<section id="id100">
<h3>修正<a class="headerlink" href="#id100" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] 応答がエラーで中断された時に、 <code class="docutils literal notranslate"><span class="pre">shutdown?immediate</span></code> を実行しても、リクエストが中断しない問題を修正しました。</p></li>
<li><p>リクエスト中にエラーが発生した時にクラッシュする問題を修正しました。</p>
<ul>
<li><p>これは、Apache Arrow形式を使っている時にのみ発生します。</p></li>
<li><p>前のリクエストがエラーによって中断された後に再度Groongaへリクエストを送信した時にGroongaがクラッシュします。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] 一時テーブルを使用した時にクラッシュする問題を修正しました。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">between</span></code> の第一引数に動的カラムを指定すると、Groongaがクラッシュしていました。</p></li>
</ul>
</li>
<li><p>プラグインで作成したプロシージャーが予期せず解放される問題を修正しました。</p>
<ul>
<li><p>参照カウントモードでのみ発生します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を使っていない場合は、発生しません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を実行したプロセスでは発生しません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を実行していないプロセスで発生します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">token_column</span></code> を使った静的インデックス構築中に正規化エラーが発生する問題を修正しました。[GitHub#1122][naoaさんの報告]</p></li>
</ul>
</section>
<section id="id101">
<h3>感謝<a class="headerlink" href="#id101" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-4-2020-06-29">
<span id="release-10-0-4"></span><h2>10.0.4リリース - 2020-06-29<a class="headerlink" href="#release-10-0-4-2020-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id102">
<h3>改良<a class="headerlink" href="#id102" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/tables.html"><span class="doc">テーブル</span></a>] ハッシュテーブルで4億件のレコードの登録をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">_score</span></code> が再帰的に値を取得しない時のパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>Groongaは、検索結果が検索対象の時に、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> の値を再帰的に取得します。</p></li>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">slices</span></code> は検索結果が検索対象です。したがって、 <code class="docutils literal notranslate"><span class="pre">slices</span></code> を使っているクエリーでは、この改善は効果がありません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] ドリルダウンのキーをクエリーログに出力するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>], [<a class="reference internal" href="reference/commands/reference_release.html"><span class="doc">reference_release</span></a>] 参照カウントモード用に新しいコマンドを追加しました。</p>
<ul class="simple">
<li><p>短い間隔で複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> を呼び出す必要がある場合、参照カウントモードによる自動クローズによってパフォーマンスが低下します。</p></li>
<li><p>複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> の前に <code class="docutils literal notranslate"><span class="pre">reference_acquire</span></code> を呼び、 複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> の後に <code class="docutils literal notranslate"><span class="pre">reference_release</span></code> を呼ぶことで、このパフォーマンスの低下を避けることができます。<code class="docutils literal notranslate"><span class="pre">reference_acquire</span></code> と <code class="docutils literal notranslate"><span class="pre">reference_release</span></code> の間は自動クローズは無効になります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_acquire</span></code> が、対象のオブジェクトの参照を取得するためです。</p></li>
</ul>
</li>
<li><p>パフォーマンスに影響のある操作が完了したら、 <code class="docutils literal notranslate"><span class="pre">reference_release</span></code> を呼ぶ必要があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_release</span></code> を呼ばない場合、参照カウントモードは機能しません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 一度の <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> で複数グループの集計をサポートしました。</p>
<ul>
<li><p>以下のように、一回の <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> で異なるグループ毎に和と算術平均を計算できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">quantity</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">price_sum</span><span class="p">,</span><span class="n">quantity_sum</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sum(price)&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sum(quantity)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">111</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="mi">22</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price_sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;quantity_sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">1500</span><span class="p">,</span>
          <span class="mi">112</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mi">1800</span><span class="p">,</span>
          <span class="mi">47</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">500</span><span class="p">,</span>
          <span class="mi">111</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] スタンドアローンモードで、 <code class="docutils literal notranslate"><span class="pre">--pid-path</span></code> をサポートしました。</p>
<ul class="simple">
<li><p>以前のバージョンのスタンドアローンモードでは、 <code class="docutils literal notranslate"><span class="pre">--pid-path</span></code> は無視されていました。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/io_flush.html"><span class="doc">io_flush</span></a>] 参照カウントモードに対応しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>],[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] 参照カウントモードに対応しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] 最後のチャンクの後にヘッダーをつけないようにしました。</p>
<ul class="simple">
<li><p>最後のチャンクの後のヘッダーを無視するHTTPクライアントが存在する可能性があるためです。</p></li>
</ul>
</li>
<li><p>[vector_slice] <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型のベクターをサポートしました。 [GitHub#1106 naoaさんがパッチ提供]</p></li>
<li><p>トークンカラムを使った、並列静的インデックス構築をサポートしました。</p>
<ul class="simple">
<li><p>予めトークナイズされたデータから複数スレッドで静的インデックスの構築ができるようになりました。</p></li>
<li><p>以下の環境変数で、並列静的インデックス構築のパラメータを調整できます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TOKEN_COLUMN_PARALLEL_CHUNK_SIZE</span></code> : スレッド毎にどのくらいのレコードを処理するかを指定します。</p>
<ul>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">1024</span></code> レコードです。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TOKEN_COLUMN_PARALLEL_TABLE_SIZE_THRESHOLD</span></code> : どのくらいのソースレコードで並列化するかを指定します。</p>
<ul>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">102400</span></code> レコードです。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 参照カウントモード時の <code class="docutils literal notranslate"><span class="pre">load_table</span></code> のパフォーマンスを改善しました。</p></li>
</ul>
</section>
<section id="id103">
<h3>修正<a class="headerlink" href="#id103" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>シャードをまたいでいて、かつ <code class="docutils literal notranslate"><span class="pre">--filter</span></code> を指定していない動的カラムを使って検索すると、Gronngaのデータベースが破損する問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema</span></code> コマンドの結果に <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型が表示されなかった問題を修正しました。</p></li>
<li><p>参照 <code class="docutils literal notranslate"><span class="pre">uvector</span></code> が要素を持っていないとき、 <code class="docutils literal notranslate"><span class="pre">_nsubrecs</span></code> を余分にカウントする問題を修正しました。</p></li>
</ul>
</section>
<section id="id104">
<h3>感謝<a class="headerlink" href="#id104" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-3-2020-05-29">
<span id="release-10-0-3"></span><h2>10.0.3リリース - 2020-05-29<a class="headerlink" href="#release-10-0-3-2020-05-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id105">
<h3>改良<a class="headerlink" href="#id105" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>予めトークナイズされたデータから転置インデックスを構築できるようになりました。</p>
<ul>
<li><p>これにより、インデックスの構築が高速化します。</p></li>
<li><p>この改善を使うには、トークンカラムを準備する必要があります。</p></li>
<li><p>トークンカラムは、インデックスカラムのように自動で値が生成されます。</p></li>
<li><p>トークンカラムの値はソースカラムの値をトークナイズすることで生成されます。</p></li>
<li><p>トークンカラムは以下のようにソースカラムを設定することで作成できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>

<span class="n">table_create</span> <span class="n">Notes</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Notes</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="c1"># The last &quot;title&quot; is the source column.</span>
<span class="n">column_create</span> <span class="n">Notes</span> <span class="n">title_terms</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Terms</span> <span class="n">title</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 関数の引数に <code class="docutils literal notranslate"><span class="pre">vector</span></code> を指定できるようになりました。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">query</span></code> の <code class="docutils literal notranslate"><span class="pre">flags</span></code> オプションを <code class="docutils literal notranslate"><span class="pre">vector</span></code> を使って以下のように記述できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;content&quot;, &quot;-content:@mroonga&quot;, </span><span class="se">\</span>
<span class="s1">                  { </span><span class="se">\</span>
<span class="s1">                    &quot;expander&quot;: &quot;QueryExpanderTSV&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;flags&quot;: [&quot;ALLOW_LEADING_NOT&quot;, &quot;ALLOW_COLUMN&quot;] </span><span class="se">\</span>
<span class="s1">                  })&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 動的カラムに新しいステージ <code class="docutils literal notranslate"><span class="pre">result_set</span></code> を追加しました。</p>
<ul class="simple">
<li><p>このステージは、結果セットのテーブルにカラムを作ります。したがって、 <code class="docutils literal notranslate"><span class="pre">query</span></code> か <code class="docutils literal notranslate"><span class="pre">filter</span></code> が存在しない場合は作られません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> が存在しない場合は、結果セットのテーブルが作られないためです。</p></li>
</ul>
</li>
<li><p>このステージでは <code class="docutils literal notranslate"><span class="pre">_value</span></code> は使用できません。 <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの値は <code class="docutils literal notranslate"><span class="pre">score_column</span></code> に格納されます。</p></li>
</ul>
</li>
<li><p>[vector_slice] 重み付きベクターの重みに <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型が使えるようになりました。  [GitHub#1106 naoaさんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] drilldownsの動的カラムのステージに <code class="docutils literal notranslate"><span class="pre">filtered</span></code> と <code class="docutils literal notranslate"><span class="pre">output</span></code> を追加しました。 [GitHub#1101 naoaさんがパッチ提供][GitHub#1100 naoaさんがパッチ提供]</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">drilldowns[Label].stage</span> <span class="pre">filtered</span></code> や <code class="docutils literal notranslate"><span class="pre">drilldowns[Label].stage</span> <span class="pre">output</span></code> のように drilldowns の動的カラムのステージに <code class="docutils literal notranslate"><span class="pre">filtered</span></code> と <code class="docutils literal notranslate"><span class="pre">output</span></code> を使えます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ドリルダウンでの集計に <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型の値をサポートしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MAX</span></code>、<code class="docutils literal notranslate"><span class="pre">MIN</span></code>、<code class="docutils literal notranslate"><span class="pre">SUM</span></code> を使って <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型の値の最大値、最小値、合計値を集計できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] [<a class="reference internal" href="reference/functions/geo_in_rectangle.html"><span class="doc">geo_in_rectangle</span></a>] [<a class="reference internal" href="reference/functions/geo_in_circle.html"><span class="doc">geo_in_circle</span></a>] <code class="docutils literal notranslate"><span class="pre">query()</span></code> と <code class="docutils literal notranslate"><span class="pre">geo_in_rectangle()</span></code> と <code class="docutils literal notranslate"><span class="pre">geo_in_circle()</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">score_column</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">score_column</span></code> を使うことで条件毎にスコアの値を格納できます。</p></li>
<li><p>通常、Groongaは、全ての条件のスコアーを加算してスコアーを計算しますが、条件毎にスコアーの値を取得したいこともあります。</p></li>
<li><p>例えば以下のように、中心座標にどれだけ近いかをスコアーとして使いたい場合に <code class="docutils literal notranslate"><span class="pre">score_column</span></code> が使えます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">LandMarks</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">category</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">point</span> <span class="n">COLUMN_SCALAR</span> <span class="n">WGS84GeoPoint</span>

<span class="n">table_create</span> <span class="n">Points</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">WGS84GeoPoint</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">land_mark_index</span> <span class="n">COLUMN_INDEX</span> <span class="n">LandMarks</span> <span class="n">point</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">LandMarks</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aries&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;11x11&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Taurus&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Lighthouse&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;9x10&quot;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Gemini&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Lighthouse&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;8x8&quot;</span>  <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cancer&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;12x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Leo&quot;</span>        <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;11x13&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Virgo&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;22x10&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Libra&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;14x14&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Scorpio&quot;</span>    <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;21x9&quot;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sagittarius&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;43x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Capricorn&quot;</span>  <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;33x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aquarius&quot;</span>   <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;mountain&quot;</span>  <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;55x11&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Pisces&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;9x9&quot;</span>  <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ophiuchus&quot;</span>  <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;mountain&quot;</span>  <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;21x21&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">LandMarks</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;distance&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">initial</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="mf">0.0</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;name, category, point, distance, _score&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(point, &quot;11x11&quot;, &quot;11x1&quot;, {&quot;score_column&quot;: distance}) &amp;&amp; category == &quot;Tower&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1590647445.406149</span><span class="p">,</span>
    <span class="mf">0.0002503395080566406</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;category&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;point&quot;</span><span class="p">,</span>
          <span class="s2">&quot;WGS84GeoPoint&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Aries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11x11&quot;</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Cancer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;12x12&quot;</span><span class="p">,</span>
        <span class="mf">0.0435875803232193</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Leo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11x13&quot;</span><span class="p">,</span>
        <span class="mf">0.06164214760065079</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Pisces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9x9&quot;</span><span class="p">,</span>
        <span class="mf">0.0871751606464386</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Libra&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;14x14&quot;</span><span class="p">,</span>
        <span class="mf">0.1307627409696579</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> によるソートは意味をなしません。 <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">==</span> <span class="pre">&quot;Tower&quot;</span></code> によって、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> の値は全て <code class="docutils literal notranslate"><span class="pre">1</span></code> になるためです。しかし、 <code class="docutils literal notranslate"><span class="pre">socre_column</span></code> を使うことで、中心座標からの距離でソートできます。</p></li>
</ul>
</li>
<li><p>[Windows] クラッシュしていないくてもエラー時にはバックトレースが出力されるようになりました。</p></li>
<li><p>[Windows] 古いWindowsのサポートをやめました。</p>
<ul class="simple">
<li><p>10.0.3から、Windows 8 (Windows Server 2012) 以降を要求します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 参照可能なソートキーとそうでないソートキーが混在しているときのソートパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>参照可能なソートキーとそうでないソートキーが混在していて、参照可能なキーが2つ以上あるときのソートパフォーマンスを改善しました。</p>
<ul>
<li><p>参照可能なソートキーとは以下のソートキー以外のことです。</p>
<ul>
<li><p>圧縮されたカラム</p></li>
<li><p>ドリルダウンのキーに複数の値が指定されているドリルダウンの値を格納する <code class="docutils literal notranslate"><span class="pre">_value</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型のキーを持たないパトリシアトライテーブルの <code class="docutils literal notranslate"><span class="pre">_key</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>文字列以外のソートキーが多いほど、ソートに使用するメモリ使用量が少なくなります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 全てのソートキーが参照可能なキーの時のソートのパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">_socre</span> <span class="pre">=</span> <span class="pre">column1*X</span> <span class="pre">+</span> <span class="pre">column2*Y</span> <span class="pre">+</span> <span class="pre">...</span></code> の場合のスコアラーのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>この最適化は、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> 内に多くの <code class="docutils literal notranslate"><span class="pre">+</span></code> または <code class="docutils literal notranslate"><span class="pre">*</span></code> がある場合に効きます。</p></li>
<li><p>現状、 <code class="docutils literal notranslate"><span class="pre">+</span></code> と <code class="docutils literal notranslate"><span class="pre">*</span></code> に対してのみ効果があります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] フレーズ近傍検索をサポートしました。</p>
<ul>
<li><p>フレーズ単位で近傍検索できます。</p>
<ul>
<li><p>フレーズ近傍検索のクエリー構文は、 <code class="docutils literal notranslate"><span class="pre">*NP&quot;Phrase1</span> <span class="pre">phrase2</span> <span class="pre">...&quot;</span></code> です。</p></li>
<li><p>フレーズ近傍検索のスクリプト構文は、 <code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">*NP</span> <span class="pre">&quot;phrase1</span> <span class="pre">phrase2</span> <span class="pre">...&quot;</span></code> です。</p></li>
<li><p>検索対象のフレーズにスペースを含む場合、 以下のようにフレーズを <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> で囲うことで検索できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also started to use Groonga. It&#39;s also very fast! Really fast!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *NP &quot;</span><span class="se">\\</span><span class="s1">&quot;I started</span><span class="se">\\</span><span class="s1">&quot; </span><span class="se">\\</span><span class="s1">&quot;use Groonga</span><span class="se">\\</span><span class="s1">&quot;&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1590469700.715882</span><span class="p">,</span>
    <span class="mf">0.03997230529785156</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/columns/vector.html"><span class="doc">ベクターカラム</span></a>] 重み付きベクターの重みに <code class="docutils literal notranslate"><span class="pre">float32</span></code> 型を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uint32</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">float32</span></code> として重みを格納できます。</p></li>
<li><p>この機能を使うには、 <code class="docutils literal notranslate"><span class="pre">column_create</span></code> 実行時に <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグを追加する必要があります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">column_create</span> <span class="n">Records</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
</pre></div>
</div>
</li>
<li><p>今の所、 <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグは、 <code class="docutils literal notranslate"><span class="pre">COLUMN_INDEX</span></code> フラグと併用できません。</p></li>
</ul>
</li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_weight_vector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>重み付きベクターかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_uvector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> かどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> とは、要素のサイズが固定の <code class="docutils literal notranslate"><span class="pre">vector</span></code> です。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_weight_uvector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>重み付きuvectorかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id_size(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_id</span> <span class="pre">id)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>Groongaのデータ型のサイズを <code class="docutils literal notranslate"><span class="pre">size_t</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_xxx</span></code> を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p>これらの関数はセレクター関連のデータを返します。</p>
<ul>
<li><p>これらの関数はセレクターの中で呼び出すことを想定しています。セレクター以外の場所で呼び出された場合は、 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get(grn_ctx</span> <span class="pre">*ctx)</span></code></p>
<ul>
<li><p>セレクター呼び出しに関する全ての情報を <code class="docutils literal notranslate"><span class="pre">grn_selector_data</span> <span class="pre">*</span></code> 構造体として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_selector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクター自身を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_expr(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクターに使用されている、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件や <code class="docutils literal notranslate"><span class="pre">--query</span></code> 条件を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_table(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>検索対象のテーブルを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_index(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクターに使われているインデックスを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_args(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data,</span> <span class="pre">size_t</span> <span class="pre">*n_args)</span></code></p>
<ul>
<li><p>セレクターが呼び出した関数の引数を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_result_set(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>結果テーブルを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_op(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>既存の結果セットに対してどう集合演算したかを <code class="docutils literal notranslate"><span class="pre">grn_operator</span></code> として返します。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_value_operator(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*value,</span> <span class="pre">grn_operator</span> <span class="pre">default_operator,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*context)</span></code></p>
<ul class="simple">
<li><p>クエリーオペレーターを <code class="docutils literal notranslate"><span class="pre">grn_operator</span></code> として返します。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> は <code class="docutils literal notranslate"><span class="pre">GRN_OP_ANDP</span></code> として返されます。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_value_bool(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*value,</span> <span class="pre">bool</span> <span class="pre">default_value,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag)</span></code></p>
<ul>
<li><p>以下の関数の引数 <code class="docutils literal notranslate"><span class="pre">with_transposition</span></code> のように <code class="docutils literal notranslate"><span class="pre">true</span></code> または <code class="docutils literal notranslate"><span class="pre">false</span></code> が指定される値を <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。( <code class="docutils literal notranslate"><span class="pre">bool</span></code> はC言語のデータ型です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzy_search</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max_distance&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;prefix_length&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max_expansion&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;with_transposition&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p>これらは、 <code class="docutils literal notranslate"><span class="pre">query()</span></code> でのみ使えます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*options,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name,</span> <span class="pre">va_list</span> <span class="pre">args)</span></code> を追加しました。</p>
<ul>
<li><p>オプションのパースを実行します。</p></li>
<li><p>今までは、オプションのパースを自分で実装しなければなりませんでしたが、この関数を呼び出すだけでオプションをパースできます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parse(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*options,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name,</span> <span class="pre">...)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_option_parsev()</span></code> を呼び出します。したがって、この関数の機能は、 <code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev()</span></code> と同じです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev()</span></code> とは、インターフェースだけが異なります。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_text_printfv(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*bulk,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*format,</span> <span class="pre">va_list</span> <span class="pre">args)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_text_vprintf</span></code> は10.0.3から非推奨になりました。 代わりに <code class="docutils literal notranslate"><span class="pre">grn_text_printfv</span></code> を使ってください。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id_is_float_family(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_id</span> <span class="pre">id)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id</span></code> が <code class="docutils literal notranslate"><span class="pre">GRN_DB_FLOAT32</span></code> または <code class="docutils literal notranslate"><span class="pre">GRN_DB_FLOAT</span></code> かどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_dat_cursor_get_max_n_records(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_dat_cursor</span> <span class="pre">*c)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>カーソルが保持できるレコード数の最大値を <code class="docutils literal notranslate"><span class="pre">size_t</span></code> として返します。(このAPIはDATテーブル用です。)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_table_cursor_get_max_n_records(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>カーソルが保持できるレコード数の最大値を返します。</p></li>
<li><p>全ての種類(<code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_HASH_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_DAT_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_PAT_KEY</span></code>)のテーブルで使えます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_xxx</span></code> を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_record(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_posting</span> <span class="pre">*posting,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットのテーブルにレコードを追加します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_ii_posting_add_float</span></code> は10.0.3から非推奨になりました。代わりに <code class="docutils literal notranslate"><span class="pre">grn_rset_add_records()</span></code> を使ってください。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_table(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_obj</span> <span class="pre">*table,</span> <span class="pre">double</span> <span class="pre">score,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットにテーブルを追加します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_table_cursor(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor,</span> <span class="pre">double</span> <span class="pre">score,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットにカーソル内のレコードを追加します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_vector_copy(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*src,</span> <span class="pre">grn_obj</span> <span class="pre">*dest)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vector</span></code> オブジェトをコピーします。 <code class="docutils literal notranslate"><span class="pre">vector</span></code> オブジェクトのコピーに成功したかどうかを返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_have_source(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>ソースカラムを持つカラムかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_token_column(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>トークンカラムかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_hash_add_table_cursor(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*hash,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor,</span> <span class="pre">double</span> <span class="pre">score)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>結果セットを一括して挿入するための関数です。 <code class="docutils literal notranslate"><span class="pre">grn_ii_posting_add()</span></code> を使ってレコードを挿入するより高速です。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id106">
<h3>修正<a class="headerlink" href="#id106" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>複数のスレッドから、同時にモジュール(トークナイザー、ノーマライザー、トークンフィルター)が使われた場合にクラッシュする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値を表示する際の精度を修正しました。</p>
<ul>
<li><p>10.0.3から <code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値の精度は、 8桁から7桁になります。</p></li>
</ul>
</li>
<li><p>動的カラムのパラメーターだけが違うクエリーが実行された時にGroongaが誤ったキャッシュを使用していた問題を修正しました。 [GitHub#1102 naoaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id107">
<h3>感謝<a class="headerlink" href="#id107" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-2-2020-04-29">
<span id="release-10-0-2"></span><h2>10.0.2リリース - 2020-04-29<a class="headerlink" href="#release-10-0-2-2020-04-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id108">
<h3>改良<a class="headerlink" href="#id108" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 関数が <code class="docutils literal notranslate"><span class="pre">uvector</span></code> に対応しました。 [GitHub#1089][naoaさんがパッチ提供]</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> とは、要素のサイズが固定のベクターです。</p></li>
<li><p>例えば、Time型の要素を格納しているベクターは <code class="docutils literal notranslate"><span class="pre">uvector</span></code> です。</p></li>
</ul>
</li>
<li><p>ゼロコピーで値を参照できないソートキーが混在しているケースでソートのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>いくつかのソートキー(例えば、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> 等)の値はゼロコピーで値を参照できません。</p></li>
<li><p>これらの値が一つでも含まれる場合、以前は全てのソートキーの値をコピーしていました。</p></li>
<li><p>今回の変更から、参照できないソートキーの値だけコピーし、参照可能なソートキーの値はコピーせずに参照するようにしました。</p></li>
<li><p>ただ、この変更で全てのソートキーの値が参照可能なケースでパフォーマンスが落ちる可能性があります。</p></li>
</ul>
</li>
<li><p>重み付きベクターをJSON文字列としてロードできるようにしました。</p>
<ul>
<li><p>以下の例のように、重み付きベクターをJSON文字列としてロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">data_tags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Data</span> <span class="n">tags</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">fruit</span><span class="se">\&quot;</span><span class="s2">: 10, </span><span class="se">\&quot;</span><span class="s2">apple</span><span class="se">\&quot;</span><span class="s2">: 100}&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">fruit</span><span class="se">\&quot;</span><span class="s2">: 200}&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型をサポートしました。</p>
<ul class="simple">
<li><p>Groongaは既に <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型を持っていますが、これは、倍精度浮動小数点数です。したがって、単精度浮動小数点数のみを使う場合は、効率が悪いです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型を追加することで、より適切な型を選択できるようになりました。</p></li>
</ul>
</li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_unref(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>このAPIは参照カウントモードのときのみ使用します。(参照カウントモードとは、 <code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> の状態のことです。)</p>
<ul>
<li><p>このAPIは、参照カウントモードの時のみ <code class="docutils literal notranslate"><span class="pre">grn_obj_unlink()</span></code> を呼び出します。参照カウントモード以外の時は、何もしません。</p></li>
<li><p>参照カウントモードの時のみ <code class="docutils literal notranslate"><span class="pre">grn_obj_unlink()</span></code> を呼び出す必要がある時に便利です。</p></li>
<li><p>以下の例のように、参照カウントモードかどうかの条件を書かなくて良くなるためです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_unref()</span></code> を使用しない場合の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">grn_enable_reference_count</span><span class="p">)</span> <span class="p">{</span>
 <span class="n">grn_obj_unlink</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_ubref()</span></code> を使用する場合の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grn_obj_ubref</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_major(void)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_minor(void)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_micro(void)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> としてGroongaのメジャー、マイナー、マイクロバージョンを返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_record_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_section_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_position(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_rest(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul class="simple">
<li><p>これらは、ポスティングリストの情報を返します。</p></li>
<li><p>これらのAPIは、 <code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float</span></code> 以外は、 <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> として値を返します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float</span></code> は <code class="docutils literal notranslate"><span class="pre">float</span></code> として値を返します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_section_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p>セクションIDとはカラム名の内部表現です。</p></li>
<li><p>カラム名を文字列としてポスティングリストに格納すると、情報量が多くなり無駄な容量を使います。</p></li>
<li><p>したがって、カラム名をセクションIDという数値としてポスティングリストに格納することで、情報量を圧縮し使用する容量を少なくしています。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf</span></code> の <code class="docutils literal notranslate"><span class="pre">tf</span></code> とは、単語の出現頻度です。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p>トークンの重みを <code class="docutils literal notranslate"><span class="pre">float</span></code> として返します。</p></li>
<li><p>今後はトークンの重みを取得する際はこのAPIを使用することをおすすめします。</p>
<ul>
<li><p>近い将来、重みは内部的に <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> から <code class="docutils literal notranslate"><span class="pre">float</span></code> に変更するためです。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id109">
<h3>修正<a class="headerlink" href="#id109" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>32bit GUN/Linux等でGroongaがクラッシュすることがある問題を修正しました。</p></li>
<li><p>関係のないカラムの値をクリアーしてしまう問題を修正しました。 [GitHub#1087][sutaminさんの報告]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドでレコードをダンプした時にメモリリークする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_columns</span></code> に無効な値を指定した時にメモリリークする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snippet</span></code> 関数を実行する時にメモリリークする問題を修正しました。</p></li>
<li><p>以下の条件を満たした時にメモリリークする問題を修正しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code> ステージで動的カラムを使用した場合。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドの引数 <code class="docutils literal notranslate"><span class="pre">slices</span></code> を使用した場合。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_table_remove</span></code> でテーブルを削除した際にメモリリークする問題を修正しました。</p></li>
<li><p>参照カウントモードを使用した時にメモリリークする問題を修正しました。</p>
<ul>
<li><p>参照カウントモードとは、 <code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> の状態のことです。</p></li>
<li><p>この機能は実験的です。パフォーマンスが低下することがあります。</p></li>
</ul>
</li>
<li><p>Apache Arrow形式でデータをロードした際に <code class="docutils literal notranslate"><span class="pre">_key</span></code> アクセサーを解放しすぎる問題を修正しました。</p></li>
</ul>
</section>
<section id="id110">
<h3>感謝<a class="headerlink" href="#id110" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>sutaminさん</p></li>
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-1-2020-03-30">
<span id="release-10-0-1"></span><h2>10.0.1リリース - 2020-03-30<a class="headerlink" href="#release-10-0-1-2020-03-30" title="この見出しへのパーマリンク">#</a></h2>
<p>Groonga 10.0.0 のUbuntuとWindows(VC++版)のパッケージに誤りがあったため Groonga 10.0.1 をリリースしました。</p>
<p>既にCentOS、Debian、Windows(MinGW版)のGroonga 10.0.0を使用している方は、そのまま使っていただいて問題ありません。</p>
<section id="id111">
<h3>修正<a class="headerlink" href="#id111" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Windows(VC++版)のパッケージに不足していたランタイム(vcruntime140_1.dll)を追加しました。</p></li>
</ul>
</section>
</section>
<section id="release-10-0-0-2020-03-29">
<span id="release-10-0-0"></span><h2>10.0.0リリース - 2020-03-29<a class="headerlink" href="#release-10-0-0-2020-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id112">
<h3>改良<a class="headerlink" href="#id112" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[httpd] バンドルしているnginxのバージョンを1.17.9に更新しました。</p></li>
<li><p>[httpd] 出力形式を拡張子として指定できるようにしました。</p>
<ul class="simple">
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">load?output_type=json</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">load.json</span></code> と書けます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] Linuxのdumpレベルのログにオープンしたファイルとクローズしたファイルのパスを出力するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] Windowsのdebugレベルのログにオープンしたファイルとクローズしたファイルのパスを出力するようにしました。</p></li>
<li><p>以下のAPIとマクロを追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_timeval_from_double(grn_ctx,</span> <span class="pre">double)</span></code></p>
<ul>
<li><p>このAPIは、 <code class="docutils literal notranslate"><span class="pre">double</span></code> 型を <code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型に変換します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型の値を返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TIMEVAL_TO_NSEC(timeval)</span></code></p>
<ul>
<li><p>このマクロは、 <code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型の値を <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> 型の値としてナノ秒に変換します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TIME_USEC_TO_SEC(usec)</span></code></p>
<ul>
<li><p>このマクロは、ミリ秒を秒に変換します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>以下のマクロを非推奨にしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_OBJ_FORMAT_FIN(grn_ctx,</span> <span class="pre">grn_obj_format)</span></code></p>
<ul>
<li><p>10.0.0から代わりに <code class="docutils literal notranslate"><span class="pre">grn_obj_format_fin(grn_ctx,</span> <span class="pre">grn_obj_format)</span></code> を使ってください。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>],[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>]  ストリーム出力に対応しました。</p>
<ul>
<li><p>この機能は <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> 以降で使えます。headerがbodyの後に出力されます。</p></li>
<li><p>現在、この機能をサポートしているのは、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> のみです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は、 <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> 以降では、常に出力がstreamとして返ります。</p></li>
<li><p>この機能は以下の制限があります。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> に指定できる負の値は -1 のみです。</p></li>
<li><p>MessagePack形式の出力はサポートしていません。</p></li>
</ul>
</li>
<li><p>この変更で、JSONの応答内容を少し変更しています。</p>
<ul>
<li><p>以下のように以前のバージョンとは、キーの順序が異なっています。</p>
<ul>
<li><p>以前のバージョンのキーの順序</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>本バージョン(10.0.0)のキーの順序</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> を <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> で実行した時はキャッシュが効きません。</p>
<ul class="simple">
<li><p>10.0.0から <code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> の時にストリームで応答を返すので、応答全体をキャッシュできないためです。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] Apache Arrow形式での応答をサポートしました。</p>
<ul class="simple">
<li><p>以下のデータ型をサポートしています。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt16</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int16</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt64</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int64</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShortText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Text</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LongText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Vector</span></code> of <code class="docutils literal notranslate"><span class="pre">Int32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Reference</span> <span class="pre">vector</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Ubuntu 20.04 (Focal Fossa)をサポートしました。</p></li>
<li><p>Ubuntu 19.04 (Disco Dingo)のサポートをやめました。</p>
<ul class="simple">
<li><p>このバージョンはEOLになっているためです。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-9-1-2-2020-01-29">
<span id="release-9-1-2"></span><h2>9.1.2リリース - 2020-01-29<a class="headerlink" href="#release-9-1-2-2020-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id113">
<h3>改良<a class="headerlink" href="#id113" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[tools] 指定したテーブルまたはカラムのファイルのみをコピーするスクリプトを追加しました。</p>
<ul>
<li><p>このスクリプトの名前は、copy-related-files.rbです。</p></li>
<li><p>このスクリプトは非常に大きいデータベースから指定したテーブルまたはカラムを抽出したい場合に便利です。</p></li>
<li><p>特定のテーブルまたはカラムに関連するファイルは、障害の再現に必要なことがあります。</p></li>
<li><p>データベースをまるごと提供するのが難しい場合は、このツールを使って対象のテーブルまたはカラムに関連するファイルを抽出できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/shutdown.html"><span class="doc">shutdown</span></a>] 全てのスレッドが使われている場合でも、 <code class="docutils literal notranslate"><span class="pre">/d/shutdown?mode=immediate</span></code> を即時受け付けるようにしました。</p>
<ul>
<li><p>この機能はGroonga HTTPサーバでのみ使えます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> を使うと、使用していないオブジェクトをすぐに開放します。</p>
<ul>
<li><p>この機能は実験的です。パフォーマンスが低下します。</p></li>
<li><p>多くのテーブルにまたがるデータをロードする際等にメモリーの使用量を一定量に保つ効果が期待できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] <code class="docutils literal notranslate"><span class="pre">groonga-release</span></code> パッケージをバージョンごとに用意しました。</p>
<ul>
<li><p>インストール方法に少し変更があるので注意してください。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Groongaのaptリポジトリーの追加に <code class="docutils literal notranslate"><span class="pre">groonga-archive-keyring</span></code> を使うようにしました。</p>
<ul>
<li><p>この改善によって、Groongaのaptリポジトリーを簡単に追加できます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-archive-keyring</span></code> はGroongaのaptリポジトリーを使うための全ての情報が入っています。そのため、リポジトリー情報やPGPキーの変更を意識する必要がありません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-archive-keyring</span></code> はdebパッケージなので、 <code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">update</span></code> で簡単に更新できます。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-9-1-1-2020-01-07">
<span id="release-9-1-1"></span><h2>9.1.1リリース - 2020-01-07<a class="headerlink" href="#release-9-1-1-2020-01-07" title="この見出しへのパーマリンク">#</a></h2>
<section id="id114">
<h3>改良<a class="headerlink" href="#id114" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] Apache Arrow 形式のデータをサポートしました。</p>
<ul>
<li><p>Apache Arrow形式のデータを使うことで、パースのコストを削減でき、他のフォーマットより高速にデータをロードできる可能性があります。</p></li>
<li><p>この変更によって、他のデータ分析システムからApache Arrow形式のデータを直接Groongaへ入力することもできます。</p></li>
<li><p>Apache Arrow形式のフォーマットはHTTPインターフェイスでのみ使えます。コマンドラインインターフェイスでは使えません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] Apache Arrow 形式のロード方法をドキュメントに追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] エラーメッセージを改善しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">load</span></code> コマンドのレスポンスにエラーメッセージも含むようにしました。</p></li>
<li><p>この変更によって、データのロードに失敗した場合、 <code class="docutils literal notranslate"><span class="pre">load</span></code> コマンドのエラーの詳細を出力します。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.17.7に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] HTTPリクエストのbodyにコマンドのパラメータを指定できるようにしました。</p>
<ul>
<li><p>この場合、 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> に <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> を指定しなければいけません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] HTTP POST の使用方法をドキュメントに追加しました。</p></li>
</ul>
</section>
</section>
<section id="release-9-1-0-2019-11-29">
<span id="release-9-1-0"></span><h2>9.1.0リリース - 2019-11-29<a class="headerlink" href="#release-9-1-0-2019-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id115">
<h3>改良<a class="headerlink" href="#id115" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>&quot;&amp;&amp;&quot;演算のパフォーマンスを改善しました。</p>
<ul>
<li><p>例えば、以下のような条件式のパフォーマンスが向上します。</p></li>
<li><p>( A || B ) &amp;&amp; ( C || D ) &amp;&amp; ( E || F) ...</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers/token_mecab.html"><span class="doc">TokenMecab</span></a>] <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">use_base_form</span></code> オプションを追加しました。</p>
<ul>
<li><p>このオプションによってトークンの原型を使って検索できます。</p></li>
<li><p>例えば、このオプションを使って&quot;支えた&quot;を検索した場合、&quot;支える&quot;もヒットします。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id116">
<h3>修正<a class="headerlink" href="#id116" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>インデックスがアクセサーの際にパフォーマンスが低下する問題を修正しました。</p>
<ul>
<li><p>例えば、以下のような条件を含むクエリーで起こります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">accessor</span> <span class="pre">&#64;</span> <span class="pre">query</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">accessor</span> <span class="pre">==</span> <span class="pre">query</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>バッファーが十分に大きい時に、検索結果の推定サイズがオーバーフローする問題を修正しました。 [PGroonga#GitHub#115][Albert Songさんの報告]</p></li>
<li><p>test(1)のポータビリティを改善しました。（おばたさんがパッチ提供）</p></li>
<li><p>不足しているツールを追加</p>
<ul>
<li><p>前のバージョンに <code class="docutils literal notranslate"><span class="pre">index-column-diff-all.sh</span></code> と <code class="docutils literal notranslate"><span class="pre">object-inspect-all.sh</span></code> がバンドルされていなかったためです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id117">
<h3>感謝<a class="headerlink" href="#id117" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Albert Songさん</p></li>
<li><p>おばたさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-9-2019-10-30">
<span id="release-9-0-9"></span><h2>9.0.9リリース - 2019-10-30<a class="headerlink" href="#release-9-0-9-2019-10-30" title="この見出しへのパーマリンク">#</a></h2>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>今回のバージョンからパフォーマンスが低下しているかもしれません。もし、以前よりパフォーマンスが低下していたら、是非、再現手順を報告してほしいです。</p>
</div>
<section id="id118">
<h3>改良<a class="headerlink" href="#id118" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] 応答の送信時間をクエリーログに出力するように改良しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/status.html"><span class="doc">status</span></a>] <code class="docutils literal notranslate"><span class="pre">status</span></code> コマンドの応答に現在のジョブ数を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] <code class="docutils literal notranslate"><span class="pre">$request_time</span></code> をサポートしました。</p>
<ul>
<li><p>以前のバージョンでは、 <code class="docutils literal notranslate"><span class="pre">log_format</span></code> ディレクティブに <code class="docutils literal notranslate"><span class="pre">$request_time</span></code> を指定しても、<code class="docutils literal notranslate"><span class="pre">$request_time</span></code> の値は常に0でした。</p></li>
<li><p>今回のバージョンから、 <code class="docutils literal notranslate"><span class="pre">$request_time</span></code> を指定した場合、 groonga-httpd は正しい時間を出力します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] <code class="docutils literal notranslate"><span class="pre">$request_time</span></code> の設定方法をドキュメントに追加しました。</p></li>
<li><p>Ubuntu 19.10(Eoan Ermine)をサポートしました。</p></li>
<li><p>CentOS 8をサポートしました。(実験的)</p>
<ul>
<li><p>CentOS 8向けのパッケージは開発用のパッケージが不足しているため、一部の機能が使えません。(例えば、 <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> が使えなかったり、JSON文字列からint32のベクターへのキャストが出来なかったりします。)</p></li>
</ul>
</li>
<li><p>[tools] <code class="docutils literal notranslate"><span class="pre">index_column_diff</span></code> コマンドを簡単に実行するスクリプトを追加しました。</p>
<ul>
<li><p>このスクリプトの名前は、index-column-diff-all.shです。</p></li>
<li><p>このスクリプトは、Groongaのデータベースからインデックスカラムを抽出し、抽出したインデックスカラムに対して <code class="docutils literal notranslate"><span class="pre">index_column_diff</span></code> を実行します。</p></li>
</ul>
</li>
<li><p>[tools] <code class="docutils literal notranslate"><span class="pre">object_inspect</span></code> コマンドを全てのオブジェクトに対して実行するスクリプトを追加しました。</p>
<ul>
<li><p>このスクリプトの名前は、object-inspect-all.shです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id119">
<h3>修正<a class="headerlink" href="#id119" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>between の最初の引数として値を指定すると、Groongaがクラッシュする問題を修正しました。[GitHub#1045][yagisumiさんの報告]</p></li>
</ul>
</section>
<section id="id120">
<h3>感謝<a class="headerlink" href="#id120" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>yagisumiさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-8-2019-09-27">
<span id="release-9-0-8"></span><h2>9.0.8リリース - 2019-09-27<a class="headerlink" href="#release-9-0-8-2019-09-27" title="この見出しへのパーマリンク">#</a></h2>
<section id="id121">
<h3>改良<a class="headerlink" href="#id121" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/log_reopen.html"><span class="doc">log_reopen</span></a>] 2つ以上のワーカーで <code class="docutils literal notranslate"><span class="pre">groonga-httpd</span></code> を使用する場合の補足説明を追記しました。</p></li>
<li><p>作成中のインデックスを無視するように改良しました。</p>
<ul>
<li><p>インデックス構築中であっても、正しい検索結果を取得できます。</p></li>
<li><p>ただし、この場合、Groongaは検索にインデックスを使用しないため、検索は遅くなります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 対象のカラムのインデックスが作成中か、または、インデックスが無い時に <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> がシーケンシャルサーチを実行する機能を追加しました。</p>
<ul>
<li><p>以前のバージョンでは、上記の状態の場合、 <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> はエラーになりました。</p></li>
<li><p>今回のバージョンから、 上記の状態でも <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> は検索結果を返します。</p></li>
<li><p>ただし、上記の状態の場合、 <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> は、シーケンシャルサーチで実行されるため遅いです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] CentOS 6の32-bitパッケージのサポートをやめました。</p></li>
</ul>
</section>
<section id="id122">
<h3>修正<a class="headerlink" href="#id122" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] レコードが十分にあるとき、かつフィルター条件にマッチしないレコードが推定値を超えた時に、同じオブジェクトを2回閉じるという例外が発生する問題を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-9-0-7-2019-08-29">
<span id="release-9-0-7"></span><h2>9.0.7リリース - 2019-08-29<a class="headerlink" href="#release-9-0-7-2019-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id123">
<h3>改良<a class="headerlink" href="#id123" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.17.3に更新しました。</p>
<ul>
<li><p>CVE-2019-9511、CVE-2019-9513、CVE-2019-9516のセキュリティの修正が含まれています。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id124">
<h3>修正<a class="headerlink" href="#id124" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>ポスティングリストが巨大になった時にGroongaがクラッシュする問題を修正しました。</p>
<ul>
<li><p>ただし、このバグは、一般的なデータでは殆ど発生しません。ポスティングリストは、一般的なデータでは、そこまで大きくならないためです。</p></li>
</ul>
</li>
<li><p>動的カラムのステージに <code class="docutils literal notranslate"><span class="pre">initial</span></code> を指定し、インデックスを使用した検索をすると空の結果を返す問題を修正しました。 [GitHub#683]</p></li>
<li><p>configure時にlibeditがインストールされているにもかかわらず、検知しない問題を修正しました。 [GitHub#1030][yuさんがパッチ提供]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--slices</span></code> と <code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> オプション使用時に <code class="docutils literal notranslate"><span class="pre">--offset</span></code> と <code class="docutils literal notranslate"><span class="pre">--limit</span></code> オプションが動作しない問題を修正しました。 [clear-code/redmine_full_text_search#70][a9zawaさんの報告]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドの結果が巨大な時、検索結果が空になる問題を修正しました。[groonga-dev,04770][Yutaro Shimamuraさんの報告]</p></li>
<li><p>前方一致検索や後方一致検索時に適切なインデックスを使わない問題を修正しました。[GitHub#1007, PGroonga#GitHub#96][oknjさんの報告]</p></li>
</ul>
</section>
<section id="id125">
<h3>感謝<a class="headerlink" href="#id125" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>oknjさん</p></li>
<li><p>Yutaro Shimamuraさん</p></li>
<li><p>yuさん</p></li>
<li><p>a9zawaさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-6-2019-08-05">
<span id="release-9-0-6"></span><h2>9.0.6リリース - 2019-08-05<a class="headerlink" href="#release-9-0-6-2019-08-05" title="この見出しへのパーマリンク">#</a></h2>
<section id="id126">
<h3>改良<a class="headerlink" href="#id126" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Debian 10 (buster)をサポートしました。</p></li>
</ul>
</section>
<section id="id127">
<h3>修正<a class="headerlink" href="#id127" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 検索エスカレーションが起こった際に検索がエラーになるバグを修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] ネストされた等価演算を使った際に、誤った検索結果を返すことがあるバグを修正しました。</p></li>
<li><p>[geo_distance_location_rectangle] <code class="docutils literal notranslate"><span class="pre">load</span></code> のフォーマットが誤っている例を修正しました。 [GitHub#1023] [yagisumiさんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="tutorial/micro_blog.html"><span class="doc">マイクロブログ検索システムの作成</span></a>] 検索結果が誤っている例を修正しました。[GitHub#1024][yagisumiさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id128">
<h3>感謝<a class="headerlink" href="#id128" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>yagisumiさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-5-2019-07-30">
<span id="release-9-0-5"></span><h2>9.0.5リリース - 2019-07-30<a class="headerlink" href="#release-9-0-5-2019-07-30" title="この見出しへのパーマリンク">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>このリリースには影響の大きい不具合があることがわかりました。<code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドが誤った結果を返します。この問題を修正し、9.0.6をリリースする予定です。Groonga 9.0.5は使わず、後日リリースされる9.0.6を使ってください。問題の詳細については <a class="reference external" href="https://groonga.org/ja/blog/2019/07/30/groonga-9.0.5.html">https://groonga.org/ja/blog/2019/07/30/groonga-9.0.5.html</a> で解説しています。</p>
</div>
<section id="id129">
<h3>改良<a class="headerlink" href="#id129" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 検索対象のシャードが十分に大きい時にのみ最適化を適用するように改良しました。</p>
<ul>
<li><p>この機能は、ソートキーが同じ時にオフセット間で検索結果が重複するのを減らします。</p></li>
<li><p>十分に大きいのしきい値はデフォルトで10000レコードです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">unify_to_katakana</span></code> を追加しました。</p>
<ul>
<li><p>このオプションは、平仮名を片仮名にノーマライズします。</p></li>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">ゔぁゔぃゔゔぇゔぉ</span></code> を <code class="docutils literal notranslate"><span class="pre">ヴァヴィヴヴェヴォ</span></code> にノーマライズします。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] slicesパラメーターでdrilldownsをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] slicesパラメーターでcolumnsをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] initialステージ内でslicesパラメーターが <code class="docutils literal notranslate"><span class="pre">_score</span></code> を参照できるよう改良しました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>], [<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] slicesパラメータ指定時に、slices実行前の式からもキーワードを抽出するように改良しました。</p></li>
<li><p>slicesパラメータ指定時に、slices実行前の式からもスコアーを収集するように改良しました。</p></li>
<li><p>ポスティングリストにポスティングを追加する際に自動的にスコアーを1増やすのをやめました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_ii_posting_add</span></code> は、この変更によって後方互換性がなくなりました。互換性を保つには、呼び出し側でスコアーを増やす必要があります。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">XXX.YYY.ZZZ</span> <span class="pre">==</span> <span class="pre">AAA</span></code> のようなネストされた等価演算のインデックス検索をサポートしました。</p></li>
<li><p>ハッシュテーブル使用時にハッシュの再構築の間隔を少なくしました。</p>
<ul>
<li><p>この昨日によって、結果出力のパフォーマンスが改善します。</p></li>
</ul>
</li>
<li><p>クエリーログにプレフィックスを追加できるようになりました。</p>
<ul>
<li><p>どの条件のフィルターなのかわかりやすくなります。</p></li>
</ul>
</li>
<li><p>Apache Arrow 1.0.0 をサポートしました。</p>
<ul>
<li><p>ただし、このバージョンはまだ、リリースされていません。</p></li>
</ul>
</li>
<li><p>Amazon Linux 2 をサポートしました。</p></li>
</ul>
</section>
<section id="id130">
<h3>修正<a class="headerlink" href="#id130" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;</span></code> のようなJSONのベクター値がインデックスされないバグを修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">table_create</span></code> のテストのパラメーター名が誤っていたバグを修正しました。[GitHub#1000][yagisumiさんがパッチ提供]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">command_version=3</span></code> でdrilldownコマンドが実行された際に、ドリルダウンのラベルが空になるバグを修正しました。[GitHub#1001][yagisumiさんの報告]</p></li>
<li><p>MinGWでWindows版のパッケージのビルドが失敗するバグを修正しました。</p></li>
<li><p>MinGWのWindows版パッケージにCOPYINGがインストールされないバグを修正しました。</p></li>
<li><p>ハイライト対象として、クエリーにテキスト以外を指定した際に、キーワードがハイライトされないバグを修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/object_inspect.html"><span class="doc">object_inspect</span></a>] のMessagePack形式の出力が壊れるバグを修正しました。[GitHub#1009][yagisumiさんの報告]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index_column_diff</span></code> のMessagePack形式の出力が壊れるバグを修正しました。[GitHub#1009][yagisumiさんの報告]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/suggest.html"><span class="doc">suggest</span></a>] のMessagePack形式の出力が壊れるバグを修正しました。[GitHub#1011][yagisumiさんの報告]</p></li>
<li><p>パトリシアトライのテーブルの検索時などにreallocのサイズが十分に確保されないバグを修正しました。[島津製作所さんの報告]</p>
<ul>
<li><p>Groongaはこのバグでクラッシュする可能性があります。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-release</span></code> version 1.5.0より前から1.5.0-1へアップデートした際に <code class="docutils literal notranslate"><span class="pre">groonga.repo</span></code> が削除されるバグを修正しました。[groonga-talk:429][Josep Sanzさんの報告]</p></li>
</ul>
</section>
<section id="id131">
<h3>感謝<a class="headerlink" href="#id131" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>yagisumiさん</p></li>
<li><p>島津製作所さん</p></li>
<li><p>Josep Sanzさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-4-2019-06-29">
<span id="release-9-0-4"></span><h2>9.0.4リリース - 2019-06-29<a class="headerlink" href="#release-9-0-4-2019-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id132">
<h3>改良<a class="headerlink" href="#id132" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>配列リテラルの複数要素をサポートしました。</p></li>
<li><p>ベクターの等価演算をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 出力するクエリーログを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> コマンドが、以下のタイミングでログを出力するようになります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> によるフィルター後</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> によるソート後</p></li>
<li><p>動的カラム適用後</p></li>
<li><p>結果出力後</p></li>
</ul>
</li>
<li><p>この機能によって、このコマンドがどこまで完了したかを見ることができます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] <code class="docutils literal notranslate"><span class="pre">TokenPattern</span></code> の説明をドキュメントに追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] <code class="docutils literal notranslate"><span class="pre">TokenTable</span></code> の説明をドキュメントに追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> の説明をドキュメントに追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] groonga.logへの操作ログの出力を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grndb</span></code> コマンドが実行結果と実行過程を出力するようになります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 空のファイルのチェックをサポートしました。</p>
<ul>
<li><p>この機能によって、空のファイルが存在するかどうかをチェックできます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--since</span></code> を追加しました。</p>
<ul>
<li><p>検査の範囲を指定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--since</span></code> についてのドキュメントを追加しました。</p></li>
<li><p>RapidJSONをバンドルしました。</p>
<ul>
<li><p>部分的にGroongaのJSONパーサーとしてRapidJSONを使うことができます。(この機能はまだ部分的です。)</p></li>
<li><p>これを使うことでより厳格なJSONのパースができます。</p></li>
</ul>
</li>
<li><p>JSON文字列からint32のベクターへのキャストをサポートしました。</p>
<ul>
<li><p>この機能は、RapidJSONが必要です。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] <code class="docutils literal notranslate"><span class="pre">default_operator</span></code> を追加しました。</p>
<ul>
<li><p>&quot;keyword1 keyword2&quot;時の演算子をカスタマイズできます。</p></li>
<li><p>デフォルトでは、&quot;keyword1 keyword2&quot;はAND演算です。</p></li>
<li><p>&quot;keyword1 keyword2&quot;の演算子をAND以外に変更できます。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id133">
<h3>修正<a class="headerlink" href="#id133" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[optimizer] 複数のfilter条件と <code class="docutils literal notranslate"><span class="pre">xxx.yyy==&quot;keyword&quot;</span></code> のような条件を指定した際にエラーが発生するバグを修正しました。</p></li>
<li><p>GroongaのWindows用のパッケージ(VC++版)に不足していたライセンスファイルを追加しました。</p></li>
<li><p>GroongaのWindows用のパッケージ(VC++版)UCRTランタイムを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/window_function.html"><span class="doc">ウィンドウ関数</span></a>] メモリリークを修正しました。</p>
<ul>
<li><p>これは、複数のウインドウに対してソートキーを適用した際に発生します。 [Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</li>
</ul>
</section>
<section id="id134">
<h3>感謝<a class="headerlink" href="#id134" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-3-2019-05-29">
<span id="release-9-0-3"></span><h2>9.0.3リリース - 2019-05-29<a class="headerlink" href="#release-9-0-3-2019-05-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id135">
<h3>改良<a class="headerlink" href="#id135" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] より多くのクエリーログを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドが、以下のタイミングでログを出力するようになります。</p>
<ul>
<li><p>ドリルダウンによるソート後</p></li>
<li><p>ドリルダウンによるフィルター後</p></li>
</ul>
</li>
<li><p>この機能によって、このコマンドがどこまで完了したかを見ることができます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] より多くのクエリーログを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_select</span></code> コマンドが、以下のタイミングでログを出力するようになります。</p>
<ul>
<li><p>動的カラム作成後</p></li>
<li><p>ドリルダウンによるグループ化後</p></li>
<li><p>ドリルダウンによるソート後</p></li>
<li><p>ドリルダウンによるフィルター後</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_select</span></code> によるソート後</p></li>
</ul>
</li>
<li><p>この機能によって、このコマンドがどこまで完了したかを見ることができます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">limit</span></code> オプションを使用したときのソートのパフォーマンスを少し改善しました。</p></li>
<li><p>[index_column_diff] パフォーマンスを改善しました。</p>
<ul>
<li><p>このコマンドの実行速度を大幅に短くしました。</p></li>
</ul>
</li>
<li><p>[index_column_diff] 無効な参照を無視するように改良しました。</p></li>
<li><p>[index_column_diff] ベクター要素の重複に対応しました。</p></li>
<li><p>[Normalizers] Unicode 12.1 の NFKC（Normalization Form Compatibility Composition）をベースにしたノーマライザー <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC121</span></code> を追加しました。</p></li>
<li><p>[TokenFilters] Unicode 12.1 の NFKC（Normalization Form Compatibility Composition）をベースにしたトークンフィルター <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC121</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--log-flags</span></code> を追加しました。</p>
<ul>
<li><p>groonga実行ファイルと同様、ログに出力する項目を指定できます。</p></li>
<li><p>サポートされているログフラグについては、[<a class="reference internal" href="reference/executables/groonga.html"><span class="doc">groonga 実行ファイル</span></a>] を参照してください。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 検索にマッチしない時の戻り値を変更する新しいオプションを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/plugin_unregister.html"><span class="doc">plugin_unregister</span></a>] Windowsのフルパスをサポートしました。</p></li>
<li><p>複数行のログメッセージをサポートしました。</p>
<ul>
<li><p>この機能によって、複数行に渡るログメッセージが見やすくなります。</p></li>
</ul>
</li>
<li><p>インデックスを使って検索した際、キーをGroongaのログに出力するようにしました。</p></li>
<li><p>[<a class="reference internal" href="tutorial/match_columns.html"><span class="doc">match_columnsパラメータ</span></a>] インデックスの重みのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] <code class="docutils literal notranslate"><span class="pre">order</span></code> パラメータの説明を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/object_inspect.html"><span class="doc">object_inspect</span></a>] 新しい統計 <code class="docutils literal notranslate"><span class="pre">INDEX_COLUMN_VALUE_STATISTICS_NEXT_PHYSICAL_SEGMENT_ID</span></code> と <code class="docutils literal notranslate"><span class="pre">INDEX_COLUMN_VALUE_STATISTICS_N_PHYSICAL_SEGMENTS</span></code> の説明を追加しました。</p></li>
<li><p>Ubuntu 14.04 のサポートをやめました。</p></li>
</ul>
</section>
<section id="id136">
<h3>修正<a class="headerlink" href="#id136" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[index_column_diff] <code class="docutils literal notranslate"><span class="pre">remains</span></code> を多く報告するバグを修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--without-onigmo</span></code> オプションを使った際にビルドエラーになるバグを修正しました。[GitHub#951] [Tomohiro KATOさんが報告]</p></li>
<li><p>&quot;CVE: 2019-11675&quot;の脆弱性を修正しました。[Wolfgang Hotwagnerさんが報告]</p></li>
<li><p>Windows版のGroongaにて、拡張パスプレフィックス <code class="docutils literal notranslate"><span class="pre">\\?\</span></code> を削除しました。[GitHub#958] [yagisumiさんが報告]</p>
<ul>
<li><p>この拡張プレフィックスは、プラグインを正確に見つけられないというバグを引き起こします。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id137">
<h3>感謝<a class="headerlink" href="#id137" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Tomohiro KATOさん</p></li>
<li><p>Wolfgang Hotwagnerさん</p></li>
<li><p>yagisumiさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-2-2019-04-29">
<span id="release-9-0-2"></span><h2>9.0.2リリース - 2019-04-29<a class="headerlink" href="#release-9-0-2-2019-04-29" title="この見出しへのパーマリンク">#</a></h2>
<p>このリリースからVC++で作成したWindows版パッケージを提供します。</p>
<p>今までどおり、MinGWで作成したWindows版パッケージも提供しますが、近いうちにMinGWで作ったパッケージの代わりにVC++で作ったパッケージを提供する予定です。</p>
<section id="id138">
<h3>改良<a class="headerlink" href="#id138" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいフラグ <code class="docutils literal notranslate"><span class="pre">INDEX_LARGE</span></code> を追加しました。</p>
<ul>
<li><p>このフラグによって、デフォルトの2倍の領域を持つインデックスカラムを作成できます。</p></li>
<li><p>ただ、メモリ使用量も2倍となることに注意して下さい。</p></li>
<li><p>このフラグは、インデックス対象のデータが大きい時に有用です。</p></li>
<li><p>大きいデータとは、大量のレコード（通常は少なくとも1000万レコード以上）があり、少なくとも次のうちの1つ以上の特徴があります。</p>
<ul>
<li><p>インデックス対象が複数のカラム</p></li>
<li><p>インデックステーブルにトークナイザーが付いている</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/object_inspect.html"><span class="doc">object_inspect</span></a>] セグメントの新しい統計値 <code class="docutils literal notranslate"><span class="pre">next_physical_segment_id</span></code> と <code class="docutils literal notranslate"><span class="pre">max_n_physical_segments</span></code> を追加しました。</p>
<ul>
<li><p>この情報で、インデックスカラムの領域の使用量とインデックスカラムの領域の最大値を確認できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] シャードをまたがったウィンドウ関数をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] シャードをまたがったウインドウ関数をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] シャードをまたがったウインドウ関数をサポートしました。</p></li>
<li><p>このリリースからVC++で作成したWindows版パッケージを提供するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/io_flush.html"><span class="doc">io_flush</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> を追加しました。</p>
<ul>
<li><p>指定した書き出し対象オブジェクトとその子オブジェクトすべて、参照先のテーブル、インデックスが張られているカラムがある場合、対応するインデックスカラムとそのインデックスカラムのテーブルを書き出し対象オブジェクトにできます。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id139">
<h3>修正<a class="headerlink" href="#id139" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>一部の環境でコンパイルエラー &quot;unknown type name 'bool'&quot; が発生する問題を修正しました。</p></li>
<li><p>mrubyを経由して実行するコマンド(例えば、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code>、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code>、 <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 等)で、Int32を超える数を正しく出力できない問題を修正しました。[GitHub#936] [HashidaTKSさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id140">
<h3>感謝<a class="headerlink" href="#id140" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>HashidaTKSさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-1-2019-03-29">
<span id="release-9-0-1"></span><h2>9.0.1リリース - 2019-03-29<a class="headerlink" href="#release-9-0-1-2019-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id141">
<h3>改良<a class="headerlink" href="#id141" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>ベクターの値にnullが使えるようになりました。</p>
<ul>
<li><p><cite>select ... --columns[vector].flags COLUMN_VECTOR --columns[vector].value &quot;null&quot;</cite> のように使用できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] ドキュメントを英語に翻訳しました。</p></li>
<li><p>無効なインデックスのチェックとログへの記録を強化しました。インデックス関連のバグを発見するのに役立ちます。</p></li>
<li><p><a class="reference internal" href="#release-8-0-6"><span class="std std-ref">8.0.6リリース - 2018-08-29</span></a> の <code class="docutils literal notranslate"><span class="pre">GRN_TABLE_SELECT_ENOUGH_FILTERED_RATIO</span></code> の説明を改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">--load_table</span></code> 、<code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> 、 <code class="docutils literal notranslate"><span class="pre">--load_values</span></code> を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> の結果を <code class="docutils literal notranslate"><span class="pre">--load_table</span></code> で指定したテーブルへ格納できます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load_values</span></code> オプションは、<code class="docutils literal notranslate"><span class="pre">select</span></code> の結果のカラムを指定します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> オプションは、<code class="docutils literal notranslate"><span class="pre">--load_table</span></code> で指定したテーブルのカラムを指定します。</p></li>
<li><p>このようにして、<code class="docutils literal notranslate"><span class="pre">--load_values</span></code> で指定したカラムの値を、 <code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> で指定したカラムへ格納できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">--load_table</span></code> 、<code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> 、 <code class="docutils literal notranslate"><span class="pre">--load_values</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] ロード先のテーブルをクエリーログに表示するようにしました。</p>
<ul>
<li><p>以下のように、ロード先のテーブル名は <code class="docutils literal notranslate"><span class="pre">[]</span></code> 内の文字列として表示します　。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:000000000000000</span> <span class="pre">load(3):</span> <span class="pre">[LoadedLogs][3]</span></code></p></li>
</ul>
</li>
<li><p>以下のAPIを追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_ii_get_flags()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_index_column_diff()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_memory_get_usage()</span></code></p></li>
</ul>
</li>
<li><p>壊れたインデックスをチェックするためのコマンド <code class="docutils literal notranslate"><span class="pre">index_column_diff</span></code> を追加しました。コマンド実行の進捗を記録したい場合は、ログレベルをdebugに設定してください。</p></li>
</ul>
</section>
<section id="id142">
<h3>修正<a class="headerlink" href="#id142" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 一致しない場合、空のベクターを返すよう変更しました。</p>
<ul>
<li><p>そのような場合、 <code class="docutils literal notranslate"><span class="pre">null</span></code> の代わりに空のベクター <code class="docutils literal notranslate"><span class="pre">[]</span></code> が返されます。</p></li>
</ul>
</li>
<li><p>スレッドカウントがオーバフローする可能性についての警告を修正しました。実運用では、膨大な数のスレッドが使用されていないため、ユーザーに影響はありません。[GitHub#904]</p></li>
<li><p>maxOSでのビルドエラーを修正しました。 [GitHub#909] [shiro615さんが報告]</p></li>
<li><p>ストップワードの処理のバグを修正しました。</p>
<ul>
<li><p>このバグは、クエリーの最初のトークンをストップワードとして設定すると発生します。</p></li>
<li><p>このバグが発生した場合、検索クエリーはヒットしません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/api/global_configurations.html"><span class="doc">全体設定</span></a>] <code class="docutils literal notranslate"><span class="pre">grn_lock_set_timeout</span></code> のパラメーター名の誤字を修正しました。</p></li>
<li><p>インデックスの破損によって、削除されたレコードがマッチするバグを修正しました。</p>
<ul>
<li><p>大量のレコードを追加または、削除した時に発生することがあります。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> がレコードを返さない場合のメモリリークを修正しました。[GitHub#911] [HashidaTKSさんがパッチ提供]</p></li>
<li><p>ロードしているデータが正しくノーマライズされないことによってクエリーにマッチしないバグを修正しました。[PGroonga#GitHub#93, GitHub#912,GitHub#913] [kamicupさんとdodaisukeさんが報告]</p>
<ul>
<li><p>このバグは、カタカナの後ろに空白のあるデータをロードし、ノーマライザーに <code class="docutils literal notranslate"><span class="pre">unify_kana</span></code> オプションが使用された時に発生します。</p></li>
</ul>
</li>
<li><p>インデックスの更新中にインデックスが破損するバグを修正しました。</p>
<ul>
<li><p>長期間、大量のレコードの追加、削除を繰り返した時に発生することがあります。</p></li>
</ul>
</li>
<li><p>インデックス更新時に十分な作業領域を確保できずにクラッシュするバクを修正しました。</p></li>
</ul>
</section>
<section id="id143">
<h3>感謝<a class="headerlink" href="#id143" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>shiro615さん</p></li>
<li><p>HashidaTKSさん</p></li>
<li><p>kamicupさん</p></li>
<li><p>dodaisukeさん</p></li>
</ul>
</section>
</section>
<section id="release-9-0-0-2019-02-09">
<span id="release-9-0-0"></span><h2>9.0.0リリース - 2019-02-09<a class="headerlink" href="#release-9-0-0-2019-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく9.0.0へアップグレードできます。</p>
<section id="id144">
<h3>改良<a class="headerlink" href="#id144" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenPattern</span></code> を追加しました。</p>
<ul>
<li><p>正規表現を使ってトークンを抽出できます。</p>
<ul>
<li><p>このトークナイザーは正規表現にマッチしたトークンのみを抽出します。</p></li>
</ul>
</li>
<li><p>正規表現のパターンは複数指定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenTable</span></code> を追加しました。</p>
<ul>
<li><p>既存のテーブルのカラムの値を使ってトークンを抽出できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] バイナリデータのダンプに対応しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] インデックスカラムに対する類似文書検索をサポートしました。</p>
<ul>
<li><p>マルチカラムインデックスを使用している場合、この機能を使って、全てのソースカラムに対して類似文書検索ができます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_blank</span></code> を追加しました。</p>
<ul>
<li><p>このオプションは空白を取り除きます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga.html"><span class="doc">groonga 実行ファイル</span></a>] ログ内のThreadIDの表示を改善しました。</p>
<ul>
<li><p>Windows版では、ProcessIDとThreadIDを混同しやすかったので、どちらがThreadIDでどちらがProcessIDかを明確にしました。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-8-1-1-2019-01-29">
<span id="release-8-1-1"></span><h2>8.1.1リリース - 2019-01-29<a class="headerlink" href="#release-8-1-1-2019-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id145">
<h3>改良<a class="headerlink" href="#id145" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">--load_table</span></code> 、<code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> 、 <code class="docutils literal notranslate"><span class="pre">--load_values</span></code> を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_select</span></code> の結果を <code class="docutils literal notranslate"><span class="pre">--load_table</span></code> で指定したテーブルへ格納できます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load_values</span></code> オプションは、<code class="docutils literal notranslate"><span class="pre">logical_select</span></code> の結果のカラムを指定します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> オプションは、<code class="docutils literal notranslate"><span class="pre">--load_table</span></code> で指定したテーブルのカラムを指定します。</p></li>
<li><p>このようにして、<code class="docutils literal notranslate"><span class="pre">--load_values</span></code> で指定したカラムの値を、 <code class="docutils literal notranslate"><span class="pre">--load_columns</span></code> で指定したカラムへ格納できます。</p></li>
</ul>
</li>
<li><p>インデックスの更新エラー時のログを改善しました。</p>
<ul>
<li><p>ログに、より詳細な情報を追加しました。</p>
<ul>
<li><p>例えば、ポスティングリストのマージに失敗した時にマージ元のバッファーとチャンクを出力します。</p></li>
<li><p>また、バッファー確保のエラーが発生した時は、バッファーの空き領域と要求サイズをログに出力します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga.html"><span class="doc">groonga 実行ファイル</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--log-flags</span></code> を追加しました。</p>
<ul>
<li><p>Groongaのログに出力する項目を指定できます。</p></li>
<li><p>以下のような項目を出力できます。</p>
<ul>
<li><p>タイムスタンプ</p></li>
<li><p>ログメッセージ</p></li>
<li><p>ロケーション(ログが出力された場所)</p></li>
<li><p>プロセスID</p></li>
<li><p>スレッドID</p></li>
</ul>
</li>
<li><p>以下のように接頭辞を指定できます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p>
<ul>
<li><p>この接頭辞は、 &quot;フラグを追加する&quot;という意味です。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p>
<ul>
<li><p>この接頭辞は、&quot;フラグを削除する&quot;という意味です。</p></li>
</ul>
</li>
<li><p>接頭辞無しは、&quot;存在しているフラグを置き換える&quot;という意味です。</p></li>
</ul>
</li>
<li><p>具体的には、以下のようにフラグ指定できます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p>
<ul>
<li><p>ログに何も出力しません。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p>
<ul>
<li><p>ログにタイムスタンプを出力します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">message</span></code></p>
<ul>
<li><p>ログにメッセージを出力します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">location</span></code></p>
<ul>
<li><p>ログの出力場所(ファイル名、行数、関数名)とプロセスIDを出力します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">process_id</span></code></p>
<ul>
<li><p>ログにプロセスIDを出力します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code></p>
<ul>
<li><p>このフラグは、 <code class="docutils literal notranslate"><span class="pre">process_id</span></code> のエイリアスです。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">thread_id</span></code></p>
<ul>
<li><p>ログにスレッドIDを出力します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p>
<ul>
<li><p>このフラグは、 <code class="docutils literal notranslate"><span class="pre">none</span></code> と <code class="docutils literal notranslate"><span class="pre">default</span></code> 以外の全てのフラグを指定します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code></p>
<ul>
<li><p>ログに、タイムスタンプとログメッセージを出力します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code> を使って、複数のフラグを指定することもできます。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id146">
<h3>修正<a class="headerlink" href="#id146" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>インデックスの更新エラー発生時にメモリリークする問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] ステートレスなノーマライザーとステートフルなノーマライザーを同時に使用した時に、それらが誤った結果を返すバグを修正しました。</p>
<blockquote>
<div><ul class="simple">
<li><p>ステートレスなノーマライザーとは以下です。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_voiced_sound_mark</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_hyphen</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_prolonged_sound_mark</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_hyphen_and_prolonged_sound_mark</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_middle_dot</span></code></p></li>
</ul>
</li>
<li><p>ステートフルなノーマライザーとは以下です。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_katakana_bu_sound</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_to_romaji</span></code></p></li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="release-8-1-0-2018-12-29">
<span id="release-8-1-0"></span><h2>8.1.0リリース - 2018-12-29<a class="headerlink" href="#release-8-1-0-2018-12-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id147">
<h3>改良<a class="headerlink" href="#id147" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.15.8に更新しました。</p></li>
</ul>
</section>
<section id="id148">
<h3>修正<a class="headerlink" href="#id148" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">io_flush</span></code> コマンド実行後に、DBに対するアンロックが常にフラッシュの実行後になってしまうバグを修正しました。</p></li>
<li><p>参照先を持たないレコードを持つテーブルに対して <code class="docutils literal notranslate"><span class="pre">reindex</span></code> コマンドを実行した際に、 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> コマンドが終了しないバグを修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-8-0-9-2018-11-29">
<span id="release-8-0-9"></span><h2>8.0.9リリース - 2018-11-29<a class="headerlink" href="#release-8-0-9-2018-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id149">
<h3>改良<a class="headerlink" href="#id149" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] トークナイザーの作成に失敗した際のエラーメッセージにトークナイザーの名前を出力するよう改良。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenDelimit] トークンの区切り文字のカスタマイズをサポートしました。</p>
<ul>
<li><p>空白以外のトークンを区切り文字に使えます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenDelimit] 新しいオプション <code class="docutils literal notranslate"><span class="pre">pattern</span></code> を追加しました。</p>
<ul>
<li><p>このオプションにより、区切り文字にに正規表現を指定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] 各トークンの情報に <code class="docutils literal notranslate"><span class="pre">force_prefix_search</span></code> の値を追加しました。</p>
<ul>
<li><p>&quot;force_prefix&quot; は後方互換のため残しています。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] ビルトインのトークンフィルタ <code class="docutils literal notranslate"><span class="pre">TokenFilterNFKC100</span></code> を追加しました。</p>
<ul>
<li><p>NormalizerNFKC100のように <code class="docutils literal notranslate"><span class="pre">unify_kana</span></code> オプションで、カタカナをひらがなへ変換できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>][TokenFilterStem] 新しオプション <code class="docutils literal notranslate"><span class="pre">algorithm</span></code> を追加しました。</p>
<ul>
<li><p>このオプションによって、英語以外の言語(フランス語、スペイン語、ポルトガル語、イタリア語、ルーマニア語、ドイツ語、オランダ語、スウェーデン語、ノルウェー語、デンマーク語、ロシア語、フィンランド語)をステミングできます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/token_filters.html"><span class="doc">トークンフィルター</span></a>][TokenFilterStopWord] 新しいオプション <code class="docutils literal notranslate"><span class="pre">column</span></code> を追加しました</p>
<ul>
<li><p>このオプションによって、is_stop_word以外のカラムをスットプワードに指定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] トークンフィルターのオプションの出力をサポートしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> や <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> 等のようなオプションを持つトークナイザーを指定した場合、それらのオプションも <code class="docutils literal notranslate"><span class="pre">table_list</span></code> コマンドで出力できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/truncate.html"><span class="doc">truncate</span></a>] トークンフィルターのオプションを持ったテーブルをサポートしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> や <code class="docutils literal notranslate"><span class="pre">TokenStopWord</span></code> 等のようなオプションを持つトークナイザーを持つテーブルでも <code class="docutils literal notranslate"><span class="pre">truncate</span></code> できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/schema.html"><span class="doc">schema</span></a>] トークンフィルターのオプションの出力をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">unify_to_romaji</span></code> を追加しました。</p>
<ul>
<li><p>このオプションによって、ひらがなとカタカナをローマ字に正規化できます。</p></li>
</ul>
</li>
<li><p>[query-log][show-condition] &quot;func() &gt; 0&quot;をサポートしました。</p></li>
<li><p>[Windows] アンマップ前のフラッシュを確実にするよう改善しました。</p></li>
<li><p>ファイル入力のエラーメッセージを改善しました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.15.7に更新しました。</p>
<ul>
<li><p>CVE-2018-16843とCVE-2018-16844のセキュリティの修正が含まれています。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id150">
<h3>修正<a class="headerlink" href="#id150" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>ウインドウ関数を評価する際にメモリリークする問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] ログの内容が混在することがあるバグを修正しました。</p></li>
<li><p>output_columnsのスライスのエラーが発生した際に、無効なJSONが生成されるバグを修正しました。</p></li>
<li><p>ネストして参照されているベクターカラムの値を取得する際にメモリリークする問題を修正しました。</p></li>
<li><p>インデックス破損を警告するログを出力する際にクラッシュするバグを修正しました。</p></li>
<li><p>式の評価で一時的なベクターが再利用された時にクラッシュするバグを修正しました。</p>
<ul class="simple">
<li><p>例えば、以下のようにベクターを使った式を評価する時にクラッシュします。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">_score</span> <span class="pre">=</span> <span class="pre">_score</span> <span class="pre">+</span> <span class="pre">(vector_size(categories)</span> <span class="pre">&gt;</span> <span class="pre">0)</span></code></p>
</li>
<li><p>deleteコマンドで削除したベクターカラムの値がヒットするバグを修正しました。[dodaisukeさんの報告]</p></li>
</ul>
</section>
<section id="id151">
<h3>感謝<a class="headerlink" href="#id151" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>dodaisukeさん</p></li>
</ul>
</section>
</section>
<section id="release-8-0-8-2018-10-29">
<span id="release-8-0-8"></span><h2>8.0.8リリース - 2018-10-29<a class="headerlink" href="#release-8-0-8-2018-10-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id152">
<h3>改良<a class="headerlink" href="#id152" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/table_list.html"><span class="doc">table_list</span></a>] デフォルトトークナイザーのオプションをサポートしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> や <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> 等のようなオプションを持つトークナイザーを指定した場合、それらのオプションも <code class="docutils literal notranslate"><span class="pre">table_list</span></code> コマンドで出力できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">record</span> <span class="pre">&#64;</span> <span class="pre">'query'</span></code> を使ったシーケンシャルマッチでノーマライザーのオプションをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/truncate.html"><span class="doc">truncate</span></a>] トークナイザーのオプションを持ったテーブルをサポートしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> や <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> 等のようなオプションを持つトークナイザーを持つテーブルでも <code class="docutils literal notranslate"><span class="pre">truncate</span></code> できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] <code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">target_class</span></code> オプションを追加しました。</p>
<ul>
<li><p>このオプションは、指定した品詞のトークンを検索します。例えば、名詞のみを検索することができます。</p></li>
<li><p>このオプションは、以下のようにサブクラスを指定することや、 <code class="docutils literal notranslate"><span class="pre">+</span></code> や <code class="docutils literal notranslate"><span class="pre">-</span></code> を使って、特定の品詞を追加または除外することもできます。したがって、以下のように代名詞を除外して検索することもできます。</p>
<p><code class="docutils literal notranslate"><span class="pre">'TokenMecab(&quot;target_class&quot;,</span> <span class="pre">&quot;-名詞/代名詞&quot;,</span> <span class="pre">&quot;target_class&quot;,</span> <span class="pre">&quot;+&quot;)'</span></code></p>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/io_flush.html"><span class="doc">io_flush</span></a>] <code class="docutils literal notranslate"><span class="pre">io_flush</span></code> 中のデータベースのロックをサポートしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">io_flush</span></code> 実行中に <code class="docutils literal notranslate"><span class="pre">io_flush</span></code> 対象のテーブルを削除するとGroongaがクラッシュする問題があったためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/cast_loose.html"><span class="doc">cast_loose</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">cast_loose()</span></code> を追加しました。</p>
<ul class="simple">
<li><p>この関数は、指定した型へキャストします。もし、指定した値がキャストできない場合、値は、指定したデフォルト値になります。</p></li>
</ul>
</li>
<li><p>条件式の評価順序の最適化を追加しました。(実験的)</p>
<ul>
<li><p>以下のように環境変数を設定することでこの機能を有効にできます。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code></p>
</li>
</ul>
</li>
<li><p>インデックス検索可能な正規表現に <code class="docutils literal notranslate"><span class="pre">(?-mix:XXX)</span></code> 記法をサポートしました。 [groonga-dev,04683][ Masatoshi SEKIさんの報告]</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(?-mix:XXX)</span></code> は XXX と同じ扱いです。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.15.5に更新しました。</p></li>
<li><p>Ubuntu 18.10 (Cosmic Cuttlefish)をサポートしました。</p></li>
</ul>
</section>
<section id="id153">
<h3>修正<a class="headerlink" href="#id153" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Groonga GQTP サーバーが新しい接続を受け付けなくなることがあるバグを修正しました。[groonga-dev,04688][Yutaro Shimamuraさんの報告]</p>
<ul>
<li><p>quitを使わずにクライアントプロセスを中断した時に発生します。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id154">
<h3>感謝<a class="headerlink" href="#id154" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Masatoshi SEKIさん</p></li>
<li><p>Yutaro Shimamuraさん</p></li>
</ul>
</section>
</section>
<section id="release-8-0-7-2018-09-29">
<span id="release-8-0-7"></span><h2>8.0.7リリース - 2018-09-29<a class="headerlink" href="#release-8-0-7-2018-09-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id155">
<h3>改良<a class="headerlink" href="#id155" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] Mecabのメタデータの出力をサポートしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">include_class</span></code> オプションを追加しました。</p>
<p>このオプションは、Mecabのメタデータの <code class="docutils literal notranslate"><span class="pre">class</span></code> と <code class="docutils literal notranslate"><span class="pre">subclass</span></code> を出力します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">include_reading</span></code> オプションを追加しました。</p>
<p>このオプションは、Mecabのメタデータの <code class="docutils literal notranslate"><span class="pre">reading</span></code> を出力します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">include_form</span></code> オプションを追加しました。</p>
<p>このオプションは、Mecabのメタデータの <code class="docutils literal notranslate"><span class="pre">inflected_type</span></code> と <code class="docutils literal notranslate"><span class="pre">inflected_form</span></code> 、 <code class="docutils literal notranslate"><span class="pre">base_form</span></code> を出力します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code> に <code class="docutils literal notranslate"><span class="pre">use_reading</span></code> オプションを追加しました。</p>
<p>このオプションは、読みがなによる検索をサポートします。</p>
<p>このオプションは、読みがなを使った検索をするため、表記ゆれの対策として有用です。</p>
</li>
</ul>
</li>
<li><p>[plugin] 複数のディレクトリからプラグインを取得できるようになりました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_PLUGINS_PATH</span></code> に複数のディレクトリを指定できます。Windowsの場合は、&quot;:&quot;でWindows以外では、&quot;;&quot;で区切ります。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_PLUGINS_PATH</span></code> は、 <code class="docutils literal notranslate"><span class="pre">GRN_PLUGINS_DIR</span></code> より優先度が高いです。現状、このオプションはWindowsではサポートされていません。</p>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenNgram] <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> に <code class="docutils literal notranslate"><span class="pre">unify_alphabet</span></code> オプションを追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">unify_alphabet</span></code> を <code class="docutils literal notranslate"><span class="pre">false</span></code> として使うと、 <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> はASCII文字のトークナイズ方法にバイグラムを使います。</p>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenNgram] <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> に <code class="docutils literal notranslate"><span class="pre">unify_symbol</span></code> オプションを追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">TokenNgram(&quot;unify_symbol&quot;,</span> <span class="pre">false)</span></code> は、 <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code> と同じ動作です。</p>
</li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenNgram] <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> に <code class="docutils literal notranslate"><span class="pre">unify_digit</span></code> オプションを追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">unify_digit</span></code> を <code class="docutils literal notranslate"><span class="pre">false</span></code> として使うと、 <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> は数字のトークナイズ方法にバイグラムを使います。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.15.4に更新しました。</p></li>
</ul>
</section>
<section id="id156">
<h3>修正<a class="headerlink" href="#id156" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>いくつかのケースでの誤ったスコア計算を修正しました。</p>
<ul>
<li><p>ブール値に数値を加算、乗算または除算するときに発生します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">！=</span></code> や <code class="docutils literal notranslate"><span class="pre">==</span></code> を使ってスカラーとベクトルの列を比較するときに発生します。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-8-0-6-2018-08-29">
<span id="release-8-0-6"></span><h2>8.0.6リリース - 2018-08-29<a class="headerlink" href="#release-8-0-6-2018-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id157">
<h3>改良<a class="headerlink" href="#id157" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] <code class="docutils literal notranslate"><span class="pre">chunked_tokenize</span></code> と <code class="docutils literal notranslate"><span class="pre">chunk_size_threshold</span></code> の両オプションに対応しました。</p></li>
<li><p>[optimizer] query family expressionの推定に対応しました。<code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">&#64;</span> <span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">&#64;~</span> <span class="pre">pattern</span></code> のようなquery family expressionについて、より効果的な実行計画を立てられます。</p></li>
<li><p>[optimizer] オプティマイザをプラグインから組み込みの機能に変更し、初期状態で無効としました。環境変数を <code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code> と定義するか、従来通りに <code class="docutils literal notranslate"><span class="pre">expression_rewriters</span></code> テーブルを使う事で機能を有効化できます。</p></li>
<li><p>充分に絞り込み済みの場合において、初期状態でシーケンシャルサーチを行うようにしました。現在の結果が充分に少数である場合、シーケンシャルサーチはインデックス検索よりも高速です。現在の結果がテーブル内の全レコードの1%で1000件未満の場合、インデックス検索可能な場合であってもシーケンシャルサーチが使われます。</p>
<p>現在、この最適化は、 <code class="docutils literal notranslate"><span class="pre">==</span></code> と <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> を使った検索時に適用されます。</p>
<p>絞り込みに指定したカラムを持つテーブルのキーが <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> の場合、この最適化を適用するためには、そのテーブルのノーマライザーを <code class="docutils literal notranslate"><span class="pre">NormalizerAuto</span></code> にする必要があります。</p>
<p>この機能は環境変数で <code class="docutils literal notranslate"><span class="pre">GRN_TABLE_SELECT_ENOUGH_FILTERED_RATIO=0.0</span></code> と設定する事で無効化できます。</p>
</li>
<li><p>[load] エラーメッセージにテーブル名を含めるようにしました。</p></li>
<li><p>[load] <code class="docutils literal notranslate"><span class="pre">lock_table</span></code> オプションを追加しました。<code class="docutils literal notranslate"><span class="pre">--lock_table</span> <span class="pre">yes</span></code> が指定された場合、カラムの更新と <code class="docutils literal notranslate"><span class="pre">--each</span></code> の適用を行っている間、<code class="docutils literal notranslate"><span class="pre">load</span></code> は対象のテーブルをロックします。このオプションは <code class="docutils literal notranslate"><span class="pre">load</span></code> と <code class="docutils literal notranslate"><span class="pre">delete</span></code> の衝突を防ぎますが、読み込みの性能を低下させるでしょう。</p></li>
<li><p>[vector_find] サポートされていないモードでクラッシュしないようにしました。</p></li>
</ul>
</section>
<section id="id158">
<h3>修正<a class="headerlink" href="#id158" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[index] <code class="docutils literal notranslate"><span class="pre">HASH_KEY</span></code> を伴ったテキストのベクターに対するオフラインでのインデックス構築に関して、誤ったセクションIDを持つインデックスが構築されてしまうバグを修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--match_columns</span> <span class="pre">'index[0]</span> <span class="pre">||</span> <span class="pre">index[9]'</span></code> が誤ったセクションを使用してしまう問題を修正しました。</p></li>
<li><p>[highlighter] 語彙表がハッシュテーブルで、且つキーワードがN-gramのNよりも少ない文字数の場合に、誤ったハイライトが行われていた問題を修正しました。</p></li>
<li><p>[mruby] 本当のエラーが隠されていた問題を修正しました。mrubyは引数無しで投げられたエラーの伝搬に対応していません。<a class="github reference external" href="https://github.com/mruby/mruby/issues/290">mruby/mruby#290</a></p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenNgram loose]: クエリが曖昧な種類のみであった場合に検索結果が見つからない問題を修正しました。語彙表を伴っての <code class="docutils literal notranslate"><span class="pre">highlight_html()</span></code> も同様に壊れていました。</p></li>
<li><p>テキストから数値への変換において、後続するゴミ部分が無視されていた問題を修正しました。 &quot;0garbage&quot; は変換エラーになります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_column</span> <span class="pre">&gt;=</span> <span class="pre">'key_value'</span></code> に当てはまる場合の最適化の問題を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-8-0-5-2018-07-29">
<span id="release-8-0-5"></span><h2>8.0.5リリース - 2018-07-29<a class="headerlink" href="#release-8-0-5-2018-07-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id159">
<h3>改良<a class="headerlink" href="#id159" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/grn_expr/script_syntax.html"><span class="doc">スクリプト構文</span></a>] 類似文書検索の補足説明とその日本語訳を追加しました。 [GitHub groonga/GitHub#858] [堀本さんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="reference/functions/time_classify_day_of_week.html"><span class="doc">time_classify_day_of_week</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">time_classify_day_of_week()</span></code> を追加しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fstack-protector</span></code> で警告を抑制するようにしました。（OBATA Akioさんが提案）</p></li>
<li><p>新しいAPI <code class="docutils literal notranslate"><span class="pre">time_format_iso8601()</span></code> を追加しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_raw_string</span></code> 構造体を公開。</p></li>
<li><p>新しいAPI: <code class="docutils literal notranslate"><span class="pre">grn_obj_clear_option_values()</span></code> を追加しました。永続的なデータベースのremoveと一時的なデータベースのcloseの際にオプションの値を消去できます。</p></li>
<li><p>[log] <code class="docutils literal notranslate"><span class="pre">[ii][update][one]</span></code> のエラーメッセージにインデックスカラム名を出力するようにしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.15.2に更新しました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 17.10 (Artful Aardvark）のサポートをやめました。2018年7月19日でサポートが切れた（EOLになった）ためです。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] jessieのサポートをやめました。Debianのセキュリティ＆リリースチームはもはやjessieの更新を提供しません。</p></li>
</ul>
</section>
<section id="id160">
<h3>修正<a class="headerlink" href="#id160" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>POSTでの <code class="docutils literal notranslate"><span class="pre">/d/load</span></code> へのデータ送信が中断された後に誤った結果が返されていたのを修正しました。</p></li>
<li><p>KyTeaに関する間違った関数呼び出しを修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">--force-truncate</span></code> オプションのラベルを追加しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-normalizer-mysql</span></code> のようにプラグインとして提供されているノーマライザーでオプションを使った場合に、データベースを終了するときにクラッシュする問題を修正しました。</p></li>
<li><p>ノーマライザーとトークナイザーのオプションが無視される場合があった問題を修正しました。この問題は同じオブジェクトIDが再利用された場合に発生していました。</p></li>
</ul>
</section>
</section>
<section id="release-8-0-4-2018-06-29">
<span id="release-8-0-4"></span><h2>8.0.4リリース - 2018-06-29<a class="headerlink" href="#release-8-0-4-2018-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id161">
<h3>改良<a class="headerlink" href="#id161" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[log] <code class="docutils literal notranslate"><span class="pre">[ii][update][one]</span></code> のエラーメッセージにサブエラーを追加しました。</p></li>
<li><p>新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_highlighter_clear_keywords()</span></code> を追加しました。</p></li>
<li><p>新しいpredicate <code class="docutils literal notranslate"><span class="pre">grn_obj_is_number_family_bulk()</span></code> を追加しました。</p></li>
<li><p>新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_value_mode()</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/vector_find.html"><span class="doc">vector_find</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">vector_find()</span></code> を追加しました。</p></li>
<li><p>msgpackでのmemcpyの警告を抑制しました。</p></li>
<li><p>mrubyを1.0.0から1.4.1に更新しました。</p></li>
<li><p>[doc][<a class="reference internal" href="reference/api/grn_obj.html"><span class="doc">grn_obj</span></a>] <code class="docutils literal notranslate"><span class="pre">grn_obj_is_index_column()</span></code> のAPIリファレンスを追加しました。</p></li>
<li><p>[windows] printfフォーマットの警告を抑制しました。</p></li>
<li><p>[windows] msgpackによる警告を抑制しました。</p></li>
<li><p>[<a class="reference internal" href="reference/api/grn_obj.html"><span class="doc">grn_obj</span></a>][<a class="reference internal" href="reference/api/plugin.html"><span class="doc">Plugin</span></a>] エンコーディングコンバーターを追加しました。ルール:</p>
<ul>
<li><p>grn_ctx::errbuf: grn_encoding</p></li>
<li><p>grn_logger_put: grn_encoding</p></li>
<li><p>mruby: UTF-8</p></li>
<li><p>path: locale</p></li>
</ul>
</li>
<li><p>[mrb] <code class="docutils literal notranslate"><span class="pre">LocaleOutput</span></code> を追加しました。</p></li>
<li><p>[windows] イメージのパスのgrn_encodingへの変換をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] エラーメッセージのエンコーディングを変換するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_sum.html"><span class="doc">window_sum</span></a>] 対象カラムとしての動的カラムをサポートしました。</p></li>
<li><p>[doc][<a class="reference internal" href="reference/api/grn_obj.html"><span class="doc">grn_obj</span></a>] <code class="docutils literal notranslate"><span class="pre">grn_obj_is_vector_column()</span></code> のAPIリファレンスを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/column_create.html"><span class="doc">column_create</span></a>] より多くのバリデーションを追加しました。</p>
<ul>
<li><p>1: ベクターカラムの全文検索インデックスは <code class="docutils literal notranslate"><span class="pre">WITH_SECTION</span></code> フラグが必要です。（ただし、 <code class="docutils literal notranslate"><span class="pre">WITH_POSITION</span></code> あり、 <code class="docutils literal notranslate"><span class="pre">WITH_SECTION</span></code> なしのTokenDelmitは許容されます。これはタグ検索に便利なパターンです。)</p></li>
<li><p>2: ベクターカラムの全文検索インデックスはマルチカラムインデックスであってはいけません。詳細: <a class="github reference external" href="https://github.com/groonga/groonga/commit/08e2456ba35407e3d5172f71a0200fac2a770142">groonga/groonga</a></p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 実装が不十分だったため、ログのチェックを一時的に無効にしました</p></li>
</ul>
</section>
<section id="id162">
<h3>修正<a class="headerlink" href="#id162" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 十分にフィルターされたケースで、スコアが多すぎる問題を修正</p></li>
<li><p>KyTeaがインストールされているとビルドに失敗する問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 出力チャネルを修正しました。</p></li>
<li><p>[query-log][show-condition] クラッシュするバグを修正しました（まだ残っている可能性があります）。</p></li>
<li><p>[highlighter][lexicon] ハイライトされないバグを修正しました。キーワードの長さがN未満（N-gramのN。多くの場合はBigramなので2未満）の場合、キーワードがハイライトされていませんでした。</p></li>
<li><p>[windows] base path検出時の問題を修正しました。システムロケールのDLLパスが、CP932での「U+8868 CJK UNIFIED IDEOGRAPH-8868」のように0x5c （ASCIIでの <code class="docutils literal notranslate"><span class="pre">\</span></code> )を含む場合に問題がありました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenNgram] 最初の文字の長さの誤りを修正しました。この問題は、「U+3231 PARENTHESIZED IDEOGRAPH STOCK」のような「PARENTHESIZED IDEOGRAPH」文字で起きていました。</p></li>
</ul>
</section>
</section>
<section id="release-8-0-3-2018-05-29">
<span id="release-8-0-3"></span><h2>8.0.3リリース - 2018-05-29<a class="headerlink" href="#release-8-0-3-2018-05-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id163">
<h3>改良<a class="headerlink" href="#id163" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> または <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> を使って検索した結果のハイライトをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">report_source_location</span> <span class="pre">option</span></code> を追加しました。このオプションは、<code class="docutils literal notranslate"><span class="pre">highlight_html</span></code> で語彙表を使ったハイライトをする時に使用します。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">unify_middle_dot</span> <span class="pre">option</span></code> を追加しました。このオプションは、中点を正規化します。<code class="docutils literal notranslate"><span class="pre">・</span></code> の有無や <code class="docutils literal notranslate"><span class="pre">・</span></code> 位置にかかわらず検索できます。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">unify_katakana_v_sounds</span> <span class="pre">option</span></code> を追加しました。このオプションは、<code class="docutils literal notranslate"><span class="pre">ヴァヴィヴヴェヴォ</span></code> を <code class="docutils literal notranslate"><span class="pre">バビブベボ</span></code>  へ正規化します。例えば <code class="docutils literal notranslate"><span class="pre">バイオリン</span></code> を <code class="docutils literal notranslate"><span class="pre">ヴァイオリン</span></code> で検索できます。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">unify_katakana_bu_sound</span> <span class="pre">option</span></code> を追加しました。このオプションは、<code class="docutils literal notranslate"><span class="pre">ヴァヴィヴゥヴェヴォ</span></code> を <code class="docutils literal notranslate"><span class="pre">ブ</span></code> に正規化します。例えば、<code class="docutils literal notranslate"><span class="pre">セーブル</span></code> や <code class="docutils literal notranslate"><span class="pre">セーヴル</span></code> を <code class="docutils literal notranslate"><span class="pre">セーヴェル</span></code> で検索できます。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 十分にフィルターされたケースでの <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> の動作を最適化しました。この最適化は、 <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> 実行前に十分にレコードが絞り込まれているケースで有効になります。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] 全てのワーカのコンテキストアドレスをユニークにしました。コンテキストアドレスは、以下のクエリーログの <code class="docutils literal notranslate"><span class="pre">#{ID}</span></code> です。</p>
<div class="line-block">
<div class="line">#{TIME_STAMP}|#{MESSAGE}</div>
<div class="line">#{TIME_STAMP}|#{ID}|&gt;#{QUERY}</div>
<div class="line">#{TIME_STAMP}|#{ID}|:#{ELAPSED_TIME} #{PROGRESS}</div>
<div class="line">#{TIME_STAMP}|#{ID}|&lt;#{ELAPSED_TIME} #{RETURN_CODE}</div>
</div>
</li>
<li><p>[<a class="reference internal" href="reference/commands/delete.html"><span class="doc">delete</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">limit</span></code> を追加しました。以下の例のように、削除するレコードの件数を制限できます。<code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">--table</span> <span class="pre">Users</span> <span class="pre">--filter</span> <span class="pre">'_key</span> <span class="pre">&#64;^</span> <span class="pre">&quot;b&quot;'</span> <span class="pre">--limit</span> <span class="pre">4</span></code></p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.14.0に更新しました。</p></li>
</ul>
</section>
<section id="id164">
<h3>修正<a class="headerlink" href="#id164" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] 動的カラムをフィルターした時にエラーが発生するとメモリリークする不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] 動的カラムの初期化に失敗した際にメモリリークする不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 動的カラムの評価に失敗した際にメモリリークする不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] <code class="docutils literal notranslate"><span class="pre">loose_symbol</span></code> のように緩いトークナイズをした時に <code class="docutils literal notranslate"><span class="pre">source_offset</span></code> が誤った値になる不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">U+FF21</span> <span class="pre">FULLWIDTH</span> <span class="pre">LATIN</span> <span class="pre">CAPITAL</span> <span class="pre">LETTER</span> <span class="pre">A</span></code> のような全角ラテン大文字が、<code class="docutils literal notranslate"><span class="pre">U+0061</span> <span class="pre">LATIN</span> <span class="pre">SMALL</span> <span class="pre">LETTER</span> <span class="pre">A</span></code> のようなラテン小文字に正規化されない不具合を修正しました。すでに、 <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC100</span></code> を使用している場合は、インデックスを再生成する必要があります。</p></li>
</ul>
</section>
</section>
<section id="release-8-0-2-2018-04-29">
<span id="release-8-0-2"></span><h2>8.0.2リリース - 2018-04-29<a class="headerlink" href="#release-8-0-2-2018-04-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id165">
<h3>改良<a class="headerlink" href="#id165" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>][<a class="reference internal" href="reference/executables/grndb.html#grndb-force-truncate"><span class="std std-ref">--force-truncate</span></a>]  <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">recover</span> <span class="pre">--force-truncate</span></code> オプションを指定することで、テーブルにロックが残ったままの状態でも truncate できるようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> オプションに対応しました。</p></li>
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">time_format()</span></code> を追加しました。<code class="docutils literal notranslate"><span class="pre">Time</span></code> 型のカラムの値を時刻表記で出力できます。書式は <code class="docutils literal notranslate"><span class="pre">strftime</span></code> 用の形式を指定できます。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenNgram</span></code> を追加しました。このトークナイザーは、オプションを通じて挙動を動的に変えることができます。対応しているオプションは以下の通りです。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> : Ngram の「N」を指定します。例えば trigram の場合は「3」です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loose_symbol</span></code> : 記号を含む語句について、記号の有無の違いを無視して検索できるようにトークナイズします。例えば「090-1111-2222」という語句は、「09011112222」「090」「1111」「2222」「090-1111-2222」のいずれで検索した場合にも検索結果としてヒットするようになります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loose_blank</span></code> : 空白を含む語句について、空白の有無の違いを無視して検索できるようにトークナイズします。例えば「090 1111 2222」という語句は、「09011112222」「090」「1111」「2222」「090 1111 2222」のいずれで検索した場合にも検索結果としてヒットするようになります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_blank</span></code> : 空白を含む語句について、空白無しの語句で検索できるようにトークナイズします。例えば「090 1111 2222」という語句は、「09011112222」「090」「1111」「2222」のいずれで検索した場合にも検索結果としてヒットするようになります。空白を含む語句「090 1111 2222」での検索にはヒットしない点にご注意下さい。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] Unicode 10.0 の NFKC（Normalization Form Compatibility Composition）に基づくノーマライザーである &quot;NormalizerNFKC100&quot; を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] ノーマライザーの &quot;NormalizerNFKC51&quot; と &quot;NormalizerNFKC100&quot; でのオプション指定に対応しました。ノーマライザーの挙動を動的に変えることができます。対応しているオプションは以下の通りです。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana</span></code> : 同じ音となる全角ひらがな、全角カタカナ、半角カタカナの文字を同一視します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_case</span></code> : 全角ひらがな、全角カタカナ、半角カタカナで拗音、促音などを表す小さな文字（例：「ぁ」「ゃ」「っ」）を大きな文字と同一視します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_kana_voiced_sound_mark</span></code> : 全角ひらがな、全角カタカナ、半角カタカナで濁点や半濁点の有無を同一視します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_hyphen</span></code> : ハイフンに類する文字すべてをハイフンと同一視します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_prolonged_sound_mark</span></code> : 長音記号に類する文字すべてを長音記号と同一視します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unify_hyphen_and_prolonged_sound_mark</span></code> : ハイフンに類する文字と長音記号に類する文字のすべてをハイフンと同一視します。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] トークナイザーとノーマライザーのオプションの出力に対応しました。トークナイザーまたはノーマライザーのオプションを含んだ状態でGroonga 8.0.2およびそれ以降で出力した dump は、Grooga 8.0.1以前のバージョンでは読み込めず、未対応の情報によりエラーとなります。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] トークナイザーとノーマライザーのオプションの出力に対応しました。トークナイザーまたはノーマライザーのオプションを含んだ状態でGroonga 8.0.2およびそれ以降で出力した schema は、Grooga 8.0.1以前のバージョンでは読み込めず、未対応の情報によりエラーとなります。</p></li>
<li><p>Ubuntu 18.04 (Bionic Beaver)をサポートしました。</p></li>
</ul>
</section>
<section id="id166">
<h3>修正<a class="headerlink" href="#id166" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>スペースのみの検索クエリが意図しないレコードにマッチする不具合を修正しました。[groonga-dev,04609][satouyuzhさんの報告]</p></li>
<li><p>誤ったスコアラーが使われる場合があった不具合を修正しました。この問題は以下のように複数のスコアラーが使われた時に発生していました： <code class="docutils literal notranslate"><span class="pre">--match_columns</span> <span class="pre">'title</span> <span class="pre">||</span> <span class="pre">scorer_tf_at_most(content,</span> <span class="pre">2.0)'</span></code></p></li>
<li><p>「thread_limit」の変更に時間がかかりすぎる問題を修正しました。</p></li>
</ul>
</section>
<section id="id167">
<h3>感謝<a class="headerlink" href="#id167" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>satouyuzhさん</p></li>
</ul>
</section>
</section>
<section id="release-8-0-1-2018-03-29">
<span id="release-8-0-1"></span><h2>8.0.1リリース - 2018-03-29<a class="headerlink" href="#release-8-0-1-2018-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id168">
<h3>改良<a class="headerlink" href="#id168" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/log.html"><span class="doc">ログ</span></a>] クエリーログ内で <code class="docutils literal notranslate"><span class="pre">filter</span></code> 条件を表示するようにしました。この機能はデフォルトでは、無効になっています。有効にするためには、環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_QUERY_LOG_SHOW_CONDITION=yes</span></code> を設定します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.pdb</span></code> を <code class="docutils literal notranslate"><span class="pre">*.dll</span></code> と <code class="docutils literal notranslate"><span class="pre">*.exe</span></code> と同じディレクトリにインストールされるようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージの動的カラムをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] [<a class="reference internal" href="reference/commands/logical_count.html#logical-count-post-filter"><span class="std std-ref">post_filter</span></a>] フィルタータイミングを新規追加しました。 <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージのカラムが生成された後に実行されます。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] [<a class="reference internal" href="reference/commands/logical_select.html#logical-select-post-filter"><span class="std std-ref">post_filter</span></a>] フィルタータイミングを新規追加しました。 <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージのカラムが生成された後に実行されます。</p></li>
<li><p>ベクターデータに対してLZ4/Zstd/zlibの圧縮をサポートしました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_key</span></code> のようなアクセサへのエイリアスをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 大きい結果セットに対するウィンドウ関数の動作を最適化しました。一致するレコードが十分見つかった場合は、残りのウィンドウに対してウィンドウ関数を適用しません。</p>
<p>TODO: この最適化は、最適化によるオーバーヘッドが無視出来ない場合、小さな結果セットに対しては、無効になります。 オーバーヘッドがどのくらいになるのかは、まだ評価出来ていません。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">match_escalation</span></code> パラメーターを追加しました。<code class="docutils literal notranslate"><span class="pre">--match_escalation</span> <span class="pre">yes</span></code> とすることによって、マッチ演算のエスカレーションを強制的に有効にします。このパラメータは、 <code class="docutils literal notranslate"><span class="pre">--match_escalation_threshold</span> <span class="pre">99999....999</span></code> よりも強力です。<code class="docutils literal notranslate"><span class="pre">match_escalation</span> <span class="pre">yes</span></code> は、 <code class="docutils literal notranslate"><span class="pre">SOME_CONDITIONS</span> <span class="pre">&amp;&amp;</span> <span class="pre">column</span> <span class="pre">&#64;</span> <span class="pre">'query'</span></code> もエスカレーションしますが、 <code class="docutils literal notranslate"><span class="pre">--match_escalation_threshold</span></code> ではしないためです。</p>
<p>デフォルトは、 <code class="docutils literal notranslate"><span class="pre">--match_escalation</span> <span class="pre">auto</span></code> です。これは、既存の動作と同じです。</p>
<p><code class="docutils literal notranslate"><span class="pre">--match_escalation</span> <span class="pre">no</span></code> とすることで、マッチ演算のエスカレーションを無効にできます。これは、 <code class="docutils literal notranslate"><span class="pre">--match_escalation_threshold</span> <span class="pre">-1</span></code> と同様の動きになります。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.10に更新しました。</p></li>
</ul>
</section>
<section id="id169">
<h3>修正<a class="headerlink" href="#id169" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>共通接頭辞がどのトークンにもマッチしない時にメモリリークする問題を修正しました。[GitHub#820] [村上さんがパッチ提供]</p></li>
<li><p>同一プロセスで複数のデータベースを開いている時に、異なるデータベースのキャッシュを使用してしまう問題を修正しました。</p></li>
<li><p>誤ったインデックスが構築される問題を修正しました。この問題は、インデックスカラムのソースがベクターカラムでかつ、 <code class="docutils literal notranslate"><span class="pre">WITH_SECTION</span></code> を指定していない時だけ発生します。</p></li>
<li><p>比較時(&gt;,&gt;=,&lt;,&lt;=,==,!=)に定数がオーバーフローまたは、アンダーフローし得る問題を修正しました。</p></li>
</ul>
</section>
<section id="id170">
<h3>感謝<a class="headerlink" href="#id170" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>村上さん</p></li>
</ul>
</section>
</section>
<section id="release-8-0-0-2018-02-09">
<span id="release-8-0-0"></span><h2>8.0.0リリース - 2018-02-09<a class="headerlink" href="#release-8-0-0-2018-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなくアップグレードできます。</p>
<section id="id171">
<h3>改良<a class="headerlink" href="#id171" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--drilldown_adjuster</span></code> と <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL].adjuster</span></code> を追加しました。drilldown結果に対して、スコア調整できるようになります。</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html#online-index-construction"><span class="std std-ref">動的なインデックス構築方法</span></a>] 環境変数の名前を <code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_ENABLE</span></code> から <code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD</span></code> へ変更しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD=0</span> <span class="pre">==</span> <span class="pre">GRN_II_REDUCE_EXPIRE_ENABLE=no</span></code> 。 <code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD=-1</span></code> とすると、しきい値は <code class="docutils literal notranslate"><span class="pre">ii-&gt;chunk-&gt;max_map_seg</span> <span class="pre">/</span> <span class="pre">2</span></code> となります。<code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> とすると、しきい値は <code class="docutils literal notranslate"><span class="pre">MIN(ii-&gt;chunk-&gt;max_map_seg</span> <span class="pre">/</span> <span class="pre">2,</span> <span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD)</span></code> となります。デフォルト値は、 <code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD=32</span></code> です。</p>
</li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] 境界値なしの <code class="docutils literal notranslate"><span class="pre">between()</span></code> を受け付けるようにしました。<code class="docutils literal notranslate"><span class="pre">between()</span></code> の引数の数が3つでも実行できます。2番目と3番目の引数が境界を含むものとして処理されます。</p></li>
</ul>
</section>
<section id="id172">
<h3>修正<a class="headerlink" href="#id172" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>ハッシュテーブルのメモリリークを修正しました。 [GitHub:mroonga/mroonga#190][fuku1さんの報告]</p></li>
<li><p>配列のメモリリークを修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">output_columns</span></code> で結果の変化する関数を使っている時にキャッシュしないようにしました。</p></li>
<li><p>[Windows] <code class="docutils literal notranslate"><span class="pre">WSASend</span></code> が適切なエラーコードを返すようにしました。</p></li>
</ul>
</section>
<section id="id173">
<h3>感謝<a class="headerlink" href="#id173" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>fuku1さん</p></li>
</ul>
</section>
</section>
<section id="release-7-1-1-2018-01-29">
<span id="release-7-1-1"></span><h2>7.1.1リリース - 2018-01-29<a class="headerlink" href="#release-7-1-1-2018-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id174">
<h3>改良<a class="headerlink" href="#id174" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 17.04（Zesty Zapus）のサポートをやめました。2018年1月13日でサポートが切れた（EOLになった）ためです。</p></li>
<li><p>Quorum matchをサポートしました。スクリプト構文でもクエリー構文でもquorum matchを使うことができます。</p>
<p>TODO: quorum matchの構文をドキュメントへ追加、それらのドキュメントへのリンク生成</p>
</li>
<li><p>スクリプト構文で類似度のカスタマイズをサポートしました。スクリプト構文内で類似度のカスタマイズができます。</p>
<p>TODO: 類似度のカスタマイズの構文をドキュメントへ追加、それらのドキュメントへのリンク生成</p>
</li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>][<a class="reference internal" href="reference/executables/grndb.html#grndb-force-lock-clear"><span class="std std-ref">--force-lock-clear</span></a>] <code class="docutils literal notranslate"><span class="pre">--force-lock-clear</span></code> を追加しました。このオプションは、データベースやテーブル、データカラムのロックを強制的に解除します。データベースやテーブル、データカラムにロックが残っていても再度データベースを使えるようになります。</p>
<p>しかし、このオプションはとても危険です。通常は使うべきではありません。データベースが壊れている場合は、データベースは依然として破損しています。このオプションはロックを無視するだけです。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] サロゲートペアをエスケープ可能にしました。例えば、 <code class="docutils literal notranslate"><span class="pre">\uD83C\uDF7A</span></code> は <code class="docutils literal notranslate"><span class="pre">🍺</span></code> として処理されます。</p></li>
<li><p>[Windows] Windows上でスパースファイルを使用するように変更しました。ディスク容量を節約できます。パフォーマンス上のデメリットはありません。</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html#online-index-construction"><span class="std std-ref">動的なインデックス構築方法</span></a>] インデックスカラム内のメモリーマップをいつ開放するかをコントロールする環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_II_REDUCE_EXPIRE_THRESHOLD</span></code> を追加しました。デフォルトは <code class="docutils literal notranslate"><span class="pre">-1</span></code> です。 <code class="docutils literal notranslate"><span class="pre">-1</span></code> のときはインデックスカラムのサイズによって動的に開放するタイミングを決めます。インデックスカラムが小さければ頻繁に解放し、大きければ頻度を下げます。</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> を設定すると従来と同じ挙動になります。従来の挙動とは、Groongaは開放できそうなときはいつも開放しようとするという挙動です。</p>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] [<a class="reference internal" href="reference/commands/logical_range_filter.html#logical-range-filter-post-filter"><span class="std std-ref">post_filter</span></a>]フィルタータイミングを新規追加しました。 <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージで生成されるカラムが生成された後に実行されます。</p></li>
</ul>
</section>
<section id="id175">
<h3>修正<a class="headerlink" href="#id175" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>参照ベクタのインデックスを作成する際に使用するリソースを削減しました。[GitHub#806][村上さんが報告]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/table_create.html"><span class="doc">table_create</span></a>] <code class="docutils literal notranslate"><span class="pre">token_filters</span></code> が無効であってもテーブルが作成される不具合を修正しました。</p></li>
</ul>
</section>
<section id="id176">
<h3>感謝<a class="headerlink" href="#id176" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>付超群さん</p></li>
<li><p>村上さん</p></li>
</ul>
</section>
</section>
<section id="release-7-1-0-2017-12-29">
<span id="release-7-1-0"></span><h2>7.1.0リリース - 2017-12-29<a class="headerlink" href="#release-7-1-0-2017-12-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id177">
<h3>改良<a class="headerlink" href="#id177" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">load</span></code> コマンドのクエリーログのフォーマットを改良しました。<code class="docutils literal notranslate"><span class="pre">load</span></code> コマンドのクエリーログに以下の項目が追加されます。</p>
<blockquote>
<div><ul class="simple">
<li><p>ロードしたレコード数を表示します。</p></li>
<li><p>ロードがエラーになったレコードとカラムの数を表示します。</p></li>
<li><p>ロード後の総レコード数を表示します。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> コマンドのクエリーログのフォーマットを改良しました。<code class="docutils literal notranslate"><span class="pre">logical_count</span></code> コマンドのクエリーログに以下の項目が追加されます。</p>
<blockquote>
<div><ul class="simple">
<li><p>マッチしたレコード数を表示します。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> コマンドのクエリーログのフォーマットを改良しました。 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> コマンドのクエリーログに以下の項目が追加されます。</p>
<blockquote>
<div><ul class="simple">
<li><p>マッチしたレコード数を表示します。</p></li>
<li><p>ドリルダウンした数を表示します。</p></li>
<li><p>ラベルつきのドリルダウンをした数を表示します。</p></li>
<li><p>それぞれのシャードで検索にマッチした数を表示します。</p></li>
<li><p>検索対象のシャードの情報を&quot;[...]&quot;を使って表示します。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/commands/delete.html"><span class="doc">delete</span></a>] <code class="docutils literal notranslate"><span class="pre">delete</span></code> コマンドのクエリーログのフォーマットを改良しました。 <code class="docutils literal notranslate"><span class="pre">delete</span></code> コマンドのクエリーログに以下の項目が追加されます。</p>
<blockquote>
<div><ul class="simple">
<li><p>削除したレコード数と削除に失敗したレコード数を表示します。</p></li>
<li><p>削除後に残ったレコード数を表示します。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] <code class="docutils literal notranslate"><span class="pre">groonga</span> <span class="pre">-s</span></code> で実行したサーバーをC-c で確実に停止出来るようにしました。</p></li>
<li><p>Lisp表現( <code class="docutils literal notranslate"><span class="pre">#&lt;nan&gt;</span></code> 、 <code class="docutils literal notranslate"><span class="pre">#i1/0</span></code> 、 <code class="docutils literal notranslate"><span class="pre">#-i1/0</span></code> )の代わりに <code class="docutils literal notranslate"><span class="pre">Nan</span></code> と <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> 、 <code class="docutils literal notranslate"><span class="pre">-Infinity</span></code> を使用するように改良しました。</p></li>
<li><p>ドリルダウンでベクター型のカラムをサポートしました。</p></li>
<li><p>部分的に正規表現を用いた検索から、キーワードを抽出出来るように改良しました。これにより、正規表現を用いた検索に <code class="docutils literal notranslate"><span class="pre">highlight_html</span></code> と <code class="docutils literal notranslate"><span class="pre">snippet_html</span></code> を使えるようになります。[takagi01さんに報告いただきました]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_bulk_*()</span></code> APIにおいて、 <code class="docutils literal notranslate"><span class="pre">realloc()</span></code> が呼ばれる回数を削減しました。</p>
<p>Windowsにおいて出力が大きいケースでパフォーマンスが向上します。例えば、出力が100MBを超える場合には、約100倍速くなります。</p>
<p><code class="docutils literal notranslate"><span class="pre">realloc()</span></code> はWindowsでは重い処理であるためです。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_OVERLAP_TOKEN_SKIP_ENABLE</span></code> の値にyesが設定された時のみ <code class="docutils literal notranslate"><span class="pre">GRN_II_OVERLAP_TOKEN_SKIP_ENABLE</span></code> を有効にするようにしました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_NGRAM_TOKENIZER_REMOVE_BLANK_DISABLE</span></code> は非推奨になりました。代わりに <code class="docutils literal notranslate"><span class="pre">GRN_NGRAM_TOKENIZER_REMOVE_BLANK_ENABL=no</span></code> を使って下さい。</p></li>
<li><p>関数 <code class="docutils literal notranslate"><span class="pre">index_column_source_records</span></code> を新規に追加しました。インデックスカラムのソースを取得することができます。[村上さんがパッチを提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] offsetに負の値を設定出来るようにしました。</p></li>
<li><p>固定サイズのカラムの値を取得する際のパフォーマンスを向上しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga.html"><span class="doc">groonga 実行ファイル</span></a>] groongaコマンドの引数に <code class="docutils literal notranslate"><span class="pre">--listen-backlog</span></code> オプションを追加しました。listenシステムコールのbacklogをカスタマイズできます。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.8に更新しました。</p></li>
</ul>
</section>
<section id="id178">
<h3>修正<a class="headerlink" href="#id178" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">highlight_full</span></code> 関数を使用するとメモリリークする問題を修正しました。</p></li>
<li><p>Mroongaで以下ような呼び出しを行った際にクラッシュする問題を修正しました。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_expr_append_const(&quot;_id&quot;)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_expr_append_op(GRN_OP_GET_VALUE)</span></code></p></li>
</ol>
</div></blockquote>
</li>
</ul>
</section>
<section id="id179">
<h3>感謝<a class="headerlink" href="#id179" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>takagi01</p></li>
<li><p>村上さん</p></li>
</ul>
</section>
</section>
<section id="release-7-0-9-2017-11-29">
<span id="release-7-0-9"></span><h2>7.0.9リリース - 2017-11-29<a class="headerlink" href="#release-7-0-9-2017-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id180">
<h3>改良<a class="headerlink" href="#id180" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Apache Arrowの新しいバージョンをサポートしました。このリリースでは、Apache Arrowサポートを有効にするには0.8.0以降が必要です。</p></li>
<li><p>[sharding] 動的カラムの新しいAPIを追加しました。</p>
<ul>
<li><p>Groonga::LabeledArguments</p></li>
</ul>
</li>
<li><p>[sharding] 便利メソッドである <code class="docutils literal notranslate"><span class="pre">Table#select_all</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 動的カラムをサポートしました。 <code class="docutils literal notranslate"><span class="pre">initial</span></code> と <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージのみをサポートしています。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] <code class="docutils literal notranslate"><span class="pre">cache</span></code> 引数と動的カラムに関するドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] 動的カラムをサポートしました。<code class="docutils literal notranslate"><span class="pre">initial</span></code> ステージのみサポートしています。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] 名前付き引数のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--match_columns</span> <span class="pre">_key</span></code> をインデックスを使わない場合でもサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] 126を超える引数を指定できるようにしました。 [GitHub#760] [GitHub#781] [groonga-dev,04449] [むらたさんが報告]</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.7に更新しました。</p></li>
</ul>
</section>
<section id="id181">
<h3>修正<a class="headerlink" href="#id181" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] 古いバージョンのGroongaがすでにインストールされている場合にそちらを参照してしまい、ビルドエラーになる問題を修正しました。　[GitHub#775] [myamanishi3さんが報告]</p></li>
<li><p>[<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] <code class="docutils literal notranslate"><span class="pre">in_values</span></code> に多すぎる引数を指定するとクラッシュする不具合を修正しました。この不具合は126を超える引数をサポートする過程で見つかりました。 [GitHub#780]</p></li>
<li><p>[cmake] LZ4 と MessagePack をビルド時に正しく検出できるようにしました。 [Sergei Golubchikさんが報告]</p></li>
<li><p>[<a class="reference internal" href="reference/indexing.html#offline-index-construction"><span class="std std-ref">静的なインデックス構築方法</span></a>] ベクターカラムの静的索引構築時に必要以上のリソースを使用する問題を修正しました。1つのベクターカラムの要素数が多く、大量のレコードがある場合はGroongaがクラッシュしていました。 [groonga-dev,04533][内山敏郎さんが報告]</p></li>
</ul>
</section>
<section id="id182">
<h3>感謝<a class="headerlink" href="#id182" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>むらたさん</p></li>
<li><p>myamanishi3さん</p></li>
<li><p>Sergei Golubchikさん</p></li>
<li><p>内山敏郎さん</p></li>
</ul>
</section>
</section>
<section id="release-7-0-8-2017-10-29">
<span id="release-7-0-8"></span><h2>7.0.8リリース - 2017-10-29<a class="headerlink" href="#release-7-0-8-2017-10-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id183">
<h3>改良<a class="headerlink" href="#id183" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[windows] クラッシュした際にバックトレースを出せるようにしました。関数呼び出しだけでなく、ソースコードの該当行も可能な限り表示します。バックトレースのサポートにより、問題の素早い解決につながります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QUERY_NO_SYNTAX_ERROR</span></code> を指定してあれば &quot;( )&quot; を <code class="docutils literal notranslate"><span class="pre">--query</span></code> に指定して実行できるようにしました。 以前のバージョンでは、エラーになっていました。 [GitHub#767]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QUERY_NO_SYNTAX_ERROR</span></code> を指定してあれば &quot;(+)&quot; を <code class="docutils literal notranslate"><span class="pre">--query</span></code> に指定して実行できるようにしました。 以前のバージョンでは、エラーになっていました。 [GitHub#767]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QUERY_NO_SYNTAX_ERROR</span></code> を指定してあれば <code class="docutils literal notranslate"><span class="pre">--query</span> <span class="pre">&quot;~y&quot;</span></code> (~ではじまる)クエリーを実行できるようにしました。 以前のバージョンでは、エラーになっていました。 [GitHub#767]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expired</span></code> のログレベルを <code class="docutils literal notranslate"><span class="pre">info</span></code> から <code class="docutils literal notranslate"><span class="pre">debug</span></code> に変更しました。 <code class="docutils literal notranslate"><span class="pre">2017-10-29</span> <span class="pre">14:05:34.123456|i|</span> <span class="pre">&lt;0000000012345678:0&gt;</span> <span class="pre">expired</span> <span class="pre">i=000000000B123456</span> <span class="pre">max=10</span> <span class="pre">(2/2)</span></code> このメッセージはインデックスをメモリーにマップした後で開放されたときに記録されます。つまり、メモリーの使用状況に関するデバッグには有用ですが、通常の運用においては有用ではありません。そのためログレベルを <code class="docutils literal notranslate"><span class="pre">debug</span></code> に変更しました。</p></li>
<li><p>Ubuntu 17.10 Artful Aardvarkをサポート。</p></li>
</ul>
</section>
<section id="id184">
<h3>修正<a class="headerlink" href="#id184" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[dat] データベースを拡張する際、意図せず大きなファイルが(ワーストケースで)作成されてしまうことのある不具合を修正しました。この不具合はインデックスカラムを頻繁に作成/削除を繰り返したときに発生する可能性があります。7.0.7ではこの不具合に関連して&quot;大量にキーを削除したケースで <code class="docutils literal notranslate"><span class="pre">table_create</span></code> に失敗する&quot;問題を修正しましたが、その修正が不十分なケースに対応しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">offset</span></code> と <code class="docutils literal notranslate"><span class="pre">limit</span></code> が複数のシャードに対して適用されたとき、実際よりも少ないレコードが返される不具合を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-7-0-7-2017-09-29">
<span id="release-7-0-7"></span><h2>7.0.7リリース - 2017-09-29<a class="headerlink" href="#release-7-0-7-2017-09-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id185">
<h3>改良<a class="headerlink" href="#id185" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QUERY_NO_SYNTAX_ERROR</span></code> を <code class="docutils literal notranslate"><span class="pre">+</span></code> のみのクエリーに指定したときにも動作するようにしました。以前のバージョンではそのようなクエリーはエラーになっていました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.5に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] 引数のデフォルト値を構文のセクションに追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/command/command_version.html"><span class="doc">コマンドバージョン</span></a>] <code class="docutils literal notranslate"><span class="pre">--default-command-version</span> <span class="pre">3</span></code> に対応しました。</p></li>
<li><p>関数呼び出し時に検索結果をキャッシュできるようにしました。ほとんどの関数の呼び出し結果はキャッシュされます。例外は <code class="docutils literal notranslate"><span class="pre">now()</span></code> と <code class="docutils literal notranslate"><span class="pre">rand()</span></code> を使った場合です。標準でキャッシュするように振る舞いを変更したので、新たにAPIを追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_set_is_stable()</span></code> を追加。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_is_stable()</span></code> を追加。</p></li>
</ul>
<p>呼び出しごとに結果が異なる関数を新規に追加する場合、<code class="docutils literal notranslate"><span class="pre">grn_proc_is_stable(ctx,</span> <span class="pre">proc,</span> <span class="pre">GRN_FALSE)</span></code> を呼ばなければなりません。もし呼ばなかった場合には、検索結果がキャッシュされるので、期待と異なり誤った結果を返します。</p>
</li>
</ul>
</section>
<section id="id186">
<h3>修正<a class="headerlink" href="#id186" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[windows] <code class="docutils literal notranslate"><span class="pre">database_unmap</span></code> が実行される前のファイルハンドルのエラー処理を適切に行うようにしました。<code class="docutils literal notranslate"><span class="pre">database_unmap</span></code> 実行前にリクエストがキャンセルされた場合、排他制御部分が未初期化となる場合がありました。その場合、クラッシュしていました。</p></li>
<li><p>[<a class="reference internal" href="reference/tokenizers.html"><span class="doc">トークナイザー</span></a>] トークナイザー名のドキュメントを修正しました。<code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlpha</span></code> や <code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlphaDigit</span></code> であるべきでした。</p></li>
<li><p>エラー時に空のファイルが残らないようにしました。</p>
<p>以前のバージョンでは、空のファイルがエラー時に残っていました。</p>
<p>再現するためのシナリオは以下です。:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_fileinfo_open</span></code> によりファイルの作成に成功する</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DO_MAP</span></code> によりファイルマッピングに失敗する</p></li>
</ol>
</div></blockquote>
<p>そのような場合、Groongaの管理下にないファイルのせいで「すでにファイルが存在します。」という別のエラーが発生します。そういったファイルは後始末の段階で削除すべきでした。</p>
</li>
<li><p>短時間に多数の更新を行っている状況で検索した場合にクラッシュすることがある不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/table_create.html"><span class="doc">table_create</span></a>] 大量に削除されたキーがDATテーブルに存在する場合、<code class="docutils literal notranslate"><span class="pre">table_create</span></code> の実行に失敗する不具合を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-7-0-6-2017-08-29">
<span id="release-7-0-6"></span><h2>7.0.6リリース - 2017-08-29<a class="headerlink" href="#release-7-0-6-2017-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id187">
<h3>改良<a class="headerlink" href="#id187" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>前方一致検索を複数インデックスを指定してできるようになりました。 (例 <code class="docutils literal notranslate"><span class="pre">--query</span> <span class="pre">&quot;Foo*&quot;</span> <span class="pre">--match_columns</span> <span class="pre">&quot;TITLE_INDEX_COLUMN||BODY_INDEX_COLUMN&quot;</span></code>)</p></li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_count.html"><span class="doc">window_count</span></a>] <code class="docutils literal notranslate"><span class="pre">window_count</span></code> 関数を追加しました。検索した結果にカウントした値を追加するのに使います。検索結果をもとに分析したり、カウント結果をもとにフィルタしたりすると便利です。</p></li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_get_disk_usage()</span></code> を追加。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_EXPR_QUERY_NO_SYNTAX_ERROR</span></code> を追加。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_expr_syntax_expand_query_by_table()</span></code> を追加。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_table_find_reference_object()</span></code> を追加。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/object_inspect.html"><span class="doc">object_inspect</span></a>] 指定したオブジェクトのディスク使用量を表示できるようになりました。</p></li>
<li><p>クエリーをパースする際にフォールバックする機能をサポートしました。 <code class="docutils literal notranslate"><span class="pre">QUERY_NO_SYNTAX_ERROR</span></code> フラグが <code class="docutils literal notranslate"><span class="pre">query_flags</span></code> に指定されていると有効になります。(標準では無効です) このフラグが設定されていると、シンタックスエラーが発生しなくなります。例えば、&quot;A +&quot; というクエリーは自動的にエスケープされて &quot;A +&quot; という扱いになります。この振る舞いはアプリケーションがユーザーの入力をそのまま検索語句として使い、シンタックスエラーやログに記録されないようにしたい場合に便利です。</p></li>
<li><p>クエリー内の語のスコアを調整できるようになりました。&quot;&gt;&quot;, &quot;&lt;&quot; と &quot;~&quot;がサポートされています。例えば &quot;&gt;Groonga&quot; は &quot;Groonga&quot; のスコアをインクリメントします。&quot;&lt;Groonga&quot; は &quot;Groonga&quot; のスコアをデクリメントします。&quot;~Groonga&quot; は検索結果についてマッチしたドキュメントのスコアをデクリメントします。&quot;~&quot; は検索結果そのものには影響しません。</p></li>
<li><p>テーブルを削除するときのパフォーマンスを改善しました。 <code class="docutils literal notranslate"><span class="pre">thread_limit=1</span></code> する必要はありません。参照されているテーブルが存在するかチェックする処理をオブジェクトを開かなくてもできるようにしました。その結果としてパフォーマンスが改善しました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.4に更新しました。</p></li>
</ul>
</section>
<section id="id188">
<h3>修正<a class="headerlink" href="#id188" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] 7番目の引数 ( <code class="docutils literal notranslate"><span class="pre">--sort_hash_table</span></code> )が名前無しだと無視される不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/schema.html"><span class="doc">schema</span></a>] コマンドラインパラメータの誤りを修正しました。<cite>source</cite> であるべきところが <cite>sources</cite> になっていました。[groonga-dev,04449] [むらたさんが報告]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/ruby_eval.html"><span class="doc">ruby_eval</span></a>] ruby_evalコマンドがシンタックスエラーのときにクラッシュする問題を修正しました。 [GitHub#751] [ryo-pinusさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id189">
<h3>感謝<a class="headerlink" href="#id189" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>murata satoshi</p></li>
<li><p>ryo-pinus</p></li>
</ul>
</section>
</section>
<section id="release-7-0-5-2017-07-29">
<span id="release-7-0-5"></span><h2>7.0.5リリース - 2017-07-29<a class="headerlink" href="#release-7-0-5-2017-07-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id190">
<h3>改良<a class="headerlink" href="#id190" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.3に更新しました。セキュリティーに関する修正(CVE-2017-7529)を含んでいます。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] UInt64の最大値をロードできるようにしました。以前のバージョンでは意図せず0に変換されてしまっていました。</p></li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_window_get_size()</span></code> [GitHub#725] [村上さんがパッチ提供]</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/functions/math_abs.html"><span class="doc">math_abs</span></a>] 絶対値を計算するための <code class="docutils literal notranslate"><span class="pre">math_abs()</span></code> 関数を追加しました。 [GitHub#721]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_default_logger_set_path()</span></code> と <code class="docutils literal notranslate"><span class="pre">grn_default_query_logger_set_path()</span></code> をスレッドセーフにしました。</p></li>
<li><p>[Windows] バンドルしているpcreを8.41に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/normalize.html"><span class="doc">normalize</span></a>] エラー時に冗長な空文字列が出力されないようにしました。</p></li>
<li><p>[functions/time] 0除算が発生したときにエラーメッセージを出力するようにしました。 [GitHub#733] [村上さんがパッチ提供]</p></li>
<li><p>[windows] <code class="docutils literal notranslate"><span class="pre">ERROR_NO_SYSTEM_RESOURCES</span></code> エラーを <code class="docutils literal notranslate"><span class="pre">GRN_RESOURCE_TEMPORARILY_UNAVAILABLE</span></code> にマッピングするようにしました。以前は <code class="docutils literal notranslate"><span class="pre">rc=-1</span></code> をエラーコードとして返していました。ただし実際にどんな問題がおきたのかこれではわかりにくいので、 今回の修正では <code class="docutils literal notranslate"><span class="pre">rc=-12</span></code> を返すようにしています。</p></li>
<li><p>[functions/min][functions/max] ベクターカラムをサポートしました。これでカラムがスカラーなのかベクターなのか気にせず使えるようになりました。 [GitHub#735] [村上さんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] <code class="docutils literal notranslate"><span class="pre">--sort_hash_table</span></code> オプションをサポートしました。ハッシュテーブルの <code class="docutils literal notranslate"><span class="pre">_key</span></code> でのソートには <code class="docutils literal notranslate"><span class="pre">--sort_hash_table</span> <span class="pre">yes</span></code> を指定します。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/between.html"><span class="doc">between</span></a>] インデックスカラムを指定できるようになりました。 [GitHub#740] [村上さんがパッチ提供]</p></li>
<li><p>[load] Apache Arrow 0.5.0 以降をサポート。</p></li>
<li><p>[<a class="reference internal" href="troubleshooting/how_to_analyze_error_message.html"><span class="doc">エラーメッセージの解析方法</span></a>] エラーメッセージの解析方法のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] ソースからビルドするときに必要なパッケージのリストを更新しました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 16.10（Yakkety Yak）のサポートをやめました。2017年7月20日でサポートが切れた（EOLになった）ためです。</p></li>
</ul>
</section>
<section id="id191">
<h3>修正<a class="headerlink" href="#id191" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>テキスト型( <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> など)のベクターカラムに対するインデックスを正しく構築できるようにしました。この修正でインデックス更新後に全文検索でマッチしない問題が解決します。 [GitHub#494]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/thread_limit.html"><span class="doc">thread_limit</span></a>] <code class="docutils literal notranslate"><span class="pre">thread_limit?max=1</span></code> というリクエストが同時にきたときにデッドロックが発生する問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] デフォルトのPIDのパスと再起動時に想定しているPIDのパスがあっていない問題を修正しました。そのせいで groonga-httpd の再起動に失敗していました。 [GitHub#743] [sozakiさんが報告]</p></li>
</ul>
</section>
<section id="id192">
<h3>感謝<a class="headerlink" href="#id192" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>村上さん</p></li>
</ul>
</section>
</section>
<section id="release-7-0-4-2017-06-29">
<span id="release-7-0-4"></span><h2>7.0.4リリース - 2017-06-29<a class="headerlink" href="#release-7-0-4-2017-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id193">
<h3>改良<a class="headerlink" href="#id193" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>物理的なファイルの作成/削除のログを障害の切り分けのために記録するようにしました。 [GitHub#700,#701]</p></li>
<li><p>[<a class="reference internal" href="reference/functions/in_records.html"><span class="doc">in_records</span></a>] 固定長カラムの検索パフォーマンスを改善しました。速度が50%程度改善する可能性があります。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">--log-path</span></code> オプションを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">--log-level</span></code> オプションを追加しました。</p></li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_operator_to_exec_func()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_corrupt()</span></code></p></li>
</ul>
</li>
<li><p>&quot;固定長カラム 演算子 定数&quot; というようなクエリのパフォーマンスを改善しました。対応している演算子は <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> と <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> です。</p></li>
<li><p>&quot;カラム 演算子 値 &amp;&amp; カラム 演算子 値 &amp;&amp; ...&quot; というようなクエリのパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> で壊れたオブジェクトの検出をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/io_flush.html"><span class="doc">io_flush</span></a>] <code class="docutils literal notranslate"><span class="pre">--only_opened</span></code> オプションをサポートしました。開いているデータベースオブジェクトのみをフラッシュすることができます。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/grndb.html"><span class="doc">grndb</span></a>] 参照先のない &quot;inspect&quot; オブジェクトの検出と削除をサポートしました。この状態はコマンド名が <code class="docutils literal notranslate"><span class="pre">inspect</span></code> から <code class="docutils literal notranslate"><span class="pre">object_inspect</span></code> に変更されたことによって発生していました。</p></li>
</ul>
</section>
<section id="id194">
<h3>修正<a class="headerlink" href="#id194" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[rpm][centos] カスタマイズ版のビルドで意図しないマクロ展開が発生する問題を修正しました。この不具合はGroongaをSRPMからビルドする際にspecファイルの <code class="docutils literal notranslate"><span class="pre">additional_configure_options</span></code> パラメータを使ってリビルドするときのみ発生していました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_table_setoperation()</span></code> のNULLチェックを追加しました。インデックスが壊れている際に、クラッシュする可能性がありました。 [GitHub#699]</p></li>
</ul>
</section>
<section id="id195">
<h3>感謝<a class="headerlink" href="#id195" title="この見出しへのパーマリンク">#</a></h3>
</section>
</section>
<section id="release-7-0-3-2017-05-29">
<span id="release-7-0-3"></span><h2>7.0.3リリース - 2017-05-29<a class="headerlink" href="#release-7-0-3-2017-05-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id196">
<h3>改良<a class="headerlink" href="#id196" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="tutorial/match_columns.html#full-text-search-with-specific-index-name"><span class="std std-ref">インデックス名を指定した全文検索</span></a> のドキュメントを追加しました。</p></li>
<li><p>[インデックス] どのレコードに対するポスティングリストが長すぎるのかわかるように、警告メッセージをログに出すようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>][<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>] Apache Arrowをサポートするようにしました。 [GitHub#691]</p></li>
<li><p>[cmake] 静的ライブラリとしてビルドする際に、LZ4をリンクできるようにしました。 [Sergei Golubchikさんがパッチを提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/delete.html"><span class="doc">delete</span></a>] キャンセルできるようにしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.13.0に更新しました。</p></li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_caller()</span></code> を追加。</p></li>
</ul>
</li>
<li><p>インデックスカラムに関連した関数とセレクタを追加しました。</p>
<ul>
<li><p>追加されたセレクタ: <code class="docutils literal notranslate"><span class="pre">index_column_df_ratio_between()</span></code></p></li>
<li><p>追加された関数: <code class="docutils literal notranslate"><span class="pre">index_column_df_ratio()</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="id197">
<h3>修正<a class="headerlink" href="#id197" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/delete.html"><span class="doc">delete</span></a>] エラーが適切にクリアされていない不具合を修正しました。そのせいで、後続の削除処理に影響し意図しない振る舞いをしていました。</p></li>
<li><p>[windows] ファイルを <code class="docutils literal notranslate"><span class="pre">O_CREAT</span></code> フラグ付きで開くときに、IOのバージョンが正しく検出されない不具合を修正しました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/vector_slice.html"><span class="doc">vector_slice</span></a>] (型のサイズが)4バイトでないベクターカラムをsliceできない不具合を修正しました。 [GitHub#695] [村上さんがパッチ提供]</p></li>
<li><p>(型のサイズが)4バイトでないベクターカラムでベクターの要素をインデックスで指定するとシーケンシャルサーチでマッチしない不具合を修正しました。 [GitHub#696] [村上さんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">min</span></code> に月の最終日を指定すると &quot;argument out of range&quot; が発生する不具合を修正しました。</p></li>
</ul>
</section>
<section id="id198">
<h3>感謝<a class="headerlink" href="#id198" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>Sergei Golubchikさん</p></li>
<li><p>村上さん</p></li>
</ul>
</section>
</section>
<section id="release-7-0-2-2017-04-29">
<span id="release-7-0-2"></span><h2>7.0.2リリース - 2017-04-29<a class="headerlink" href="#release-7-0-2-2017-04-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id199">
<h3>改良<a class="headerlink" href="#id199" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <a class="reference internal" href="reference/commands/logical_select.html#logical-select-drilldowns-label-columns-name-window-sort-keys"><span class="std std-ref">drilldowns[${LABEL}].columns[${NAME}].window.sort_keys</span></a> と <a class="reference internal" href="reference/commands/logical_select.html#logical-select-drilldowns-label-columns-name-window-group-keys"><span class="std std-ref">drilldowns[${LABEL}].columns[${NAME}].window.group_keys</span></a> で複数のキーを指定できるようになりました。</p></li>
<li><p>[Windows] バンドルしているLZ4を1.7.5に更新しました。</p></li>
<li><p>[cache] 永続化キャッシュをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/log_level.html"><span class="doc">log_level</span></a>] 英語のドキュメントを更新しました。</p></li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_set_default_cache_base_path()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_default_cache_base_path()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_persistent_cache_open()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_cache_default_open()</span></code></p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/executables/groonga.html#cmdoption-groonga-cache-base-path"><code class="xref std std-option docutils literal notranslate"><span class="pre">groonga</span> <span class="pre">--cache-base-path</span></code></a>] 永続キャッシュを使うための新しいオプションを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] [<a class="reference internal" href="reference/executables/groonga-httpd.html#groonga-httpd-groonga-cache-base-path"><span class="std std-ref">groonga_cache_base_path</span></a>] 永続キャッシュを使うための新しい設定を追加しました。</p></li>
<li><p>[Windows] バンドルしているmsgpackを2.1.1に更新しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/object_inspect.html"><span class="doc">object_inspect</span></a>] カラム情報を表示するだけでなく、インデックスカラムの統計情報も表示できるようにしました。</p></li>
<li><p>正規表現の「 <code class="docutils literal notranslate"><span class="pre">.*</span></code> 」というパターンでインデックスを使って検索できるようになりました。 この機能はデフォルトで有効です。環境変数に <code class="docutils literal notranslate"><span class="pre">GRN_SCAN_INFO_REGEXP_DOT_ASTERISK_ENABLE=no</span></code> を設定すると無効化できます。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/in_records.html"><span class="doc">in_records</span></a>] 既存のテーブルを条件のパターンを指定するのに使うことのできる関数を追加しました。</p></li>
<li><p>[<a class="reference internal" href="install/ubuntu.html"><span class="doc">Ubuntu</span></a>] EOLのため、Ubuntu 12.04のサポートをやめました。</p></li>
</ul>
</section>
<section id="id200">
<h3>修正<a class="headerlink" href="#id200" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] 異なるキャッシュが使われてしまう不具合を修正しました。この問題は動的カラムを使っているときに発生していました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] 動的カラムが作成されない不具合を修正しました。レコードにマッチしない場合に発生していました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/reindex.html"><span class="doc">reindex</span></a>] reindexコマンドの実行によりデータが失われてしまう不具合を修正しました。</p></li>
<li><p>[httpd] 別のユーザーでワーカーを動かしている時、 <a class="reference internal" href="reference/commands/quit.html"><span class="doc">quit</span></a> と <a class="reference internal" href="reference/commands/shutdown.html"><span class="doc">shutdown</span></a> のレスポンスが壊れている問題を修正しました。 [GitHub ranguba/groonga-client#12]</p></li>
</ul>
</section>
</section>
<section id="release-7-0-1-2017-03-29">
<span id="release-7-0-1"></span><h2>7.0.1リリース - 2017-03-29<a class="headerlink" href="#release-7-0-1-2017-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id201">
<h3>改良<a class="headerlink" href="#id201" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p>grn_ii_cursor_next_pos()</p></li>
<li><p>grn_table_apply_expr()</p></li>
<li><p>grn_obj_is_data_column()</p></li>
<li><p>grn_obj_is_expr()</p></li>
<li><p>grn_obj_is_scalar_column()</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="reference/commands/column_copy.html"><span class="doc">column_copy</span></a>] 参照型のベクタのダンプをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">array&lt;object&gt;</span></code> スタイルの重み付きベクターカラムのloadをサポートしました。 <code class="docutils literal notranslate"><span class="pre">array&lt;object&gt;</span></code> の例: <code class="docutils literal notranslate"><span class="pre">[{&quot;key1&quot;:</span> <span class="pre">weight1},</span> <span class="pre">{&quot;key2&quot;:</span> <span class="pre">weight2}]</span></code></p></li>
<li><p>インデックスを使った <code class="docutils literal notranslate"><span class="pre">!(XXX</span> <span class="pre">OPERATOR</span> <span class="pre">VALUE)</span></code> の検索をサポートしました。演算子として <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> だけでなく、 <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、 <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、 <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、 <code class="docutils literal notranslate"><span class="pre">==</span></code> や <code class="docutils literal notranslate"><span class="pre">!=</span></code> も使えます。</p></li>
<li><p>インデックスを使って <code class="docutils literal notranslate"><span class="pre">!(column</span> <span class="pre">==</span> <span class="pre">CONSTANT)</span></code> を検索できるようになりました。例えば <code class="docutils literal notranslate"><span class="pre">!(column</span> <span class="pre">==</span> <span class="pre">29)</span></code> などです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!</span></code> の最適化を以下のパターンでサポートしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">!(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;X&quot;)</span> <span class="pre">&amp;&amp;</span> <span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;Y&quot;)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;Y&quot;)</span> <span class="pre">&amp;&amp;</span> <span class="pre">!(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;X&quot;)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;Y&quot;)</span> <span class="pre">&amp;!</span> <span class="pre">!(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;X&quot;)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">XXX</span> <span class="pre">||</span> <span class="pre">!(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;xxx&quot;)</span></code> をインデックスを使って検索できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/dump.html"><span class="doc">dump</span></a>]  <code class="docutils literal notranslate"><span class="pre">'{&quot;x&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;y&quot;:</span> <span class="pre">2}'</span></code> というスタイルを参照されていない重み付きベクターカラムで使うようにしました。この変更は古いGroongaには影響しません。もともとサポートされているからです。</p></li>
<li><p>[実験的] <code class="docutils literal notranslate"><span class="pre">GRN_ORDER_BY_ESTIMATED_SIZE_ENABLE</span></code> 環境変数をサポートしました。この変数はクエリの最適化を予想されるヒット件数に応じて行うかどうかを切り替えるのに使用します。この機能はデフォルトでは無効です。有効にするには <code class="docutils literal notranslate"><span class="pre">GRN_ORDER_BY_ESTIMATED_SIZE_ENABLE=yes</span></code> を指定します。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">columns</span></code> や <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> の評価結果をクエリログに追加するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> のクエリログのフォーマットを変更しました。これは非互換な変更ですが、クエリログを変換するようなプログラムを独自に開発しているユーザー以外には影響ありません。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/table_remove.html"><span class="doc">table_remove</span></a>] 一時的なメモリ使用量を削減しました。スレッドの最大数が0のときに有効になります。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">columns[LABEL](N)</span></code> がクエリログのフォーマットとして使われます。以前は <code class="docutils literal notranslate"><span class="pre">columns(N)[LABEL]</span></code> でした。</p></li>
<li><p>[<a class="reference internal" href="tutorial/query_expansion.html"><span class="doc">クエリ拡張</span></a>] ベクターカラムを使った推奨例に更新しました。[ぐるなびさんが報告]</p></li>
<li><p>ロック中にリクエストがキャンセルされたことを検出できるようにしました。これは <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> がロック中に意図せず無視されないようにします。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>]  <code class="docutils literal notranslate"><span class="pre">initial</span></code> および <code class="docutils literal notranslate"><span class="pre">filtered</span></code> 動的カラムをサポートしました。使用例は <code class="docutils literal notranslate"><span class="pre">--columns[LABEL].stage</span> <span class="pre">initial</span></code> や <code class="docutils literal notranslate"><span class="pre">--columns[LABEL].stage</span> <span class="pre">filtered</span></code> です。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> や <code class="docutils literal notranslate"><span class="pre">query</span></code> 、 <code class="docutils literal notranslate"><span class="pre">drilldown_filter</span></code> オプションをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] 類似文書検索をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>]  <code class="docutils literal notranslate"><span class="pre">initial</span></code> および <code class="docutils literal notranslate"><span class="pre">filtered</span></code> 動的カラムをサポートしました。使用例は <code class="docutils literal notranslate"><span class="pre">--columns[LABEL].stage</span> <span class="pre">initial</span></code> や <code class="docutils literal notranslate"><span class="pre">--columns[LABEL].stage</span> <span class="pre">filtered</span></code> です。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] 動的カラムでウィンドウ関数をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 動的カラムに関するドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/window_function.html"><span class="doc">ウィンドウ関数</span></a>] ウィンドウ関数のセクションをドキュメントに追加しました。</p></li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] EOLのため、CentOS 5のサポートをやめました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.11.12に更新しました。</p></li>
<li><p>ANDでのマッチ最適化を環境変数で無効化できるようにしました。この機能は <code class="docutils literal notranslate"><span class="pre">GRN_TABLE_SELECT_AND_MIN_SKIP_ENABLE=no</span></code> を設定することで無効化できます。デフォルトでは有効になっています。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/vector_new.html"><span class="doc">vector_new</span></a>] 新規ベクターを作成するための関数を追加しました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">drilldown_filter</span></code> のドキュメントを追加しました。</p></li>
</ul>
</section>
<section id="id202">
<h3>修正<a class="headerlink" href="#id202" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/commands/lock_clear.html"><span class="doc">lock_clear</span></a>] テンポラリデータベースに対して実行するとクラッシュする不具合を修正しました。</p></li>
<li><p>自然言語に対する動的インデックス更新でインデックスサイズが肥大化する問題を修正しました。Groonga 6.1.4から発生していました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] &quot;A &amp;&amp; B.C &#64; X&quot; というクエリでマッチすべきレコードを返さないことがある不具合を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_io_flush()</span></code> と <code class="docutils literal notranslate"><span class="pre">grn_io_expire()</span></code> がコンフリクトする問題を修正しました。この修正がないと、 <code class="docutils literal notranslate"><span class="pre">io_flush</span></code> と <code class="docutils literal notranslate"><span class="pre">load</span></code> が同時に特定のタイミングで実行されるとクラッシュする不具合がありました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/logical_table_remove.html"><span class="doc">logical_table_remove</span></a>] 最大スレッド数が1のときにクラッシュする不具合を修正しました。</p></li>
</ul>
</section>
<section id="id203">
<h3>感謝<a class="headerlink" href="#id203" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>株式会社ぐるなびさん</p></li>
</ul>
</section>
</section>
<section id="release-7-0-0-2017-02-09">
<span id="release-7-0-0"></span><h2>7.0.0リリース - 2017-02-09<a class="headerlink" href="#release-7-0-0-2017-02-09" title="この見出しへのパーマリンク">#</a></h2>
<section id="id204">
<h3>改良<a class="headerlink" href="#id204" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="reference/functions/in_values.html"><span class="doc">in_values</span></a>] 参照型ベクターカラムのシーケンシャルサーチに対応しました。 [GitHub#629] [村上さんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] 誤った <code class="docutils literal notranslate"><span class="pre">drilldown[LABEL].sort_keys</span></code> が指定されたとき、無視するのではなく、エラーを報告するようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/select.html"><span class="doc">select</span></a>] DBのメタデータを不必要に更新しないようにしました。 <code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドを使っているだけなのにDBにロックがかかったままになってしまうのを防ぎます。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/lock_clear.html"><span class="doc">lock_clear</span></a>] <code class="docutils literal notranslate"><span class="pre">lock_clear</span></code> でDBのメタデータに対するロックも削除できるようにしました。</p></li>
<li><p>[<a class="reference internal" href="install/centos.html"><span class="doc">CentOS</span></a>] GroongaをAmazon LinuxでもインストールできるようにEPELをデフォルトで有効にするようにしました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] <code class="docutils literal notranslate"><span class="pre">default_mode</span></code> オプションで &quot;&#64;X&quot; スタイルのエイリアスが使えるようになりました。</p></li>
<li><p>[<a class="reference internal" href="reference/functions/query.html"><span class="doc">query</span></a>] 動作モードのリストに関するドキュメントを更新しました。動作モードの既定値は <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> (&quot;&#64;&quot;) で全文検索を実行します。</p></li>
<li><p>[rpm][centos] CentOS 7で groonga-token-filter-stem パッケージを提供するようにしました。 ステミングに対応するための <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> トークンフィルターを提供します。　[GitHub#633] [Tim Bellefleurさんが報告]</p></li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a>] <code class="docutils literal notranslate"><span class="pre">record_number</span></code> が非推奨になりました。代わりに <code class="docutils literal notranslate"><span class="pre">window_record_number</span></code> を使ってください。 <code class="docutils literal notranslate"><span class="pre">record_number</span></code> は互換性のためだけに残っています。</p></li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_sum.html"><span class="doc">window_sum</span></a>] <code class="docutils literal notranslate"><span class="pre">window_sum</span></code> ウィンドウ関数を追加しました。PostgreSQLのsum()と同様のウィンドウ関数を提供します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_DAT_KEY</span></code> テーブルをインメモリで使ったときに静的インデックス構築をできるようにしました。 [GitHub#623] [村上さんが報告]</p></li>
<li><p>バンドルしている鬼雲を6.1.1へと更新しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns[LABEL].window.group_keys</span></code> をサポートしました。ウィンドウ関数をグループごとに提供することができます。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] 誤ったキーが指定されていたときにエラーを報告するようにしました。キーの型が異なっている場合でも気付けるようになります。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">--output_errors</span> <span class="pre">yes</span></code> オプションをサポートしました。&quot;yes&quot;を指定すると、どのレコードのloadに失敗したのかエラーを取得できるようになります。この機能を使う場合には、コマンドバージョン3を指定します。</p></li>
<li><p>[<a class="reference internal" href="reference/commands/load.html"><span class="doc">load</span></a>] キーのキャストに失敗したときのエラーメッセージをわかりやすくしました。以前は単に &quot;cast failed&quot; と表示していましたが、テーブルのキーの型とキャスト対象となるキーの型もメッセージに含まれるようになりました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.11.9に更新しました。</p></li>
</ul>
</section>
<section id="id205">
<h3>修正<a class="headerlink" href="#id205" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>存在しないソートキーを <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL]</span></code> や <code class="docutils literal notranslate"><span class="pre">slices[LABEL]</span></code> に指定するとJSONパースエラーとなる不具合を修正しました。 [GitHub#627] [村上さんがパッチ提供]</p></li>
<li><p>存在しないグループのサブレコードにアクセスしようとするとクラッシュする不具合を修正しました。例えば、 <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL].sort_keys</span> <span class="pre">_sum</span></code> を <code class="docutils literal notranslate"><span class="pre">calc_types</span></code> の指定なしに使っていた場合に問題が発生していました。 [GitHub#625] [村上さんがパッチ提供]</p></li>
<li><p>tokenizerでエラーが発生するとクラッシュする不具合を修正しました。tokenizer と token filterを登録していて、tokenizer にエラーがあると発生していました。</p></li>
<li><p>[<a class="reference internal" href="reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a>] ウィンドウ関数の引数が正しく渡されていない不具合を修正しました。 [GitHub#634] [村上さんがパッチ提供]</p></li>
</ul>
</section>
<section id="id206">
<h3>感謝<a class="headerlink" href="#id206" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>村上さん</p></li>
<li><p>aomi-nさん</p></li>
</ul>
</section>
</section>
<section id="the-old-releases">
<h2>古いリリース<a class="headerlink" href="#the-old-releases" title="この見出しへのパーマリンク">#</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="news/6.x.html">News - 6.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-5-2017-01-23">6.1.5リリース - 2017-01-23</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-4-2017-01-18">6.1.4リリース - 2017-01-18</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-3-2017-01-06">6.1.3リリース - 2017-01-06</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-2-2016-12-31">6.1.2リリース - 2016-12-31</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-1-2016-11-29">6.1.1リリース - 2016-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-1-0-2016-10-29">6.1.0リリース - 2016-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-9-2016-09-29">6.0.9リリース - 2016-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-8-2016-08-29">6.0.8リリース - 2016-08-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-7-2016-07-29">6.0.7リリース - 2016-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-5-2016-06-29">6.0.5リリース - 2016-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-4-2016-06-06">6.0.4リリース - 2016-06-06</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-3-2016-05-29">6.0.3リリース - 2016-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-2-2016-04-29">6.0.2リリース - 2016-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-1-2016-03-29">6.0.1リリース - 2016-03-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/6.x.html#release-6-0-0-2016-02-29">6.0.0リリース - 2016-02-29</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/5.x.html">News - 5.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-1-2-2016-01-29">5.1.2リリース - 2016-01-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-1-1-2015-12-29">5.1.1リリース - 2015-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-1-0-2015-11-29">5.1.0リリース - 2015-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-9-2015-10-29">5.0.9リリース - 2015-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-8-2015-09-29">5.0.8リリース - 2015-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-7-2015-08-31">5.0.7リリース - 2015-08-31</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-6-2015-07-29">5.0.6リリース - 2015-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-5-2015-06-29">5.0.5リリース - 2015-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-4-2015-05-29">5.0.4リリース - 2015-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-3-2015-04-29">5.0.3リリース - 2015-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-2-2015-03-31">5.0.2リリース - 2015-03-31</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-1-2015-03-29">5.0.1リリース - 2015-03-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/5.x.html#release-5-0-0-2015-02-09">5.0.0リリース - 2015-02-09</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/4.x.html">News - 4.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-1-1-2015-01-29">4.1.1リリース - 2015-01-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-1-0-2015-01-09">4.1.0リリース - 2015-01-09</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-9-2014-12-29">4.0.9リリース - 2014-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-8-2014-11-29">4.0.8リリース - 2014-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-7-2014-10-29">4.0.7リリース - 2014-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-6-2014-09-29">4.0.6リリース - 2014-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-5-2014-08-29">4.0.5リリース - 2014-08-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-4-2014-07-29">4.0.4リリース - 2014-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-3-2014-06-29">4.0.3リリース - 2014-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-2-2014-05-29">4.0.2リリース - 2014-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-1-2014-03-29">4.0.1リリース - 2014-03-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/4.x.html#release-4-0-0-2014-02-09">4.0.0リリース - 2014-02-09</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/3.x.html">News - 3.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-1-2-2014-01-29">3.1.2リリース - 2014-01-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-1-1-2013-12-29">3.1.1リリース - 2013-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-1-0-2013-11-29">3.1.0リリース - 2013-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-9-2013-10-29">3.0.9リリース - 2013-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-8-2013-09-29">3.0.8リリース - 2013-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-7-2013-08-29">3.0.7リリース - 2013-08-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-6-2013-07-29">3.0.6リリース - 2013-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-5-2013-06-29">3.0.5リリース - 2013-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-4-2013-05-29">3.0.4リリース - 2013-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-3-2013-04-29">3.0.3リリース - 2013-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-2-2013-03-29">3.0.2リリース - 2013-03-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-1-2013-02-28">3.0.1リリース - 2013-02-28</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/3.x.html#release-3-0-0-2013-02-09">3.0.0リリース - 2013-02-09</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/2.x.html">News - 2.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-1-2-2013-01-29">2.1.2リリース - 2013-01-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-1-1-2012-12-29">2.1.1リリース - 2012-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-1-0-2012-12-29">2.1.0リリース - 2012-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-9-2012-11-29">2.0.9リリース - 2012-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-8-2012-10-29">2.0.8リリース - 2012-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-7-2012-09-29">2.0.7リリース - 2012-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-6-2012-08-29">2.0.6リリース - 2012-08-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-5-2012-07-29">2.0.5リリース - 2012-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-4-2012-06-29">2.0.4リリース - 2012-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-3-2012-05-29">2.0.3リリース - 2012-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-2-2012-04-29">2.0.2リリース - 2012-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-1-2012-03-29">2.0.1リリース - 2012-03-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/2.x.html#release-2-0-0-2012-02-29">2.0.0リリース - 2012-02-29</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/1.3.x.html">News - 1.3.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/1.3.x.html#release-1-3-0-2012-01-29">1.3.0リリース - 2012-01-29</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/1.2.x.html">News - 1.2.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-9-2011-12-29">1.2.9リリース - 2011-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-8-2011-11-29">1.2.8リリース - 2011-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-7-2011-10-29">1.2.7リリース - 2011-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-6-2011-09-29">1.2.6リリース - 2011-09-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-5-2011-08-29">1.2.5リリース - 2011-08-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-4-2011-07-29">1.2.4リリース - 2011-07-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-3-2011-06-29">1.2.3リリース - 2011-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#release-1-2-2-2011-05-29">1.2.2リリース - 2011-05-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#id20">1.2.1リリース - 2011-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.2.x.html#id24">1.2.0リリース - 2011-03-29</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/1.1.x.html">バージョン1.1.xのお知らせ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/1.1.x.html#id1">1.1.0リリース - 2011-02-09</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/1.0.x.html">バージョン1.0.xのお知らせ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id1">1.0.8リリース - 2011-02-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id4">1.0.7リリース - 2011-01-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id8">1.0.6リリース - 2010-12-31</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id11">1.0.5リリース - 2010-12-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id16">1.0.4リリース - 2010-11-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id21">1.0.3リリース - 2010-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id26">1.0.2リリース - 2010-09-09</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id31">1.0.1リリース - 2010-09-06</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/1.0.x.html#id35">1.0.0リリース - 2010-08-29</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/0.x.html">バージョン0.xのお知らせ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/0.x.html#id1">0.7.7リリース - 2010-08-25</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/0.x.html#id4">0.7.6リリース - 2010-08-19</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="news/senna.html">News in Senna period</a><ul>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#senna-groonga-2009-01-14">Senna -&gt; groonga - 2009-01-14</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id1">2006-04-05</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id2">2006-03-03</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id4">2006-01-16</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id5">2006-01-12</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id7">2005-12-22</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id9">2005-10-27</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id11">2005-09-17</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id13">2005-09-08</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id15">2005-08-16</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id17">2005-07-05</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id18">2005-06-23</a></li>
<li class="toctree-l2"><a class="reference internal" href="news/senna.html#id20">2005-04-12</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-13-0-2-2023-07-12">13.0.2リリース - 2023-07-12</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improvements">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixes">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thanks">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-13-0-1-2023-03-24">13.0.1リリース - 2023-03-24</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-13-0-0-2023-02-09">13.0.0リリース - 2023-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features-and-improvements-in-13-0-0">13.0.0の新規機能と改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#higlight-and-summary-of-changes-from-12-0-0-to-12-1-2">Groonga 12.0.0 から 12.1.2 までの主な変更点</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#higlight">ハイライト</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">概要</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-2-2023-01-29">12.1.2リリース - 2023-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-1-2023-01-06">12.1.1リリース - 2023-01-06</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-0-2022-11-29">12.1.0 リリース - 2022-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-9-2022-10-28">12.0.9リリース - 2022-10-28</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-8-2022-10-03">12.0.8リリース - 2022-10-03</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-7-2022-08-29">12.0.7リリース - 2022-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-6-2022-08-04">12.0.6リリース - 2022-08-04</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-5-2022-06-29">12.0.5リリース - 2022-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#known-issues">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-4-2022-06-06">12.0.4リリース - 2022-06-06</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-3-2022-04-29">12.0.3リリース - 2022-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-2-2022-03-29">12.0.2リリース - 2022-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-1-2022-02-28">12.0.1リリース - 2022-02-28</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">既知の問題</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-0-2022-02-09">12.0.0リリース - 2022-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-changes-from-groonga-11-0-0-to-11-1-3">Groonga 11.0.0 から 11.1.3 までの主な変更点</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features-and-improvements">新規機能と改良</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">修正</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#newly-supported-oses">新しくサポートしたOS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dropped-support-oses">サポートをやめたOS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">感謝</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-3-2022-01-29">11.1.3リリース - 2022-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-1-2021-12-29">11.1.1リリース - 2021-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id43">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id45">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id46">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-0-2021-11-29">11.1.0リリース - 2021-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id47">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id48">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id49">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id50">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-9-2021-11-04">11.0.9リリース - 2021-11-04</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id51">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id52">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id53">既知の問題</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-7-2021-09-29">11.0.7リリース - 2021-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id54">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id55">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-6-2021-08-29">11.0.6リリース - 2021-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-5-2021-07-29">11.0.5リリース - 2021-07-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-4-2021-06-29">11.0.4リリース - 2021-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id68">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-3-2021-05-29">11.0.3リリース - 2021-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id69">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-2-2021-05-10">11.0.2リリース - 2021-05-10</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-1-2021-03-31">11.0.1リリース - 2021-03-31</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-0-2021-02-09">11.0.0リリース - 2021-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-1-1-2021-01-25">10.1.1リリース - 2021-01-25</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-1-0-2020-12-29">10.1.0リリース - 2020-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-9-2020-12-01">10.0.9リリース - 2020-12-01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id89">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-8-2020-10-29">10.0.8リリース - 2020-10-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id90">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id92">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id93">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-7-2020-09-29">10.0.7リリース - 2020-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id94">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id95">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-6-2020-08-29">10.0.6リリース - 2020-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id96">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id97">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id98">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-5-2020-07-30">10.0.5リリース - 2020-07-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id99">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id100">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id101">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-4-2020-06-29">10.0.4リリース - 2020-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id102">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id103">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id104">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-3-2020-05-29">10.0.3リリース - 2020-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id105">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id106">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id107">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-2-2020-04-29">10.0.2リリース - 2020-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id108">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id109">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id110">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-1-2020-03-30">10.0.1リリース - 2020-03-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id111">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-0-2020-03-29">10.0.0リリース - 2020-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id112">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-1-2-2020-01-29">9.1.2リリース - 2020-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id113">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-1-1-2020-01-07">9.1.1リリース - 2020-01-07</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id114">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-1-0-2019-11-29">9.1.0リリース - 2019-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id115">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id116">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id117">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-9-2019-10-30">9.0.9リリース - 2019-10-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id118">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id119">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id120">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-8-2019-09-27">9.0.8リリース - 2019-09-27</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id121">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id122">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-7-2019-08-29">9.0.7リリース - 2019-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id123">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id124">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id125">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-6-2019-08-05">9.0.6リリース - 2019-08-05</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id126">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id127">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id128">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-5-2019-07-30">9.0.5リリース - 2019-07-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id129">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id130">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id131">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-4-2019-06-29">9.0.4リリース - 2019-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id132">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id133">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id134">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-3-2019-05-29">9.0.3リリース - 2019-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id135">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id136">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id137">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-2-2019-04-29">9.0.2リリース - 2019-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id138">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id139">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id140">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-1-2019-03-29">9.0.1リリース - 2019-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id141">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id142">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id143">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-9-0-0-2019-02-09">9.0.0リリース - 2019-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id144">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-1-1-2019-01-29">8.1.1リリース - 2019-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id145">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id146">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-1-0-2018-12-29">8.1.0リリース - 2018-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id147">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id148">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-9-2018-11-29">8.0.9リリース - 2018-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id149">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id150">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id151">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-8-2018-10-29">8.0.8リリース - 2018-10-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id152">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id153">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id154">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-7-2018-09-29">8.0.7リリース - 2018-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id155">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id156">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-6-2018-08-29">8.0.6リリース - 2018-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id157">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id158">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-5-2018-07-29">8.0.5リリース - 2018-07-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id159">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id160">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-4-2018-06-29">8.0.4リリース - 2018-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id161">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id162">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-3-2018-05-29">8.0.3リリース - 2018-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id163">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id164">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-2-2018-04-29">8.0.2リリース - 2018-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id165">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id166">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id167">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-1-2018-03-29">8.0.1リリース - 2018-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id168">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id169">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id170">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-8-0-0-2018-02-09">8.0.0リリース - 2018-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id171">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id172">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id173">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-1-1-2018-01-29">7.1.1リリース - 2018-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id174">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id175">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id176">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-1-0-2017-12-29">7.1.0リリース - 2017-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id177">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id178">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id179">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-9-2017-11-29">7.0.9リリース - 2017-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id180">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id181">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id182">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-8-2017-10-29">7.0.8リリース - 2017-10-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id183">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id184">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-7-2017-09-29">7.0.7リリース - 2017-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id185">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id186">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-6-2017-08-29">7.0.6リリース - 2017-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id187">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id188">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id189">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-5-2017-07-29">7.0.5リリース - 2017-07-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id190">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id191">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id192">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-4-2017-06-29">7.0.4リリース - 2017-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id193">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id194">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id195">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-3-2017-05-29">7.0.3リリース - 2017-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id196">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id197">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id198">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-2-2017-04-29">7.0.2リリース - 2017-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id199">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id200">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-1-2017-03-29">7.0.1リリース - 2017-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id201">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id202">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id203">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-7-0-0-2017-02-09">7.0.0リリース - 2017-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id204">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id205">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id206">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-old-releases">古いリリース</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2009-2023 Groonga Project.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>