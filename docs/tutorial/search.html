
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4.4. Various search conditions &#8212; Groonga v12.1.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://www.google-analytics.com/analytics.js"></script>
    <script>
                    window.ga = window.ga || function () {
                        (ga.q = ga.q || []).push(arguments) };
                    ga.l = +new Date;
                    ga('create', 'UA-7532323-1', 'auto');
                    ga('set', 'anonymizeIp', true);
                    ga('send', 'pageview');
                </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/search';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://groonga.org/docs/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'english';
        </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.5. Drilldown" href="drilldown.html" />
    <link rel="prev" title="4.3. Various data types" href="data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
   


<a class="navbar-brand logo" href="https://groonga.org/">

  
  
  
  
  
  
  

  
    <img src="../_static/groonga.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/groonga.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-toggle="dropdown">
        english  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-toggle="dropdown">
        english  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">4.1. Basic operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="network.html">4.2. Remote access</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">4.3. Various data types</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4.4. Various search conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="drilldown.html">4.5. Drilldown</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">4.6. Tag search and reverse resolution of reference relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="match_columns.html">4.7. match_columns parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="patricia_trie.html">4.8. Prefix search with patricia trie</a></li>
<li class="toctree-l1"><a class="reference internal" href="lexicon.html">4.9. Additional information about lexicon for full text search</a></li>
<li class="toctree-l1"><a class="reference internal" href="micro_blog.html">4.10. Let’s create micro-blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="query_expansion.html">4.11. Query expansion</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="various-search-conditions">
<h1><span class="section-number">4.4. </span>Various search conditions<a class="headerlink" href="#various-search-conditions" title="Permalink to this heading">#</a></h1>
<p>Groonga supports to narrow down by using syntax like JavaScript, sort by the calculated value. Additionally, Groonga also supports to narrow down &amp; sort search results by using location information (latitude &amp; longitude).</p>
<section id="narrow-down-full-text-search-by-using-syntax-like-javascript">
<h2><span class="section-number">4.4.1. </span>Narrow down &amp; Full-text search by using syntax like JavaScript<a class="headerlink" href="#narrow-down-full-text-search-by-using-syntax-like-javascript" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">select</span></code> command accepts the search condition.
There is one difference between <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter and <code class="docutils literal notranslate"><span class="pre">query</span></code> parameter, you need to specify the condition by syntax like JavaScript for <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;_id &lt;= 1&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_key</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;http://example.org/&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>See the detail of above query. Here is the condition which is specified as <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_id</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In this case, this query returns the records which meets the condition that the value of <code class="docutils literal notranslate"><span class="pre">_id</span></code> is equal to or less than 1.</p>
<p>Moreover, you can use <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> for AND search, <code class="docutils literal notranslate"><span class="pre">||</span></code> for OR search.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;_id &gt;= 4 &amp;&amp; _id &lt;= 6&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_key</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         4,</span>
<span class="c1">#         &quot;http://example.net/afr&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         5,</span>
<span class="c1">#         &quot;http://example.org/aba&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         6,</span>
<span class="c1">#         &quot;http://example.com/rab&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;_id &lt;= 2 || _id &gt;= 7&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_key</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         5</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;http://example.org/&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         2,</span>
<span class="c1">#         &quot;http://example.net/&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         7,</span>
<span class="c1">#         &quot;http://example.net/atv&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         8,</span>
<span class="c1">#         &quot;http://example.org/gat&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         9,</span>
<span class="c1">#         &quot;http://example.com/vdw&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>If you specify <code class="docutils literal notranslate"><span class="pre">query</span></code> parameter and <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter at the same time, you can get the records which meets both of the condition as a result.</p>
</section>
<section id="sort-by-using-scorer">
<h2><span class="section-number">4.4.2. </span>Sort by using <code class="docutils literal notranslate"><span class="pre">scorer</span></code><a class="headerlink" href="#sort-by-using-scorer" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> command accepts <code class="docutils literal notranslate"><span class="pre">scorer</span></code> parameter which is used to process each record of full-text search results.</p>
<p>This parameter accepts the conditions which is specified by syntax like JavaScript as same as <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;true&quot;</span> <span class="o">--</span><span class="n">scorer</span> <span class="s2">&quot;_score = rand()&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_key</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="n">_score</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         9</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         6,</span>
<span class="c1">#         &quot;http://example.com/rab&quot;,</span>
<span class="c1">#         424238335</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         9,</span>
<span class="c1">#         &quot;http://example.com/vdw&quot;,</span>
<span class="c1">#         596516649</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         7,</span>
<span class="c1">#         &quot;http://example.net/atv&quot;,</span>
<span class="c1">#         719885386</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         2,</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         846930886</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         8,</span>
<span class="c1">#         &quot;http://example.org/gat&quot;,</span>
<span class="c1">#         1649760492</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         3,</span>
<span class="c1">#         &quot;http://example.com/&quot;,</span>
<span class="c1">#         1681692777</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         4,</span>
<span class="c1">#         &quot;http://example.net/afr&quot;,</span>
<span class="c1">#         1714636915</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         1804289383</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         5,</span>
<span class="c1">#         &quot;http://example.org/aba&quot;,</span>
<span class="c1">#         1957747793</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;true&quot;</span> <span class="o">--</span><span class="n">scorer</span> <span class="s2">&quot;_score = rand()&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_key</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="n">_score</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         9</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         4,</span>
<span class="c1">#         &quot;http://example.net/afr&quot;,</span>
<span class="c1">#         783368690</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         2,</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         1025202362</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         5,</span>
<span class="c1">#         &quot;http://example.org/aba&quot;,</span>
<span class="c1">#         1102520059</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         1189641421</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         3,</span>
<span class="c1">#         &quot;http://example.com/&quot;,</span>
<span class="c1">#         1350490027</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         8,</span>
<span class="c1">#         &quot;http://example.org/gat&quot;,</span>
<span class="c1">#         1365180540</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         9,</span>
<span class="c1">#         &quot;http://example.com/vdw&quot;,</span>
<span class="c1">#         1540383426</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         7,</span>
<span class="c1">#         &quot;http://example.net/atv&quot;,</span>
<span class="c1">#         1967513926</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         6,</span>
<span class="c1">#         &quot;http://example.com/rab&quot;,</span>
<span class="c1">#         2044897763</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>‘_score’ is one of a pseudo column. The score of full-text search is assigned to it.
See <a class="reference internal" href="../reference/columns/pseudo.html"><span class="doc">Pseudo column</span></a> about ‘_score’ column.</p>
<p>In the above query, the condition of <code class="docutils literal notranslate"><span class="pre">scorer</span></code> parameter is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_score</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case, the score of full-text search is overwritten by the value of rand() function.</p>
<p>The condition of <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> parameter is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_score</span>
</pre></div>
</div>
<p>This means that sorting the search result by ascending order.</p>
<p>As a result, the order of search result is randomized.</p>
</section>
<section id="narrow-down-sort-by-using-location-information">
<h2><span class="section-number">4.4.3. </span>Narrow down &amp; sort by using location information<a class="headerlink" href="#narrow-down-sort-by-using-location-information" title="Permalink to this heading">#</a></h2>
<p>Groonga supports to store location information (Longitude &amp; Latitude) and not only narrow down but also sort by using it.</p>
<p>Groonga supports two kind of column types to store location information. One is <code class="docutils literal notranslate"><span class="pre">TokyoGeoPoint</span></code>, the other is <code class="docutils literal notranslate"><span class="pre">WGS84GeoPoint</span></code>. <code class="docutils literal notranslate"><span class="pre">TokyoGeoPoint</span></code> is used for Japan geodetic system. <code class="docutils literal notranslate"><span class="pre">WGS84GeoPoint</span></code> is used for world geodetic system.</p>
<p>Specify longitude and latitude as follows:</p>
<ul class="simple">
<li><p>“[latitude in milliseconds]x[longitude in milliseconds]”（e.g.: “128452975x503157902”）</p></li>
<li><p>“[latitude in milliseconds],[longitude in milliseconds]”（e.g.: “128452975,503157902”）</p></li>
<li><p>“[latitude in degrees]x[longitude in degrees]”（e.g.: “35.6813819x139.7660839”）</p></li>
<li><p>“[latitude in degrees],[longitude in degrees]”（e.g.: “35.6813819,139.7660839”）</p></li>
</ul>
<p>Let’s store two location information about station in Japan by WGS. One is Tokyo station, the other is Shinjyuku station. Both of them are station in Japan. The latitude of Tokyo station is 35 degrees 40 minutes 52.975 seconds, the longitude of Tokyo station is 139 degrees 45 minutes 57.902 seconds. The latitude of Shinjyuku station is  35 degrees 41 minutes  27.316 seconds, the longitude of Shinjyuku station is 139 degrees 42 minutes 0.929 seconds. Thus, location information in milliseconds are “128452975x503157902” and “128487316x502920929” respectively. location information in degrees are  “35.6813819x139.7660839” and “35.6909211x139.7002581” respectively.</p>
<p>Let’s register location information in milliseconds.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="n">name</span> <span class="n">location</span> <span class="o">--</span><span class="nb">type</span> <span class="n">WGS84GeoPoint</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span>
<span class="p">[</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.org/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128452975x503157902&quot;</span><span class="p">}</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.net/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128487316x502920929&quot;</span><span class="p">},</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 2]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;_id:1 OR _id:2&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         &quot;128487316x502920929&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>Then assign the value of geo distance which is calculated by <a class="reference internal" href="../reference/functions/geo_distance.html"><span class="doc">geo_distance</span></a> function to <code class="docutils literal notranslate"><span class="pre">scorer</span></code> parameter.</p>
<p>Let’s show geo distance from Akihabara station in Japan. In world geodetic system, the latitude of Akihabara station is  35 degrees 41 minutes 55.259 seconds, the longitude of Akihabara station is 139 degrees 46 minutes 27.188 seconds. Specify “128515259x503187188” for geo_distance function.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;_id:1 OR _id:2&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">scorer</span> <span class="s1">&#39;_score = geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;,</span>
<span class="c1">#         2054</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         &quot;128487316x502920929&quot;,</span>
<span class="c1">#         6720</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>As you can see, the geo distance between Tokyo station and Akihabara station is 2054 meters, the geo distance between Akihabara station and Shinjyuku station is 6720 meters.</p>
<p>The return value of geo_distance function is also used for sorting by specifying pseudo <code class="docutils literal notranslate"><span class="pre">_score</span></code> column to <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> parameter.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;_id:1 OR _id:2&quot;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">scorer</span> <span class="s1">&#39;_score = geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         &quot;128487316x502920929&quot;,</span>
<span class="c1">#         6720</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;,</span>
<span class="c1">#         2054</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>Groonga also supports to narrow down by “a certain point within specified meters”.</p>
<p>In such a case, use <a class="reference internal" href="../reference/functions/geo_in_circle.html"><span class="doc">geo_in_circle</span></a> function in <code class="docutils literal notranslate"><span class="pre">filter</span></code> parameter.</p>
<p>For example, search the records which exists within 5000 meters from Akihabara station.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Site</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(location, &quot;128515259x503187188&quot;, 5000)&#39;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>There is <a class="reference internal" href="../reference/functions/geo_in_rectangle.html"><span class="doc">geo_in_rectangle</span></a> function which is used to search a certain point within specified region.</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="data.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title"><span class="section-number">4.3. </span>Various data types</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="drilldown.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title"><span class="section-number">4.5. </span>Drilldown</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#narrow-down-full-text-search-by-using-syntax-like-javascript">
   4.4.1. Narrow down &amp; Full-text search by using syntax like JavaScript
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sort-by-using-scorer">
   4.4.2. Sort by using
   <code class="docutils literal notranslate">
    <span class="pre">
     scorer
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#narrow-down-sort-by-using-location-information">
   4.4.3. Narrow down &amp; sort by using location information
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://github.com/groonga/groonga/edit/master/doc/source/tutorial/search.rst">
        <i class="fa-solid fa-pencil"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2009-2022 Groonga Project.<br>

</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
  </footer>
  </body>
</html>