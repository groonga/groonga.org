
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.6. Tag search and reverse resolution of reference relationships &#8212; Groonga v12.0.0 documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.7. match_columns parameter" href="match_columns.html" />
    <link rel="prev" title="4.5. Drilldown" href="drilldown.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-7532323-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="https://groonga.org/">
  <img src="../_static/groonga.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/groonga/groonga" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/groonga" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog" rel="noopener" target="_blank" title="Blog"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        English  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorial/index and {'json_url': 'https://groonga.org/docs/_static/switcher.json', 'url_template': 'https://groonga.org/{version}docs/', 'version_match': 'English'}.
-->

<script type="text/javascript">
// Construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://groonga.org/{version}docs/";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorial/index.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://groonga.org/docs/_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorial/index.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            // get the base URL for that doc version, add the current page's
            // path to it, and set as `href`
            entry.url = buildURL(entry);
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 12.0.0 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "English") {
                node.classList.add("active");
                $("#version_switcher_button").text(entry.name);
            }
        });
    });
})();
</script>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   4.1. Basic operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="network.html">
   4.2. Remote access
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data.html">
   4.3. Various data types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="search.html">
   4.4. Various search conditions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="drilldown.html">
   4.5. Drilldown
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4.6. Tag search and reverse resolution of reference relationships
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="match_columns.html">
   4.7. match_columns parameter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="patricia_trie.html">
   4.8. Prefix search with patricia trie
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lexicon.html">
   4.9. Additional information about lexicon for full text search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="micro_blog.html">
   4.10. Let’s create micro-blog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="query_expansion.html">
   4.11. Query expansion
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tag-search">
   4.6.1. Tag search
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reverse-resolution-of-reference-relationships">
   4.6.2. Reverse resolution of reference relationships
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geo-location-search-with-index">
   4.6.3. Geo location search with index
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/groonga/groonga/edit/master/doc/source/tutorial/index.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="tag-search-and-reverse-resolution-of-reference-relationships">
<h1><span class="section-number">4.6. </span>Tag search and reverse resolution of reference relationships<a class="headerlink" href="#tag-search-and-reverse-resolution-of-reference-relationships" title="Permalink to this headline">¶</a></h1>
<p>As you know, Groonga supports to store array in column which refers other table.
In fact, you can do tag search by using array data which refers other table.</p>
<p>Tag search is very fast because Groonga use inverted index as data structure.</p>
<div class="section" id="tag-search">
<h2><span class="section-number">4.6.1. </span>Tag search<a class="headerlink" href="#tag-search" title="Permalink to this headline">¶</a></h2>
<p>Let’s consider to create a search engine for an web site to share movies. Each movie may be associated with multiple keywords which represents the content of movie.</p>
<p>Let’s create tables for movie information, then search the movies.</p>
<p>First, create the <code class="docutils literal notranslate"><span class="pre">Video</span></code> table which stores movie information. the <code class="docutils literal notranslate"><span class="pre">Video</span></code> table has two columns. the <code class="docutils literal notranslate"><span class="pre">title</span></code> column stores title of the movie. the <code class="docutils literal notranslate"><span class="pre">tags</span></code> column stores multiple tag information in reference Tag table.</p>
<p>Next, create the <code class="docutils literal notranslate"><span class="pre">Tag</span></code> table which stores tag information. the <code class="docutils literal notranslate"><span class="pre">Tag</span></code> table has one column. The tag string is stored as primary key, then <code class="docutils literal notranslate"><span class="pre">index_tags</span></code> stores indexes for tags column of Video table.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Video</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">UInt32</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Tag</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">name</span> <span class="n">title</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">name</span> <span class="n">tags</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Tag</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tag</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_tags</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Video</span> <span class="o">--</span><span class="n">source</span> <span class="n">tags</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Soccer 2010&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Sports&quot;</span><span class="p">,</span><span class="s2">&quot;Soccer&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Zenigata Kinjirou&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Variety&quot;</span><span class="p">,</span><span class="s2">&quot;Money&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;groonga Demo&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;IT&quot;</span><span class="p">,</span><span class="s2">&quot;Server&quot;</span><span class="p">,</span><span class="s2">&quot;groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Moero!! Ultra Baseball&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Sports&quot;</span><span class="p">,</span><span class="s2">&quot;Baseball&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Hex Gone!&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Variety&quot;</span><span class="p">,</span><span class="s2">&quot;Quiz&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Pikonyan 1&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Pikonyan&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Draw 8 Month&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Raccoon&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;K.O.&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Music&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 8]</span>
</pre></div>
</div>
<p>After creating indexed column, you can do full-text search very fast. The indexed column is also automatically updated when stored data is refreshed.</p>
<p>List up the movies that specific keywords are given.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Variety</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         2,</span>
<span class="c1">#         &quot;Zenigata Kinjirou&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         5,</span>
<span class="c1">#         &quot;Hex Gone!&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Sports</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Soccer 2010&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         4,</span>
<span class="c1">#         &quot;Moero!! Ultra Baseball&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Animation</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         6,</span>
<span class="c1">#         &quot;Pikonyan 1&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         7,</span>
<span class="c1">#         &quot;Draw 8 Month&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         8,</span>
<span class="c1">#         &quot;K.O.&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>You can search by tags such as “Variety”, “Sports” and “Animation”.</p>
</div>
<div class="section" id="reverse-resolution-of-reference-relationships">
<h2><span class="section-number">4.6.2. </span>Reverse resolution of reference relationships<a class="headerlink" href="#reverse-resolution-of-reference-relationships" title="Permalink to this headline">¶</a></h2>
<p>Groonga supports indexes for reverse resolution among tables. Tag search is one of concrete examples.</p>
<p>For example, you can search friendships by reverse resolution in social networking site.</p>
<p>Following example shows how to create <code class="docutils literal notranslate"><span class="pre">User</span></code> table which stores user information, <code class="docutils literal notranslate"><span class="pre">username</span></code> column which stores user name, <code class="docutils literal notranslate"><span class="pre">friends</span></code> column which stores list of user’s friends in array, <code class="docutils literal notranslate"><span class="pre">index_friends</span></code> column as indexed column.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">User</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">username</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">friends</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">User</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_friends</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="nb">type</span> <span class="n">User</span> <span class="o">--</span><span class="n">source</span> <span class="n">friends</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;健作&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">,</span><span class="s2">&quot;moritapo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;moritapo&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;森田&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;ぐるんが太郎&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;ぐるんが次郎&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;tomo&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;トモちゃん&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;hana&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;hana&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;花子&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;moritapo&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 6]</span>
</pre></div>
</div>
<p>Let’s show list of users who contains specified user in friend list.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">query</span> <span class="n">friends</span><span class="p">:</span><span class="nd">@tomo</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">username</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         5</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         &quot;健作&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         &quot;ぐるんが太郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;jiro&quot;,</span>
<span class="c1">#         &quot;ぐるんが次郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;moritapo&quot;,</span>
<span class="c1">#         &quot;森田&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         &quot;花子&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">query</span> <span class="n">friends</span><span class="p">:</span><span class="nd">@jiro</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">username</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         &quot;健作&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         &quot;ぐるんが太郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         &quot;花子&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>Then drilldown the count which shows user is listed as friend.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span> <span class="o">--</span><span class="n">drilldown</span> <span class="n">friends</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         6</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;friends&quot;,</span>
<span class="c1">#           &quot;User&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;index_friends&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         6</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_nsubrecs&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;jiro&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;tomo&quot;,</span>
<span class="c1">#         5</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;moritapo&quot;,</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         1</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>As you can see, it shows the results which follows reverse resolution of reference relationship.</p>
</div>
<div class="section" id="geo-location-search-with-index">
<h2><span class="section-number">4.6.3. </span>Geo location search with index<a class="headerlink" href="#geo-location-search-with-index" title="Permalink to this headline">¶</a></h2>
<p>Groonga supports to add indexes to the column which stores geo location information.
Groonga is very fast because it use such indexes against the column which contains geo location information to search enormous number of records.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">name</span> <span class="n">location</span> <span class="o">--</span><span class="nb">type</span> <span class="n">WGS84GeoPoint</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">GeoIndex</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">WGS84GeoPoint</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoIndex</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_point</span> <span class="o">--</span><span class="nb">type</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="n">source</span> <span class="n">location</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span>
<span class="p">[</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.org/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128452975x503157902&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.net/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128487316x502920929&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 2]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(location, &quot;128515259x503187188&quot;, 5000)&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>These indexes are also used when sorting the records with geo location search.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(location, &quot;128515259x503187188&quot;, 50000)&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;-geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span> <span class="o">--</span><span class="n">scorer</span> <span class="s1">&#39;_score = geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;,</span>
<span class="c1">#         2054</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         &quot;128487316x502920929&quot;,</span>
<span class="c1">#         6720</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="drilldown.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">4.5. </span>Drilldown</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="match_columns.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4.7. </span>match_columns parameter</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2009-2022 Groonga Project.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>